/*!CK:1050139755!*//*1379642724,180639547*/

if (self.CavalryLogger) { CavalryLogger.start_js(["eUDzJ"]); }

__d("BuddyListNub",["Arbiter","AvailableList","BlackbirdUpsell","ChannelConnection","ChannelConstants","ChatConfig","ChatSidebar","ChatVisibility","CSS","Dock","DOM","Event","HTML","JSXDOM","KeyEventController","Keys","NubController","OrderedFriendsList","Parent","PresencePrivacy","Toggler","csx","cx","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('BlackbirdUpsell'),j=b('ChannelConnection'),k=b('ChannelConstants'),l=b('ChatConfig'),m=b('ChatSidebar'),n=b('ChatVisibility'),o=b('CSS'),p=b('Dock'),q=b('DOM'),r=b('Event'),s=b('HTML'),t=b('JSXDOM'),u=b('KeyEventController'),v=b('Keys'),w=b('NubController'),x=b('OrderedFriendsList'),y=b('Parent'),z=b('PresencePrivacy'),aa=b('Toggler'),ba=b('csx'),ca=b('cx'),da=b('tx'),ea=32,fa=10;for(var ga in w)if(w.hasOwnProperty(ga))ia[ga]=w[ga];var ha=w===null?null:w.prototype;ia.prototype=Object.create(ha);ia.prototype.constructor=ia;ia.__superConstructor__=w;function ia(ja,ka,la){w.call(this);ha.init.call(this,ja);this.root=ja;this.orderedList=ka;this.typeahead=la;this.button=q.find(ja,'a.fbNubButton');this.unreadCount=q.find(ja,"span._5ayx");this.label=q.find(ja,'span.label');this.body=q.scry(ja,'div.fbNubFlyoutBody')[0];this.container=y.byClass(ja,"_56ox");var ma=q.find(ja,'div.fbNubFlyoutTitlebar');aa.createInstance(ma).setSticky(false);ka.subscribe('render',this.flyoutContentChanged.bind(this));ka.setScrollContainer(this.body);h.subscribe('buddylist/availability-changed',this._updateCount.bind(this));g.subscribe('chat/connect',this._handleConnect.bind(this));z.subscribe('privacy-user-presence-changed',this._handleVisibilityChange.bind(this));this.message=q.find(ja,"div._4mq1");this.warningMsgText=null;this.warningMsgEventListener=null;this.showWarningTimeout=null;j.subscribe(j.CONNECTED,this._handleChannelConnected.bind(this));j.subscribe(j.SHUTDOWN,this._handleChannelShutdown.bind(this));j.subscribe(j.RECONNECTING,this._handleChannelReconnecting.bind(this));j.subscribe([j.MUTE_WARNING,j.UNMUTE_WARNING],this._updateView.bind(this));this.subscribe('show',this.onShow.bind(this));this.subscribe('hide',this.onHide.bind(this));this.subscribe('resize',this.onResize.bind(this));r.listen(ja,'keydown',this._onKeyDown.bind(this));r.listen(this.button,'click',this.onButtonClick.bind(this));u.registerKey('q',function(event){if(this._isOpen){la.getCore().getElement().focus();}else{this.onButtonClick();this.show();}event.prevent();}.bind(this));la.getCore().subscribe('escape',this.hide.bind(this));la.subscribe(['respond','reset'],function(na,oa){if(this._isOpen){var pa=this.orderedList.isVisible();if(oa&&oa.value&&oa.value===la.getCore().getValue()&&la.getView().isVisible()){p.setUseMaxHeight(this.root,false);this.orderedList.hide();}else this._showBuddyList();if(pa!==this.orderedList.isVisible())this.flyoutContentChanged();}}.bind(this));g.subscribe('sidebar/show',this.hide.bind(this));g.subscribe('sidebar/hide',this._onSidebarHide.bind(this));if(l.get('litestand_buddylist_count')){this._unreadMessageCount=0;g.subscribe('buddylist-nub/updateCount',function(na,oa){if(this._unreadMessageCount!==oa.count){this._unreadMessageCount=oa.count;this._updateView();}}.bind(this));}this._orderedListCount=x.getList().length;g.inform('buddylist-nub/initialized',this,g.BEHAVIOR_PERSISTENT);this._handleVisibilityChange();}ia.prototype.getButton=function(){return this.button;};ia.prototype.getRoot=function(){return this.root;};ia.prototype._handleConnect=function(ja){this._updateView(true);};ia.prototype._getShutdownReason=function(ja){switch(ja){case k.HINT_AUTH:return "Your session has timed out. Please log in.";case k.HINT_CONN:return da._("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});case k.HINT_MAINT:return da._("Facebook {Chat} is currently down for maintenance.",{Chat:"Chat"});default:return da._("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});}};ia.prototype._getReconnectMsg=function(ja){var ka;if(ja===null){ka="Unable to connect to chat. Check your Internet connection.";}else if(ja>l.get('warning_countdown_threshold_msec')){var la=q.create('a',{href:'#',className:'fbChatReconnectLink'},"Try again"),ma=q.create('div',null,la),na=ma.innerHTML;ka=s(da._("Unable to connect to chat. {try-again-link}",{'try-again-link':na}));}else if(ja>1000){ka=da._("Unable to connect to chat. Reconnecting in {seconds}...",{seconds:Math.floor(ja/1000)});}else ka="Unable to connect to chat. Reconnecting...";return ka;};ia.prototype._resetShowWarningTimeout=function(){if(this.showWarningTimeout){clearTimeout(this.showWarningTimeout);this.showWarningTimeout=null;}};ia.prototype._handleChannelConnected=function(ja){this._resetShowWarningTimeout();if(this.orderedList.isVisible())n.goOnline();this.warningMsgText=null;this._updateView();};ia.prototype._handleChannelShutdown=function(ja,ka){this._resetShowWarningTimeout();this.warningMsgText=this._getShutdownReason(ka);this._updateView();};ia.prototype._handleChannelReconnecting=function(ja,ka){this._resetShowWarningTimeout();this.warningMsgText=this._getReconnectMsg(ka);if(ka>1000){if(ka>l.get('warning_countdown_threshold_msec')){if(this.warningMsgEventListener){this.warningMsgEventListener.remove();this.warningMsgEventListener=null;}this.warningMsgEventListener=r.listen(this.message,'click',function(event){if(o.hasClass(event.getTarget(),'fbChatReconnectLink')){this._tryReconnect();event.kill();}}.bind(this));}this.showWarningTimeout=setTimeout(this._handleChannelReconnecting.bind(this,ja,ka-1000),1000,false);}this._updateView();};ia.prototype._tryReconnect=function(){if(j.disconnected())j.reconnect();};ia.prototype._handleVisibilityChange=function(){this._updateView();if(i.shouldShow()){if(n.hasBlackbirdEnabled()){i.showBlackbirdDialog(this.getButton(),z.getVisibility());}else if(!n.isOnline())i.showOfflineDialog(this.getButton());}else i.hide();if(!n.isOnline())this.hide();};ia.prototype._updateView=function(ja){var ka=this.container;if(ka){o.conditionClass(ka,'offline',!n.isOnline());o.conditionClass(ka,'error',j.disconnected());}if(j.disconnected())q.setContent(this.message,this.warningMsgText);var la,ma;if(!n.isOnline()){la=da._("{Chat} (Off)",{Chat:"Chat"});}else if(j.disconnected()){la=da._("{Chat} (Disconnected)",{Chat:"Chat"});}else{var na=h.getOnlineCount();if(na){la=da._("{Chat} {number-available}",{Chat:"Chat",'number-available':t.span({className:"count"}," (",t.strong(null,na),") ")});}else{la="Chat";ma=true;}}this._setUnread(this._unreadMessageCount);this._setLabel(la,ma);this.buttonContentChanged();};ia.prototype.onButtonClick=function(){this._conditionallyShowTypeahead();if(o.shown(this.typeahead.getElement())){var ja=this.subscribe('show',function(){this.typeahead.getCore().getElement().focus();i.dismiss();}.bind(this));this.unsubscribe.bind(this,ja).defer();}};ia.prototype.onHide=function(){this._isOpen=false;if(this._buddyListRenderSubscription){this.orderedList.unsubscribe(this._buddyListRenderSubscription);this._buddyListRenderSubscription=null;}this.orderedList.hide();this.typeahead.getCore().reset();};ia.prototype._onKeyDown=function(event){var ja=r.getKeyCode(event);if(ja===v.ESC&&!o.hasClass(this.root,'menuOpened')){this.hide();return false;}else if(ja==v.RETURN)m.enable();};ia.prototype._onSidebarHide=function(event){this.getButton().focus();};ia.prototype.onResize=function(){var ja=p.getMaxFlyoutHeight(this.root)-60,ka=Math.max(250,ja);this.orderedList.setNumTopFriends(Math.floor(ka/ea));};ia.prototype._showBuddyList=function(){if(!this._buddyListRenderSubscription)this._buddyListRenderSubscription=this.orderedList.subscribe('render',p.setUseMaxHeight.bind(p,this.root,false));this.orderedList.show();};ia.prototype.onShow=function(){this._isOpen=true;if(j.disconnected()){this._tryReconnect();this._showBuddyList();}else n.goOnline(this._showBuddyList.bind(this));};ia.prototype._setLabel=function(ja,ka){var la=this.label.cloneNode(true);q.setContent(la,ja);q.replace(this.label,la);this.label=la;this.throbber&&o.conditionShow(this.throbber,!!ka);};ia.prototype._setUnread=function(ja){o.conditionShow(this.unreadCount,!!ja);if(ja){ja=t.span({className:"_51jx _5ayw"},ja);q.setContent(this.unreadCount,ja);}};ia.prototype._conditionallyShowTypeahead=function(){o.conditionShow(this.typeahead.getElement(),this._orderedListCount>=fa);};ia.prototype._updateCount=function(){this._updateView();this._conditionallyShowTypeahead();};e.exports=ia;});
__d("LiveBarData",["function-extensions","Arbiter","ArbiterMixin","AsyncRequest","ChannelConstants","LayerDestroyOnHide","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AsyncRequest'),j=b('ChannelConstants'),k=b('LayerDestroyOnHide'),l=b('copyProperties'),m=b('setTimeoutAcrossTransitions'),n=false,o={},p={},q={};function r(y){if((y.expires*1000)-Date.now()>0)return true;return false;}function s(y){var z=y.payload.actions;if(!(z&&z.length))return;var aa;for(var ba=0;ba<z.length;ba++){aa=z[ba].actor_id;if(!o[aa]||z[ba].action_id!=o[aa].action_id)continue;if(z[ba].delete_action||z[ba].remove){v(z[ba]);continue;}}}function t(y){var z=false;for(var aa=0;aa<y.length;aa++){if(y[aa].delete_action||y[aa].remove){v(y[aa]);continue;}var ba=y[aa].actor_id,ca=y[aa].action_id;if(o[ba]){if(o[ba].action_id==ca)continue;v(o[ba]);}z=true;o[ba]=y[aa];u(y[aa]);}if(z)x.inform('new-actions');}function u(y){var z=(y.expires*1000)-Date.now();p[y.actor_id]=m(v.curry(y),Math.max(0,z));}function v(y){if(!o[y.actor_id])return;if(o[y.actor_id].action_id!=y.action_id)return;delete o[y.actor_id];var z=y.actor_id;if(p[z]){clearTimeout(p[z]);delete p[z];}w(z);x.inform('remove-action',y);}function w(y){var z=q[y];if(z){z.enableBehavior(k);if(!z.isShown())z.destroy();delete q[y];}}g.subscribe(j.getArbiterType('livebar_update'),function(y,z){t(z.obj.actions);});var x={};l(x,h,{fetch:function(){if(n)return;var y=[];for(var z in o){var aa=o[z];if(aa.suppress_callout)continue;if(!q[aa.actor_id])y.push(o[z]);}if(y.length>0){n=true;new i().setURI('/ajax/chat/livebar.php').setData({actions:y}).setHandler(s).setFinallyHandler(function(){n=false;}).setAllowCrossPageTransition(true).send();}},addActions:t,getAction:function(y){var z=o[y];if(z&&r(z))return z;return null;},getDialog:function(y){var z=this.getAction(y);if(z&&q[z.actor_id])return q[z.actor_id];return null;},setDialog:function(y,z,aa){var ba=o[y];if(ba&&ba.action_id==z){w(y);q[y]=aa;x.inform('dialog-fetched',y);}}});e.exports=x;});
__d("LiveBar",["ChatOrderedList","function-extensions","LegacyContextualDialog","ChatConfig","CSS","LiveBarData","copyProperties","setTimeoutAcrossTransitions","shield"],function(a,b,c,d,e,f){b('ChatOrderedList');b('function-extensions');b('LegacyContextualDialog');var g=b('ChatConfig'),h=b('CSS'),i=b('LiveBarData'),j=b('copyProperties'),k=b('setTimeoutAcrossTransitions'),l=b('shield'),m=g.get('livebar_fetch_defer')||1000;function n(o,p,q){this._orderedList=o;this._root=o.getRoot();this._liveBarTypes=q;this._hoverController=o.getHoverController();this._hoverController.subscribe('hover',this._mouseMove.bind(this));this._hoverController.subscribe('leave',this._mouseLeave.bind(this));o.subscribe('render',l(this._handleChatListUpdate,this));i.subscribe('new-actions',this._updateIcons.bind(this));i.subscribe('remove-action',this._handleRemoveAction.bind(this));i.subscribe('dialog-fetched',function(r,s){this._setDialogContent(s);}.bind(this));i.addActions(p);}n.prototype._getLiveBarTypes=function(){return this._liveBarTypes;};n.prototype._handleChatListUpdate=function(){if(!this._chatListRendered){this._chatListRendered=true;this._updateIcons();}};n.prototype._handleShow=function(o){this._setDialogContent(o);};n.prototype._mouseMove=function(){if(!this._fetchTimer){this._fetchTimer=k(this._fetch.bind(this),m);this._mouseLeftRoot=false;}};n.prototype._mouseLeave=function(){this._mouseLeftRoot=true;clearTimeout(this._fetchTimer);this._fetchTimer=null;};n.prototype._setDialogContent=function(o){var p=i.getDialog(o);if(p)this._hoverController.showHovercard(o,p);};n.prototype._fetch=function(){if(this._mouseLeftRoot)return;this._fetchTimer=null;i.fetch();};n.prototype._updateIcons=function(){if(!this._chatListRendered)return;var o=this._orderedList.getAllNodes(),p=this._getLiveBarTypes();for(var q in o){var r=i.getAction(q);if(r&&(!this._renderedIcons[q]||this._renderedIcons[q]!=r.action_id)){for(var s=0;s<p.length;s++)h.removeClass(o[q],p[s]);h.addClass(o[q],r.livebar_type);this._renderedIcons[q]=r.action_id;var t=this._hoverController.register(q,this._handleShow.bind(this));if(t)this._registrations[q]=t;}}};n.prototype._handleRemoveAction=function(o,p){var q=p.action_id,r=p.actor_id;this._registrations[r]&&this._registrations[r].unregister();delete this._registrations[r];if(this._renderedIcons[r]==q){var s=this._getLiveBarTypes(),t=this._orderedList.getAllNodes();if(t[r])for(var u=0;u<s.length;u++)h.removeClass(t[r],s[u]);delete this._renderedIcons[r];}};n.setDialog=function(o,p,q){i.setDialog(o,p,q);};j(n.prototype,{_root:null,_liveBarTypes:null,_hoverController:null,_registrations:{},_renderedIcons:{},_fetchTimer:null,_mouseLeftRoot:false,_chatListRendered:false});e.exports=n;});
__d("LiveBarDark",["LiveBar","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('LiveBar'),h=b('copyProperties'),i=b('emptyFunction');for(var j in g)if(g.hasOwnProperty(j))l[j]=g[j];var k=g===null?null:g.prototype;l.prototype=Object.create(k);l.prototype.constructor=l;l.__superConstructor__=g;function l(){if(g!==null)g.apply(this,arguments);}h(l.prototype,{_setupDialogContent:i,_show:i,_updateIcons:i,_handleRemoveAction:i,_handleChatListUpdate:i});e.exports=l;});
__d("ChatSidebarDropdown",["Arbiter","AsyncRequest","Chat","ChatOptions","ChatVisibility","CSS","DOM","Event","JSLogger","PresenceState","SelectorDeprecated"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('Chat'),j=b('ChatOptions'),k=b('ChatVisibility'),l=b('CSS'),m=b('DOM'),n=b('Event'),o=b('JSLogger'),p=b('PresenceState'),q=b('SelectorDeprecated');function r(s,t){this._root=s;this._logger=o.create('blackbird');this._displayBrowserNotificationsIfNeeded();q.listen(s,'select',this._onSelect.bind(this));q.listen(s,'toggle',this._onToggle.bind(this));if(t){q.listen(s,'close',t.allowCollapse.curry(true,'SidebarMenu'));q.listen(s,'open',t.allowCollapse.curry(false,'SidebarMenu'));}g.subscribe('chat/option-changed',this._onOptionChanged.bind(this));}r.prototype.changeSetting=function(s,t){if(this._pendingChange)return false;this._pendingChange=true;var u={};u[s]=t;j.setSetting(s,t,'sidebar_menu');new h('/ajax/chat/settings.php').setHandler(this._onChangeSettingResponse.bind(this,s,t)).setErrorHandler(this._onChangeSettingError.bind(this,s,t)).setFinallyHandler(this._onChangeFinally.bind(this)).setData(u).setAllowCrossPageTransition(true).send();};r.prototype._displayBrowserNotificationsIfNeeded=function(){if(window.webkitNotifications){m.scry(document,'li.sidebar-browser-notif').forEach(l.show);if(window.webkitNotifications.checkPermission()!==0)m.scry(document,'li.sidebar-browser-notif').forEach(function(s){l.removeClass(s,'checked');});}};r.prototype._conditionEnabled=function(s,t){var u=q.getOption(this._root,s);u&&q.setOptionEnabled(u,t);};r.prototype._onChangeSettingResponse=function(s,t,u){p.doSync();};r.prototype._onChangeSettingError=function(s,t,u){j.setSetting(s,!t,'sidebar_menu_error');};r.prototype._onChangeFinally=function(){this._pendingChange=false;};r.prototype._onOptionChanged=function(s,t){var u=t.name,v=t.value;if(u==='sound'||u==='browser_notif'){var w=q.getOption(this._root,u);if(v!==q.isOptionSelected(w))q.setSelected(this._root,u,v);}};r.prototype._onSelect=function(s){if(this._pendingChange)return false;var t=false,u=false,v=q.getOptionValue(s.option);switch(v){case 'sidebar':return this.toggleSidebar();case 'online':if(!k.isOnline()){k.goOnline();}else u=true;t=true;break;case 'offline':if(k.isOnline()){k.goOffline();}else u=true;t=true;break;case 'advanced_settings':case 'turn_off_dialog':g.inform('chat/advanced-settings-dialog-opened');t=true;break;}if(u){this._logger.error('sidebar_dropdown_visibility_error',{action:v});}else this._logger.log('sidebar_dropdown_set_visibility',{action:v});if(t){q.toggle(this._root);return false;}};r.prototype._onToggle=function(s){if(this._pendingChange)return false;var t=q.getOptionValue(s.option),u=q.isOptionSelected(s.option);switch(t){case 'visibility':if(!k){this._jslogger.error('on_toggle_visibility_undefined');return;}k.toggleVisibility();this._logger.log('sidebar_dropdown_toggle_visibility',{available:u});break;case 'browser_notif':if(u&&window.webkitNotifications&&window.webkitNotifications.checkPermission()!==0){window.webkitNotifications.requestPermission(function(){this.changeSetting(t,u);}.bind(this));}else this.changeSetting(t,u);break;case 'sound':this.changeSetting(t,u);break;}q.toggle(this._root);};r.prototype._onVisibilityChanged=function(){var s=k.isOnline(),t=q.getOption(this._root,'visibility');if(s!==q.isOptionSelected(t))q.setSelected(this._root,'visibility',s);};r.prototype.toggleSidebar=function(){i.toggleSidebar();q.toggle(this._root);return false;};r.registerEditFavorites=function(s,t,u,v){function w(x){l.conditionShow(s,!x);l.conditionShow(t,x);}n.listen(s,'click',function(){u.toggleEditMode();w(true);q.toggle(v);});n.listen(t,'click',function(){u.toggleEditMode();w(false);q.toggle(v);});u.subscribe('editStart',w.curry(true));u.subscribe('editEnd',w.curry(false));};e.exports=r;});
__d("ChatSidebarLog",["AsyncSignal","Bootloader","ModuleDependencies","JSLogger","Run"],function(a,b,c,d,e,f){var g=b('AsyncSignal'),h=b('Bootloader'),i=b('ModuleDependencies'),j=b('JSLogger'),k=b('Run'),l=j.create('chat_sidebar_load'),m=null,n=false,o=(Math.random()*2147483648|0).toString(36),p=Date.now();k.onLoad(function(){n=true;});try{d(['ChatSidebar'],function(u){m=u;});}catch(q){l.warn('exception',{reason:q.toString()});}function r(u,v){if(u.length>v)return u[v];return null;}function s(u){setTimeout(function(){var v=i.getMissing('ChatSidebar'),w=h.getErrorUrls(),x=h.getLoadingUrls(),y=[];for(var z in x)y.push({url:z,time:x[z]});y.sort(function(ba,ca){return ca.time-ba.time;});var aa={start_gap:p-h.getStartTime(),page_loaded:n,page_id:o,timeout:u,missing_total:v.length,module_1:r(v,0),module_2:r(v,1),module_3:r(v,2),error_url_total:w.length,error_url_1:r(w,0),error_url_2:r(w,1),error_url_3:r(w,2),loading_url_total:y.length,loading_url_1:r(y,0)?r(y,0).url:null,loading_time_1:r(y,0)?r(y,0).time:null,loading_url_2:r(y,1)?r(y,1).url:null,loading_time_2:r(y,1)?r(y,1).time:null,loading_url_3:r(y,2)?r(y,2).url:null,loading_time_3:r(y,2)?r(y,2).time:null};if(!m){l.warn('require_'+u,{missing:v});aa.symptom='require';}if(m&&!m.isInitialized()){l.warn('init_'+u,{missing:v});aa.symptom='init';}if(aa.symptom)new g('/ajax/chat/sidebar_load.php',aa).send();},u);}var t={start:function(){s(5000);s(10000);s(15000);s(30000);s(60000);}};e.exports=t;});
__d("NotificationImpressions",["AsyncSignal","NotificationTokens","URI"],function(a,b,c,d,e,f){var g=b('AsyncSignal'),h=b('NotificationTokens'),i=b('URI'),j='/ajax/notifications/impression.php';function k(l,m){var n={ref:m};h.untokenizeIDs(l).forEach(function(o,p){n['alert_ids['+p+']']=o;});new g(i(j).getQualifiedURI().toString(),n).send();}e.exports={log:k};});
__d("NotificationLogger",["JSLogger"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=g.create('notification_ui'),i={logBeepsReceived:function(j){h.bump('beeps_received',j);},logBeepRender:function(){h.bump('beep_render');},logBeepFlash:function(){h.bump('beep_flash');},logBeepClick:function(){h.bump('beep_click');},logBeepDiscard:function(){h.bump('beep_discard');}};e.exports=i;});
__d("NotificationBeeperItemContents.react",["Animation","CloseButton.react","ImageBlock.react","NotificationLogger","NotificationURI","NotificationUserActions","React","TextWithEntities.react","Timestamp.react","cx"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('CloseButton.react'),i=b('ImageBlock.react'),j=b('NotificationLogger'),k=b('NotificationURI'),l=b('NotificationUserActions'),m=b('React'),n=b('TextWithEntities.react'),o=b('Timestamp.react'),p=b('cx');function q(s,t){return m.DOM.span({className:"fwb"},s);}var r=m.createClass({displayName:'NotificationBeeperItemContents',_markAsRead:function(){l.markNotificationsAsRead([this.props.beep.notificationID]);this.props.onHide();},_onClose:function(){this._markAsRead();this.props.onHide();},_doFlash:function(){j.logBeepFlash();new g(this.refs.inner.getDOMNode()).from('opacity','0').to('opacity','1').duration(200).go();},componentDidUpdate:function(s){if(s.beep.beepID!==this.props.beep.beepID)this._doFlash();},render:function(){var s=this.props.beep,t=s.icon.uri,u=s.link?k.localize(s.link):'#',v=s.photo&&k.snowliftable(u);return (m.DOM.div({ref:"inner"},h({className:"_3soc",onClick:this._onClose,size:"medium"}),m.DOM.a({href:u,ajaxify:v?u:null,onClick:this._markAsRead,rel:v?'theater':null,className:"_3soi"},i({className:"_3soj"},m.DOM.img({src:s.actors[0].profile_picture.uri,className:"_3sok"}),m.DOM.div({className:"_3sol"},n({renderEmoticons:true,renderEmoji:true,interpolator:q,ranges:s.text.ranges,aggregatedranges:s.text.aggregated_ranges,text:s.text.text}),i({className:"_3som"},m.DOM.img({src:t}),o({time:s.timestamp.time,text:s.timestamp.text,verbose:s.timestamp.verbose})))))));}});e.exports=r;});
__d("NotificationBeeperItem.react",["Animation","BrowserSupport","NotificationBeeperItemContents.react","NotificationLogger","React","cx","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('BrowserSupport'),i=b('NotificationBeeperItemContents.react'),j=b('NotificationLogger'),k=b('React'),l=b('cx'),m=b('setTimeoutAcrossTransitions'),n=k.createClass({displayName:'NotificationBeeperItem',getInitialState:function(){return {fadedIn:false,hidden:false};},componentDidMount:function(){var o;if(h.hasCSSAnimations()){o=this.setState.bind(this,{fadedIn:true},null);}else o=function(){new g(this.refs.item.getDOMNode()).from('top','-30px').from('opacity','0').to('top','0px').to('opacity','1').duration(200).ondone(this.setState.bind(this,{fadedIn:true},null)).go();}.bind(this);m(o,50);this.props.onInserted(this.props.beep);j.logBeepRender();},_onClick:function(){j.logBeepClick();},_onHide:function(){this.setState({hidden:true});},render:function(){var o=this.props.beep,p=(("_3sod")+(this.state.fadedIn?' '+"_3soe":'')+(this.state.hidden?' '+"_3sof":'')),q=o.beepRenderer||i;return (k.DOM.li({className:p,ref:"item",onClick:this._onClick,'data-gt':o.tracking},q({beep:o,onHide:this._onHide})));}});e.exports=n;});
__d("NotificationSound",["Sound","copyProperties"],function(a,b,c,d,e,f){var g=b('Sound'),h=b('copyProperties'),i=5000;g.init(['audio/mpeg']);function j(k){this._soundPath=k;this._lastPlayed=0;}h(j.prototype,{play:function(k){if(!this._soundPath)return;var l=Date.now();if((l-this._lastPlayed)<i)return;this._lastPlayed=l;g.play(this._soundPath,k);}});e.exports=j;});
__d("NotificationBeeper.react",["Animation","Arbiter","ChannelConstants","NotificationBeeperItem.react","NotificationConstants","NotificationImpressions","NotificationLogger","NotificationPhotoThumbnail","NotificationSound","NotificationUpdates","NotificationUserActions","React","Style","cx","isEmpty","merge","setTimeoutAcrossTransitions","shield"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('ChannelConstants'),j=b('NotificationBeeperItem.react'),k=b('NotificationConstants'),l=b('NotificationImpressions'),m=b('NotificationLogger'),n=b('NotificationPhotoThumbnail'),o=b('NotificationSound'),p=b('NotificationUpdates'),q=b('NotificationUserActions'),r=b('React'),s=b('Style'),t=b('cx'),u=b('isEmpty'),v=b('merge'),w=b('setTimeoutAcrossTransitions'),x=b('shield'),y=10000,z=4000,aa='beeper',ba=k.PayloadSourceType.LIVE_SEND,ca=k.PayloadSourceType.OTHER_APPLICATION,da=r.createClass({displayName:'NotificationBeeper',getInitialState:function(){return {soundEnabled:this.props.soundEnabled,hovering:false,fading:false,paused:false,pendingBeeps:{},renderedBeeps:{}};},componentWillMount:function(){var fa=i.getArbiterType('notif_sound_pref_changed'),ga='update-notifications';this.subscriptions=[p.subscribe(ga,function(ha,ia){if(ia.payloadsource===ba||ia.payloadsource===ca){var ja=ia.nodes;if(ja&&ja.length){m.logBeepsReceived(ja.length);this._handleBeepChanges(ea(ja));}}}.bind(this)),h.subscribe(fa,function(ha,ia){this.setState({soundEnabled:ia.obj.enabled});}.bind(this))];h.inform('NotificationBeeper/mounted',null,h.BEHAVIOR_PERSISTENT);},componentWillUnmount:function(){this.subscriptions.forEach(function(fa){fa.unsubscribe();});this.subscriptions=null;},_onMouseEnter:function(){if(this.state.paused)return;this._hideWait&&clearTimeout(this._hideWait);if(this.state.fading){this._animation.stop();this._animation=null;s.set(this.refs.container.getDOMNode(),'opacity','0.96');}var fa=Object.keys(this.state.renderedBeeps);if(this.props.unseenVsUnread){q.markNotificationsAsSeen(fa);}else q.markNotificationsAsRead(fa);this.setState({hovering:true,fading:false,pendingBeeps:{},renderedBeeps:v(this.state.renderedBeeps,this.state.pendingBeeps)});},_onMouseLeave:function(){if(this.state.paused)return;this._waitToHide(z);this.setState({hovering:false});},_onInsertedItem:function(fa){if(!this.state.hovering)this._waitToHide();if(this.state.soundEnabled&&fa.sound){if(!this._notifSound)this._notifSound=new o(this.props.soundPath);this._notifSound.play(fa.beepID);}if(this.props.shouldLogImpressions)l.log([fa.notificationID],aa);},_waitToHide:function(fa){this._hideWait&&clearTimeout(this._hideWait);this._hideWait=w(x(this._hide,this),(fa||y)*(this.props.slowFade?2:1));},_hide:function(){this._animation&&this._animation.stop();this._animation=new g(this.refs.container.getDOMNode()).from('opacity','0.96').to('opacity','0').duration(1500).ondone(this._finishHide).go();this.setState({fading:true});},_finishHide:function(){var fa=this.state.pendingBeeps;this.setState({fading:false,pendingBeeps:{},renderedBeeps:{}});w(this.setState.bind(this,{renderedBeeps:fa},null));s.set(this.refs.container.getDOMNode(),'opacity','0.96');},_handleBeepChanges:function(fa){var ga=this.state.fading?this.state.pendingBeeps:this.state.renderedBeeps;Object.keys(fa).reverse().forEach(function(ha){var ia=fa[ha],ja=ia.beepID,ka=this.state.renderedBeeps[ha]||{};if(ka.beepID!=ja){delete ga[ha];ga[ha]=ia;}}.bind(this));if(!this.state.paused)this._waitToHide();this.forceUpdate();},_togglePause:function(){if(!this.state.paused){this._animation&&this._animation.stop();this._hideWait&&clearTimeout(this._hideWait);}else this._waitToHide();this.setState({paused:!this.state.paused});},render:function(){var fa=this.state.renderedBeeps,ga={};Object.keys(fa).reverse().forEach(function(ka){var la=fa[ka];ga[ka]=j({beep:la,onInserted:this._onInsertedItem});},this);var ha=!u(ga),ia=null;if(ha&&this.props.canPause)ia=r.DOM.li({className:"_a_g",onClick:this._togglePause},this.state.paused?'Continue':'Pause [fb]');var ja=((!ha?"hidden_elem":'')+(' '+"_50d1"));return (r.DOM.ul({ref:"container",className:ja,'data-gt':this.props.tracking,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave},ga,ia));}});function ea(fa){var ga={};fa.forEach(function(ha){if(!ha.showBeep){m.logBeepDiscard();return;}var ia=ha.alert_id,ja=ia+'-'+ha.receivedTime,ka=n.getThumbnail(ha.attachments,ha.attached_story);ga[ia]={notificationID:ia,beepID:ja,beepRenderer:ha.beepRenderer,actors:ha.actors,icon:ha.icon,link:ha.url,photo:ka,text:ha.unaggregatedTitle||ha.title,timestamp:ha.timestamp,receivedTime:ha.receivedTime,sound:!!ha.sound,tracking:ha.tracking};});return ga;}e.exports=da;});
__d("FbdEventLog",["URI","AsyncSignal"],function(a,b,c,d,e,f){var g=b('URI'),h=b('AsyncSignal'),i={log:function(j,k,l,m){if(!j)return;var n=g('/desktop/eventlog.php'),o=new h(n.toString(),{event:j,category:k||'unknown',payload:l||''});o.setHandler(m).send();}};e.exports=i;});
__d("DownloadDialog",["Arbiter","DataStore","Event","ModalMask","Overlay","Parent","Style","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DataStore'),i=b('Event'),j=b('ModalMask'),k=b('Overlay'),l=b('Parent'),m=b('Style'),n=b('copyProperties'),o=b('emptyFunction');for(var p in k)if(k.hasOwnProperty(p))r[p]=k[p];var q=k===null?null:k.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=k;function r(){k.call(this);return this;}r.prototype.init=function(s,t){q.init.call(this,s);this.position=t;var u=(h.get(this._root,'modal')==='true');r.hideDialog(t);r.activeDialogs[t]=this;i.listen(this._root,'click',function(event){if(l.byClass(event.getTarget(),'closeButton'))if(this._cancelHandler()!==false)r.hideDialog(this.position);}.bind(this));this.subscribe('show',function(){if(u)j.show();g.inform('layer_shown',{type:'DownloadDialog'});}.bind(this));this.subscribe('hide',function(){if(u)j.hide();g.inform('layer_hidden',{type:'DownloadDialog'});this._closeHandler();}.bind(this));};r.prototype.setWidth=function(s){this._width=Math.floor(s);return this;};r.prototype.updatePosition=function(){if(this._width)m.set(this._overlay,'width',this._width+'px');return true;};r.prototype.setCancelHandler=function(s){this._cancelHandler=s||o;return this;};r.prototype.setCloseHandler=function(s){this._closeHandler=s||o;return this;};r.dismissAll=function(){for(var s in this.POSITIONS)this.hideDialog(this.POSITIONS[s]);};r.hideDialog=function(s){var t=this.activeDialogs[s];t&&t.hide();this.activeDialogs[s]=null;};n(r,{POSITIONS:{BOTTOM_LEFT:'bottom_left',TOP_LEFT:'top_left',IE9_BOTTOM:'ie9_bottom'},activeDialogs:{}});n(r.prototype,{_cancelHandler:o,_closeHandler:o,_width:null,position:r.POSITIONS.BOTTOM_LEFT});e.exports=r;a.DownloadDialog=r;});
__d("FbdConversionTracking",["AsyncRequest","emptyFunction"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('emptyFunction'),i={logClick:function(j,k){if(!k)k='desktop';new g().setURI('/ajax/desktop/log_clicks.php').setData({click_source:j,promo:k}).setAllowCrossPageTransition(true).setErrorHandler(h).send();},logConversion:function(j,k){if(!k)k='desktop';new g().setURI('/ajax/desktop/log_conversions.php').setData({conversion_action:j,promo:k}).setAllowCrossPageTransition(true).setErrorHandler(h).send();}};e.exports=i;});
__d("FbdInstall",["$","AsyncRequest","CSS","DOM","DownloadDialog","FbdConversionTracking","FbdEventLog","FBDesktopDetect","FBDesktopPlugin","MegaphoneHelper"],function(a,b,c,d,e,f){var g=b('$'),h=b('AsyncRequest'),i=b('CSS'),j=b('DOM'),k=b('DownloadDialog'),l=b('FbdConversionTracking'),m=b('FbdEventLog'),n=b('FBDesktopDetect'),o=b('FBDesktopPlugin'),p=b('MegaphoneHelper'),q=1000,r=300*q,s={cancelSetup:function(){var t=JSON.stringify({ref:this.ref});m.log('download_canceled','setup',t);l.logConversion('download_canceled');},hideMegaphone:function(){if(this.megaphoneId&&this.megaphoneLoc)p.hideStory(this.megaphoneId,this.megaphoneLoc,this.elementId,'',null);},init:function(t,u){this.downloadUrl=t;this.ref=u||'unknown';},initInstallWait:function(t,u,v){this.megaphoneId=t;this.megaphoneLoc=u;this.elementId=v;this._waitForInstall(r);},promptDownload:function(t){t=t||this.downloadUrl;if(t){var u=JSON.stringify({ref:this.ref});m.log('download_prompted','setup',u);l.logConversion('download_prompted');var v=j.create('iframe',{src:t,className:'hidden_elem'});j.appendContent(document.body,v);}},_responseHandler:function(t){if(t.payload){this._authToken=t.payload.access_token;this._userId=t.payload.id;}if(this._authToken&&this._userId){this._waitForRunningStart=Date.now();setTimeout(this._waitForRunning.bind(this),q);}},setupPlugin:function(){new h('/ajax/desktop/download').send();this.promptDownload();},updateSidebarLinkVisibility:function(){if(!n.isPluginInstalled()){i.show(g('sidebar-messenger-install-link'));i.show(g('sidebar-messenger-install-separator'));}},_waitForInstall:function(t){var u=JSON.stringify({ref:this.ref});if(n.isPluginInstalled()){m.log('install_success','setup',u);l.logConversion('install_success');o.recheck();new h("/desktop/fbdesktop2/transfer.php").setMethod("POST").setHandler(this._responseHandler.bind(this)).send();k.dismissAll();this.hideMegaphone();return;}if(t<=0){m.log('install_timeout','setup',u);l.logConversion('install_timeout');k.dismissAll();}else setTimeout(this._waitForInstall.bind(this,t-q),q);},_waitForRunning:function(){var t=Date.now()-this._waitForRunningStart;if(o.isAppRunning()){o.transferAuthToken(this._authToken,this._userId);}else if(t<r)setTimeout(this._waitForRunning.bind(this),q);}};e.exports=s;});
__d("SidebarTicker",["Arbiter","ChatSidebar","CSS","DOM","Run","TickerController","$","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatSidebar'),i=b('CSS'),j=b('DOM'),k=b('Run'),l=b('TickerController'),m=b('$'),n=b('copyProperties');function o(){this._ticker=m('pagelet_ticker');this._initSubscriptions();if(i.hasClass(document.documentElement,'sidebarMode'))this._onSidebarShow();}o.hide=function(){k.onAfterLoad(function(){j.remove(m('pagelet_ticker'));j.remove(j.find(document.body,'div.fbSidebarGripper'));h.resize();});};n(o.prototype,{_initSubscriptions:function(){this._subscriptions=[g.subscribe('sidebar/show',this._onSidebarShow.bind(this))];},_onSidebarShow:function(){l.show(this._ticker);}});e.exports=o;});
__d("SidebarTickerResizer",["Arbiter","AsyncRequest","ChatSidebar","SimpleDrag","$"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('ChatSidebar'),j=b('SimpleDrag'),k=b('$'),l=1e-07;function m(n){var o=k('pagelet_ticker'),p=o.parentNode,q=this._saveResizedState.bind(this),r,s,t,u=function(x,event){r=event.clientY;s=o.offsetHeight;t=p.offsetHeight;},v=function(x,event){var y=s+(event.clientY-r),z=100-(((t-y)/t)*100);z=Math.max(l,Math.min(90,z));o.style.height=z+'%';if(x=='end'){q(z);g.inform('Ticker/resized');}i.resize();},w=new j(n);w.subscribe('start',u);w.subscribe(['update','end'],v);}m.prototype._saveResizedState=function(n){new h('/ajax/feed/ticker/resize').setData({height:''+n}).setMethod('POST').send();};e.exports=m;});
__d("NotificationXOut",["Arbiter","Event"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Event');function i(m,n){g.inform('notif/negativeCancel',{id:m});n.kill();}function j(m){m.prevent();}function k(m,n){h.listen(m,'click',i.curry(n));}function l(m){h.listen(m,'click',j);}e.exports={setupCancelListener:k,setupNoListener:l};});
__d("LiveMessageReceiver",["Arbiter","ChannelConstants","copyProperties","emptyFunction","shield"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('copyProperties'),j=b('emptyFunction'),k=b('shield');function l(m){this.eventName=m;this.subs=null;this.handler=j;this.shutdownHandler=null;this.registered=false;this.appId=1;}i(l,{getAppMessageType:function(m,n){return 'live_message/'+m+':'+n;},route:function(m){var n=function(o){var p=l.getAppMessageType(m.app_id,m.event_name);g.inform(p,o,g.BEHAVIOR_PERSISTENT);};n(m.response);}});i(l.prototype,{setAppId:function(m){this.appId=m;return this;},setHandler:function(m){this.handler=m;this._dirty();return this;},setRestartHandler:j,setShutdownHandler:function(m){this.shutdownHandler=k(m);this._dirty();return this;},_dirty:function(){if(this.registered){this.unregister();this.register();}},register:function(){var m=function(o,p){return this.handler(p);}.bind(this),n=l.getAppMessageType(this.appId,this.eventName);this.subs={};this.subs.main=g.subscribe(n,m);if(this.shutdownHandler)this.subs.shut=g.subscribe(h.ON_SHUTDOWN,this.shutdownHandler);this.registered=true;return this;},unregister:function(){if(!this.subs)return this;for(var m in this.subs)if(this.subs[m])this.subs[m].unsubscribe();this.subs=null;this.registered=false;return this;}});e.exports=l;});
__d("initLiveMessageReceiver",["Arbiter","ChannelConstants","LiveMessageReceiver"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('LiveMessageReceiver');g.subscribe(h.getArbiterType('app_msg'),function(j,k){i.route(k.obj);});});