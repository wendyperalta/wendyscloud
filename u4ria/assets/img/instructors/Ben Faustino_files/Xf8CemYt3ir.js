/*!CK:3425892573!*//*1379685017,172005422*/

if (self.CavalryLogger) { CavalryLogger.start_js(["JGpDv"]); }

__d("MercuryMessageSourceTags",[],function(a,b,c,d,e,f){e.exports={CHAT:"source:chat",MOBILE:"source:mobile",MESSENGER:"source:messenger",EMAIL:"source:email"};});
__d("MercuryTimePassed",[],function(a,b,c,d,e,f){e.exports={TODAY:0,WEEK_AGO:1,CURRENT_YEAR:3,OTHER_YEAR:4,MONTH_AGO:2};});
__d("MessagingEvent",[],function(a,b,c,d,e,f){e.exports={UNSUBSCRIBE:"unsubscribe",DELIVERY_RECEIPT:"delivery_receipt",REPORT_SPAM_MESSAGES:"report_spam_messages",DELIVER_FAST_PAST:"deliver_fast_path",DELETE_MESSAGES:"delete_messages",READ_RECEIPT:"read_receipt",SENT_PUSH:"sent_push",READ:"read",CHANGE_MUTE_SETTINGS:"change_mute_settings",ERROR:"error",UNMARK_SPAM:"unmark_spam",UNREAD:"unread",DELIVER_LOG:"deliver_log",DELIVER:"deliver",READ_ALL:"read_all",MESSENGER_STATUS:"messenger_status",TAG:"tag",MORE_THREADS:"more_threads",DELETE:"delete",REPORT_SPAM:"report_spam",SUBSCRIBE:"subscribe"};});
__d("AsyncLoader",["copyProperties","AsyncRequest","BaseAsyncLoader"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('AsyncRequest'),i=b('BaseAsyncLoader');function j(k,l){this._endpoint=k;this._type=l;}g(j.prototype,i.prototype);j.prototype.send=function(k,l,m,n,o){new h(k).setData({ids:l}).setHandler(n).setErrorHandler(o).setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};e.exports=j;});
__d("ChannelSubdomain",["Cookie","JSLogger"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('JSLogger'),i=h.create('channel'),j=7,k=null;function l(o,p){var q=null,r=m(),s;o--;var t=Math.min(32,j*o);t=Math.max(t,1);var u=false;for(var v=0;v<32;v++){s=(v+p)%t;if(!(r&(1<<s))){u=true;break;}}if(u){k=s;q=k%j;g.set('sub',r|(1<<k));}else{k=-1;q=null;i.error('subdomain_overflow',{slot:k,max:o});}return q;}function m(){var o=g.get('sub')||0;o=parseInt(o,10);return isNaN(o)?0:o;}function n(){if(k!==null&&k>=0){var o=m()&~(1<<k);if(o){g.set('sub',o);}else g.clear('sub');}}e.exports={allocate:l,clear:n};});
__d("AvailableListConstants",[],function(a,b,c,d,e,f){var g={ON_AVAILABILITY_CHANGED:'buddylist/availability-changed',ON_UPDATE_ERROR:'buddylist/update-error',ON_UPDATED:'buddylist/updated',ON_CHAT_NOTIFICATION_CHANGED:'chat-notification-changed',OFFLINE:0,IDLE:1,ACTIVE:2,MOBILE:3,LEGACY_OVERLAY_OFFLINE:-1,LEGACY_OVERLAY_ONLINE:0,LEGACY_OVERLAY_IDLE:1,legacyStatusMap:{'0':2,'1':1,'-1':0,'2':3},reverseLegacyStatusMap:{0:-1,1:1,2:0,3:2}};a.AvailableListConstants=e.exports=g;});
__d("PresencePrivacy",["Arbiter","AsyncRequest","ChannelConstants","copyProperties","Env","JSLogger","PresenceUtil","PresencePrivacyInitialData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('ChannelConstants'),j=b('copyProperties'),k=b('Env'),l=b('JSLogger'),m=b('PresenceUtil'),n=b('PresencePrivacyInitialData'),o='/ajax/chat/privacy/settings.php',p='/ajax/chat/privacy/online_policy.php',q='/ajax/chat/privacy/visibility.php',r='friend_visibility',s='visibility',t='online_policy',u=j({},n.privacyData),v=n.visibility,w=j({},n.privacyData),x=v,y=n.onlinePolicy,z=y,aa=[],ba=false;function ca(){return l.create('blackbird');}var da=j(new g(),{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1});function ea(qa){var ra;for(ra in qa){var sa=qa[ra];if(ra==k.user){ca().error('set_viewer_visibility');throw new Error("Invalid to set current user's visibility");}switch(sa){case da.WHITELISTED:case da.BLACKLISTED:case da.UNLISTED:break;default:ca().error('set_invalid_friend_visibility',{id:ra,value:sa});throw new Error("Invalid state: "+sa);}}for(ra in qa)u[ra]=qa[ra];da.inform('privacy-changed');}function fa(qa,ra){var sa={};sa[qa]=ra;ea(sa);}function ga(qa){switch(qa){case da.ONLINE:case da.OFFLINE:break;default:ca().error('set_invalid_visibility',{value:qa});throw new Error("Invalid visibility: "+qa);}v=qa;da.inform('privacy-changed');da.inform('privacy-user-presence-changed');g.inform('chat/visibility-changed',{sender:this});}function ha(qa){switch(qa){case da.ONLINE_TO_WHITELIST:case da.ONLINE_TO_BLACKLIST:break;default:throw new Error("Invalid default online policy: "+qa);}y=qa;da.inform('privacy-user-presence-changed');da.inform('privacy-changed');}function ia(qa,ra){ba=true;qa.send();}function ja(qa,ra){aa.push({request:qa,data:ra});if(!ba){var sa=aa.shift();ia(sa.request,sa.data);}}function ka(qa,ra){var sa=qa.type;if(sa===r){var ta=ra.payload.user_availabilities;if(!Array.isArray(ta)){da.inform('privacy-availability-changed',{user_availabilities:ta});for(var ua in qa.settings)w[ua]=qa.settings[ua];}}else{if(sa===s){x=qa.visibility;}else if(sa===t)z=qa.online_policy;da.inform('privacy-user-presence-response');}ca().log('set_update_response',{data:qa,response:ra});}function la(qa,ra){if(v!==x)ga(x);if(y!==z)ha(z);j(u,w);da.inform('privacy-changed');aa=[];ca().log('set_error_response',{data:qa,response:ra});}function ma(qa){ba=false;if(aa.length>0){var ra=aa.shift();ia(ra.request,ra.data);}}function na(qa,ra){if(m!=null){var sa=qa.getData();sa.window_id=m.getSessionID();qa.setData(sa);}qa.setHandler(ka.bind(this,ra)).setErrorHandler(la.bind(this,ra)).setTransportErrorHandler(la.bind(this,ra)).setFinallyHandler(ma.bind(this)).setAllowCrossPageTransition(true);return qa;}function oa(qa,ra,sa){return na(new h(qa).setData(ra),sa);}function pa(qa,ra){var sa=ra.obj;if(sa.viewer_id!=k.user){ca().error('invalid_viewer_for_channel_message',{type:qa,data:ra});throw new Error("Viewer got from the channel is not the real viewer");}if(sa.window_id===m.getSessionID())return;var ta=sa.data;if(sa.event=='access_control_entry'){ta.target_ids.forEach(function(va){fa(va,ta.setting);w[va]=ta.setting;});}else{if(sa.event=='visibility_update'){var ua=!!ta.visibility?da.ONLINE:da.OFFLINE;ga(ua);x=ua;}else if(sa.event=='online_policy_update'){ha(ta.online_policy);z=ta.online_policy;}da.inform('privacy-user-presence-response');}ca().log('channel_message_received',{data:ra.obj});}j(da,{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1,init:function(qa,ra,sa){},setVisibility:function(qa){x=v;ga(qa);var ra={visibility:qa},sa={type:s,visibility:qa},ta=oa(q,ra,sa);ja(ta,sa);ca().log('set_visibility',{data:ra});return qa;},getVisibility:function(){return v;},setOnlinePolicy:function(qa){z=y;ha(qa);var ra={online_policy:qa},sa={type:t,online_policy:qa},ta=oa(p,ra,sa);ja(ta,sa);ca().log('set_online_policy',{data:ra});return qa;},getOnlinePolicy:function(){return y;},getFriendVisibility:function(qa){return u[qa]||da.UNLISTED;},allows:function(qa){if(this.getVisibility()===da.OFFLINE)return false;var ra=this.getOnlinePolicy();return ra===da.ONLINE_TO_WHITELIST?u[qa]==da.WHITELISTED:u[qa]!=da.BLACKLISTED;},setFriendsVisibility:function(qa,ra){if(qa.length>0){var sa={};for(var ta=0;ta<qa.length;ta++){var ua=qa[ta];w[ua]=u[ua];sa[ua]=ra;}ea(sa);var va=ra;if(va==da.UNLISTED)va=w[qa[0]];var wa={users:qa,setting:ra,setting_type:va},xa={type:r,settings:sa},ya=oa(o,wa,xa);ja(ya,xa);ca().log('set_friend_visibility',{data:wa});}return ra;},setFriendVisibilityMap:function(qa,ra){for(var sa in qa)w[sa]=u[sa];ea(qa);var ta={type:r,settings:qa};ja(na(ra,ta),ta);ca().log('set_friend_visibility_from_map',{data:qa});},allow:function(qa){if(this.allows(qa)){ca().error('allow_already_allowed');throw new Error("allow() should only be called for users that "+"are not already allowed");}if(this.getVisibility()===da.OFFLINE){ca().error('allow_called_while_offline');throw new Error("allow() should only be called when the user is already online");}var ra=this.getOnlinePolicy()===da.ONLINE_TO_WHITELIST?da.WHITELISTED:da.UNLISTED;return this.setFriendsVisibility([qa],ra);},disallow:function(qa){if(!this.allows(qa)){ca().error('disallow_already_disallowed');throw new Error("disallow() should only be called for users that "+"are not already disallowed");}if(this.getVisibility()===da.OFFLINE){ca().error('disallow_called_while_offline');throw new Error("disallow() should only be called when the user is already online");}var ra=this.getOnlinePolicy()===da.ONLINE_TO_BLACKLIST?da.BLACKLISTED:da.UNLISTED;return this.setFriendsVisibility([qa],ra);},getBlacklist:function(){var qa=[];for(var ra in u)if(u[ra]===da.BLACKLISTED)qa.push(ra);return qa;},getWhitelist:function(){var qa=[];for(var ra in u)if(u[ra]===da.WHITELISTED)qa.push(ra);return qa;},getMapForTest:function(){return u;},setMapForTest:function(qa){u=qa;}});da.inform('privacy-changed');da.inform('privacy-user-presence-changed');ca().log('initialized',{visibility:v,policy:y});g.subscribe(i.getArbiterType('privacy_changed'),pa.bind(this));g.subscribe(i.ON_CONFIG,function(qa,ra){var sa=ra.getConfig('visibility',null);if(sa!==null&&typeof(sa)!=='undefined'){var ta=sa?da.ONLINE:da.OFFLINE;ga(ta);ca().log('config_visibility',{vis:ta});}}.bind(this));a.PresencePrivacy=e.exports=da;},3);
__d("ChatVisibility",["Arbiter","JSLogger","PresencePrivacy"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('JSLogger'),i=b('PresencePrivacy'),j={isOnline:function(){return i.getVisibility()===i.ONLINE;},hasBlackbirdEnabled:function(){return this.isVisibleToMostFriends()||this.isVisibleToSomeFriends();},isVisibleToMostFriends:function(){return i.getOnlinePolicy()===i.ONLINE_TO_BLACKLIST&&i.getBlacklist().length>0;},isVisibleToSomeFriends:function(){return i.getOnlinePolicy()===i.ONLINE_TO_WHITELIST&&i.getWhitelist().length>0;},goOnline:function(k){if(i.getVisibility()===i.OFFLINE){h.create('blackbird').log('chat_go_online');i.setVisibility(i.ONLINE);g.inform('chat-visibility/go-online');}k&&k();},goOffline:function(k){if(i.getVisibility()===i.ONLINE){h.create('blackbird').log('chat_go_offline');i.setVisibility(i.OFFLINE);g.inform('chat-visibility/go-offline');}k&&k();},toggleVisibility:function(){if(j.isOnline()){j.goOffline();}else j.goOnline();}};a.ChatVisibility=e.exports=j;},3);
__d("RangedCallbackManager",["CallbackManagerController","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('CallbackManagerController'),h=b('copyProperties'),i=b('createObjectFrom'),j=function(k,l,m){this._resources=[];this._reachedEndOfArray=false;this._error=false;this._existingIDs={};this._controller=new g(this._constructCallbackArg.bind(this));this._getValueHandler=k;this._compareValuesHandler=l;this._skipOnStrictHandler=m;};h(j.prototype,{executeOrEnqueue:function(k,l,m,n){return this._controller.executeOrEnqueue({start:k,limit:l},m,{strict:!!n});},unsubscribe:function(k){this._controller.unsubscribe(k);},getUnavailableResources:function(k){var l=this._controller.getRequest(k),m=[];if(l&&!this._reachedEndOfArray){var n=l.request,o=this._filterForStrictResults(l.options),p=n.start+n.limit;for(var q=o.length;q<p;q++)m.push(q);}return m;},addResources:function(k){k.forEach(function(l){if(!this._existingIDs[l]){this._existingIDs[l]=true;this._resources.push(l);this._error=null;}}.bind(this));this.resortResources();this._controller.runPossibleCallbacks();},addResourcesWithoutSorting:function(k,l){var m=this._resources.slice(0,l);m=m.concat(k);m=m.concat(this._resources.slice(l));this._resources=m;h(this._existingIDs,i(k,true));this._error=null;this._controller.runPossibleCallbacks();},removeResources:function(k){k.forEach(function(l){if(this._existingIDs[l]){this._existingIDs[l]=false;var m=this._resources.indexOf(l);if(m!=-1)this._resources.splice(m,1);}}.bind(this));},removeAllResources:function(){this._resources=[];this._existingIDs={};},resortResources:function(){this._resources=this._resources.sort(function(k,l){return this._compareValuesHandler(this._getValueHandler(k),this._getValueHandler(l));}.bind(this));},setReachedEndOfArray:function(){if(!this._reachedEndOfArray){this._reachedEndOfArray=true;this._error=null;this._controller.runPossibleCallbacks();}},hasReachedEndOfArray:function(){return this._reachedEndOfArray;},setError:function(k){if(this._error!==k){this._error=k;this._controller.runPossibleCallbacks();}},getError:function(k,l,m){var n=this._filterForStrictResults({strict:m});return k+l>n.length?this._error:null;},hasResource:function(k){return this._existingIDs[k];},getResourceAtIndex:function(k){return this._resources[k];},getAllResources:function(){return this._resources.concat();},getCurrentArraySize:function(){return this._resources.length;},_filterForStrictResults:function(k){var l=this._resources;if(k&&k.strict&&this._skipOnStrictHandler)l=l.filter(this._skipOnStrictHandler);return l;},_constructCallbackArg:function(k,l){var m=this._filterForStrictResults(l);if(!this._reachedEndOfArray&&!this._error&&k.start+k.limit>m.length){return false;}else{var n=m.slice(k.start,k.start+k.limit),o=k.start+k.limit>m.length?this._error:null;return [n,o];}},getElementsUntil:function(k){var l=[];for(var m=0;m<this._resources.length;m++){var n=this._getValueHandler(this._resources[m]);if(this._compareValuesHandler(n,k)>0)break;l.push(this._resources[m]);}return l;}});e.exports=j;});
__d("formatDate",["DateFormatConfig","fbt","invariant"],function(a,b,c,d,e,f){var g=b('DateFormatConfig'),h=b('fbt'),i=b('invariant'),j=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],k=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],m=["January","February","March","April","May","June","July","August","September","October","November","December"],n=['',"st","nd","rd","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","st","nd","rd","th","th","th","th","th","th","th","st"];function o(s,t,u){u=u||{};if(!t||!s)return '';if(typeof s==='string')s=parseInt(s,10);if(typeof s==='number')s=new Date(s*1000);i(s instanceof Date);i(!isNaN(s.getTime()));i(s.getTime()<1e+15);if(typeof t!=='string'){var v=q();for(var w in v){var x=v[w];if(x.start<=s.getTime()&&t[x.name]){t=t[x.name];break;}}}var y;if(u.skipPatternLocalization||r()){y=t;}else{i(g.formats[t]);y=g.formats[t];}var z=u.utc?'getUTC':'get',aa=s[z+'Date'](),ba=s[z+'Day'](),ca=s[z+'Month'](),da=s[z+'FullYear'](),ea=s[z+'Hours'](),fa=s[z+'Minutes'](),ga=s[z+'Seconds'](),ha=s[z+'Milliseconds'](),ia='';for(var ja=0;ja<y.length;ja++){var ka=y.charAt(ja);switch(ka){case '\\':ja++;ia+=y.charAt(ja);break;case 'd':ia+=p(aa,2);break;case 'j':ia+=aa;break;case 'S':ia+=n[aa];break;case 'D':ia+=j[ba];break;case 'l':ia+=k[ba];break;case 'F':case 'f':ia+=m[ca];break;case 'M':ia+=l[ca];break;case 'm':ia+=p(ca+1,2);break;case 'n':ia+=ca+1;break;case 'Y':ia+=da;break;case 'y':ia+=(''+da).slice(2);break;case 'a':if(ea<12){ia+="am";}else ia+="pm";break;case 'A':if(ea<12){ia+="AM";}else ia+="PM";break;case 'g':ia+=(ea===0||ea===12)?12:ea%12;break;case 'G':ia+=ea;break;case 'h':if(ea===0||ea===12){ia+=12;}else ia+=p(ea%12,2);break;case 'H':ia+=p(ea,2);break;case 'i':ia+=p(fa,2);break;case 's':ia+=p(ga,2);break;case 'X':ia+=p(ha,3);break;default:ia+=ka;}}return ia;}function p(s,t){return Array(t-(''+s).length+1).join('0')+s;}function q(){var s=new Date(),t=s.getTime(),u=s.getFullYear(),v=s.getDate()-((s.getDay()-g.weekStart+6)%7),w=new Date(u,s.getMonth()+1,0).getDate(),x=new Date(u,1,29).getMonth()===1?366:365,y=1000*60*60*24;return [{name:'today',start:s.setHours(0,0,0,0)},{name:'withinDay',start:t-y},{name:'thisWeek',start:new Date(s.getTime()).setDate(v)},{name:'withinWeek',start:t-y*7},{name:'thisMonth',start:s.setDate(1)},{name:'withinMonth',start:t-y*w},{name:'thisYear',start:s.setMonth(0)},{name:'withinYear',start:t-y*x},{name:'older',start:-Infinity}];}o.periodNames=['today','thisWeek','thisMonth','thisYear','withinDay','withinWeek','withinMonth','withinYear','older'];function r(){if(!window||!window.location)return false;var s=window.location.pathname,t='/intern';return s.substr(0,t.length)===t;}e.exports=o;});
__d("MercuryMessages",["AsyncRequest","Env","KeyedCallbackManager","MercuryActionTypeConstants","MercuryActionStatus","MercuryAssert","MercuryAttachmentType","MercuryGenericConstants","MercuryIDs","MercuryLogMessageType","MercuryMessageClientState","MercuryMessageSourceTags","MercuryPayloadSource","MercurySingletonMixin","MercurySourceType","MercuryTimePassed","MercuryMessageIDs","MercuryParticipants","PresenceUtil","RangedCallbackManager","ReportState","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","copyProperties","debounceAcrossTransitions","formatDate","isNode","randomInt","tx"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Env'),i=b('KeyedCallbackManager'),j=b('MercuryActionTypeConstants'),k=b('MercuryActionStatus'),l=b('MercuryAssert'),m=b('MercuryAttachmentType'),n=b('MercuryGenericConstants'),o=b('MercuryIDs'),p=b('MercuryLogMessageType'),q=b('MercuryMessageClientState'),r=b('MercuryMessageSourceTags'),s=b('MercuryPayloadSource'),t=b('MercurySingletonMixin'),u=b('MercurySourceType'),v=b('MercuryTimePassed'),w=b('MercuryMessageIDs'),x=b('MercuryParticipants'),y=b('PresenceUtil'),z=b('RangedCallbackManager'),aa=b('ReportState'),ba=b('MercuryServerRequests'),ca=b('MercuryThreadInformer'),da=b('MercuryThreads'),ea=b('copyProperties'),fa=b('debounceAcrossTransitions'),ga=b('formatDate'),ha=b('isNode'),ia=b('randomInt'),ja=b('tx');function ka(cb,db){var eb=db;if(cb._localIdsMap[db])eb=cb._localIdsMap[db];return cb._messages[eb];}var la=new i();function ma(cb,db){if(db.status===undefined)db.status=k.UNSENT;db.timestamp_absolute="Today";db.message_id=db.message_id||cb.generateNewClientMessageID(db.timestamp);var eb=x.getIDForUser(cb._fbid);db.specific_to_list=db.specific_to_list||[];if(db.specific_to_list.length&&db.specific_to_list.indexOf(eb)===-1)db.specific_to_list.push(eb);if(!db.thread_id){if(db.specific_to_list.length==1){db.thread_id='user:'+cb._fbid;}else if(db.specific_to_list.length==2){var fb=db.specific_to_list[0]==eb?db.specific_to_list[1]:db.specific_to_list[0];if(o.tokenize(fb).type=='email'){db.thread_id=n.PENDING_THREAD_ID;}else db.thread_id=cb._threads.getThreadIDForParticipant(fb);}db.thread_id=db.thread_id||'root:'+db.message_id;}if(!db.specific_to_list.length){var gb=cb._serverRequests.tokenizeThreadID(db.thread_id);if(gb.type=='user')db.specific_to_list=['fbid:'+gb.value,eb];}}function na(cb,db,eb,fb){var gb=ya(eb)?[r.CHAT]:[],hb=Date.now(),ib=ga(new Date(hb),'g:ia'),jb={action_type:db,thread_id:fb,author:x.getIDForUser(cb._fbid),author_email:null,coordinates:null,timestamp:hb,timestamp_absolute:(new Date(hb)).toLocaleDateString(),timestamp_relative:ib,timestamp_time_passed:v.TODAY,is_unread:false,is_cleared:false,is_forward:false,is_filtered_content:false,is_spoof_warning:false,source:eb,source_tags:gb};return jb;}function oa(cb){switch(cb){case s.UNKNOWN:case s.SERVER_INITIAL_DATA:case s.SERVER_FETCH_THREAD_INFO:case s.SERVER_THREAD_SYNC:return true;}return false;}function pa(cb){return cb&&cb.substr(0,6)==='server';}function qa(cb,db){if(!cb._threadsToMessages[db])cb._threadsToMessages[db]=new z(function(eb){return ka(cb,eb).timestamp;},function(eb,fb){return fb-eb;});return cb._threadsToMessages[db];}function ra(cb){var db=[];return JSON.stringify(cb,function(eb,fb){if(typeof fb==='object'&&fb!==null){if(ha(fb))return '<'+fb.nodeName+'>';if(db.indexOf(fb)!==-1)return 'CIRCULAR';db.push(fb);}return fb;});}aa.registerCallback('mercury-messages',function(){var cb={},db={},eb=ta._getInstances();for(var fb in eb){cb[fb]={};for(var gb in eb[fb]._messages){var hb=eb[fb]._messages[gb];if(Object.keys(hb).length===0)continue;var ib=hb.thread_id;cb[fb][ib]=cb[fb][ib]||{};cb[fb][ib][hb.message_id]=JSON.parse(ra(hb));}db[fb]=ea({},eb[fb]._localIdsMap);}var jb={};jb.local_message_ids=db;jb.messages=cb;return jb;});function sa(cb,db,eb){db.forEach(function(fb){var gb=qa(cb,fb);gb.setReachedEndOfArray();cb._threadInformer.reorderedMessages(fb,eb);});}function ta(cb){this._fbid=cb;this._serverRequests=ba.getForFBID(this._fbid);this._threadInformer=ca.getForFBID(this._fbid);this._threads=da.getForFBID(this._fbid);this._failedHistoryFetchThreads={};this._threadsToMessages={};this._titanMessagesCount={};this._localTitanMessagesCount={};this._messages={};this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};this._serverRequests.subscribe('update-messages',function(db,eb){var fb=(eb.actions||[]).filter(function(hb){var ib=hb.action_type;return (hb.is_forward||hb.thread_id)&&(ib==j.LOG_MESSAGE||ib==j.USER_GENERATED_MESSAGE||ib==j.SEND_MESSAGE||ib==j.CLEAR_CHAT||ib==j.DELETE_THREAD||ib==j.DELETE_MESSAGES);}),gb=oa(eb.payload_source);if(pa(eb.payload_source))fb.forEach(function(hb){if(!hb.is_forward){var ib=this._threads.getThreadMetaNow(hb.thread_id);if(ib)hb.is_cleared=hb.timestamp<ib.chat_clear_time;}}.bind(this));this.handleUpdates(fb,gb,eb.payload_source,eb.from_client);if(eb.end_of_history)sa(this,eb.end_of_history,eb.payload_source);}.bind(this));}ea(ta.prototype,{getMessagesFromIDs:function(cb){return (cb||[]).map(ka.curry(this)).filter(function(db){return db;});},hasLoadedNMessages:function(cb,db){var eb=qa(this,cb);return eb.hasReachedEndOfArray()||eb.getCurrentArraySize()>=db;},hasLoadedExactlyNMessages:function(cb,db){var eb=qa(this,cb);return eb.getCurrentArraySize()==db;},getThreadMessagesRange:function(cb,db,eb,fb,gb,hb){var ib=qa(this,cb),jb=function(pb){fb(ua(this,pb));}.bind(this),kb=ib.executeOrEnqueue(db,eb,jb),lb=ib.getUnavailableResources(kb),mb=this._failedHistoryFetchThreads[cb];if(lb.length&&!mb){var nb=(this._titanMessagesCount[cb]||0)-(this._localTitanMessagesCount[cb]||0),ob=lb.length+(this._localTitanMessagesCount[cb]||0);this._serverRequests.fetchThreadMessages(cb,nb,ob,gb,hb);}else this._failedHistoryFetchThreads[cb]=false;return kb;},getThreadMessagesSinceTimestamp:function(cb,db){var eb=qa(this,cb),fb=eb.getElementsUntil(db);return ua(this,fb);},hasLoadedAllMessages:function(cb){return qa(this,cb).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(cb){var db=qa(this,cb).getAllResources();return ua(this,db);},unsubscribe:function(cb,db){l.isThreadID(db);var eb=qa(this,db);eb.unsubscribe(cb);},addAttachmentData:function(cb,db,eb){var fb=ka(this,cb);if(fb){var gb=fb.attachments.indexOf(db);if(gb!=-1){fb.attachments[gb]=eb;this._threadInformer.updatedMessage(fb.thread_id,fb.message_id,'attach');}}else{if(!this._attachmentData[cb])this._attachmentData[cb]=[];this._attachmentData[cb].push({attach_key:db,data:eb});}},handleUpdates:function(cb,db,eb,fb){var gb,hb={},ib={};for(var jb=0;jb<cb.length;jb++){var kb=cb[jb];if(kb.is_forward||eb==s.SERVER_SEARCH){if(!this._messages[kb.message_id]){this._messages[kb.message_id]=kb;za(this,kb);}continue;}if(kb.client_state===q.SEND_TO_SERVER){this._messages[kb.message_id]=kb;za(this,kb);continue;}var lb=kb.action_type;if(lb==j.SEND_MESSAGE){var mb=kb.client_message_id;if(mb&&this._localIdsMap[mb]&&kb.status){if(kb.status==k.UNCONFIRMED){if(!ib[kb.thread_id])ib[kb.thread_id]=[];ib[kb.thread_id].push(kb.client_message_id);}else if(!hb[kb.thread_id])hb[kb.thread_id]=[];var nb=ka(this,kb.client_message_id),ob=nb.status;nb.status=kb.status;if(kb.status===k.SUCCESS||kb.error_data)nb.error_data=kb.error_data;if(kb.status==k.SUCCESS){this.updateLocalMessage(kb,eb);if(kb.client_thread_id==n.PENDING_THREAD_ID){nb.thread_id=kb.thread_id;hb[kb.thread_id].push(nb.message_id);la.setResource(nb.message_id,nb.thread_id);}}if(typeof ob!='undefined'||kb.status==k.FAILED_UNKNOWN_REASON||kb.status==k.UNABLE_TO_CONFIRM||kb.status==k.SUCCESS||kb.status==k.ERROR)this._threadInformer.updatedMessage(kb.thread_id,ka(this,kb.client_message_id).message_id,eb);}continue;}else if(lb==j.DELETE_THREAD){qa(this,kb.thread_id).removeAllResources();continue;}else if(lb==j.DELETE_MESSAGES){var pb=kb.message_ids.map(function(wb){return ka(this,wb).message_id;}.bind(this));gb=qa(this,kb.thread_id);gb.removeResources(pb);this._threadInformer.reorderedMessages(kb.thread_id,eb);continue;}else if(lb==j.LOG_MESSAGE){if(kb.log_message_type==p.SERVER_ERROR)this._failedHistoryFetchThreads[kb.thread_id]=true;}else if(lb==j.CLEAR_CHAT){var qb=qa(this,kb.thread_id).getAllResources();qb.map(ka.curry(this)).forEach(function(wb){wb.is_cleared=true;});continue;}var rb=ka(this,kb.message_id);if((kb.threading_id&&this._localIdsMap[kb.threading_id])||(rb&&!rb.is_forward))continue;if(!hb[kb.thread_id])hb[kb.thread_id]=[];hb[kb.thread_id].push(kb.message_id);this._messages[kb.message_id]=kb;za(this,kb);if(kb.threading_id&&kb.threading_id!=kb.message_id)w.addServerID(kb.threading_id,kb.message_id);if(!db)this._threadInformer.receivedMessage(kb);}for(var sb in hb){gb=qa(this,sb);var tb=gb.getAllResources(),ub=tb.filter(function(wb){var xb=this._messages[wb];return xb.action_type==j.LOG_MESSAGE&&xb.log_message_type==p.SERVER_ERROR;}.bind(this));gb.removeResources(ub);va(this,sb,hb[sb]);if(fb)wa(this,sb,hb[sb]);if(db){gb.addResources(hb[sb]);this._threadInformer.reorderedMessages(sb,eb);}else gb.addResourcesWithoutSorting(hb[sb].reverse(),0);this._threadInformer.updatedThread(sb);}var vb=Object.keys(ib);if(vb.length)this._serverRequests.requestMessageConfirmation(ib);},sendMessage:function(cb,db,eb){db=db||Function.prototype;ma(this,cb);this._localIdsMap[cb.message_id]=cb.message_id;if(cb.thread_id=='root:'+cb.message_id)qa(this,cb.thread_id).setReachedEndOfArray();this._serverRequests.sendNewMessage(cb,eb);if(cb.thread_id==n.PENDING_THREAD_ID){this._messages[cb.message_id]=cb;return la.executeOrEnqueue(cb.message_id,db);}else db(cb.thread_id);},isOutbound:function(cb){return cb.author==x.user;},isInbound:function(cb){return !this.isOutbound(cb);},isFirstMessage:function(cb){var db=qa(this,cb.thread_id);if(db.getCurrentArraySize()===0)return false;var eb=db.getResourceAtIndex(db.getCurrentArraySize()-1),fb=ka(this,eb).message_id,gb=ka(this,cb.message_id).message_id;return db.hasReachedEndOfArray()&&fb==gb;},unsubscribeSend:function(cb){la.unsubscribe(cb);},resendMessage:function(cb,db){var eb=ea({},cb);eb.status=k.RESENDING;eb.timestamp=Date.now();eb.message_id=cb.message_id;this._messages[cb.message_id]=eb;var fb=qa(this,cb.thread_id);fb.resortResources([cb.message_id]);this.sendMessage(eb,null,db);this._threadInformer.reorderedMessages(cb.thread_id,s.CLIENT_SEND_MESSAGE);},deleteMessages:function(cb,db){if(db.length){var eb=qa(this,cb),fb=eb.getCurrentArraySize()==db.length&&eb.hasReachedEndOfArray();this._serverRequests.deleteMessages(cb,db,fb);}},markMessagesSpam:function(cb,db){if(db.length){var eb=qa(this,cb),fb=eb.getCurrentArraySize()==db.length&&eb.hasReachedEndOfArray();if(fb){this._serverRequests.markThreadSpam(cb);}else this._serverRequests.markMessagesSpam(cb,db);}},updateLocalMessage:function(cb,db){var eb=cb.message_id,fb=cb.client_message_id;this._localIdsMap[fb]=eb;this._messages[eb]=this._messages[fb];w.addServerID(fb,eb);this._messages[fb]={};var gb=ka(this,fb);if(cb.timestamp)gb.timestamp=cb.timestamp;if(cb.attachments&&cb.attachments.length){gb.raw_attachments=null;gb.attachments=cb.attachments;za(this,gb,eb);}if(cb.log_message_data)gb.log_message_data=cb.log_message_data;if(xa(gb))this._localTitanMessagesCount[gb.thread_id]--;},constructUserGeneratedMessageObject:function(cb,db,eb,fb){var gb=na(this,j.USER_GENERATED_MESSAGE,db,eb);gb.body=cb;gb.has_attachment=false;gb.html_body=false;gb.attachments=[];gb.specific_to_list=fb||[];return gb;},constructLogMessageObject:function(cb,db,eb,fb){var gb=na(this,j.LOG_MESSAGE,cb,db);gb.log_message_type=eb;gb.log_message_data=fb;return gb;},generateNewClientMessageID:function(cb){var db=cb+':'+(ia(0,4294967295)+1)+'-'+y.getSessionID();return '<'+db+'@mail.projektitan.com>';},getNumberLocalMessages:function(cb){return this._localTitanMessagesCount[cb]||0;}});ea(ta,t,{addAttachmentData:function(cb,db,eb,fb){fb=fb||h.user;ta.getForFBID(fb).addAttachmentData(cb,db,eb);}});function ua(cb,db){var eb=db.map(ka.curry(cb));return eb.reverse();}function va(cb,db,eb){var fb=eb.filter(function(gb){return xa(ka(cb,gb));});if(!cb._titanMessagesCount[db])cb._titanMessagesCount[db]=0;cb._titanMessagesCount[db]+=fb.length;}function wa(cb,db,eb){var fb=eb.filter(function(gb){return xa(ka(cb,gb));});if(!cb._localTitanMessagesCount[db])cb._localTitanMessagesCount[db]=0;cb._localTitanMessagesCount[db]+=fb.length;}function xa(cb){var db=cb.action_type;if(db==j.USER_GENERATED_MESSAGE)return true;switch(cb.log_message_type){case p.SUBSCRIBE:case p.UNSUBSCRIBE:case p.SERVER_ERROR:case p.LIVE_LISTEN:return false;default:return true;}}function ya(cb){switch(cb){case u.CHAT_WEB:case u.CHAT_JABBER:case u.CHAT_IPHONE:case u.CHAT_MEEBO:case u.CHAT_ORCA:case u.CHAT_TEST:case u.CHAT:case u.DESKTOP:return true;default:return false;}}function za(cb,db,eb){eb=eb||db.message_id;var fb=cb._attachmentData[eb];if(fb){fb.forEach(function(gb){var hb=db.attachments.indexOf(gb.attach_key);if(hb!==-1)db.attachments[hb]=gb.data;});delete cb._attachmentData[eb];}else if(!db.is_forward&&ab(cb,db)){cb._messagesNeedingAttachmentData[eb]=true;bb(cb);}}function ab(cb,db){if(!db||!db.attachments)return false;for(var eb=0;eb<db.attachments.length;eb++){var fb=db.attachments[eb];if(typeof fb==='string'&&fb.indexOf(m.SHARE)===0)return true;}var gb=db.forward_message_ids||[];for(eb=0;eb<gb.length;eb++){var hb=ka(cb,gb[eb]);if(ab(cb,hb))return true;}return false;}var bb=fa(function(cb){var db={};for(var eb in cb._messagesNeedingAttachmentData){var fb=ka(cb,eb);if(ab(cb,fb))db[eb]=true;}var gb=Object.keys(db);if(gb.length){var hb={message_ids:gb};if(cb._fbid!=h.user)hb.request_user_id=cb._fbid;new g('/ajax/mercury/attachments/fetch_shares.php').setData(hb).setAllowCrossPageTransition(true).send();}cb._messagesNeedingAttachmentData={};},0,this);e.exports=ta;});
__d("ChatOpenTab",["Arbiter","Banzai","Bootloader","ChatVisibility","ContextualThing","Event","MercuryIDs","MercuryMessages","MercuryServerRequests","MercuryThreads","Parent"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Banzai'),i=b('Bootloader'),j=b('ChatVisibility'),k=b('ContextualThing'),l=b('Event'),m=b('MercuryIDs'),n=b('MercuryMessages').get(),o=b('MercuryServerRequests').get(),p=b('MercuryThreads').get(),q=b('Parent'),r='messaging_tracking';function s(x){p.getThreadMeta(x,function(){g.inform('chat/open-tab',{thread_id:x});});}function t(x,y,z,aa){l.listen(x,'click',function(ba){if(aa(y,z))return;return ba.kill();});}function u(x,y,z){var aa={referrer:x||'',message_thread_id:y,message_view:'chat',timestamp_send:Date.now()};if(z!==undefined)aa.message_target_ids=[z];h.post(r,aa,{delay:0,retry:true});}function v(x){var y=k.getRootContext(x);return (y&&q.byClass(y,'uiLayer')!==null);}var w={openEmptyTab:function(x,y){if(!window.Chat||!j.isOnline())return true;i.loadModules(['ChatTabModel'],function(z){var aa=z.getEmptyTab();if(!aa){aa='root:'+n.generateNewClientMessageID(Date.now());p.createNewLocalThread(aa,[]);}s(aa);u(y,aa);});},listenOpenEmptyTab:function(x,y){t(x,null,y,w.openEmptyTab);},openThread:function(x,y){if(m.isValid(x)){s(x);}else o.getClientThreadID(x,s);u(y,x);},listenOpenThread:function(x,y,z){t(x,y,z,w.openThread);},openUserTab:function(x,y){var z=p.getCanonicalThreadToUser(x);s(z.thread_id);u(y,z.thread_id,x);},listenOpenUserTab:function(x,y,z){if(!v(x))t(x,y,z,w.openUserTab);}};e.exports=w;});
__d("ChatQuietLinks",["Event","DOM","UserAgent","DataStore","Parent"],function(a,b,c,d,e,f){var g=b('Event'),h=b('DOM'),i=b('UserAgent'),j=b('DataStore'),k=b('Parent'),l={},m={silenceLinks:function(q){n(q,this.removeEmptyHrefs.bind(this));},nukeLinks:function(q){n(q,this.removeAllHrefs.bind(this));},removeEmptyHrefs:function(q){o(q,function(r){return !r||r==='#';});},removeAllHrefs:function(q){o(q);},removeMessagesHrefs:function(q){o(q,function(r){return !r||r==='#'||r.indexOf('/messages/')!=-1;});}};function n(q,r){var s=!!i.chrome(),t=!!i.chrome()||i.ie()>=9||i.firefox()>=4;if(l[h.getID(q)])return;l[h.getID(q)]=true;if(!t)return;if(!s){r&&r(q);return;}g.listen(q,'mouseover',function u(v){var w=k.byTag(v.getTarget(),'a');if(w){var x=w.getAttribute('href');if(p(x)){j.set(w,'stashedHref',w.getAttribute('href'));w.removeAttribute('href');}}});g.listen(q,'mouseout',function u(v){var w=k.byTag(v.getTarget(),'a'),x=w&&j.remove(w,'stashedHref');if(p(x))w.setAttribute('href',x);});g.listen(q,'mousedown',function(u){if(!u.isDefaultRequested())return true;var v=k.byTag(u.getTarget(),'a'),w=v&&j.get(v,'stashedHref');if(p(w))v.setAttribute('href',w);});}function o(q,r){var s=h.scry(q,'a');if(r)s=s.filter(function(t){return r(t.getAttribute('href'));});s.forEach(function(t){t.removeAttribute('href');t.setAttribute('tabindex',0);});}function p(q){return q&&q!=='#';}e.exports=m;});
__d("LastMobileActiveTimes",["tx"],function(a,b,c,d,e,f){var g=b('tx'),h=0,i={};function j(n){if(!h||!n)return '';var o=h-n,p=Math.floor(o/60),q=Math.floor(p/60),r=Math.floor(q/24);if(p<=1){return g._("{count}m",{count:1});}else if(p<60){return g._("{count}m",{count:p});}else if(q<24){return g._("{count}h",{count:q});}else if(r<3){return g._("{count}d",{count:r});}else return '';}function k(n,o){i[n]=o;}function l(n){if(n in i){return i[n];}else return 0;}var m={update:function(n,o){h=o/1000;for(var p in n)k(p,n[p]);},getShortDisplay:function(n){return j(l(n));}};e.exports=m;});
__d("legacy:ChatTypeaheadBehavior",["ChatTypeaheadBehavior"],function(a,b,c,d){var e=b('ChatTypeaheadBehavior');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.chatTypeahead=function(f){f.enableBehavior(e);};},3);
__d("NotificationURI",["URI"],function(a,b,c,d,e,f){var g=b('URI'),h={localize:function(i){i=g(i);if(!i.isFacebookURI())return i.toString();var j=i.getSubdomain();return i.getUnqualifiedURI().getQualifiedURI().setSubdomain(j).toString();},snowliftable:function(i){if(!i)return false;i=g(i);return i.isFacebookURI()&&i.getQueryData().hasOwnProperty('fbid');},isVaultSetURI:function(i){if(!i)return false;i=g(i);return i.isFacebookURI()&&i.getPath()=='/ajax/vault/sharer_preview.php';}};e.exports=h;});
__d("SplitImage.react",["React","Image.react","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('Image.react'),i=b('cx'),j=g.createClass({displayName:'SplitImage',render:function(){var k=this.props.size;return this.transferPropsTo(g.DOM.div({className:"_55lt",style:{width:k,height:k}},this.renderImages()));},renderImages:function(){if(!this.props.srcs)return null;var k=this.props.srcs,l=Array.isArray(k);if(!l||k.length==1)return this.renderOne(l?k[0]:k);return k.length==2?this.renderTwo(k):this.renderThree(k);},renderOne:function(k){return (h({src:k,width:this.props.size,height:this.props.size}));},renderTwo:function(k){var l=this.props.size,m=Math.floor(l/2),n=-Math.floor(m/2),o=(("_55lu")+(this.props.border?' '+"_57xo":''));return (g.DOM.div(null,g.DOM.div({className:"_55lu",style:{width:m}},h({src:k[0],width:l,height:l,style:{marginLeft:n}})),g.DOM.div({className:o,style:{width:m}},h({src:k[1],width:l,height:l,style:{marginLeft:n}}))));},renderThree:function(k){var l=this.props.size,m=Math.floor(l/3*2),n=-Math.floor((l-m)/2),o=Math.floor(l/2),p=l-m,q=-Math.floor((o-p)/2),r=(("_55lu")+(this.props.border?' '+"_57pl":'')),s=(("_55lu")+(this.props.border?' '+"_57pm":''));return (g.DOM.div(null,g.DOM.div({className:r,style:{width:m}},h({src:k[0],width:l,height:l,style:{marginLeft:n}})),g.DOM.div({className:s,style:{width:p,height:o}},h({src:k[1],width:o,height:o,style:{marginLeft:q}})),g.DOM.div({className:"_55lu",style:{width:p,height:o}},h({src:k[2],width:o,height:o,style:{marginLeft:q}}))));}});e.exports=j;});
__d("ChatSidebarItem.react",["AvailableListConstants","ChatConfig","ChatFavoriteList","ChatSidebarConstants","Image.react","Link.react","React","SplitImage.react","cx","ix"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('ChatConfig'),i=b('ChatFavoriteList'),j=b('ChatSidebarConstants'),k=b('Image.react'),l=b('Link.react'),m=b('React'),n=b('SplitImage.react'),o=b('cx'),p=b('ix'),q=9,r=m.createClass({displayName:'ChatSidebarItem',render:function(){var s=(("_55ln")+(this.props.context?' '+"_55lo":'')+(this.props.unreadCount&&h.get('litestand_buddylist_count')?' '+"_5bom":'')),t;if(this.props.litestandSidebar)t=m.DOM.div({'aria-label':this.props.name,className:"_4_vf",'data-hover':"tooltip",'data-tooltip-position':"right"});return (l({className:s,href:this.props.href,onClick:this.props.onClick,rel:"ignore"},m.DOM.div({className:"_55lp"},this.renderFavorite(),m.DOM.div({className:"_56p9"},this.renderImage(),m.DOM.div({className:"_568w"})),m.DOM.div({className:"_5bon"},this.renderBirthday(),this.renderUnreadCount(),this.renderStatus()),m.DOM.div({className:"_55lr"},this.props.name),m.DOM.div({className:"_55ls"},this.props.context)),t));},renderFavorite:function(){if(this.props.isAdded===undefined)return null;var s=null;if(this.props.litestandSidebar){s=this.props.isAdded?p('/images/litestand/bookmarks/sidebar/remove.png'):p('/images/litestand/bookmarks/sidebar/add.png');}else s=this.props.isAdded?p('/images/chat/delete.png'):p('/images/chat/add.png');var t=(("_568x")+(!this.props.showEditButton?' '+"hidden_elem":''));return (m.DOM.div({className:t,onClick:this.props.onEditClick},k({className:"_568y",src:s})));},renderImage:function(){var s=this.props.imageSize||j.IMAGE_SIZE;return n({size:s,srcs:this.props.images});},renderUnreadCount:function(){var s=this.props.unreadCount;if(!s||!h.get('litestand_buddylist_count'))return null;var t=(("_5boo")+(s>q?' '+"_5bop":''));if(s>q)s=q+'+';return (m.DOM.div({className:t},s));},renderStatus:function(){var s=this.getStatusSrc();if(!s)return null;if(this.props.unreadCount&&h.get('litestand_blended_sidebar')&&h.get('litestand_buddylist_count'))return;var t=h.get('divebar_favorite_list',0)&&i.isEditMode();if(t)return;return (m.DOM.div({className:"_568z"},m.DOM.div({className:"_568-"},this.props.statusTime),k({className:"_568_",src:s})));},renderBirthday:function(){if(!this.props.birthday)return null;var s=p('/images/gifts/icons/cake_icon.png');if(h.get('gray_cake'))s=p('/images/chat/sidebar/livebar/divebar_cake.png');return (k({className:"_5dv3",src:s}));},getStatusSrc:function(){switch(this.props.status){case g.ACTIVE:case g.IDLE:if(this.props.litestandSidebar)return h.get('litestand_blended_sidebar')?p('/images/litestand/sidebar/blended/online.png'):p('/images/litestand/sidebar/online.png');return p('/images/chat/status/online.png');case g.MOBILE:if(this.props.litestandSidebar)return h.get('litestand_blended_sidebar')?p('/images/litestand/sidebar/blended/pushable.png'):p('/images/litestand/sidebar/pushable.png');return p('/images/chat/status/mobile.png');}return null;}});e.exports=r;});
__d("loadImage",[],function(a,b,c,d,e,f){function g(h,i){var j=new Image();j.onload=function(){i(j.width,j.height,j);};j.src=h;}e.exports=g;});
__d("PixelzFocus",[],function(a,b,c,d,e,f){var g={search:function(h,i){var j=0,k=h.length-1;while(j<=k){var l=j+Math.floor((k-j)/2),m=h[l];if(m>i){k=l-1;}else if(m<i){j=l+1;}else return l;}return Math.min(j,k);},forceSpecificPoint:function(h,i,j){var k=1e-09,l=g.search(h,i-j-k)+1,m=g.search(h,i+j);return h.slice(l,m+1);},findBiggestSets:function(h,i){var j=[],k=-1;for(var l=0;l<h.length;++l){var m=h[l],n=l,o=g.search(h,m+i),p=o-n;if(p>k)j=[];if(p>=k){k=p;j.push({low:n,high:o});}}return j;},getBestSet:function(h,i,j){var k=-1,l=null;for(var m=0;m<i.length;++m){var n=i[m],o=h[n.low],p=h[n.high],q=o+(p-o)/2,r=Math.min(o-(q-j),(q+j)-p);if(r>k){k=r;l=n;}}return l;},getFocusFromSet:function(h,i){var j=h[i.low],k=h[i.high];return j+(k-j)/2;},clampFocus:function(h,i){var j=i/2,k=1-(i/2);if(h<j)return j;if(h>k)return k;return h;},convertFromCenterToCSS:function(h,i){if(Math.abs(1-i)<1e-05)return 0;return (h-i/2)/(1-i);},convertFromCSSToCenter:function(h,i){return h*(1-i)+i/2;},getVisible:function(h,i){if(h<i)return h/i;return i/h;},getHidden:function(h,i){return 1-g.getVisible(h,i);},focusHorizontally:function(h,i){return h<i;},convertVectorFromCenterToCSS:function(h,i,j){var k=g.focusHorizontally(i,j),l;if(k){l=h.x/100;}else l=h.x/100;var m=g.convertFromCenterToCSS(l,g.getVisible(i,j));if(k){return {x:m,y:0};}else return {x:0,y:m};},getCropRect:function(h,i,j){var k=g.focusHorizontally(i,j),l=g.getVisible(i,j);if(k){var m=(1-l)*h.x;return {left:m,top:0,width:l,height:1};}else{var n=(1-l)*h.y;return {left:0,top:n,width:1,height:l};}}};e.exports=g;});
__d("Pixelz.react",["arrayContains","copyProperties","cx","invariant","loadImage","React","ReactPropTypes","PixelzFocus"],function(a,b,c,d,e,f){var g=b('arrayContains'),h=b('copyProperties'),i=b('cx'),j=b('invariant'),k=b('loadImage'),l=b('React'),m=b('ReactPropTypes'),n=b('PixelzFocus'),o=l.createClass({displayName:'Pixelz',propTypes:{width:m.number,height:m.number,resizeMode:m.oneOf(['contain','cover','stretch']),alt:m.string,letterbox:m.bool,borderRadius:m.number,insetBorderColor:m.string,animated:m.bool,upscale:m.bool,cropRect:function(p,q,r){var s=p[q],t=('Invalid prop `'+q+'` supplied to `'+r+'`, expected a rectangle with values normalized '+'between 0 and 1');j(s.left>=0);j(s.top>=0);j(s.width>=0);j(s.height>=0);j(s.left+s.width<=1);j(s.top+s.height<=1);},focus:function(p,q,r){var s=p[q],t=('Invalid prop `'+q+'` supplied to `'+r+'`, expected either a {x, y, type} vector where type '+'is `css` or `center` or an array of {x, y} vectors. All the vectors '+'have with values normalized between 0 and 1');if(Array.isArray(s)){for(var u=0;u<s.length;++u){j(s[u].x>=0&&s[u].x<=1);j(s[u].y>=0&&s[u].y<=1);}}else{if(!s.type)s.type='css';j(s.x>=0&&s.x<=1);j(s.y>=0&&s.y<=1);j(g(['center','css'],s.type));}}},getDefaultProps:function(){return {resizeMode:'cover',alt:'',letterbox:true,upscale:true,cropRect:{width:1,height:1,top:0,left:0},focus:{x:.5,y:.5,type:'css'}};},getInitialState:function(){return {srcDimensions:{}};},getSrcDimensions:function(){var p=this.props.src,q=this.state.srcDimensions[p];if(q)return q;k(p,function(r,s){var t={};t[p]={width:r,height:s};this.setState({srcDimensions:t});}.bind(this));return null;},getCropSrcDimensions:function(){var p=this.getSrcDimensions();return {width:p.width*this.props.cropRect.width,height:p.height*this.props.cropRect.height};},getUpscaleCropDimensions:function(){var p=this.getCropSrcDimensions(),q=p.width/p.height,r=this.props.width/this.props.height;if(this.props.width&&this.props.height&&this.props.resizeMode==='stretch')return {width:this.props.width,height:this.props.height};if((!this.props.width&&this.props.height)||((this.props.resizeMode==='contain')!==(q>=r)))return {width:this.props.height*q,height:this.props.height};if(this.props.width)return {width:this.props.width,height:this.props.width/q};return p;},getCropDimensions:function(){var p=this.getUpscaleCropDimensions(),q=this.getCropSrcDimensions();if(!this.props.upscale)return {width:Math.min(p.width,q.width),height:Math.min(p.height,q.height)};return p;},getCropAspectRatio:function(){var p=this.getCropDimensions();return p.width/p.height;},getContainerDimensions:function(){if(this.props.letterbox&&this.props.width&&this.props.height)return {width:this.props.width,height:this.props.height};return this.getCropDimensions();},getContainerAspectRatio:function(){var p=this.getContainerDimensions();return p.width/p.height;},getContainerPosition:function(){return {left:0,top:0};},getFocus:function(){var p=this.props.focus;if(!Array.isArray(p)&&p.type==='css')return {x:p.x,y:p.y};var q=this.getContainerAspectRatio(),r=this.getCropAspectRatio(),s=n.getVisible(q,r),t=n.focusHorizontally(q,r),u;if(!Array.isArray(p)){u=n.convertFromCenterToCSS(t?p.x:p.y,s);}else{var v=p.map(function(y){return t?y.x:y.y;});v.sort();var w=n.findBiggestSets(v,s),x=n.getBestSet(v,w,s);u=n.getFocusFromSet(v,x);}return {x:t?u:.5,y:t?.5:u};},getCropPosition:function(){var p=this.getCropDimensions(),q=this.getContainerDimensions(),r=this.getFocus();return {left:r.x*(q.width-p.width),top:r.y*(q.height-p.height)};},getScaleDimensions:function(){var p=this.getCropDimensions();return {width:p.width/this.props.cropRect.width,height:p.height/this.props.cropRect.height};},getScalePosition:function(){var p=this.getScaleDimensions();return {left:-p.width*this.props.cropRect.left,top:-p.height*this.props.cropRect.top};},getClipCropRectangle:function(){var p=this.getContainerDimensions(),q=this.getCropDimensions(),r=this.getContainerPosition(),s=this.getCropPosition(),t=Math.max(r.left,s.left),u=Math.max(r.top,s.top),v=Math.min(r.top+p.height,s.top+q.height),w=Math.min(r.left+p.width,s.left+q.width);return {left:t,top:u,width:w-t,height:v-u};},getClipCropPosition:function(){var p=this.getClipCropRectangle();return {left:p.left,top:p.top};},getClipCropDimensions:function(){var p=this.getClipCropRectangle();return {width:p.width,height:p.height};},getClipScalePosition:function(){var p=this.getScalePosition(),q=this.getClipCropPosition(),r=this.getCropPosition();return {left:p.left+(r.left-q.left),top:p.top+(r.top-q.top)};},getClipScaleDimensions:function(){return this.getScaleDimensions();},areDimensionsEqual:function(p,q){return p.width===q.width&&p.height===q.height;},shouldAddAllNodesAndStyles:function(){return this.props.animated;},hasCrop:function(){if(this.shouldAddAllNodesAndStyles())return true;var p=this.getContainerDimensions(),q=this.getClipCropDimensions(),r=this.getClipScaleDimensions();if(this.areDimensionsEqual(p,q)||this.areDimensionsEqual(q,r))return false;return true;},hasContainer:function(){if(this.shouldAddAllNodesAndStyles()||this.hasInsetBorder())return true;var p=this.getContainerDimensions(),q=this.getClipScaleDimensions();if(this.areDimensionsEqual(p,q))return false;return true;},hasInsetBorder:function(){return this.shouldAddAllNodesAndStyles()||this.props.insetBorderColor;},applyPositionStyle:function(p,q){if(this.shouldAddAllNodesAndStyles()||q.left)p.left=Math.round(q.left);if(this.shouldAddAllNodesAndStyles()||q.top)p.top=Math.round(q.top);},applyDimensionsStyle:function(p,q){p.width=Math.round(q.width);p.height=Math.round(q.height);},applyBorderRadiusStyle:function(p){if(this.shouldAddAllNodesAndStyles()||this.props.borderRadius)p.borderRadius=this.props.borderRadius||0;},getScaleStyle:function(){var p={},q=this.getClipCropDimensions(),r=this.getClipScaleDimensions();if(this.shouldAddAllNodesAndStyles()||!this.areDimensionsEqual(q,r)){this.applyPositionStyle(p,this.getClipScalePosition());}else this.applyPositionStyle(p,this.getClipCropPosition());this.applyDimensionsStyle(p,this.getClipScaleDimensions());this.applyBorderRadiusStyle(p);return p;},getCropStyle:function(){var p={};this.applyPositionStyle(p,this.getClipCropPosition());this.applyDimensionsStyle(p,this.getClipCropDimensions());this.applyBorderRadiusStyle(p);return p;},getInsetBorderStyle:function(){var p={borderColor:this.props.insetBorderColor||'transparent'};this.applyPositionStyle(p,this.getClipCropPosition());this.applyDimensionsStyle(p,this.getClipCropDimensions());this.applyBorderRadiusStyle(p);return p;},getContainerStyle:function(){var p={};this.applyDimensionsStyle(p,this.getContainerDimensions());this.applyBorderRadiusStyle(p);return p;},getScale:function(){var p=this.getScaleStyle(),q=p.width,r=p.height;p=h({},p);delete p.width;delete p.height;return this.transferPropsTo(l.DOM.img({alt:this.props.alt,className:(("_56wb")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),src:this.props.src,style:p,width:q,height:r}));},getCrop:function(){var p=this.getScale();if(!this.hasCrop())return p;return (l.DOM.div({className:(("_56ma")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getCropStyle()},p));},getInsetBorder:function(){if(!this.hasInsetBorder())return null;return (l.DOM.div({className:(("_56lv")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getInsetBorderStyle()}));},getContainer:function(){var p=this.getCrop();if(!this.hasContainer())return p;var q=this.getInsetBorder();return (l.DOM.div({className:(("_56jj")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getContainerStyle()},p,q));},render:function(){var p=this.getSrcDimensions();if(!p)return l.DOM.span(null);return this.getContainer();}});e.exports=o;});
__d("AbstractButton.react",["Link.react","ReactPropTypes","React","cx","invariant"],function(a,b,c,d,e,f){var g=b('Link.react'),h=b('ReactPropTypes'),i=b('React'),j=b('cx'),k=b('invariant');function l(n,o){if(n.props.className){n.props.className+=' '+o;}else n.props.className=o;}var m=i.createClass({displayName:'AbstractButton',propTypes:{image:function(n,o,p){var q=n[o];k(q==null||i.isValidComponent(q));return q;},depressed:h.bool,imageOnRight:h.bool,href:h.object},render:function(){var n=(("_42ft")+(this.props.disabled?' '+"_42fr":'')+(this.props.depressed?' '+"_42fs":'')),o=this.props.image,p=this.props.label;if(o&&p)if(this.props.imageOnRight){l(o,'mls');}else l(o,'mrs');var q;if(this.props.href){q=g({disabled:null});}else{var r=this.props.type||'submit';q=i.DOM.button({type:r});if(r==='submit')q.props.value='1';}if(this.props.imageOnRight){q.props.children=[p,o];}else q.props.children=[o,p];q.props.className=n;q.props.label=null;return this.transferPropsTo(q);}});e.exports=m;});
__d("XUIButton.react",["AbstractButton.react","ReactPropTypes","React","cx"],function(a,b,c,d,e,f){var g=b('AbstractButton.react'),h=b('ReactPropTypes'),i=b('React'),j=b('cx'),k='medium',l=i.createClass({displayName:'XUIButton',propTypes:{use:h.oneOf(['default','special','confirm']),size:h.oneOf(['small','medium','large','xlarge','xxlarge']),suppressed:h.bool},getDefaultProps:function(){return {use:'default',size:k,suppressed:false};},getButtonSize:function(){return this.props.size||k;},render:function(){var m=this.props.use,n=this.getButtonSize(),o=this.props.suppressed,p=(("_4jy0")+(n==='small'?' '+"_517i":'')+(n==='medium'?' '+"_4jy3":'')+(n==='large'?' '+"_4jy4":'')+(n==='xlarge'?' '+"_4jy5":'')+(n==='xxlarge'?' '+"_4jy6":'')+(m==='default'?' '+"_517h":'')+(m==='confirm'?' '+"_4jy1":'')+(m==='special'?' '+"_4jy2":'')+(o?' '+"_59pe":'')+(m==='confirm'||m==='special'?' '+"selected":''));return this.transferPropsTo(g({className:p}));}});e.exports=l;});
__d("escapeRegex",[],function(a,b,c,d,e,f){function g(h){return h.replace(/([.?*+\^$\[\]\\(){}|\-])/g,"\\$1");}e.exports=g;});
__d("URLMatcher",[],function(a,b,c,d,e,f){var g='!"#%&\'()*,-./:;<>?@[\\]^_`{|}',h='\u2000-\u206F\u00ab\u00bb\uff08\uff09',i='(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])',j='(?:(?:ht|f)tps?)://',k='(?:(?:'+i+'[.]){3}'+i+')',l='\\[(?:(?:[A-Fa-f0-9]{1,4}::?){1,7}[A-Fa-f0-9]{1,4})\\]',m='(?:\\b)www\\d{0,3}[.]',n='[^\\s'+g+h+']',o='(?:(?:(?:[.:\\-_%@]|'+n+')*'+n+')|'+l+')',p='(?:[.][a-z]{2,4})',q='(?::\\d+){0,1}',r='(?=[/?#])',s='(?:'+'(?:'+j+o+q+')|'+'(?:'+k+q+')|'+'(?:'+l+q+')|'+'(?:'+m+o+p+q+')|'+'(?:'+o+p+q+r+')'+')',t='[/#?]',u='\\([^\\s()<>]+\\)',v='[^\\s()<>?#]+',w=new RegExp(s,'im'),x='^\\[[0-9]{1,4}:[0-9]{1,4}:[A-Fa-f0-9]{1,4}\\]',y=new RegExp(x,'im'),z='(?:'+'(?:'+t+')'+'(?:'+'(?:'+u+'|'+v+')*'+')*'+')*',aa=new RegExp('('+'(?:'+s+')'+'(?:'+z+')'+')','im'),ba=new RegExp('('+'(?:'+j+o+q+')|'+'(?:'+m+o+p+q+')'+')'),ca=/[\s'";]/,da=new RegExp(t,'im'),ea=new RegExp('[\\s!"#%&\'()*,-./:;<>?@[\\]^_`{|}\u00ab\u00bb\u2000-\u206F\uff08\uff09]','im'),fa=new RegExp('[\\s()<>?#]','im'),ga=new RegExp('\\s()<>'),ha=function(oa){if(oa&&oa.indexOf('@')!=-1){return (ba.exec(oa))?oa:null;}else return oa;},ia=function(oa){return ja(oa,aa);},ja=function(oa,pa){var qa=(pa.exec(oa)||[])[1]||null;return ha(qa);},ka=function(oa){return w.exec(oa);},la=function(oa){return !ca.test(oa.charAt(oa.length-1));},ma=function(oa){do{var pa=w.exec(oa);if(!pa)return null;var qa=false;if(pa[0][0]==='['&&pa.index>0&&oa[pa.index-1]==='@'){var ra=y.exec(pa[0]);if(ra){qa=true;oa=oa.substr(pa.index+ra[0].length);}}}while(qa);var sa=oa.substr(pa.index+pa[0].length);if(sa.length===0||!(da.test(sa[0])))return ha(pa[0]);var ta=0,ua=0,va=1,wa=0,xa=ua;for(var ya=1;ya<sa.length;ya++){var za=sa[ya];if(xa===ua){if(za==='('){wa=wa+1;xa=va;}else if(da.test(za)||!(ea.test(za))){ta=ya;}else if(fa.test(za))break;}else if(za==='('){wa=wa+1;}else if(za===')'){wa=wa-1;if(wa===0){xa=ua;ta=ya;}}else if(ga.test(za))break;}return ha(pa[0]+sa.substring(0,ta+1));},na={};na.permissiveMatch=ia;na.matchToPattern=ja;na.matchHost=ka;na.trigger=la;na.match=ma;e.exports=na;});
__d("CacheStorage",["WebStorage","ErrorUtils","EventListener","startsWith"],function(a,b,c,d,e,f){var g=b('WebStorage'),h=b('ErrorUtils'),i=b('EventListener'),j=b('startsWith'),k={memory:t,localstorage:r,sessionstorage:s},l='_@_',m='3b',n='CacheStorageVersion';function o(v){this._store=v;}o.prototype.getStore=function(){return this._store;};o.prototype.keys=function(){var v=[];for(var w=0;w<this._store.length;w++)v.push(this._store.key(w));return v;};o.prototype.get=function(v){return this._store.getItem(v);};o.prototype.set=function(v,w){this._store.setItem(v,w);};o.prototype.remove=function(v){this._store.removeItem(v);};o.prototype.clear=function(){this._store.clear();};for(var p in o)if(o.hasOwnProperty(p))r[p]=o[p];var q=o===null?null:o.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=o;function r(){o.call(this,g.getLocalStorage());}r.available=function(){return !!g.getLocalStorage();};for(p in o)if(o.hasOwnProperty(p))s[p]=o[p];s.prototype=Object.create(q);s.prototype.constructor=s;s.__superConstructor__=o;function s(){o.call(this,g.getSessionStorage());}s.available=function(){return !!g.getSessionStorage();};function t(){this._store={};}t.prototype.getStore=function(){return this._store;};t.prototype.keys=function(){return Object.keys(this._store);};t.prototype.get=function(v){if(this._store[v]===undefined)return null;return this._store[v];};t.prototype.set=function(v,w){this._store[v]=w;};t.prototype.remove=function(v){if(v in this._store)delete this._store[v];};t.prototype.clear=function(){this._store={};};t.available=function(){return true;};function u(v,w){this._key_prefix=w||'_cs_';if(v=='AUTO'||!v)for(var x in k){var y=k[x];if(y.available()){v=x;break;}}if(v)if(typeof v=='string'){if(!k[v]||!k[v].available()){this._backend=new t();}else this._backend=new k[v]();}else if(!v.available||!v.available()){this._backend=new t();}else this._backend=v;var z=this.useBrowserStorage();if(z)i.listen(window,'storage',this._onBrowserValueChanged.bind(this));var aa=z?this._backend.getStore().getItem(n):this._backend.getStore()[n];if(aa!==m)this.clear();}u.prototype.useBrowserStorage=function(){return this._backend.getStore()===g.getLocalStorage()||this._backend.getStore()===g.getSessionStorage();};u.prototype.addValueChangeCallback=function(v){this._changeCallbacks=this._changeCallbacks||[];this._changeCallbacks.push(v);return {remove:function(){this._changeCallbacks.slice(this._changeCallbacks.indexOf(v),1);}.bind(this)};};u.prototype._onBrowserValueChanged=function(v){if(this._changeCallbacks&&j(v.key,this._key_prefix))this._changeCallbacks.forEach(function(w){w(v.key,v.oldValue,v.newValue);});};u.prototype.keys=function(){var v=[];h.guard(function(){if(this._backend){var w=this._backend.keys(),x=this._key_prefix.length;for(var y=0;y<w.length;y++)if(w[y].substr(0,x)==this._key_prefix)v.push(w[y].substr(x));}}.bind(this),'CacheStorage')();return v;};u.prototype.set=function(v,w,x){if(this._backend){if(typeof w=='string'){w=l+w;}else if(!x){var y={__t:Date.now(),__v:w};w=JSON.stringify(y);}else w=JSON.stringify(w);var z=this._backend;v=this._key_prefix+v;try{z.set(v,w);}catch(aa){var ba=z.keys().length;this._evictCacheEntries();if(z.keys().length<ba)h.applyWithGuard(z.set,z,[v,w],null,'CacheStorage:set');}}};u.prototype._evictCacheEntries=function(){var v=[],w=this._backend;w.keys().forEach(function(y){if(y===n)return;var z=w.get(y);if(z===undefined){w.remove(y);return;}if(u._hasMagicPrefix(z))return;z=JSON.parse(z);if(z&&z.__t!==undefined&&z.__v!==undefined)v.push([y,z.__t]);});v.sort(function(y,z){return y[1]-z[1];});for(var x=0;x<Math.ceil(v.length/2);x++)w.remove(v[x][0]);};u.prototype.get=function(v,w){var x;if(this._backend){h.applyWithGuard(function(){x=this._backend.get(this._key_prefix+v);},this,null,function(){x=null;},'CacheStorage:get');if(x!==null){if(u._hasMagicPrefix(x)){x=x.substr(l.length);}else try{x=JSON.parse(x);if(x&&x.__t!==undefined&&x.__v!==undefined)x=x.__v;}catch(y){x=undefined;}}else x=undefined;}if(x===undefined&&w!==undefined){x=w;this.set(v,x);}return x;};u.prototype.remove=function(v){if(this._backend)h.applyWithGuard(this._backend.remove,this._backend,[this._key_prefix+v],null,'CacheStorage:remove');};u.prototype.clear=function(){if(this._backend){h.applyWithGuard(this._backend.clear,this._backend,null,null,null,'CacheStorage:clear');if(this.useBrowserStorage()){this._backend.getStore().setItem(n,m);}else this._backend.getStore()[n]=m;}};u.getAllStorageTypes=function(){return Object.keys(k);};u._hasMagicPrefix=function(v){return v.substr(0,l.length)===l;};e.exports=u;});
__d("ModalMask",["DOM"],function(a,b,c,d,e,f){var g=b('DOM'),h=null,i=0,j={show:function(){i++;if(!h){h=g.create('div',{id:'modalMaskOverlay'});g.appendContent(document.body,h);}},hide:function(){if(i){i--;if(!i&&h){g.remove(h);h=null;}}}};e.exports=j;});
__d("WebMessengerPermalinkConstants",["URI"],function(a,b,c,d,e,f){var g=b('URI'),h={ARCHIVED_PATH:'/messages/archived',BASE_PATH:'/messages',OTHER_PATH:'/messages/other',SPAM_PATH:'/messages/spam',COMPOSE_POSTFIX_PATH:'/new',SEARCH_POSTFIX_PATH:'/search',TID_POSTFIX_PARTIAL_PATH:'/conversation-',overriddenVanities:'(archived|other|spam|new|search|conversation-.*)',getURIPathForThreadID:function(i,j){return (j||h.BASE_PATH)+h.TID_POSTFIX_PARTIAL_PATH+g.encodeComponent(g.encodeComponent(i));},getThreadIDFromURI:function(i){var j=i.getPath().match(h.BASE_PATH+'(/[^/]*)*'+h.TID_POSTFIX_PARTIAL_PATH+'([^/]+)');if(j){var k=g.decodeComponent(g.decodeComponent(j[2]));return k;}},getURIPathForIDOrVanity:function(i,j){if(i.match('^'+h.overriddenVanities+'$'))i='.'+i;return (j||h.BASE_PATH)+'/'+i;},getUserIDOrVanity:function(i){var j=i.match(h.BASE_PATH+'.*/([^/]+)/?$'),k=j&&j[1],l=h.overriddenVanities;if(!k||k.match('^'+l+'$')){return false;}else if(k.match('^\\.'+l+'$')){return k.substr(1);}else return k;}};e.exports=h;});
__d("MercuryErrorInfo",["MercuryErrorType","tx"],function(a,b,c,d,e,f){var g=b('MercuryErrorType'),h=b('tx'),i={getMessage:function(j){var k="This message failed to send.";if(i.isConnectionError(j)){k="Unable to connect to Facebook. This message failed to send. ";}else if(j.description)k=j.description;return k;},isConnectionError:function(j){if(j&&j.type==g.TRANSPORT)return j.code===1001||j.code===1004||j.code===1006;return false;},isTransient:function(j){return j&&j.is_transient;},isPermanent:function(j){return j?!this.isTransient(j):false;}};e.exports=i;});
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","MercuryActionTypeConstants","MercuryGlobalActionType","MercuryPayloadSource","MessagingReliabilityLogger","MessagingEvent","MessagingTag","MercuryParticipants","PresenceUtil","MercuryServerRequests","MercuryThreadInformer","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('MercuryActionTypeConstants'),j=b('MercuryGlobalActionType'),k=b('MercuryPayloadSource'),l=b('MessagingReliabilityLogger'),m=b('MessagingEvent'),n=b('MessagingTag'),o=b('MercuryParticipants'),p=b('PresenceUtil'),q=b('MercuryServerRequests').get(),r=b('MercuryThreadInformer').get(),s=b('copyProperties');function t(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj||!ja.obj.message){l.addEntry('channel_receive','invalid_data');return;}var ka=ja.obj.message,la={author:ka.mercury_author_id,author_email:ka.mercury_author_email,body:ka.body,subject:ka.subject,has_attachment:ka.has_attachment,attachments:ka.attachments,html_body:ka.html_body,thread_id:ka.tid,message_id:ka.mid,coordinates:ka.mercury_coordinates,is_spoof_warning:ka.is_spoof_warning,source:ka.mercury_source,source_tags:ka.mercury_source_tags,threading_id:ka.threading_id,timestamp:ka.timestamp,timestamp_absolute:ka.timestamp_absolute,timestamp_relative:ka.timestamp_relative,timestamp_time_passed:ka.timestamp_time_passed,action_type:i.USER_GENERATED_MESSAGE,is_unread:ka.is_unread,action_id:ka.action_id,is_forward:false,forward_count:ka.forward_count||ka.forward,forward_message_ids:ka.forward_msg_ids,location_text:ka.location_text,folder:ja.obj.folder},ma=[s({},la)];ma=ma.concat(ka.forward_actions||[]);var na=k.CLIENT_CHANNEL_MESSAGE;q.handleUpdateWaitForThread({actions:ma,payload_source:na},ka.tid);if(!ka.is_unread&&ka.mercury_author_id===o.user){var oa={};oa[ka.tid]=ja.obj.folder;u(h.getArbiterType('messaging'),{obj:{event:m.READ,tids:[ka.tid],folder_info:oa,timestamp:ka.timestamp}});}l.addEntry('channel_receive','success',[la.thread_id,la.message_id,p.getSessionID()]);}function u(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj||!ja.obj.tids)return;var ka=[],la=ja.obj.event==m.READ;ja.obj.tids.forEach(function(ma){ka.push({action_type:i.CHANGE_READ_STATUS,action_id:null,thread_id:ma,mark_as_read:la,timestamp:ja.obj.timestamp||0,folder:ja.obj.folder_info[ma]});});q.handleUpdate({actions:ka,payload_source:k.CLIENT_CHANNEL_MESSAGE});}function v(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj||!ja.obj.tids)return;var ka=[];ja.obj.tids.forEach(function(la){ka.push({action_type:i.DELETE_THREAD,action_id:null,thread_id:la});});q.handleUpdate({actions:ka,payload_source:k.CLIENT_CHANNEL_MESSAGE});}function w(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj||!ja.obj.tids||!ja.obj.mids)return;var ka=ja.obj.tids[0],la={action_type:i.DELETE_MESSAGES,action_id:null,thread_id:ka,message_ids:ja.obj.mids};q.handleUpdate({actions:[la],threads:[ja.obj.updated_thread],payload_source:k.CLIENT_CHANNEL_MESSAGE});}function x(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj||!ja.obj.folder)return;var ka={action_type:j.MARK_ALL_READ,action_id:ja.obj.action_id,folder:ja.obj.folder};q.handleUpdate({global_actions:[ka]});}function y(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj.tids)return;var ka=k.CLIENT_CHANNEL_MESSAGE;ja.obj.tids.forEach(function(la){var ma={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_id:la,archived:ja.obj.state};q.handleUpdateWaitForThread({actions:[s({},ma)],payload_source:ka},la);});}function z(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj.tids)return;var ka=k.CLIENT_CHANNEL_MESSAGE,la;ja.obj.tids.forEach(function(ma){if(ja.obj.event==m.TAG){la=ja.obj.tag;}else la=ja.obj.marked_as_spam?n.SPAM:n.INBOX;var na={action_type:i.CHANGE_FOLDER,action_id:null,thread_id:ma,new_folder:la};q.handleUpdateWaitForThread({actions:[s({},na)],payload_source:ka},ma);});}function aa(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj.tag)return;switch(ja.obj.tag){case n.ACTION_ARCHIVED:y(ia,ja);break;case n.INBOX:case n.OTHER:z(ia,ja);break;}}function ba(ia,ja){if(ia!=h.getArbiterType('inbox')||!ja.obj||!ja.obj.seen_timestamp)return;q.handleUpdate({message_counts:[{seen_timestamp:ja.obj.seen_timestamp,folder:n.INBOX}],unseen_thread_ids:[{thread_ids:[],folder:n.INBOX}],payload_source:k.CLIENT_CHANNEL_MESSAGE});}function ca(ia,ja){if(ia!=h.getArbiterType('mercury')||!ja.obj)return;r.synchronizeInforms(function(){var ka=ja.obj,la=[];(ka.actions||[]).forEach(function(ma){var na=i.USER_GENERATED_MESSAGE;if(ma.action_type==i.LOG_MESSAGE){var oa=k.CLIENT_CHANNEL_MESSAGE;q.handleUpdateWaitForThread({actions:[s({},ma)],payload_source:oa},ma.thread_id);}else if(ma.action_type!=na)la.push(ma);});ka.actions=la;ka.payload_source=k.CLIENT_CHANNEL_MESSAGE;q.handleUpdate(ka);});}function da(ia,ja){q.handleRoger(ja.obj);}function ea(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj||ja.obj.mute_settings===undefined||!ja.obj.thread_id)return;var ka=i.CHANGE_MUTE_SETTINGS,la=[{action_type:ka,action_id:null,thread_id:ja.obj.thread_id,mute_settings:ja.obj.mute_settings}];q.handleUpdate({actions:la,payload_source:k.CLIENT_CHANNEL_MESSAGE});}function fa(ia,ja){switch(ja.obj.event){case m.DELIVER:t(ia,ja);break;case m.READ:case m.UNREAD:u(ia,ja);break;case m.READ_ALL:x(ia,ja);break;case m.DELETE:v(ia,ja);break;case m.DELETE_MESSAGES:w(ia,ja);break;case m.TAG:aa(ia,ja);break;case m.REPORT_SPAM:z(ia,ja);break;case m.READ_RECEIPT:da(ia,ja);break;case m.CHANGE_MUTE_SETTINGS:ea(ia,ja);break;}}var ga=[],ha={turnOn:function(){if(!ga.length){var ia={mercury:ca,messaging:fa,inbox:ba};for(var ja in ia)ga.push(g.subscribe(h.getArbiterType(ja),ia[ja]));}},turnOff:function(){if(ga.length){ga.forEach(g.unsubscribe);ga=[];}}};ha.turnOn();e.exports=ha;});
__d("MercuryRoger",["ArbiterMixin","MercuryActionStatus","MercuryServerRequests","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('MercuryActionStatus'),i=b('MercuryServerRequests').get(),j=b('copyProperties'),k={},l={getSeenBy:function(m,n){if(!m)return [];var o=[],p=k[m.thread_id],q=h.SUCCESS;for(var r in p)if(p[r]>m.timestamp&&(m.status===undefined||m.status===q)&&(!n||r!=m.author))o.push(r);return o;},getSeenTimestamp:function(m,n){var o=k[m];return o?o[n]:null;}};j(l,g);i.subscribe('update-roger',function(m,n){for(var o in n){if(!k[o])k[o]={};for(var p in n[o]){var q=k[o][p],r=n[o][p];if(!q||r>q)k[o][p]=r;}}if(n)l.inform('state-changed',n);});e.exports=l;});
__d("MercuryDelayedRoger",["ArbiterMixin","LiveTimer","MercuryActionStatus","MercuryConfig","MercuryMessages","MercuryRoger","MercuryThreadInformer","MercuryThreads","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('LiveTimer'),i=b('MercuryActionStatus'),j=b('MercuryConfig'),k=b('MercuryMessages').get(),l=b('MercuryRoger'),m=b('MercuryThreadInformer').get(),n=b('MercuryThreads').get(),o=b('copyProperties'),p=b('setTimeoutAcrossTransitions'),q={},r={},s=j['roger.seen_delay'],t=o({getSeenBy:function(x,y){if(r[x])return [];if(!q[x]){var z=n.getThreadMetaNow(x);if(z)q[x]={thread_id:x,author:z.participants[0],timestamp:z.timestamp};}return l.getSeenBy(q[x],y);}},g);function u(x){var y=false;k.getThreadMessagesRange(x,0,1,function(z){var aa=z[0];if(!aa)return;var ba=aa.timestamp;if(aa.action_id||aa.status==i.SUCCESS)ba-=h.getServerTimeOffset();var ca=t.getSeenBy(x);if(r[x]){clearTimeout(r[x]);delete r[x];}var da=ba+s,ea=da-Date.now();if(ea>0)r[x]=p(function(){delete r[x];v(x);},ea);q[x]=aa;var fa=t.getSeenBy(x);if(ca.length||fa.length)y=true;});return y;}function v(x){var y={};y[x]=true;t.inform('state-changed',y);}function w(event,x){var y={};for(var z in x)if(u(z))y[z]=true;for(var aa in y){t.inform('state-changed',y);break;}}l.subscribe('state-changed',function(x,y){for(var z in y)!r[z]&&v(z);});m.subscribe('messages-received',w);m.subscribe('messages-reordered',w);m.subscribe('messages-updated',w);e.exports=t;});
__d("MercuryFilters",["MessagingTag","arrayContains"],function(a,b,c,d,e,f){var g=b('MessagingTag'),h=b('arrayContains'),i=[g.UNREAD],j={ALL:'all',getSupportedFilters:function(){return i.concat();},isSupportedFilter:function(k){return h(i,k);}};e.exports=j;});
__d("MercuryOrderedThreadlist",["LogHistory","MercuryActionTypeConstants","MercuryFilters","MercuryFolders","MercuryPayloadSource","MercurySingletonMixin","MessagingTag","RangedCallbackManager","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","arrayContains","copyProperties"],function(a,b,c,d,e,f){var g=b('LogHistory'),h=b('MercuryActionTypeConstants'),i=b('MercuryFilters'),j=b('MercuryFolders'),k=b('MercuryPayloadSource'),l=b('MercurySingletonMixin'),m=b('MessagingTag'),n=b('RangedCallbackManager'),o=b('MercuryServerRequests'),p=b('MercuryThreadInformer'),q=b('MercuryThreads'),r=b('arrayContains'),s=b('copyProperties'),t=g.getInstance('ordered_threadlist_model'),u=i.getSupportedFilters().concat([i.ALL,m.GROUPS]),v=j.getSupportedFolders();function w(ga,ha,ia,ja){var ka=[],la=false,ma=false,na=(ha||[]).filter(function(ua){var va=ua.filter||i.ALL;return (ua.folder==ia||(!ua.folder&&ia==m.INBOX))&&va==ja;}),oa=ga._threadlistOrderMap[ia][ja].getAllResources(),pa;na.forEach(function(ua){ka=ka.concat(ua.thread_ids);if(ua.error){if(ua.end>oa.length)ma=ua.error;}else{var va=ua.end-ua.start;if(ua.thread_ids.length<va)la=true;}if(!pa||ua.end>pa)pa=ua.end;});aa(ga,ka,ia,ja);if(la){ga._threadlistOrderMap[ia][ja].setReachedEndOfArray();}else if(ma){ga._threadlistOrderMap[ia][ja].setError(ma);}else{var qa=ga._threadlistOrderMap[ia][ja].getCurrentArraySize();if(pa&&qa<pa){var ra={},sa=oa.concat(ka),ta=sa.filter(function(ua){var va=ra[ua];ra[ua]=true;return va;});if(ta.length){t.warn('duplicate_threads',{folder:ia,expected_final_size:pa,actual_final_size:qa,duplicate_thread_ids:ta});ga._serverRequests.fetchThreadlistInfo(pa,ta.length,ia,ja==i.ALL?null:ja);}}}}function x(ga,ha){v.forEach(function(ia){u.forEach(function(ja){w(ga,ha,ia,ja);});});}function y(ga,ha){var ia={};v.forEach(function(ja){ia[ja]={};u.forEach(function(ka){ia[ja][ka]={to_add:[],to_remove:[],to_remove_if_last_after_add:{}};});});ha.forEach(function(ja){if(ja.is_forward)return;var ka=ja.thread_id,la=ba(ga,ka),ma=ca(ga,ka);function na(){ma.forEach(function(pa){ia[la][pa].to_add.push(ka);if(!ga._threadlistOrderMap[la][pa].hasReachedEndOfArray()&&!ga._threadlistOrderMap[la][pa].hasResource(ka))ia[la][pa].to_remove_if_last_after_add[ka]=true;});}function oa(pa){if(r(u,pa))if(r(ma,pa)){ia[la][pa].to_add.push(ka);}else ia[la][pa].to_remove.push(ka);}if(!la){if(ja.action_type===h.CHANGE_FOLDER||ja.action_type===h.CHANGE_ARCHIVED_STATUS)v.forEach(function(pa){if(pa!==la)u.forEach(function(qa){ga._threadlistOrderMap[pa][qa].removeResources([ka]);});});return;}switch(ja.action_type){case h.DELETE_THREAD:ma.forEach(function(pa){ia[la][pa].to_remove.push(ka);});break;case h.CHANGE_ARCHIVED_STATUS:case h.CHANGE_FOLDER:na();break;case h.CHANGE_READ_STATUS:oa(m.UNREAD);break;case h.USER_GENERATED_MESSAGE:case h.LOG_MESSAGE:ma.forEach(function(pa){if(da(ga,ka,la,pa))ia[la][pa].to_add.push(ka);});break;}});v.forEach(function(ja){u.forEach(function(ka){var la=ga._threadlistOrderMap[ja][ka];aa(ga,ia[ja][ka].to_add,ja,ka);for(var ma=la.getCurrentArraySize()-1;ma>=0;ma--){var na=la.getResourceAtIndex(ma);if(!ia[ja][ka].to_remove_if_last_after_add[na])break;ia[ja][ka].to_remove.push(na);}la.removeResources(ia[ja][ka].to_remove);});});}function z(ga,ha){var ia={};v.forEach(function(ja){ia[ja]={};u.forEach(function(ka){ia[ja][ka]=[];});});ha.forEach(function(ja){var ka=ba(ga,ja.thread_id),la=ca(ga,ja.thread_id);if(ka)la.forEach(function(ma){if(da(ga,ja.thread_id,ka,ma))ia[ka][ma].push(ja.thread_id);});});v.forEach(function(ja){u.forEach(function(ka){if(ia[ja][ka].length>0)aa(ga,ia[ja][ka],ja,ka);});});}function aa(ga,ha,ia,ja){ja=ja||i.ALL;ga._threadlistOrderMap[ia][ja].addResources(ha);v.forEach(function(ka){if(ka!=ia)ga._threadlistOrderMap[ka][ja].removeResources(ha);});}function ba(ga,ha){var ia=ga._threads.getThreadMetaNow(ha),ja=null;if(!ia){ja='No thread metadata';}else if(!ia.folder)ja='No thread folder';if(ja){var ka={error:ja,tid:ha};t.warn('no_thread_folder',ka);return null;}var la=ia.folder;if(ia.is_archived)la=m.ACTION_ARCHIVED;if(ga._threadlistOrderMap[la]){return la;}else return null;}function ca(ga,ha){var ia=ga._threads.getThreadMetaNow(ha),ja=[i.ALL];if(!ia){var ka={error:'no_thread_metadata',tid:ha};t.warn('no_thread_metadata',ka);return [];}if(ia.unread_count)ja.push(m.UNREAD);if(!ia.is_canonical)ja.push(m.GROUPS);return ja;}function da(ga,ha,ia,ja){var ka=ga._threads.getThreadMetaNow(ha);return ka&&ka.timestamp&&ba(ga,ha)==ia&&r(ca(ga,ha),ja);}function ea(ga){this._fbid=ga;this._serverRequests=o.getForFBID(this._fbid);this._threadInformer=p.getForFBID(this._fbid);this._threads=q.getForFBID(this._fbid);this._threadlistOrderMap={};v.forEach(function(ha){this._threadlistOrderMap[ha]={};u.forEach(function(ia){this._threadlistOrderMap[ha][ia]=new n(function(ja){return this._threads.getThreadMetaNow(ja).timestamp;}.bind(this),function(ja,ka){return ka-ja;},this._serverRequests.canLinkExternally.bind(this._serverRequests));}.bind(this));}.bind(this));this._serverRequests.subscribe('update-threadlist',function(ha,ia){if(!fa(ia))return;var ja=ia.ordered_threadlists;if(ja&&ja.length){x(this,ja);}else{var ka=(ia.actions||[]).filter(function(la){return la.thread_id;});z(this,ia.threads||[]);y(this,ka);}this._threadInformer.updatedThreadlist();}.bind(this));}s(ea.prototype,{getThreadlist:function(ga,ha,ia,ja,ka,la){return this.getFilteredThreadlist(ga,ha,ia,i.ALL,ja,ka,la);},getFilteredThreadlist:function(ga,ha,ia,ja,ka,la,ma){var na=this._threadlistOrderMap[ia][ja],oa=na.executeOrEnqueue(ga,ha,ka,la),pa=na.getUnavailableResources(oa),qa=na.getError(ga,ha,la);if(pa.length||qa){if(na.getCurrentArraySize()<ga){var ra={start:ga,limit:ha,filter:ja,resources_size:na.getCurrentArraySize()};t.warn('range_with_gap',ra);}na.setError(false);this._serverRequests.fetchThreadlistInfo(na.getCurrentArraySize(),pa.length,ia,ja==i.ALL?null:ja,ma);}return oa;},getThreadlistUntilTimestamp:function(ga,ha,ia){ia=ia||i.ALL;return this._threadlistOrderMap[ha][ia].getElementsUntil(ga);},unsubscribe:function(ga,ha,ia){ia=ia||i.ALL;this._threadlistOrderMap[ha][ia].unsubscribe(ga);}});s(ea,l);function fa(ga){switch(ga.payload_source){case k.CLIENT_CHANGE_ARCHIVED_STATUS:case k.CLIENT_CHANGE_READ_STATUS:case k.CLIENT_CHANGE_FOLDER:case k.CLIENT_CHANNEL_MESSAGE:case k.CLIENT_DELETE_MESSAGES:case k.CLIENT_DELETE_THREAD:case k.CLIENT_SEND_MESSAGE:case k.SERVER_SEND_MESSAGE:case k.SERVER_CONFIRM_MESSAGES:case k.SERVER_FETCH_THREADLIST_INFO:case k.SERVER_THREAD_SYNC:return true;case k.SERVER_INITIAL_DATA:return ga.ordered_threadlists;default:return false;}}e.exports=ea;});
__d("MercuryUnseenState",["TimestampConverter","KeyedCallbackManager","LogHistory","MercuryActionTypeConstants","MercurySingletonMixin","MercuryThreadlistConstants","MessagingTag","MercuryServerRequests","ReportState","MercuryThreadInformer","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('TimestampConverter'),h=b('KeyedCallbackManager'),i=b('LogHistory'),j=b('MercuryActionTypeConstants'),k=b('MercurySingletonMixin'),l=b('MercuryThreadlistConstants'),m=b('MessagingTag'),n=b('MercuryServerRequests'),o=b('ReportState'),p=b('MercuryThreadInformer'),q=b('copyProperties'),r=b('createObjectFrom'),s=l.MAX_UNSEEN_COUNT,t='unseen_thread_hash',u='unseen_thread_list',v=i.getInstance('mercury_unseen_state');function w(ja){this._fbid=ja;this._serverRequests=n.getForFBID(this._fbid);this._threadInformer=p.getForFBID(this._fbid);this._initialUnseenCount=0;this._lastSeenTimestamp=0;this._maxCount=false;this._unseenResources=new h();this._serverRequests.subscribe('update-unseen',function(ka,la){ba(this,la);}.bind(this));this._serverRequests.subscribe('update-thread-ids',function(ka,la){ha(this,la);}.bind(this));}q(w.prototype,{getUnseenCount:function(){if(this.exceedsMaxCount()){v.error('unguarded_unseen_count_fetch',{});return 0;}return aa(this);},exceedsMaxCount:function(){return this._maxCount||(aa(this)>s);},markAsSeen:function(){if(aa(this)>0||this._maxCount){this._serverRequests.markSeen();ca(this,g.convertActionIDToTimestamp(this._serverRequests.getLastActionID()),[]);}},markThreadSeen:function(ja,ka){var la={};la[ja]=null;ea(this,la,ka);}});q(w,k);function x(ja,ka){ja._unseenResources.setResource(t,ka);ja._unseenResources.setResource(u,Object.keys(ka));}function y(ja,ka){var la=ja._unseenResources.executeOrEnqueue(t,ka),ma=ja._unseenResources.getUnavailableResources(la);if(ma.length)ja._serverRequests.fetchUnseenThreadIDs();}function z(ja){return ja._unseenResources.getResource(t);}function aa(ja){var ka=ja._unseenResources.getResource(u);if(ka){return ka.length;}else return ja._initialUnseenCount;}function ba(ja,ka){var la=ia(ka);if(ka.unseen_thread_ids){ka.unseen_thread_ids.forEach(function(wa){if(wa.folder!=m.INBOX)return;var xa=ga(ja,wa.thread_ids),ya=ja._lastSeenTimestamp;if(la&&la.seen_timestamp)ya=la.seen_timestamp;ca(ja,ya,xa);if(la&&la.unseen_count>s)ja._maxCount=true;});}else if(la&&la.seen_timestamp){ja._lastSeenTimestamp=la.seen_timestamp;if(la.unseen_count>s){ja._maxCount=true;x(ja,{});}else{ja._initialUnseenCount=la.unseen_count;if(ja._initialUnseenCount===0)x(ja,{});}}else{if(ja._maxCount)return;var ma=ka.actions;if(!ma||!(ma.length))return;var na={},oa={};for(var pa=0;pa<ma.length;pa++){var qa=ma[pa];if(qa.is_forward)continue;var ra=qa.action_type,sa=qa.action_id,ta=qa.thread_id?qa.thread_id:qa.server_thread_id,ua=qa.folder===undefined||qa.folder==m.INBOX;if(!ua)continue;if(ra==j.USER_GENERATED_MESSAGE||ra==j.LOG_MESSAGE){var va=g.isGreaterThan(sa,na[ta]);if(qa.is_unread&&(!na[ta]||va))na[ta]=sa;}else if(ra==j.CHANGE_READ_STATUS&&qa.mark_as_read)oa[ta]=sa;}da(ja,na);ea(ja,oa);}}function ca(ja,ka,la){var ma=z(ja);if(ma===undefined||ka>ja._lastSeenTimestamp||ja._maxCount){ja._lastSeenTimestamp=ka;la=la||[];if(la.length<=s)ja._maxCount=false;var na={},oa=z(ja)||{};for(var pa in oa)if(oa[pa]!==true){var qa=oa[pa];if(fa(ja,qa))na[pa]=qa;}var ra=q(r(la,true),na);x(ja,ra);ja._threadInformer.updatedUnseenState();}}function da(ja,ka){if(ja._maxCount)return;var la={},ma=false;for(var na in ka){var oa=ka[na];if(fa(ja,oa)){la[na]=oa;ma=true;}}if(!ma)return;y(ja,function(pa){for(var qa in la){var ra=la[qa];if(!pa[qa]&&fa(ja,ra))pa[qa]=la[qa];}x(ja,pa);ja._threadInformer.updatedUnseenState();});}function ea(ja,ka,la){var ma=false;for(var na in ka){ma=true;break;}if(ma)y(ja,function(oa){var pa=false;for(var qa in ka){var ra=ka[qa],sa=g.isGreaterThan(ra,oa[qa]);if(oa[qa]&&(!ra||sa)){delete oa[qa];pa=true;}}if(pa){x(ja,oa);ja._threadInformer.updatedUnseenState();if(la&&aa(ja)===0)ja._serverRequests.markSeen();}});}function fa(ja,ka){var la=g.convertActionIDToTimestamp(ka);return la>ja._lastSeenTimestamp;}function ga(ja,ka){return ka.map(ja._serverRequests.convertThreadIDIfAvailable.bind(ja._serverRequests));}function ha(ja,ka){var la=z(ja);if(!la)return;for(var ma in ka){var na=ka[ma];if(la[ma]){la[na]=la[ma];delete la[ma];}}x(ja,la);}function ia(ja){var ka=(ja.message_counts||[]);for(var la=0;la<ka.length;la++)if(ka[la].folder==m.INBOX)return ka[la];return null;}o.registerCallback('mercury-unseen-state',function(){var ja={};ja.unseen={};ja.unseen_max_count={};ja.unseen_time={};var ka=w._getInstances();for(var la in ka){ja.unseen[la]=q({},z(ka[la]));ja.unseen_max_count[la]=ka[la]._maxCount;ja.unseen_time[la]=ka[la]._lastSeenTimestamp;}return ja;});e.exports=w;});
__d("MercuryStickerConstants",[],function(a,b,c,d,e,f){var g={LIKE_STICKER_FBID:227878347358915};e.exports=g;});
__d("MercuryThreadMetadataRawRenderer",["Event","CSS","DOM","MercuryActionStatus","MercuryErrorInfo","MessagingTag","MercuryStatusTemplates","Tooltip","URI","WebMessengerPermalinkConstants","cx","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('MercuryActionStatus'),k=b('MercuryErrorInfo'),l=b('MessagingTag'),m=b('MercuryStatusTemplates'),n=b('Tooltip'),o=b('URI'),p=b('WebMessengerPermalinkConstants'),q=b('cx'),r=b('tx'),s={renderParticipantListWithNoThreadName:function(u,v,w,x,y,z){var aa={callback:true,check_length:true,show_unread_count:true};z=z||{};var ba={};for(var ca in z)if(aa[ca]){ba[ca]=z[ca];delete z[ca];}var da=w.map(function(ia){return x[ia];}),ea=this.renderRawParticipantList(u,da,w.length,z);ea=this.renderRawTitleWithUnreadCount(ea,ba.show_unread_count?v.unread_count:0);var fa=z.abbr_mode,ga={};for(var ha in z)ga[ha]=z[ha];ga.abbr_mode=true;y.forEach(function(ia){var ja=y.length>1?this._cloneIfDOMElement(ea):ea;i.setContent(ia,ja);if(ba.check_length&&!fa&&ia.scrollWidth>ia.clientWidth){var ka=this.renderRawParticipantList(u,da,w.length,ga),la=this.renderRawTitleWithUnreadCount(ka,ba.show_unread_count?v.unread_count:0);i.setContent(ia,la);}}.bind(this));ba.callback&&ba.callback(ea);},renderRawParticipantList:function(u,v,w,x){var y={abbr_mode:true,last_separator_uses_and:true,names_renderer:true};x=x||{};var z=null;if(x.names_renderer){z=x.names_renderer(v);}else z=v.map(function(ca){return ca.name;});var aa=null;if(z.length===0){if(!u){aa="New Message";}else aa="No Participants";}else if(z.length==1){aa=z[0];}else if(z.length==2){var ba={participant1:z[0],participant2:z[1]};if(x.last_separator_uses_and){aa=r._("{participant1} and {participant2}",ba);}else aa=r._("{participant1}, {participant2}",ba);}else if(x.last_separator_uses_and){if(x.abbr_mode){aa=r._("{participant1} and {others_link}",{participant1:z[0],others_link:this.renderRawParticipantCount(u,{render_subset:true,count:w-1})});}else if(z.length==3){aa=r._("{participant1}, {participant2} and {participant3}",{participant1:z[0],participant2:z[1],participant3:z[2]});}else aa=r._("{participant1}, {participant2} and {others_link}",{participant1:z[0],participant2:z[1],others_link:this.renderRawParticipantCount(u,{render_subset:true,count:w-2})});}else if(z.length==3){aa=r._("{participant1}, {participant2}, {participant3}",{participant1:z[0],participant2:z[1],participant3:z[2]});}else aa=r._("{participant1}, {participant2}, {participant3}, {others_link}",{participant1:z[0],participant2:z[1],participant3:z[2],others_link:this.renderRawParticipantCount(u,{render_subset:true,count:w-3})});if(Array.isArray(aa))aa=i.create('span',{},aa);return aa;},renderRawTitleWithUnreadCount:function(u,v){var w=u;if(v&&v>1)w=i.create('span',{},r._("{conversation_title} ({unread_count})",{conversation_title:u,unread_count:v}));return w;},renderRawParticipantCount:function(u,v){var w=v.render_subset,x;if(!w){x=v.count>1?r._("{num} people",{num:v.count}):"1 person";}else x=v.count>1?r._("{others_count} others",{others_count:v.count}):"1 other";return x;},renderShortNames:function(u){if(u.length==1)return [u[0].name];return u.map(function(v){return v.short_name;});},getUserCanonicalTitanURL:function(u,v,w){var x=new o().setSubdomain('www'),y=u.substr(u.indexOf(':')+1);x.setPath(t(w)+'/'+y);v&&v(x.toString());return x.toString();},getTitanURLWithServerID:function(u,v,w){var x=new o().setSubdomain('www');x.setPath(p.getURIPathForThreadID(u,t(w)));v&&v(x.toString());return x.toString();},renderUserCanonicalTitanLink:function(u,v,w,x){var y=this.getUserCanonicalTitanURL(u,null,x);v.setAttribute('href',y);w&&w();},renderTitanLinkWithServerID:function(u,v,w,x){var y=this.getTitanURLWithServerID(u,null,x);v.setAttribute('href',y);w&&w();},renderStatusIndicator:function(u,v,w){var x;if(u==j.RESENDING){x=this.renderResendIndicator();}else if(u!==undefined&&u!=j.UNSENT&&u!=j.UNCONFIRMED&&u!=j.SUCCESS)x=this.renderErrorIndicator(v,w);return x;},renderResendIndicator:function(){return m[':fb:mercury:resend-indicator'].render();},renderErrorIndicator:function(u,v){if(!u)return null;var w=m[':fb:mercury:error-indicator'].render(),x=u.is_transient,y=k.getMessage(u);if(x)if(k.isConnectionError(u)){y=r._("{message} Check your network connection or click to try again.",{message:y});}else y=r._("{message} Click to send again.",{message:y});n.set(w,y,'above','center');if(v&&x){g.listen(w,'click',v);w.setAttribute('tabindex','0');h.addClass(w,"_55q-");}return w;},_cloneIfDOMElement:function(u){if(u.cloneNode){return u.cloneNode();}else return u;}};function t(u){var v=p.BASE_PATH;if(u&&u!=l.INBOX)v+='/'+u;return v;}e.exports=s;});
__d("MercurySeenByAll",["CSS","DataStore","DOM","MercuryParticipants","MercuryDelayedRoger","MercuryThreads"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DataStore'),i=b('DOM'),j=b('MercuryParticipants'),k=b('MercuryDelayedRoger'),l=b('MercuryThreads').get(),m={},n={updateOnSeenChange:function(p,q){m[p.tagName]=true;h.set(p,'thread-id',q.thread_id);g.addClass(p,'seenByListener');o(p,q);}};function o(p,q){var r=q.participants.filter(function(t){return t!==j.user;}),s=q.participants.length>0&&q.participants[0]===j.user;g.conditionClass(p,'repliedLast',s);g.conditionClass(p,'seenByAll',s&&k.getSeenBy(q.thread_id).length===r.length);}k.subscribe('state-changed',function(p,q){for(var r in m){var s=i.scry(document.body,r+'.seenByListener');for(var t=0;t<s.length;t++){var u=s[t],v=h.get(u,'thread-id');if(q[v])l.getThreadMeta(v,function(w){o(u,w);});}}});e.exports=n;});
__d("MercuryThreadMetadataRenderer",["CSS","DOM","Emoji","EmoticonsList","HTML","JSLogger","MercuryAttachment","MercuryAttachmentType","MercuryMessageSourceTags","MercurySingletonMixin","MercuryStickerConstants","MercuryThreadMetadataRawRenderer","MercuryParticipants","MercuryParticipantsConstants","Pixelz.react","React","MercurySeenByAll","MercuryServerRequests","SplitImage.react","Style","MercuryThreadlistIconTemplates","MercuryThreads","Tooltip","URI","arrayContains","createArrayFrom","copyProperties","cx","emojiAndEmote","fbt","formatDate","tx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Emoji'),j=b('EmoticonsList'),k=b('HTML'),l=b('JSLogger'),m=b('MercuryAttachment'),n=b('MercuryAttachmentType'),o=b('MercuryMessageSourceTags'),p=b('MercurySingletonMixin'),q=b('MercuryStickerConstants'),r=b('MercuryThreadMetadataRawRenderer'),s=b('MercuryParticipants'),t=b('MercuryParticipantsConstants'),u=b('Pixelz.react'),v=b('React'),w=b('MercurySeenByAll'),x=b('MercuryServerRequests'),y=b('SplitImage.react'),z=b('Style'),aa=b('MercuryThreadlistIconTemplates'),ba=b('MercuryThreads'),ca=b('Tooltip'),da=b('URI'),ea=b('arrayContains'),fa=b('createArrayFrom'),ga=b('copyProperties'),ha=b('cx'),ia=b('emojiAndEmote'),ja=b('fbt'),ka=b('formatDate'),la=b('tx'),ma=l.create('wm_timestamp');function na(ta){this._fbid=ta;this._serverRequests=x.getForFBID(ta);this._threads=ba.getForFBID(ta);}ga(na,p);ga(na.prototype,{renderTimestamp:function(ta,ua,va,wa){if(wa){if(!ua){ma.warn('no_title');ua=(new Date(wa)).toLocaleDateString();}ta.setAttribute('title',ua);ta.setAttribute('data-utime',wa/1000);if(!va){ma.warn('no_display');va=ka(new Date(wa),'g:ia');}h.setContent(ta,va);g.show(ta);}},renderMessageSourceTags:function(ta,ua,va,wa){var xa='',ya='',za='';if(ea(va,o.MESSENGER)){xa="Sent from Messenger";ya=new da('/mobile/messenger');za="_9g";}else if(ea(va,o.MOBILE)){xa="Sent from Mobile";ya=new da('/mobile/');za="_9j";}else if(ea(va,o.CHAT)){xa="Sent from chat";za="_9h";}else if(ea(va,o.EMAIL)){if(wa){xa=la._("Sent from {email}",{email:wa});}else xa="Sent from email";za="_9i";}if(za){ca.set(ta,xa);g.addClass(ua,za);if(ya){ta.setAttribute('href',ya);}else ta.removeAttribute('href');}else g.hide(ta);},renderMessageLocation:function(ta,ua,va){var wa=da('/ajax/messaging/hovercard/map.php').setQueryData(va);ta.setAttribute('data-hovercard',wa);g.removeClass(ta,"_b9");g.show(ua);},renderSpoofWarning:function(ta,ua,va){if(ua){g.addClass(ta,"_sa");ca.set(ta,la._("Unable to confirm {name_or_email} as the sender.",{name_or_email:va.name}));}},renderChatSpoofWarning:function(ta,ua,va){if(ua)h.appendContent(ta,la._("Unable to confirm {name_or_email} as the sender.",{name_or_email:va.name}));},renderCoreThreadlist:function(ta,ua,va,wa,xa){wa=wa||{};this.renderThreadImage(ta,ua.getNode('image'));var ya=ua.getNode('accessibleName'),za=[ua.getNode('name')];if(ya)za.push(ya);sa(this,ta,za,wa);if(ta.folder&&xa)ra(ua.getNode('folderBadge'),ta.folder);var ab=ua.getNode('timestamp');this.renderTimestamp(ab,ta.timestamp_absolute,ta.timestamp_relative,ta.timestamp);this.renderSnippet(ta,ua.getNode('snippet'));pa(ua,ta);va(ua,ta);},renderAndSeparatedParticipantList:function(ta,ua,va){va=va||{};va.last_separator_uses_and=true;this._threads.getThreadMeta(ta,function(wa){sa(this,wa,ua,va);}.bind(this));},renderSnippet:function(ta,ua){var va=false,wa=h.create('span');g.addClass(wa,'MercuryRepliedIndicator');h.appendContent(ua,wa);w.updateOnSeenChange(wa,ta);var xa=ta.snippet;if(xa){if(ta.snippet_has_attachment)h.appendContent(ua,h.create('span',{className:'MercuryAttachmentIndicator'}));if(ta.is_forwarded_snippet)h.appendContent(ua,h.create('strong',{className:"_55q_"},"Forwarded Message:"));if(xa.substr(0,4)=='?OTR'){xa="[encrypted message]";}else xa=xa.replace(/\r\n|[\r\n]/g," ");xa=k(i.htmlEmojiAndEmote(xa));}else{if(ta.is_forwarded_snippet)h.appendContent(ua,h.create('strong',{className:"_55q_"},"Forwarded Message"));if(ta.snippet_has_attachment&&ta.snippet_attachments&&ta.snippet_attachments.length){va=true;xa=h.create('span');qa(this,ta,xa);}}var ya=ta.participants.length;if(ta.is_subscribed)ya--;if(!va&&ta.snippet_sender&&s.getIDForUser(this._fbid)!=ta.snippet_sender&&ya>1){s.get(ta.snippet_sender,function(za){if(za.short_name){h.appendContent(ua,la._("{name}: {conversation_snippet}",{name:za.short_name,conversation_snippet:xa}));}else h.appendContent(ua,xa);});}else h.appendContent(ua,xa);},getTitanURL:function(ta,ua,va){if(ta.substr(0,ta.indexOf(':'))=='user'){r.getUserCanonicalTitanURL(ta,ua,va);}else this._serverRequests.getServerThreadID(ta,function(wa){r.getTitanURLWithServerID(wa,ua,va);});},renderTitanLink:function(ta,ua,va,wa){if(ta.substr(0,ta.indexOf(':'))=='user'){r.renderUserCanonicalTitanLink(ta,ua,va,wa);}else this._serverRequests.getServerThreadID(ta,function(xa){r.renderTitanLinkWithServerID(xa,ua,va,wa);});},renderThreadImage:function(ta,ua){if(ta.image_src){var va=u({height:t.BIG_IMAGE_SIZE,resizeMode:'cover',src:ta.image_src,width:t.BIG_IMAGE_SIZE});v.renderComponent(va,ua);return;}var wa=s.getIDForUser(this._fbid),xa=[],ya=ta.participants.filter(function(za){return za!=wa;});if(!ya.length){xa=[wa];}else if(ya.length==1){xa=[ya[0]];}else xa=ya.slice(0,3);this.renderParticipantImages(xa,ua);},renderParticipantImages:function(ta,ua){s.getOrderedBigImageMulti(ta,function(va){var wa=y({srcs:va,border:true,size:t.BIG_IMAGE_SIZE});v.renderComponent(wa,ua);});},renderParticipantList:function(ta,ua,va,wa){return r.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(ta),ua,va,wa);},renderThreadNameAndParticipantList:function(ta,ua,va,wa){var xa=r.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(ta),ua,va,wa),ya=this._threads.getThreadMetaNow(ta);if(!ya.name)return xa;return la._("{conversation_name} [with {participant_list}]",{conversation_name:ya.name,participant_list:xa});},renderParticipantCount:function(ta,ua){return r.renderRawParticipantCount(this._serverRequests.getServerThreadIDNow(ta),ua);}});function oa(ta){if(!ta.snippet_attachments)return [];return ta.snippet_attachments.filter(function(ua){return ua.attach_type===n.PHOTO;});}function pa(ta,ua){var va=oa(ua);if(va.length===0)return;var wa=va[0].thumbnail_url;if(!wa)return;var xa=(va.length==1)?'snippet-thumbnail-single':'snippet-thumbnail-multiple',ya=ta.getNode(xa);if(!ya)return;var za=h.find(ya,'i');z.set(za,'background-image','url('+wa+')');g.show(ya);}function qa(ta,ua,va){var wa=ua.snippet_sender&&s.getIDForUser(ta._fbid)==ua.snippet_sender,xa=function(db){if(!ua.snippet_sender||wa){db(null);return;}s.get(ua.snippet_sender,function(eb){db(eb.short_name);});},ya=oa(ua),za=ya.length==ua.snippet_attachments.length,ab=ua.snippet_attachments.length===1&&ua.snippet_attachments[0].metadata&&ua.snippet_attachments[0].metadata.type=='fb_voice_message',bb=ua.snippet_attachments.length===1&&ua.snippet_attachments[0].attach_type===n.STICKER,cb=ua.snippet_attachments.length===1&&ua.snippet_attachments[0].attach_type===n.SHARE;xa(function(db){var eb=null;if(za){var fb=aa[':fb:mercury:attachment-icon-text'].build().getRoot();if(ya.length===1){eb=wa?"You sent a photo.":la._("{name} sent a photo.",{name:db});}else eb=wa?la._("You sent {num_photos} photos.",{num_photos:ya.length}):la._("{name} sent {num_photos} photos.",{name:db,num_photos:ya.length});g.addClass(fb,m.getAttachIconClass(ya[0].icon_type));h.appendContent(fb,eb);h.appendContent(va,fb);}else if(ab){var gb=aa[':fb:mercury:attachment-icon-text'].build().getRoot();eb=wa?"You sent a voice message.":la._("{name} sent a voice message.",{name:db});g.addClass(gb,m.getAttachIconClass(ua.snippet_attachments[0].icon_type));h.appendContent(gb,eb);h.appendContent(va,gb);}else if(bb){if(ua.snippet_attachments[0].metadata.stickerID==q.LIKE_STICKER_FBID){eb=ia(j.symbols.like);}else eb=wa?"You sent a sticker.":la._("{name} sent a sticker.",{name:db});h.appendContent(va,eb);}else if(cb){var hb=aa[':fb:mercury:attachment-icon-text'].build().getRoot();if(wa){eb="You shared a link.";}else eb=ja._("{sender name} shared a link.",[ja.param("sender name",db)]);g.addClass(hb,m.getAttachIconClass(ua.snippet_attachments[0].icon_type));h.appendContent(hb,eb);h.appendContent(va,hb);}else ua.snippet_attachments.filter(function(ib){return ib.attach_type==n.FILE||ib.attach_type==n.PHOTO;}).forEach(function(ib){var jb=aa[':fb:mercury:attachment-icon-text'].build().getRoot();h.appendContent(jb,ib.name);g.addClass(jb,m.getAttachIconClass(ib.icon_type));h.appendContent(va,jb);});});}function ra(ta,ua){fa(ta).forEach(function(va){h.setContent(va,ua);});}function sa(ta,ua,va,wa){va=fa(va);if(ua.name){var xa=r.renderRawTitleWithUnreadCount(ua.name,wa.show_unread_count?ua.unread_count:0);va.forEach(function(za){h.setContent(za,xa);});wa.callback&&wa.callback(xa);return;}var ya=ua.participants;if(ua.participants.length>1)ya=ua.participants.filter(function(za){return za!=s.getIDForUser(ta._fbid);});s.getMulti(ya,function(za){r.renderParticipantListWithNoThreadName(ta._serverRequests.getServerThreadIDNow(ua.thread_id),ua,ya,za,va,wa);});}e.exports=na;});
__d("MercuryThreadSearchUtils",["escapeRegex","TokenizeUtil"],function(a,b,c,d,e,f){var g=b('escapeRegex'),h=b('TokenizeUtil'),i={wordsInString:function(j){return (j||'').split(/\s+/).filter(function(k){return k.trim().length>0;});},anyMatchPredicate:function(j,k){for(var l=0;l<j.length;l++)if(k(j[l]))return true;return false;},allMatchPredicate:function(j,k){for(var l=0;l<j.length;l++)if(!k(j[l]))return false;return true;},queryWordMatchesAnyNameWord:function(j,k){var l=new RegExp('\\b'+g(j),'i');return this.anyMatchPredicate(k,function(m){var n=h.parse(m).flatValue;return l.test(n);});},queryMatchesName:function(j,k){var l=this.wordsInString(j),m=this.wordsInString(k);return this.allMatchPredicate(l,function(n){return this.queryWordMatchesAnyNameWord(n,m);}.bind(this));}};e.exports=i;});
__d("Dcode",[],function(a,b,c,d,e,f){var g,h={},i={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var k=[];for(var l in i){h[i[l]]=l;k.push(i[l]);}k.reverse();g=new RegExp(k.join("|"),'g');})();var j={encode:function(k){return encodeURIComponent(k).replace(/([_A-Z])|%../g,function(l,m){return m?'%'+m.charCodeAt(0).toString(16):l;}).toLowerCase().replace(g,function(l){return h[l];});},decode:function(k){return decodeURIComponent(k.replace(/[_A-Z]/g,function(l){return i[l];}));}};e.exports=j;});
__d("DocRPC",["ErrorUtils"],function(a,b,c,d,e,f){var g=b('ErrorUtils'),h={_apis:{},_dispatch:function(i){var j;try{i=JSON.parse(i);}catch(k){throw new Error('DocRPC unparsable dispatch: "'+i+'"');}if(h._apis.hasOwnProperty(i.api)){var l=h._apis[i.api];if(l[i.method])j=g.applyWithGuard(l[i.method],l,i.args);}if(j===undefined)j=null;return JSON.stringify(j);},publish:function(i,j){h._apis[j]=i;},proxy:function(i,j,k){var l={};k.forEach(function(m){l[m]=function(){var n={api:j,method:m,args:Array.prototype.slice.call(arguments)},o;try{if(i.closed)throw new Error('DocRPC window closed');o=i.DocRPC._dispatch(JSON.stringify(n));}catch(p){g.reportError(p);return;}if(typeof(o)=='string')try{o=JSON.parse(o);}catch(p){throw new Error('DocRPC '+j+'.'+m+' unparsable return: "'+o+'"');}return o;};});return l;}};e.exports=a.DocRPC=h;});
__d("Poller",["ArbiterMixin","AsyncRequest","Cookie","Env","copyProperties","emptyFunction","mixin"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('Cookie'),j=b('Env'),k=b('copyProperties'),l=b('emptyFunction'),m=b('mixin'),n=m(g);for(var o in n)if(n.hasOwnProperty(o))q[o]=n[o];var p=n===null?null:n.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=n;function q(t){this._config=k({clearOnQuicklingEvents:true,setupRequest:l,interval:null,maxRequests:Infinity,dontStart:false},t);if(!this._config.dontStart)this.start();}q.prototype.start=function(){if(this._polling)return this;this._requests=0;this.request();return this;};q.prototype.stop=function(){this._cancelRequest();return this;};q.prototype.mute=function(){this._muted=true;return this;};q.prototype.resume=function(){if(this._muted){this._muted=false;if(!this._handle&&this._polling)return this.request();}return this;};q.prototype.skip=function(){this._skip=true;return this;};q.prototype.reset=function(){return this.stop().start();};q.prototype.request=function(){this._cancelRequest();this._polling=true;if(!s())return this._done();if(this._muted)return this;if(++this._requests>this._config.maxRequests)return this._done();var t=new h(),u=false;t.setInitialHandler(function(){return !u;});this._cancelRequest=function(){u=true;this._cleanup();}.bind(this);t.setFinallyHandler(r.bind(this));t.setInitialHandler=l;t.setFinallyHandler=l;this._config.setupRequest(t,this);if(this._skip){this._skip=false;r.bind(this).defer();}else t.send();return this;};q.prototype.isPolling=function(){return this._polling;};q.prototype.isMuted=function(){return this._muted;};q.prototype.setInterval=function(t){if(t){this._config.interval=t;this.start();}};q.prototype.getInterval=function(){return this._config.interval;};q.prototype._cleanup=function(){if(this._handle)clearTimeout(this._handle);this._handle=null;this._cancelRequest=l;this._polling=false;};q.prototype._done=function(){this._cleanup();this.inform('done',{sender:this});return this;};q.MIN_INTERVAL=2000;k(q.prototype,{_config:null,_requests:0,_muted:false,_polling:false,_skip:false,_cancelRequest:l});function r(){if(!this._polling)return;if(this._requests<this._config.maxRequests){var t=this._config.interval;t=typeof t==='function'?t(this._requests):t;this._handle=this.request.bind(this).defer((t>q.MIN_INTERVAL)?t:q.MIN_INTERVAL,this._config.clearOnQuicklingEvents);}else this._done();}function s(){return j.user==i.get('c_user');}e.exports=q;});
__d("SystemEvents",["Arbiter","Env","ErrorUtils","UserAgent","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Env'),i=b('ErrorUtils'),j=b('UserAgent'),k=b('copyProperties'),l=new g(),m=[],n=1000;setInterval(function(){for(var w=0;w<m.length;w++)m[w]();},n,false);function o(){return (/c_user=(\d+)/.test(document.cookie)&&RegExp.$1)||0;}var p=h.user,q=navigator.onLine;function r(){if(!q){q=true;l.inform(l.ONLINE,q);}}function s(){if(q){q=false;l.inform(l.ONLINE,q);}}if(j.ie()){if(j.ie()>=11){window.addEventListener('online',r,false);window.addEventListener('offline',s,false);}else if(j.ie()>=8){window.attachEvent('onload',function(){document.body.ononline=r;document.body.onoffline=s;});}else m.push(function(){(navigator.onLine?r:s)();});}else if(window.addEventListener)if(!j.chrome()){window.addEventListener('online',r,false);window.addEventListener('offline',s,false);}var t=p;m.push(function(){var w=o();if(t!=w){l.inform(l.USER,w);t=w;}});var u=Date.now();function v(){var w=Date.now(),x=w-u,y=x<0||x>10000;u=w;if(y)l.inform(l.TIME_TRAVEL,x);return y;}m.push(v);m.push(function(){if(window.onerror!=i.onerror)window.onerror=i.onerror;});k(l,{USER:'SystemEvents/USER',ONLINE:'SystemEvents/ONLINE',TIME_TRAVEL:'SystemEvents/TIME_TRAVEL',isPageOwner:function(w){return (w||o())==p;},isOnline:function(){return j.chrome()||q;},checkTimeTravel:v});e.exports=l;});
__d("setIntervalAcrossTransitions",[],function(a,b,c,d,e,f){function g(h,i){return setInterval(h,i,false);}e.exports=g;});
__d("PresenceCookieManager",["Cookie","Dcode","ErrorUtils","Env","JSLogger","PresenceUtil","URI","PresenceInitialData"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('Dcode'),i=b('ErrorUtils'),j=b('Env'),k=b('JSLogger'),l=b('PresenceUtil'),m=b('URI'),n=b('PresenceInitialData'),o=n.cookieVersion,p=n.dictEncode,q='presence',r={},s=null,t=null,u=k.create('presence_cookie');function v(){try{var z=g.get(q);if(s!==z){s=z;t=null;if(z&&z.charAt(0)=='E')z=h.decode(z.substring(1));if(z)t=JSON.parse(z);}if(t&&(!t.user||t.user===j.user))return t;}catch(y){u.warn('getcookie_error');}return null;}function w(){return parseInt(Date.now()/1000,10);}var x={register:function(y,z){r[y]=z;},store:function(){var y=v();if(y&&y.v&&o<y.v)return;var z={v:o,time:w(),user:j.user};for(var aa in r)z[aa]=i.applyWithGuard(r[aa],r,[y&&y[aa]],function(ea){ea.presence_subcookie=aa;});var ba=JSON.stringify(z);if(p)ba='E'+h.encode(ba);if(l.hasUserCookie()){var ca=ba.length;if(ca>1024)u.warn('big_cookie',ca);var da=m.getRequestURI(false).isSecure()&&!!g.get('csm');g.set(q,ba,null,null,da);}},clear:function(){g.clear(q);},getSubCookie:function(y){var z=v();if(!z)return null;return z[y];}};e.exports=x;});
__d("PresenceState",["Arbiter","ErrorUtils","JSLogger","PresenceCookieManager","copyProperties","debounceAcrossTransitions","setIntervalAcrossTransitions","PresenceInitialData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ErrorUtils'),i=b('JSLogger'),j=b('PresenceCookieManager'),k=b('copyProperties'),l=b('debounceAcrossTransitions'),m=b('setIntervalAcrossTransitions'),n=b('PresenceInitialData'),o=n.cookiePollInterval||2000,p=[],q=[],r=null,s=null,t=0,u=null,v=0,w=['sb2','t2','lm2','uct2','tr','tw','at','wml'],x=i.create('presence_state');function y(){return j.getSubCookie('state');}function z(){t=Date.now();j.store();da(s);}var aa=l(z,0);function ba(ia){if(typeof ia=='undefined'||isNaN(ia)||ia==Number.POSITIVE_INFINITY||ia==Number.NEGATIVE_INFINITY)ia=0;return ia;}function ca(ia){var ja={};if(ia){w.forEach(function(ma){ja[ma]=ia[ma];});if(t<ia.ut)x.error('new_cookie',{cookie_time:ia.ut,local_time:t});}ja.ut=t;for(var ka=0,la=p.length;ka<la;ka++)h.applyWithGuard(p[ka],null,[ja]);s=ja;return s;}function da(ia){v++;t=ba(ia.ut);if(!r)r=m(ga,o);s=ia;if(u===null)u=ia;for(var ja=0,ka=q.length;ja<ka;ja++)h.applyWithGuard(q[ja],null,[ia]);v--;}function ea(ia){if(ia&&ia.ut)if(t<ia.ut){return true;}else if(ia.ut<t)x.error('old_cookie',{cookie_time:ia.ut,local_time:t});return false;}function fa(){var ia=y();if(ea(ia))s=ia;return s;}function ga(){var ia=y();if(ea(ia))da(ia);}j.register('state',ca);g.subscribe(i.DUMP_EVENT,function(ia,ja){ja.presence_state={initial:k({},u),state:k({},s),update_time:t,sync_paused:v,poll_time:o};});(function(){var ia=fa();if(ia){da(ia);}else{x.debug('no_cookie_initial');da(ca());return;}})();var ha={doSync:function(ia){if(v)return;if(ia){z();}else aa();},registerStateStorer:function(ia){p.push(ia);},registerStateLoader:function(ia){q.push(ia);},get:function(){return fa();},getInitial:function(){return u;},verifyNumber:ba};e.exports=ha;});
__d("TypingDetector",["Event","function-extensions","ArbiterMixin","Input","Run","copyProperties","createObjectFrom","emptyFunction"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('ArbiterMixin'),i=b('Input'),j=b('Run'),k=b('copyProperties'),l=b('createObjectFrom'),m=b('emptyFunction');function n(o){this._input=o;this._ignoreKeys={};}n.INACTIVE=0;n.TYPING=1;n.QUITTING=2;k(n.prototype,h,{_timeout:7000,_currentState:n.INACTIVE,init:function(){this.init=m;this.reset();g.listen(this._input,'keyup',this._update.bind(this));j.onUnload(this._onunload.bind(this));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=n.INACTIVE;},setIgnoreKeys:function(o){this._ignoreKeys=l(o);},_onunload:function(){if(this._currentState==n.TYPING)this._transition(n.QUITTING);},_update:function(event){var o=g.getKeyCode(event),p=this._currentState;if(!this._ignoreKeys[o])if(i.getValue(this._input).trim().length===0){if(p==n.TYPING)this._transition(n.INACTIVE);}else if(p==n.TYPING){this._recordKeystroke();}else if(p==n.INACTIVE){this._transition(n.TYPING);this._recordKeystroke();}},_transition:function(o){this.reset();this._currentState=o;this.inform('change',o);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=this._checkTyping.bind(this).defer(this._timeout);},_checkTyping:function(){var o=this._lastKeystrokeTime+this._timeout,p=Date.now();if(p>o){this._transition(n.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=this._checkTyping.bind(this).defer(o-p+10);}}});e.exports=n;});