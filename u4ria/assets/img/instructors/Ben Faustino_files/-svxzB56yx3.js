/*!CK:2986168695!*//*1379476234,178570037*/

if (self.CavalryLogger) { CavalryLogger.start_js(["l4yzR"]); }

__d("legacy:UIControllerRegistry",[],function(a,b,c,d){a.__UIControllerRegistry=a.__UIControllerRegistry||{};},3);
__d("UIIntentionalStreamRefresh",["Arbiter","LiveTimer","Run","UIIntentionalStreamMessage","UserActivity","coalesce","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('LiveTimer'),i=b('Run'),j=b('UIIntentionalStreamMessage'),k=b('UserActivity'),l=b('coalesce'),m=b('copyProperties');function n(o,p){this.isAutoRefreshing=false;this.lastRefresh=Date.now();n.instance=this;this.setAutoRefreshConfig(o);this.updateConfigHandler=g.subscribe(j.UPDATE_AUTOREFRESH_CONFIG,this.updateAutoRefreshConfig.bind(this));this.updateRefreshTimeHandler=g.subscribe(j.UPDATE_LAST_REFRESH_TIME,this.updateLastRefreshTime.bind(this));i.onLeave(this.unload.bind(this));this.userActivity();this.uaToken=k.subscribe(this.userActivity.bind(this));this.autoRefreshInterval=setInterval(this.checkAutoPageRefresh.bind(this),this.checkAutoRefreshTimeInterval);this.activeRefreshInterval=setInterval(this.checkActiveRefresh.bind(this),this.checkActiveRefreshTimeInterval);this.enableAutoRefresh(p);g.subscribe(j.UPDATE_STREAM,h.loop.bind(h,true));g.subscribe(j.REFRESH_STREAM,h.loop.bind(h,true));}m(n,{DISABLE_AUTOREFRESH_TIME:4*60*1000,CHECK_AUTOREFRESH_INTERVAL:5*60*1000,AUTOREFRESH_INACTIVE_TIME:30*60*1000,CHECK_ACTIVE_REFRESH_TIME:5*60*1000,ACTIVE_REFRESH_TIME:30*1000});m(n.prototype,{updateAutoRefreshConfig:function(o,p){if(o==j.UPDATE_AUTOREFRESH_CONFIG)this.setAutoRefreshConfig(p);},updateLastRefreshTime:function(o){if(o==j.UPDATE_LAST_REFRESH_TIME)this.lastRefresh=Date.now();},setAutoRefreshConfig:function(o){o=o||{};var p=24*60*60*1000;if(!this.storyInterval)this.storyInterval=l(o.story_interval,null);this.allowAutoRefresh=l(o.allow_auto_refresh,false);this.inactiveThreshold=l(o.inactive_threshold,0);this.activeRefreshTime=l(o.fast_refresh_rate,p);this.inactiveRefreshTime=l(o.slow_refresh_rate,p);this.allowPolling=l(o.allow_polling,false);this.refreshFactor=l(o.refresh_factor,10);this.minRefreshInterval=l(o.min_refresh_interval,60*1000);this.activeRefresh=l(o.active_refresh,false);this.checkActiveRefreshTimeInterval=l(o.check_active_refresh_interval,n.CHECK_ACTIVE_REFRESH_TIME);this.activeRefreshTimeInterval=l(o.active_refresh_interval,n.ACTIVE_REFRESH_TIME);this.disableAutoRefreshTime=l(o.disable_autorefresh_time,n.DISABLE_AUTOREFRESH_TIME);this.checkAutoRefreshTimeInterval=l(o.check_autorefresh_time_interval,n.CHECK_AUTOREFRESH_INTERVAL);this.autoRefreshInactiveTime=l(o.autorefresh_inactive_time,n.AUTOREFRESH_INACTIVE_TIME);return this;},unload:function(){this.enableAutoRefresh(false);this.cleanupRefreshInterval();k.unsubscribe(this.uaToken);this.updateConfigHandler&&this.updateConfigHandler.unsubscribe();this.updateRefreshTimeHandler&&this.updateRefreshTimeHandler.unsubscribe();},userActivity:function(){var o=this.isInactive();this.lastActivity=Date.now();this.isAutoRefreshing=true;if(o&&this.canAutoRefresh())this.runAutoRefresh();return true;},isInactive:function(){return this.getMSSinceLastActivity()>this.inactiveThreshold;},getMSSinceLastActivity:function(){return Date.now()-this.lastActivity;},getMSSinceLastRefresh:function(){return Date.now()-this.lastRefresh;},getRefreshInterval:function(){if(this.isInactive()){return this.inactiveRefreshTime;}else if(this.storyInterval!=null){var o=this.storyInterval*this.refreshFactor;return Math.max(o,this.activeRefreshTime);}else return this.activeRefreshTime;},canAutoRefresh:function(){return this.isAutoRefreshing&&this.allowAutoRefresh;},cancelUpdate:function(){if(this.updateTask){clearTimeout(this.updateTask);this.updateTask=null;}},runUpdatePoll:function(){this.updateTask=null;if(this.canAutoRefresh())this.runAutoRefresh();},runAutoRefresh:function(){var o=50;if(this.getMSSinceLastRefresh()>=this.minRefreshInterval-o)g.inform(j.UPDATE_STREAM);this.schedulePoll(this.getRefreshInterval());},schedulePoll:function(o){this.cancelUpdate();if(this.allowPolling)this.updateTask=setTimeout(this.runUpdatePoll.bind(this),o);},enableAutoRefresh:function(o,p){this.isAutoRefreshing=o;if(o){var q=p?0:this.getRefreshInterval();this.schedulePoll(q);}else this.cancelUpdate();},checkAutoPageRefresh:function(){if(!this.allowAutoRefresh)return;if(this.isAutoRefreshing&&(this.getMSSinceLastActivity()>this.disableAutoRefreshTime))this.isAutoRefreshing=false;if(this.getMSSinceLastRefresh()<this.autoRefreshInactiveTime)return;var o=this.getMSSinceLastActivity();if(o>this.autoRefreshInactiveTime)g.inform(j.REFRESH_STREAM,{});},checkActiveRefresh:function(){if(!this.allowAutoRefresh)return;if(this.getMSSinceLastRefresh()<this.activeRefreshTimeInterval)return;if(this.getMSSinceLastActivity()<this.activeRefreshTimeInterval)g.inform(j.UPDATE_STREAM);},cleanupRefreshInterval:function(){if(this.autoRefreshInterval){clearInterval(this.autoRefreshInterval);this.autoRefreshInterval=null;}if(this.activeRefreshInterval){clearInterval(this.activeRefreshInterval);this.activeRefreshInterval=null;}}});e.exports=n;});
__d("UIIntentionalStream",["Animation","Arbiter","AsyncRequest","AsyncResponse","CSS","DataStore","DOM","DOMScroll","Event","HTML","JSLogger","NavigationMessage","OnVisible","PageTransitions","Run","ScrollAwareDOM","Style","UIIntentionalStreamMessage","UIIntentionalStreamRefresh","UIPagelet","URI","Vector","$","coalesce","copyProperties","createArrayFrom","ge","isEmpty","merge","reportData","startsWith"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('AsyncResponse'),k=b('CSS'),l=b('DataStore'),m=b('DOM'),n=b('DOMScroll'),o=b('Event'),p=b('HTML'),q=b('JSLogger'),r=b('NavigationMessage'),s=b('OnVisible'),t=b('PageTransitions'),u=b('Run'),v=b('ScrollAwareDOM'),w=b('Style'),x=b('UIIntentionalStreamMessage'),y=b('UIIntentionalStreamRefresh'),z=b('UIPagelet'),aa=b('URI'),ba=b('Vector'),ca=b('$'),da=b('coalesce'),ea=b('copyProperties'),fa=b('createArrayFrom'),ga=b('ge'),ha=b('isEmpty'),ia=b('merge'),ja=b('reportData'),ka=b('startsWith');function la(){h.subscribe(x.SET_AUTO_INSERT,ma);}function ma(oa,pa){if(oa!=x.SET_AUTO_INSERT)return;var qa=na.instance;if(qa)qa.pauseAutoInsert=pa.pause;}function na(oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya){if(!oa)throw new Error('UIIntentionalStream instantiated with no root.');ea(this,{id:oa.id,root:oa,instanceName:pa,newest:qa,oldest:ra,oldestMR:ra,shouldShowHidden:false,defaultFilter:sa,currentFilterKey:xa,sourceType:ta,lastSeenTime:ya,hasPendingRefresh:false,pauseAutoInsert:false,error:m.scry(oa,'div.UIIntentionalStream_Error')[0],pager:m.scry(oa,'div.uiMorePager')[0],filterNullState:m.scry(oa,'div.friendListFilterNullState')[0],streamContent:m.find(oa,'.UIIntentionalStream_Content'),requestNum:0,scrollLoadCount:1,maxScrollLoadCount:1,scrollPosition:0,lastViewStateID:0,cachedScrollQID:0,jslog:q.create('stream'),scrollListener:null,newIndexOffset:0});this.addScrollTrace('init',{});u.onLeave(this.unload.bind(this));if(!na.instances)na.instances={};na.instances[pa]=this;na.instance=this;la();this.setupSubscriptions();}ea(na.prototype,{subscribeToComposerPublish:function(){this.subscriptions.push(h.subscribe('composer/publish',function(event,oa){var pa=ca(oa.composer_id).getAttribute('data-location');if(pa==='maincolumn'&&oa.streamStory)this.addComposerContent(oa.streamStory,500);}.bind(this)));},setupSubscriptions:function(){this.subscriptions=[];this.subscribeToComposerPublish();this.subscriptions.push(h.subscribe(x.UPDATE_STREAM,this.updateStream.bind(this)));this.subscriptions.push(h.subscribe(x.REFRESH_STREAM,this.refreshStream.bind(this)));this.scrollListener=o.listen(window,'scroll',this.checkFirstScroll.bind(this));this.checkFirstScroll();u.onLoad(this.checkFirstStory.bind(this));},tearDownSubscriptions:function(){if(!this.subscriptions)return;this.subscriptions.forEach(h.unsubscribe);this.subscriptions=null;if(this.scrollListener){this.scrollListener.remove();this.scrollListener=null;}},unload:function(){this.addScrollTrace('unload',{});h.inform(x.UNLOAD);this.tearDownSubscriptions();na.instance=null;na.instances[this.instanceName]=null;this.clearScrollLoader(true);window.disableScrollLoad=null;y.instance&&y.instance.unload();},_getUpdateInsertType:function(){return na.REFRESH_PREPEND;},updateStream:function(oa){if(oa!=x.UPDATE_STREAM||this.hasPendingRefresh||this.isAutoRefreshPaused())return;this.loadNewer({showLoader:false,ignoreSelf:true,insertType:this._getUpdateInsertType()});},clearScrollLoader:function(oa){if(this.currentScrollListener){this.currentScrollListener.remove();this.currentScrollListener=null;}if(oa||this.scrollLoadCount>=this.maxScrollLoadCount)window.disableScrollLoad=true;},loadOlderPosts:function(oa){var pa={filter:this.getCurrentFilterKey(),oldest:this.oldest,oldestMR:this.oldestMR,last_seen_time:this.lastSeenTime,scroll_count:this.scrollLoadCount,scroll_position:this.scrollPosition,last_viewstate_id:this.lastViewStateID,cached_scroll_qid:this.cachedScrollQID};this.homeloadID&&(pa.homeload_id=this.homeloadID);pa=ia(pa,oa);this.loadWithParams(pa);},loadWithParams:function(oa){var pa=m.scry(this.root,'div.fbStreamPager.hasMorePosts')[0];if(pa){if(k.hasClass(pa,'async_saving'))return;k.addClass(pa,'async_saving');}this.addScrollTrace('loadwithparams',oa);z.loadFromEndpoint('MoreStoriesPagelet','home_stream',oa,{append:true,usePipe:true});},setScrollLoadCount:function(oa){this.maxScrollLoadCount=oa;},setHomeloadID:function(oa){this.homeloadID=oa;},loadMoreOnScroll:function(oa,pa){if(window.disableScrollLoad)return;var qa=function(){if(window.disableScrollLoad)return;var ta={delay_load_count:pa};this.loadOlderPosts(ta);}.bind(this),ra=m.scry(this.root,'ul.uiStream li.genericStreamStory');if(!ra.length)return;this.addScrollTrace('loadmoreonscroll',{});var sa=ra[ra.length-oa-1];if(sa){this.currentScrollListener=new s(sa,qa,null,0);}else qa();},updateTimeRange:function(oa,pa){if(!this.newest||this.newest<oa){this.newest=oa;this.addScrollTrace('update_newest',{newest:this.newest});}if(!this.oldest||(pa&&(pa<this.oldest))){this.oldest=pa;this.addScrollTrace('update_oldest',{oldest:this.oldest});}},updateOldestMR:function(oa){if(!this.oldestMR||oa<this.oldestMR){this.oldestMR=oa;this.addScrollTrace('update_oldestmr',{oldestmr:this.oldestMR});}},updateScrollPosition:function(oa){this.scrollPosition=oa;this.addScrollTrace('update_scrollposition',{scrollposition:this.scrollPosition});},updateLastViewStateID:function(oa){this.lastViewStateID=oa;this.addScrollTrace('update_lastviewstateid',{lastviewstateid:this.lastViewStateID});},updateCachedScrollQID:function(oa){this.cachedScrollQID=oa;this.addScrollTrace('update_cachedscrollqid',{qid:this.cachedScrollQID});},getID:function(){return this.id;},getCurrentFilterKey:function(){if(this.currentFilterKey)return this.currentFilterKey;var oa=aa.getMostRecentURI().getQueryData();if(oa&&oa.sk){this.currentFilterKey=oa.sk;}else if(oa&&oa.filter){this.currentFilterKey=oa.filter;}else if(this.defaultFilter)this.currentFilterKey=this.defaultFilter;return this.currentFilterKey;},resetFilterKey:function(oa){this.currentFilterKey=oa;},loadOlder:function(oa){oa=oa||{};if(!this.oldest)return;var pa=this.getCurrentParams();pa.oldest=this.oldest;this.refresh(na.REFRESH_APPEND,pa,oa);return this;},loadNewer:function(oa){if(!this.newest)return;oa=oa||{};var pa=this.getCurrentParams();pa.newest=this.newest;if(oa.ignoreSelf)pa.ignore_self=true;pa.load_newer=true;var qa=da(oa.insertType,na.REFRESH_PREPEND);this.refresh(qa,pa,oa);return this;},checkFirstStory:function(){this.logFirstStory('first_story_load');},checkFirstScroll:function(){if(this.scrollListener&&ba.getScrollPosition().y>0){this.scrollListener.remove();this.scrollListener=null;this.logFirstStory('first_scrolling');}},logFirstStory:function(oa){if(!ga('home_stream')||!ga('home_stream').childElementCount||!ga('home_stream').children[0].getAttribute('data-ft'))return;var pa=ga('home_stream').children[0].getAttribute('data-ft'),qa=JSON.parse(pa);if(!(("mf_story_key" in qa)&&("qid" in qa)))return;var ra={mf_story_key:qa.mf_story_key,qid:qa.qid};ja(oa,{ft:ra});},getCurrentParams:function(){var oa={},pa=aa.getMostRecentURI().getQueryData();pa.filter=this.getCurrentFilterKey();var qa=this.getValidParams();if(qa){qa.forEach(function(ra){oa[ra]=pa[ra];});}else oa=pa;return oa;},setHomeFilter:function(oa){this._homeFilter=oa;},setHomeFilterLoading:function(oa){if(this._homeFilter)this._homeFilter.setLoading(oa);},refresh:function(oa,pa,qa){h.inform(x.UPDATE_LAST_REFRESH_TIME);this.homeloadID&&(pa.homeload_id=this.homeloadID);this.addScrollTrace('refresh',{type:oa,data:pa,kwargs:qa});this.currentFilterKey=pa.filter;if(pa.filter==na.FEED_FILTER_KEY_DUAL_NEWS_FEED){this.currentFilterKey=this.defaultFilter;}else if(na.isHighlightsFilter(pa.filter)||pa.filter===na.FEED_FILTER_KEY_NEWS_FEED)this.defaultFilter=this.currentFilterKey;qa=qa||{};var ra=++this.requestNum,sa=da(qa.showLoader,true),ta=this.instanceName,ua=function(ya){na.getInstance(ta).handleResponse(ra,oa,ya,qa);},va=function(ya){na.getInstance(ta).handleError(ra,oa,ya,qa);},wa=function(ya){na.getInstance(ta).handleFinally(oa,pa.filter,ya);};if(!(pa.request_type=oa))pa.request_type='none';if(pa.filter){qa.show_hidden=pa.show_hidden?pa.show_hidden:false;}else qa.show_hidden=this.shouldShowHidden;pa=ea(this.getCurrentParams(),pa);this.hasPendingRefresh=true;var xa=new i().setURI(this.getEndpoint()).setReadOnly(true).setOption('retries',0).setMethod(this.getRefreshMethod()).setData(pa).setHandler(ua).setErrorHandler(va).setFinallyHandler(wa);if(oa==na.REFRESH_APPEND&&sa)xa.setStatusElement(this.pager);xa.send();if(oa==na.REFRESH_TRANSITION){if(this.pager)this.pager.style.display='none';this.clearScrollLoader();this.oldest=this.newest=null;}if(sa)this.setHomeFilterLoading(true);},addComposerContent:function(oa,pa){if(this.isOnNewsFeedFilter())k.addClass(oa,'uiStreamBoulderHighlight');this.addContentPrepend(oa,pa);},applyNewIndexes:function(oa){for(var pa=oa.length-1;pa>=0;pa--)oa[pa].setAttribute('data-insertion-position',--this.newIndexOffset);h.inform('Stream/totalHeadLoadedStories',-this.newIndexOffset);},addContentPrepend:function(oa,pa){if(oa.length){fa(oa).reverse().forEach(function(va){this.addContentPrepend(va,pa);}.bind(this));return;}var qa,ra=ba.getScrollPosition().y,sa=ba.getElementPosition(this.streamContent).y,ta=this.scrollOnPrepend&&ra>=sa;if(ta){var ua=function(va){var wa=m.find(va,'^li.uiStreamStory');if(!wa)return;l.set(wa,'origHeight',wa.offsetHeight);o.listen(va,'load',function(){var xa=l.get(wa,'origHeight');if(wa.offsetHeight!=xa){window.scrollBy(0,wa.offsetHeight-xa);l.set(wa,'origHeight',wa.offsetHeight);}});};qa=g.insert.curry(this.streamContent,oa,(function(va,wa){m.prependContent(this.streamContent,wa);h.inform('reflow');window.scrollBy(0,wa.offsetHeight);m.scry(wa,'img').forEach(ua);}).bind(this));}else qa=(function(){w.set(oa,'opacity',0);v.prependContent(this.streamContent,oa);h.inform('reflow');new g(oa).from('opacity',0).to('opacity',1).duration(400).ondone(function(){h.inform(x.UPDATE_HTML_CONTENT);}).go();}).bind(this);if(pa){k.hide(oa);m.appendContent(document.body,oa);setTimeout(function(){k.show(oa);qa();},pa);}else qa();},addContentAppend:function(oa){m.appendContent(this.streamContent,oa);},handleResponse:function(oa,pa,qa,ra){this.addScrollTrace('handle_response',{requestnum:oa,type:pa,kwargs:ra});ra=ra||{};var sa=qa.getPayload();this.filterNullState&&m.remove(this.filterNullState);if(ha(sa))return;if(sa.autoRefreshConfig)h.inform(x.UPDATE_AUTOREFRESH_CONFIG,sa.autoRefreshConfig);this.setHomeFilterLoading(false);if(pa==na.REFRESH_EXPAND){var ta=m.find(ca(ra.expandStoryID),'div.UIIntentionalStory_CollapsedStories');k.hide(ta);k.removeClass(ta,'UIIntentionalStory_CollapsedStoriesLoading');}if(this.error)this.error.style.display='none';if(oa!=this.requestNum)return;if('show_hidden' in ra)this.shouldShowHidden=ra.show_hidden;if('newestStoryTime' in sa&&sa.newestStoryTime>this.newest)this.newest=sa.newestStoryTime;if(pa!=na.REFRESH_PREPEND){if('oldestStoryTime' in sa&&(!this.oldest||sa.oldestStoryTime<this.oldest))this.oldest=sa.oldestStoryTime;if('scrollPosition' in sa)this.scrollPosition=sa.scrollPosition;if('lastViewStateID' in sa)this.lastViewStateID=sa.lastViewStateID;if('oldestMRStoryTime' in sa)this.oldestMR=sa.oldestMRStoryTime;if('cachedScrollQID' in sa){this.cachedScrollQID=sa.cachedScrollQID;}else this.cachedScrollQID=0;}if(sa.html){var ua=p(sa.html).getNodes();switch(pa){case na.REFRESH_PREPEND:this.applyNewIndexes(ua);this.addContentPrepend(ua);break;case na.REFRESH_APPEND:this.addContentAppend(ua);this.clearScrollLoader(true);break;case na.REFRESH_TRANSITION:m.setContent(this.streamContent,ua);this.scrollLoadCount=1;if(!ra.noScroll)n.scrollTo(new ba(0,0,"document"),false);break;case na.REFRESH_EXPAND:m.insertAfter(ca(ra.expandStoryID),ua);break;case na.DELAYED_STREAM:this.addContentAppend(ua);break;}h.inform(x.UPDATE_HTML_CONTENT);}},handleError:function(oa,pa,qa,ra){if(oa!=this.requestNum)return;this.setHomeFilterLoading(false);var sa=qa.getError();if(sa==1357001)j.defaultErrorHandler(qa);if(pa==na.REFRESH_EXPAND){var ta=m.find(ca(ra.expandStoryID),'div.UIIntentionalStory_CollapsedStories');k.removeClass(ta,'UIIntentionalStory_CollapsedStoriesLoading');}if(!ra.delayLoadCount&&pa!=na.REFRESH_PREPEND&&this.error)w.set(this.error,'display','block');},handleFinally:function(oa,pa){if(oa==na.REFRESH_TRANSITION){t.transitionComplete();h.inform(r.NAVIGATION_COMPLETED);}this.hasPendingRefresh=false;},getValidParams:function(){return na.VALID_PARAMS;},getEndpoint:function(){return na.ENDPOINT;},getRefreshMethod:function(){return na.REFRESH_METHOD;},isOnNewHighlights:function(){var oa=this.getCurrentFilterKey();return (na.isHighlightsFilter(oa)||(oa==na.FEED_FILTER_KEY_DUAL_NEWS_FEED&&na.isHighlightsFilter(this.defaultFilter)));},isLiveStreamBox:function(){var oa=this.getCurrentFilterKey();return oa&&oa.indexOf(na.FEED_FILTER_KEY_LIVE_STREAM_BOX)===0;},isOnNewsFeedFilter:function(){var oa=this.getCurrentFilterKey();return (oa==na.FEED_FILTER_KEY_NEWS_FEED||na.isHighlightsFilter(oa)||oa==na.FEED_FILTER_KEY_DUAL_NEWS_FEED);},isAutoRefreshPaused:function(){if(this.isOnNewHighlights()||this.isLiveStreamBox())return false;return this.pauseAutoInsert;},addScrollTrace:function(oa,pa){this.jslog.debug(oa,pa);},refreshStream:function(oa,pa){if(oa!=x.REFRESH_STREAM)return;var qa=this.getCurrentFilterKey(),ra={filter:qa},sa={filter:qa};pa.noScroll&&(sa.noScroll=1);this.refresh(na.REFRESH_TRANSITION,ra,sa);},getNewest:function(){return this.newest;}});ea(na,{ANIMATION_DURATION:300,REFRESH_METHOD:'GET',REFRESH_TRANSITION:1,REFRESH_PREPEND:2,REFRESH_APPEND:3,REFRESH_EXPAND:5,DELAYED_STREAM:6,FEED_FILTER_KEY_NEW_HIGHLIGHTS:'h',FEED_FILTER_KEY_NEWS_FEED:'lf',FEED_FILTER_KEY_DUAL_NEWS_FEED:'nf',FEED_FILTER_KEY_LIVE_STREAM_BOX:'pub',VALID_PARAMS:['filter','show_hidden'],ENDPOINT:'/ajax/intent.php',getInstance:function(oa){return na.instances[oa];},isHighlightsFilter:function(oa){if(!oa)return false;return ka(oa,na.FEED_FILTER_KEY_NEW_HIGHLIGHTS);},getStoriesByAssoc:function(oa){return m.scry(na.instance.root,'div.aid_'+oa);}});e.exports=na;});
__d("FutureHomeSideNav",["Arbiter","AsyncRequest","CSS","DOM","DOMPosition","Event","FutureSideNav","FutureSideNavItem","FutureSideNavSection","NavigationMessage","Parent","UIIntentionalStream","UIPagelet","emptyFunction","ge","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('CSS'),j=b('DOM'),k=b('DOMPosition'),l=b('Event'),m=b('FutureSideNav'),n=b('FutureSideNavItem'),o=b('FutureSideNavSection'),p=b('NavigationMessage'),q=b('Parent'),r=b('UIIntentionalStream'),s=b('UIPagelet'),t=b('emptyFunction'),u=b('ge'),v=b('tx');for(var w in m)if(m.hasOwnProperty(w))y[w]=m[w];var x=m===null?null:m.prototype;y.prototype=Object.create(x);y.prototype.constructor=y;y.__superConstructor__=m;function y(){if(m!==null)m.apply(this,arguments);}y.prototype.init=function(){x.init.apply(this,arguments);this.ajaxPipe=true;this.seeAllEndpoint="/ajax/home/generic.php";this.typeSections={favorites:'pinnedNav',profiles:'pinnedNav',apps:'appsNav',groups:'groupsNav',pages:'pagesNav',lists:'listsNav',interests:'interestsNav',connect_apps:'connectNav'};this.switchingFromTitanFixedFrame=false;this._arbiterSubscriptions.push(g.subscribe('titan_fixed_frame_changed',this.handleFixedFrameChanged.bind(this)),g.subscribe(p.NAVIGATION_FAVORITE_UPDATE,this.updateFavorite.bind(this)),g.subscribe(p.NAVIGATION_FIRST_RESPONSE,this.navigationFirstResponse.bind(this)));this._ensureHover('homeSideNav');};y.prototype.initMoreLink=function(fa){this._eventHandlers.push(l.listen(fa,'click',this._showMoreSections.bind(this,fa)));};y.prototype._showMoreSections=function(fa){var ga=j.scry(this.root,'div.belowThreshold');i.hide(fa);ga.forEach(function(ha){i.removeClass(ha,'belowThreshold');});};y.prototype.handleFixedFrameChanged=function(fa,ga,ha){if(ga){var ia=function(ja,ka){var la=k.getElementPosition(u(ka)).y;s.loadFromEndpoint(ja,ka,{fixed_frame:ga,selected_key:ha,v_pos:la});};ia('PinnedNavigationPagelet','pagelet_pinned_nav');ia('BookmarkNavigationPagelet','pagelet_bookmark_nav');if(u('chatFriendsOnline'))i.hide(u('chatFriendsOnline'));}else this.switchingFromTitanFixedFrame=true;};y.prototype.handlePageTransition=function(fa){if(this.switchingFromTitanFixedFrame){this.switchingFromTitanFixedFrame=false;return false;}else return x.handlePageTransition.call(this,fa);};y.prototype._initSection=function(fa){var ga=x._initSection.call(this,fa);for(var ha in this.typeSections){var ia=this.typeSections[ha];if(ga.id==ia){var ja=j.scry(ga.node,'h4.navHeader')[0];if(ja){var ka='\/bookmarks\/('+ha+')(\/)?';ga.seeall=this._initItem({node:ja,id:ga.id,endpoint:this.seeAllEndpoint,key:['bookmarks'],path:[{regex:ka}]});}}}return ga;};y.prototype._constructItem=function(fa,ga){return new ea(fa,ga);};y.prototype._constructSection=function(fa){return new ba(fa);};y.prototype.getSection=function(fa){return this.typeSections[fa]&&this.sections[this.typeSections[fa]];};y.prototype._getItemForKey=function(fa){var ga=x._getItemForKey.call(this,"nf");if(ga&&ga.matchKey(fa)){return ga;}else return x._getItemForKey.call(this,fa);};y.prototype._isCurrentPath=function(fa){return ((fa.getDomain()===this.uri.getDomain())&&(fa.getPath()==='/'||fa.getPath()==='/home.php'));};y.prototype._handleMenuClick=function(fa,ga,ha,event){if(i.hasClass(ha,'favorite')){g.inform(p.NAVIGATION_FAVORITE_UPDATE,{key:ga.numericKey,favorite:!fa.equals(this.getSection("favorites")),movetop:i.hasClass(ha,'movetop')});}else x._handleMenuClick.call(this,fa,ga,ha,event);};y.prototype.removeItemByKey=function(fa){g.inform(p.NAVIGATION_ITEM_REMOVED,fa);x.removeItemByKey.call(this,fa);};y.prototype.toggleItemByKey=function(fa,ga){var ha=this.getNodeForKey(fa);if(!ga){g.inform(p.NAVIGATION_ITEM_HIDDEN,fa);ha&&i.hide(ha);}else ha&&i.show(ha);var ia=this._getItemForKey(fa);this.getSection(ia.type).refresh();};y.prototype.removeItem=function(fa){var ga=this.getSection(fa.type);x.removeItem.call(this,fa);ga.refresh();};y.prototype.updateFavorite=function(fa,ga){var ha=this._findItem(function(qa){return qa.matchKey(ga.key)&&qa.canFavorite();}),ia=this.getSection("favorites"),ja=t,ka=ga.favorite?ia.addEndpoint:ia.removeEndpoint;if(ga.movetop)ka=ia.editEndpoint;if(!ha&&(ga.favorite||ga.movetop)){if(ga.movetop)var la=j.scry(this.root,'.expandableSideNav'),ma=la&&la.length&&i.hasClass(la[0],'expandedMode');ja=function(){s.loadFromEndpoint('PinnedNavigationPagelet','pagelet_pinned_nav',{expanded:ma});};}else if(!ha){ja=function(){s.loadFromEndpoint('BookmarkNavigationPagelet','pagelet_bookmark_nav');};}else{if(ga.movetop){i.show(ha.node);this.moveItem(ia,ha);var na=q.byClass(ha.node,'uiSideNav');if(na&&na.childNodes.length){var oa=q.byClass(j.scry(na,'.sortableItem')[0],'sideNavItem');j.insertBefore(oa,ha.node);i.removeClass(ha.node,'hidden');}}else{var pa=this.getSection(ha.type);if(ga.favorite){i.show(ha.node);this.moveItem(ia,ha);ha.showFavorite();}else if(!pa.equals(ia)){this.moveItem(pa,ha,true);ha.hideFavorite();}else this.removeItem(ha);pa.refresh();}ia.refresh();ga.key=ha.numericKey;g.inform('NavigationMessage.FAVORITES_UPDATED');}new h().setURI(ka).setData({id:ga.key,movetop:ga.movetop}).setHandler(ja).send();};y.prototype._doPageTransition=function(fa,ga){this._unloadStreams();var ha=x._doPageTransition.call(this,fa,ga);if(ha&&(fa.type=='groups'||fa.type=='lists'||fa.type=='interests')){fa.setCount(0);fa.hideUnreadDot();}return ha;};y.prototype._unloadStreams=function(){var fa=window.UIIntentionalStream&&r.instances,ga=['nile','global','friends','blade'];fa&&ga.forEach(function(ha){fa[ha]&&fa[ha].unload();});};y.prototype.navigationFirstResponse=function(){this.setSelected(this.loading);};for(var z in o)if(o.hasOwnProperty(z))ba[z]=o[z];var aa=o===null?null:o.prototype;ba.prototype=Object.create(aa);ba.prototype.constructor=ba;ba.__superConstructor__=o;function ba(fa){o.call(this,fa);this.editEndpoint='/ajax/bookmark/edit/';this.addEndpoint='/ajax/bookmark/add/';this.removeEndpoint='/ajax/bookmark/delete/';}ba.prototype.refresh=function(){var fa=j.scry(this.node,'li.sideNavItem'),ga=j.scry(this.node,'div.actionLinks'),ha=fa.some(i.shown);i.conditionShow(j.find(this.node,'h4.navHeader'),ha);ga.length&&i.conditionShow(ga[0],ha);};for(var ca in n)if(n.hasOwnProperty(ca))ea[ca]=n[ca];var da=n===null?null:n.prototype;ea.prototype=Object.create(da);ea.prototype.constructor=ea;ea.__superConstructor__=n;function ea(){if(n!==null)n.apply(this,arguments);}ea.prototype.canFavorite=function(){return !!this._getFavoriteLabel();};ea.prototype.showFavorite=function(){j.setContent(this._getFavoriteLabel(),"Remove from Favorites");};ea.prototype.hideFavorite=function(){j.setContent(this._getFavoriteLabel(),"Add to Favorites");};ea.prototype.hideUnreadDot=function(){var fa=j.scry(this.node,'img.unreadDot')[0];fa&&i.hide(fa);};ea.prototype._getFavoriteLabel=function(){return j.scry(this.node,'li.favorite span.itemLabel')[0];};e.exports=y;});
__d("legacy:home-side-nav-future-js",["FutureHomeSideNav"],function(a,b,c,d){a.FutureHomeSideNav=b('FutureHomeSideNav');},3);
__d("FeedBaseKeyboardController",["$","Arbiter","AsyncDialog","AsyncRequest","CSS","DOM","DOMScroll","DOMQuery","Event","Focus","Keys","NavigationMessage","Parent","Run","SubscriptionsHandler","Vector","ViewportBounds","emptyFunction","ge","getActiveElement","isAsyncScrollQuery","throttle"],function(a,b,c,d,e,f){var g=b('$'),h=b('Arbiter'),i=b('AsyncDialog'),j=b('AsyncRequest'),k=b('CSS'),l=b('DOM'),m=b('DOMScroll'),n=b('DOMQuery'),o=b('Event'),p=b('Focus'),q=b('Keys'),r=b('NavigationMessage'),s=b('Parent'),t=b('Run'),u=b('SubscriptionsHandler'),v=b('Vector'),w=b('ViewportBounds'),x=b('emptyFunction'),y=b('ge'),z=b('getActiveElement'),aa=b('isAsyncScrollQuery'),ba=b('throttle'),ca=67,da=74,ea=75,fa=76,ga=79,ha=80,ia=83,ja=191,ka;function la(){ka=k.hasClass(document.documentElement,'tinyViewport')?0:g('pagelet_bluebar').offsetTop+g('pagelet_bluebar').offsetHeight;}la.defer();o.listen(window,'resize',ba(la));function ma(na){this.root=na;this.init();}ma.prototype.getStories=function(){};ma.prototype.getParentStory=function(na){};ma.prototype.isStory=function(na){};ma.prototype.isHoldoutStory=function(na){};ma.prototype.getHeadline=function(na){};ma.prototype.getPreviousStory=function(na){};ma.prototype.getNextStory=function(na){};ma.prototype.setSelected=function(na,oa){};ma.prototype.clickLike=function(){};ma.prototype.clickComment=function(){};ma.prototype.clickShare=function(){};ma.prototype.openAttachment=function(){};ma.prototype.focusComposer=function(){var na=l.scry(y('pagelet_composer'),'textarea')[0];if(na){p.set(na);m.scrollToTop(true);}};ma.prototype.getScrollOffset=function(){return 10;};ma.prototype.getAnimationLength=function(na){return Math.min(Math.abs(v.getElementPosition(na).y-w.getTop()-document.body.scrollTop),400);};ma.prototype.findTop=function(){var na=this.getStories();for(var oa=0;oa<na.length;oa++)if(v.getElementPosition(na[oa]).y>v.getScrollPosition().y)return na[oa];};ma.prototype.onLeave=function(){this.subscriptions&&this.subscriptions.release();};ma.prototype.shouldActivateShortcut=function(event){var na=o.getKeyCode(event);if(event.getModifiers().any)if(!event.getModifiers().shift||na!==ja)return false;var oa=z();oa=k.shown(oa)&&oa;var pa=this.getParentStory(oa);if(oa&&this.isInteractive(oa))return (na===q.ESC&&pa);switch(na){case ca:case fa:case ga:case ia:return !!(oa&&pa);}return true;};ma.prototype.getHelpDialogRequest=function(){if(!this.dialogRequest){this.dialogRequest=new j('/ajax/keyboard_shortcuts');this.dialogRequest.setReadOnly(true);}else if(this.dialogRequest.transport)return null;return this.dialogRequest;};ma.prototype.init=function(){t.onLeave(this.onLeave.bind(this));this.subscriptions=new u();this.subscriptions.addSubscriptions(h.subscribe(r.NAVIGATION_BEGIN,this.onLeave.bind(this)),o.listen(document,'keydown',function(event){if(!this.shouldActivateShortcut(event))return true;var na=o.getKeyCode(event);switch(na){case da:this.vert(1);break;case ea:this.vert(-1);break;case fa:this.clickLike();break;case ca:this.clickComment();break;case ha:this.focusComposer();break;case q.RETURN:if(this.selected.id=='pagelet_composer'||y('pagelet_composer',this.selected)){this.focusComposer();}else this.clickComment();break;case ga:this.openAttachment();break;case ia:this.clickShare();break;case q.ESC:var oa=this.findTop();oa&&this.setFocused(oa);break;case ja:if(event.getModifiers().shift){var pa=this.getHelpDialogRequest();pa&&i.send(pa);}break;default:return;}this.hasUsedKeyboard=true;event.prevent();}.bind(this)),o.listen(document,'focusin',function(event){var na=event.getTarget(),oa=this.getParentStory(na);if(oa&&(this.selected!=oa)){this.setSelected(oa,false);if(!this.isInteractive(na))this.setFocused(oa);}}.bind(this)));};ma.prototype.click=function(na){if(!this.selected)return;var oa;for(var pa=0,qa=arguments.length;pa<qa;pa++){oa=l.scry(this.selected,arguments[pa])[0];if(oa&&k.shown(oa)){oa.click();return;}}};ma.prototype.vert=function(na){if(!this.scrollInitialized){this.subscriptions.addSubscriptions(o.listen(document,'scroll',function(){if(this.selected&&!this.scrolling)this.setSelected(null,true);}.bind(this)));this.scrollInitialized=true;}var oa;if(this.selected){if(this.selected.id=='pagelet_composer'){oa=na>0?this.getStories()[0]:null;if(this.isHoldoutStory(oa))oa=this.getPreviousStory(oa);}else oa=na>0?this.getNextStory(this.selected):(this.getPreviousStory(this.selected)||y('pagelet_composer'));if(!oa){return;}else if(!n.isElementNode(oa)){k.removeClass(this.selected,'selectedStorySimple');this.selected=oa;return this.vert(na);}}if(!oa||s.byClass(oa,'hidden_elem')||!l.contains(document,oa)){oa=this.findTop();if(oa&&na<0)oa=this.getPreviousStory(oa);if(this.isHoldoutStory(oa))oa=this.getPreviousStory(oa);}if(!oa)return;this.anim&&this.anim.stop();var pa=(Date.now()-(this.lastScroll||0)>30),qa=this.setFocused.bind(this,oa);if(aa()){pa=false;qa();qa=x;}this.scrolling=true;this.scrollingTimer&&window.clearTimeout(this.scrollingTimer);this.anim=m.scrollTo(oa,pa?this.getAnimationLength(oa):0,false,v.getViewportDimensions().y-ka-this.getScrollOffset(),function(){this.scrollingTimer=window.setTimeout(function(){this.scrolling=false;}.bind(this),300);qa();}.bind(this));this.setSelected(oa,true);this.lastScroll=Date.now();};ma.prototype.isInteractive=function(na){return ((na.nodeName=='INPUT')||(na.nodeName=='BUTTON')||(na.nodeName=='TEXTAREA')||(na.nodeName=='A')||!!s.byAttribute(na,'contenteditable'));};ma.prototype.setTabindexOnHeadline=function(na,oa){if(this.isStory(na)){var pa=this.getHeadline(na);if(pa)pa.tabIndex=oa;}};ma.prototype.setFocused=function(na){if(this.isStory(na)){var oa=this.getHeadline(na);oa&&p.set(oa);}};e.exports=ma;});
__d("FeedKeyboardController",["CSS","DOM","DOMQuery","FeedBaseKeyboardController","Parent","csx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('DOMQuery'),j=b('FeedBaseKeyboardController'),k=b('Parent'),l=b('csx');for(var m in j)if(j.hasOwnProperty(m))o[m]=j[m];var n=j===null?null:j.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=j;function o(){if(j!==null)j.apply(this,arguments);}o.prototype.getStories=function(){return h.scry(this.root,'li.uiStreamStory');};o.prototype.getParentStory=function(p){if(!h.contains(this.root,p))return;return k.byClass(p,'uiStreamStory');};o.prototype.isStory=function(p){return g.hasClass(p,'uiStreamStory');};o.prototype.getHeadline=function(p){return i.scry(p,'h5.uiStreamHeadline')[0];};o.prototype.clickLike=function(){this.click('.UFILikeLink');};o.prototype.clickComment=function(){this.click('.comment_link');};o.prototype.clickShare=function(){this.click('.share_action_link');};o.prototype.openAttachment=function(){this.click(".uiStreamAttachments ._5dec",'.uiStreamAttachments a.uiVideoThumb','.uiStreamAttachments a.shareText','.uiStreamAttachments a[rel="theater"]','.uiStreamAttachments .shareMediaLink');};o.prototype.isHoldoutStory=function(p){return !!p&&g.hasClass(p,'holdoutAdStory');};o.prototype.isRelevantStory=function(p){return i.isElementNode(p)&&!this.isHoldoutStory(p);};o.prototype.getPreviousStory=function(p){var q=p.previousSibling;while(q&&!this.isRelevantStory(q))q=q.previousSibling;return q;};o.prototype.getNextStory=function(p){var q=p.nextSibling;while(q&&!this.isRelevantStory(q))q=q.nextSibling;return q;};o.prototype.setSelected=function(p,q){if(p){var r=i.scry(p,'.selectedStoryIndicator');if(!r.length)h.prependContent(p,h.create('div',{'class':'selectedStoryIndicator'}));}this.selected&&this.setTabindexOnHeadline(this.selected,'-1');this.selected&&g.removeClass(this.selected,'selectedStorySimple');this.selected=p;p&&this.setTabindexOnHeadline(p,'0');p&&g.addClass(p,'selectedStorySimple');};e.exports=o;});
__d("FeedTrackingAsync",["Event","collectDataAttributes","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('collectDataAttributes'),i=b('copyProperties');function j(){g.listen(document.documentElement,'AsyncRequest/send',function(event){var k=event.getTarget(),l=event.getData().request,m=l.getData(),n=h(k,['ft']);i(m,n);});}e.exports={init:j};});
__d("MercuryLeftNavCountControl",["Arbiter","CSS","DOM","MercuryThreadlistConstants","MessagingTag","MercuryThreadInformer","MercuryUnreadState","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('MercuryThreadlistConstants'),k=b('MessagingTag'),l=b('MercuryThreadInformer').get(),m=b('MercuryUnreadState').get(),n=b('copyProperties'),o,p,q=function(r,s){o=r;p=s;this.render();this.listenerToken=l.subscribe('unread-updated',this.render.bind(this));this.subscriptions=[g.subscribe('onload/exit',this.cleanup.bind(this))];};n(q.prototype,{render:function(){var r=m.exceedsMaxCount(k.INBOX);if(r){i.setContent(o,j.MAX_UNREAD_COUNT);}else{var s=m.getUnreadCount(k.INBOX);i.setContent(o,s.toString());h.conditionClass(o.parentNode,'hidden_elem',s<=0);}i.setContent(p,r?'+':'');},cleanup:function(){this.subscriptions.forEach(g.unsubscribe);l.unsubscribe(this.listenerToken);}});e.exports=q;});
__d("MercuryLeftNav",["DOM","MercuryServerRequests","MercuryLeftNavCountControl"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('MercuryServerRequests').get(),i=b('MercuryLeftNavCountControl');function j(k,l){h.handleUpdate(l);var m=g.scry(k,'span.countValue')[0],n=g.scry(k,'span.maxCountIndicator')[0];new i(m,n);}e.exports=j;});
__d("startMessagingNavCountUpdater",["CounterDisplay","DOM","FutureSideNav","createArrayFrom"],function(a,b,c,d,e,f){var g=b('CounterDisplay'),h=b('DOM'),i=b('FutureSideNav'),j=b('createArrayFrom');function k(o){var p=i.getInstance().getNodeForKey('inbox');if(!p)return;var q=i.getInstance().getNodeForKey('other'),r=h.scry(q,'span.count')[0],s=h.scry(r,'span.countValue')[0],t=h.scry(r,'span.maxCountIndicator')[0];new n('other_unseen',s,r,null,null,true).setMaxCounter(o,t);}for(var l in g)if(g.hasOwnProperty(l))n[l]=g[l];var m=g===null?null:g.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=g;function n(){this._maxValue=null;this._maxIndicatorNode=null;var o=[this].concat(j(arguments));return m.construct.apply(this,o);}n.prototype.setMaxCounter=function(o,p){this._maxValue=o;this._maxIndicatorNode=p;};n.prototype.paint=function(){var o=this._maxValue&&this._count>this._maxValue,p=o?this._maxValue:this._count;if(this._maxIndicatorNode){h.setContent(this._maxIndicatorNode,o?'+':'');}else if(o)p=p+'+';h.setContent(this._valueNode,p);this._toggleNodes();};e.exports=k;});
__d("legacy:messaging-nav-count",["startMessagingNavCountUpdater"],function(a,b,c,d){a.startMessagingNavCountUpdater=b('startMessagingNavCountUpdater');},3);
__d("ViewportTracking",["Arbiter","Banzai","DOMDimensions","DOMPosition","Event","NavigationMessage","Run","Style","SubscriptionsHandler","UIIntentionalStreamMessage","UserActivity","Vector","clickRefAction","collectDataAttributes","copyProperties","debounce","throttle"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Banzai'),i=b('DOMDimensions'),j=b('DOMPosition'),k=b('Event'),l=b('NavigationMessage'),m=b('Run'),n=b('Style'),o=b('SubscriptionsHandler'),p=b('UIIntentionalStreamMessage'),q=b('UserActivity'),r=b('Vector'),s=b('clickRefAction'),t=b('collectDataAttributes'),u=b('copyProperties'),v=b('debounce'),w=b('throttle'),x=97,y='vpv';function z(){}z.prototype.init=function(aa){this.useBanzai=!!aa.banzai;this.readStoryIDs={};this.minSizeToBeVisible=200;this.minSizeToBeVisibleForTimetracking=200;this.timetrackingThrottlingInterval=100;this.cachedAllStories=null;this.cachedViewportHeight=i.getViewportDimensions().height;this.isTimetrackingEnabled=0;this.storyEnteredVPTimestamp={};this.userInactiveLock=false;this.userActivityPollerTimeoutID=-1;this._headLoadStoryCount=0;this.getDataFromConfig(aa);this.isLoose=!!aa.is_loose;this.maxScrollPosition=0;this.porportionRatio=.5;this.is_proportion=!!aa.is_proportion;if(this.is_proportion)this.proportionRatio=aa.proportion_ratio;if(aa.tracking_duration_config){this.minSizeToBeVisibleForTimetracking=aa.tracking_duration_config.min_height_to_be_visible;this.timetrackingThrottlingInterval=aa.tracking_duration_config.timetracking_throttling_interval;this.userActivityPollingInterval=aa.tracking_duration_config.user_activity_polling_interval;this.timeToBeConsideredInactive=aa.tracking_duration_config.time_to_be_considered_inactive;}var ba,ca=v(this.fireTimer,this.getTimeout(),this);if(this.isLoose){this.minSizeToBeVisible=0;ba=w(function(){this.maxScrollPosition=Math.max(this.maxScrollPosition,r.getScrollPosition().y);ca();}.bind(this));}else ba=ca;this.fireTimer();var da=w(this.updateTimeTrackingData.bind(this,false),this.timetrackingThrottlingInterval);this.subscriptions=new o();this.subscriptions.addSubscriptions(this._getScrollListener(ba),k.listen(window,'resize',function(){this.cachedViewportHeight=i.getViewportDimensions().height;ba();}.bind(this)),g.subscribe(p.UPDATE_HTML_CONTENT,ba),g.subscribe(l.NAVIGATION_BEGIN,this.cleanup.bind(this)),g.subscribe('Stream/totalHeadLoadedStories',function(ea,fa){this._headLoadStoryCount=fa;}.bind(this)));if(this.isTimetrackingEnabled){this.updateTimeTrackingData(false);this.subscriptions.addSubscriptions(this._getScrollListener(da));this._userActivityPoller();}m.onLeave(this.cleanup.bind(this));};z.prototype._getScrollListener=function(aa){return k.listen(window,'scroll',aa);};z.prototype.cleanup=function(){if(this.subscriptions){this.subscriptions.release();this.subscriptions=null;}if(this.isTimetrackingEnabled){clearTimeout(this.userActivityPollerTimeoutID);this.updateTimeTrackingData(true);}this._headLoadStoryCount=0;};z.prototype.fireTimer=function(){this.getStoriesInView().forEach(this.markStoryRead.bind(this));};z.prototype._userActivityPoller=function(){if(!this.userInactiveLock&&!q.isActive(this.timeToBeConsideredInactive)){this.userInactiveLock=true;this.updateTimeTrackingData(true);q.subscribeOnce(function(){this.updateTimeTrackingData(false);this.userInactiveLock=false;}.bind(this));}this.userActivityPollerTimeoutID=setTimeout(this._userActivityPoller.bind(this),this.userActivityPollingInterval);};z.prototype.addVisibleStoriesTimestamps=function(aa,ba){var ca={};for(var da=0,ea=aa.length;da<ea;da++){var fa=this.getStoryID(aa[da]);ca[fa]=true;if(fa in this.storyEnteredVPTimestamp)continue;this.storyEnteredVPTimestamp[fa]={ts:ba,story:aa[da]};}return ca;};z.prototype.removeTimestampsOfStoriesNotInView=function(aa,ba){for(var ca in this.storyEnteredVPTimestamp)if(!(ca in aa)){this.recordTimeStoryWasInView(this.storyEnteredVPTimestamp[ca].story,this.storyEnteredVPTimestamp[ca].ts,ba);delete this.storyEnteredVPTimestamp[ca];}};z.prototype.updateTimeTrackingData=function(aa){if(!this.storyEnteredVPTimestamp)this.storyEnteredVPTimestamp={};var ba=Date.now(),ca={},da;if(!aa)ca=this.getAllStoriesInView();da=this.addVisibleStoriesTimestamps(ca,ba);this.removeTimestampsOfStoriesNotInView(da,ba);};z.prototype.getStoriesInView=function(){var aa=this.getAllStories(),ba=[],ca=false;for(var da=0;da<aa.length;da++){var ea=aa[da],fa=this.getStoryID(ea);if(this.hasBeenVisible(fa))continue;if(this.isVisible(ea)){if(ea.getAttribute('data-insertion-position')===null)ea.setAttribute('data-insertion-position',da-this._headLoadStoryCount);ba.push(ea);ca=true;}else if(ca)break;}return ba;};z.prototype.getAllStoriesFromCache=function(){if(this.cachedAllStories===null)this.cachedAllStories=this.getAllStories();return this.cachedAllStories;};z.prototype.invalidateAllStoriesCache=function(){this.cachedAllStories=null;};z.prototype.getAllStoriesInView=function(){var aa=this.getAllStoriesFromCache(),ba=[],ca=false,da=0,ea=aa.length,fa=1;if(this._indexOfLastVisibleStoryOnPreviousPass>ea/2){da=ea-1;ea=-1;fa=-fa;}for(var ga=da;ga!=ea;ga+=fa){var ha=aa[ga];if(this._isVisible(ha,false,this.minSizeToBeVisibleForTimetracking)){if(ha.getAttribute('data-insertion-position')===null)ha.setAttribute('data-insertion-position',ga-this._headLoadStoryCount);ba.push(ha);ca=true;}else if(ca){this._indexOfLastVisibleStoryOnPreviousPass=ga-fa;break;}}return ba;};z.prototype.getTimetrackingDataToLog=function(aa,ba,ca){var da={evt:x,vpvd_start_timestamp:ba,vpvd_time_delta:ca-ba,story_height:i.getElementDimensions(aa).height,viewport_height:this.cachedViewportHeight};return {ft:da};};z.prototype.recordTimeStoryWasInView=function(aa,ba,ca){if(this.isTimetrackingEnabled){var da=this.getTimetrackingDataToLog(aa,ba,ca);this.sendDataToLog(aa,da);}};z.prototype.hasBeenVisible=function(aa){return aa in this.readStoryIDs;};z.prototype.isVisible=function(aa){return this._isVisible(aa,this.isLoose,this.minSizeToBeVisible);};z.prototype._isVisible=function(aa,ba,ca){var da=r.getScrollPosition().y,ea=i.getViewportDimensions().height,fa=j.getElementPosition(aa),ga=i.getElementDimensions(aa),ha=ea+this.maxScrollPosition-da;if(!fa.x&&!fa.y&&!ga.x&&!ga.y)return false;if(ba&&fa.y<ha)return true;var ia=Math.max(fa.y,0),ja=Math.min(fa.y+ga.height,ea),ka;if(this.is_proportion){ka=ga.height*this.proportionRatio;}else ka=Math.min(ga.height,ca);return (ja-ia)>=ka;};z.prototype.sendDataToLog=function(aa,ba){if(this.useBanzai){var ca=t(aa,['ft']);u(ba.ft,ca.ft);delete ba.ei;h.post('feed_tracking',ba);}else s(y,aa,null,'FORCE',ba);};z.prototype.markStoryRead=function(aa){var ba=this.getStoryID(aa);if(!ba||this.hasBeenVisible(ba))return;this.readStoryIDs[ba]=true;var ca=this.getDataToLog(aa);this.sendDataToLog(aa,ca);};e.exports=z;});
__d("collectSubtreeData",[],function(a,b,c,d,e,f){function g(i,j,k,l,m){if(i.offsetWidth===0&&i.offsetHeight===0)return m;var n={};if(i.getAttribute)for(r=0;r<j.length;r++){t=j[r];var o=i.getAttribute(k[t]);if(o){n[t]={};var p=JSON.parse(o);for(var q in l)if(p[q]!==undefined){n[t][q]=true;if(m[t]===undefined)m[t]={};if(m[t][q]===undefined)m[t][q]=[];if(l[q].length>0)m[t][q].push(l[q]);m[t][q].push('('+p[q]);}}}for(var r=0;r<i.childNodes.length;r++){var s=i.childNodes[r];g(s,j,k,l,m);}for(var t in n)for(var u in n[t]){var v=m[t][u][m[t][u].length-1];if(v.length>0&&v.charAt(0)=='('){m[t][u][m[t][u].length-1]=v.substr(1);}else m[t][u].push(')');}return m;}function h(i,j){var k={};for(var l=0;l<j.length;++l)k[j[l]]='data-'+j[l];var m={tn:"","tn-debug":","},n={};g(i,j,k,m,n);for(var o in n)for(var p in n[o])n[o][p]=n[o][p].join('');return n;}e.exports=h;});
__d("recordTNTreeData",["collectSubtreeData"],function(a,b,c,d,e,f){var g=b('collectSubtreeData');function h(i,j){var k={},l=g(i,['ft']);for(var m in l.ft){k[m+'_tree']=l.ft[m];if(m==='tn-debug')i.setAttribute('tn-debug_subtree',l.ft[m]);}k.evt_value=i.offsetHeight;if(j)k.offset=Math.max(0,i.offsetTop-j.offsetTop);return k;}e.exports=h;});
__d("PubcontentLegacyFeedChainingController",["DOM","PubcontentFeedChainingController"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('PubcontentFeedChainingController');for(var i in h)if(h.hasOwnProperty(i))k[i]=h[i];var j=h===null?null:h.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=h;function k(){if(h!==null)h.apply(this,arguments);}k.prototype.findStory=function(l){var m=g.scry(l,'^li.uiStreamStory');return m.length===1?m[0]:null;};k.prototype.findContainer=function(l){var m=g.scry(l,"div[role='article']");return m.length>=1?m[0]:null;};e.exports=k;new k();});
__d("StreamViewportTracking",["Arbiter","DOM","UIIntentionalStreamMessage","ViewportTracking","ge","recordTNTreeData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DOM'),i=b('UIIntentionalStreamMessage'),j=b('ViewportTracking'),k=b('ge'),l=b('recordTNTreeData'),m=51;for(var n in j)if(j.hasOwnProperty(n))p[n]=j[n];var o=j===null?null:j.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=j;function p(){if(j!==null)j.apply(this,arguments);}p.prototype.init=function(q,r){if(r)this.$StreamViewportTracking0=r;o.init.call(this,q);this.initSubscriptions();};p.prototype.initSubscriptions=function(){this.subscriptions.addSubscriptions(g.subscribe(i.UPDATE_LAST_REFRESH_TIME,this.invalidateAllStoriesCache.bind(this)),g.subscribe(i.UNLOAD,this.updateTimeTrackingData.bind(this,true)));};p.prototype.getDataFromConfig=function(q){this.recordTNTree=q.record_tn_tree;this.timeout=q.record_delay;this.isTimetrackingEnabled=!!q.is_timetracking_enabled;};p.prototype.getTimeout=function(){return this.timeout;};p.prototype.getStorySelector=function(){return '.uiStreamStory';};p.prototype.getAllStories=function(){var q=h.scry(this.getStream(),this.getStorySelector());return q.filter(function(r){return r.getAttribute('data-ft');});};p.prototype.getStoryID=function(q){var r=JSON.parse(q.getAttribute('data-ft'));return r.mf_story_key;};p.prototype.getDataToLog=function(q){var r={};if(this.recordTNTree){var s=this.getStream();r=l(q,s);var t=q.getAttribute('data-insertion-position');if(t!==null)r.inspos=t;}r.evt=m;return {ft:r};};p.prototype.getStream=function(){if(this.$StreamViewportTracking0)return this.$StreamViewportTracking0;return k('home_stream');};p.init=function(q,r){p.instance=new p();p.instance.init(q,r);};p.getInstance=function(){return p.instance;};e.exports=p;});
__d("legacy:UIIntentionalStream",["UIIntentionalStream"],function(a,b,c,d){a.UIIntentionalStream=b('UIIntentionalStream');},3);
__d("legacy:UIIntentionalStream-message",["UIIntentionalStreamMessage"],function(a,b,c,d){a.UIIntentionalStreamMessage=b('UIIntentionalStreamMessage');},3);
__d("legacy:UIIntentionalStreamRefresh",["UIIntentionalStreamRefresh"],function(a,b,c,d){a.UIIntentionalStreamRefresh=b('UIIntentionalStreamRefresh');},3);