/*!CK:1577787302!*//*1379684738,179347229*/

if (self.CavalryLogger) { CavalryLogger.start_js(["q1\/\/\/"]); }

__d("legacy:cookie",["Cookie"],function(a,b,c,d){var e=b('Cookie');a.getCookie=e.get;a.setCookie=e.set;a.clearCookie=e.clear;},3);
__d("HashtagParser",["URLMatcher"],function(a,b,c,d,e,f){var g=b('URLMatcher'),h=100,i=30,j=/@\[([0-9]+):([0-9]+):((?:[^\\\]]*(?:\\.)*)*)\]/g;function k(){var da='\xc0-\xd6'+'\xd8-\xf6'+'\xf8-\xff'+'\u0100-\u024f'+'\u0253-\u0254'+'\u0256-\u0257'+'\u0259'+'\u025b'+'\u0263'+'\u0268'+'\u026f'+'\u0272'+'\u0289'+'\u028b'+'\u02bb'+'\u0300-\u036f'+'\u1e00-\u1eff',ea='\u0400-\u04ff'+'\u0500-\u0527'+'\u2de0-\u2dff'+'\ua640-\ua69f'+'\u0591-\u05bf'+'\u05c1-\u05c2'+'\u05c4-\u05c5'+'\u05c7'+'\u05d0-\u05ea'+'\u05f0-\u05f4'+'\ufb12-\ufb28'+'\ufb2a-\ufb36'+'\ufb38-\ufb3c'+'\ufb3e'+'\ufb40-\ufb41'+'\ufb43-\ufb44'+'\ufb46-\ufb4f'+'\u0610-\u061a'+'\u0620-\u065f'+'\u066e-\u06d3'+'\u06d5-\u06dc'+'\u06de-\u06e8'+'\u06ea-\u06ef'+'\u06fa-\u06fc'+'\u06ff'+'\u0750-\u077f'+'\u08a0'+'\u08a2-\u08ac'+'\u08e4-\u08fe'+'\ufb50-\ufbb1'+'\ufbd3-\ufd3d'+'\ufd50-\ufd8f'+'\ufd92-\ufdc7'+'\ufdf0-\ufdfb'+'\ufe70-\ufe74'+'\ufe76-\ufefc'+'\u200c-\u200c'+'\u0e01-\u0e3a'+'\u0e40-\u0e4e'+'\u1100-\u11ff'+'\u3130-\u3185'+'\uA960-\uA97F'+'\uAC00-\uD7AF'+'\uD7B0-\uD7FF'+'\uFFA1-\uFFDC',fa=String.fromCharCode,ga='\u30A1-\u30FA\u30FC-\u30FE'+'\uFF66-\uFF9F'+'\uFF10-\uFF19\uFF21-\uFF3A'+'\uFF41-\uFF5A'+'\u3041-\u3096\u3099-\u309E'+'\u3400-\u4DBF'+'\u4E00-\u9FFF'+fa(173824)+'-'+fa(177983)+fa(177984)+'-'+fa(178207)+fa(194560)+'-'+fa(195103)+'\u3003\u3005\u303B',ha=da+ea+ga,ia='\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6'+'\u00F8-\u0241\u0250-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EE\u037A\u0386'+'\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03CE\u03D0-\u03F5\u03F7-\u0481'+'\u048A-\u04CE\u04D0-\u04F9\u0500-\u050F\u0531-\u0556\u0559\u0561-\u0587'+'\u05D0-\u05EA\u05F0-\u05F2\u0621-\u063A\u0640-\u064A\u066E-\u066F'+'\u0671-\u06D3\u06D5\u06E5-\u06E6\u06EE-\u06EF\u06FA-\u06FC\u06FF\u0710'+'\u0712-\u072F\u074D-\u076D\u0780-\u07A5\u07B1\u0904-\u0939\u093D\u0950'+'\u0958-\u0961\u097D\u0985-\u098C\u098F-\u0990\u0993-\u09A8\u09AA-\u09B0'+'\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC-\u09DD\u09DF-\u09E1\u09F0-\u09F1'+'\u0A05-\u0A0A\u0A0F-\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32-\u0A33'+'\u0A35-\u0A36\u0A38-\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D'+'\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2-\u0AB3\u0AB5-\u0AB9\u0ABD'+'\u0AD0\u0AE0-\u0AE1\u0B05-\u0B0C\u0B0F-\u0B10\u0B13-\u0B28\u0B2A-\u0B30'+'\u0B32-\u0B33\u0B35-\u0B39\u0B3D\u0B5C-\u0B5D\u0B5F-\u0B61\u0B71\u0B83'+'\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99-\u0B9A\u0B9C\u0B9E-\u0B9F'+'\u0BA3-\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0C05-\u0C0C\u0C0E-\u0C10'+'\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C60-\u0C61\u0C85-\u0C8C'+'\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE'+'\u0CE0-\u0CE1\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39'+'\u0D60-\u0D61\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6'+'\u0E01-\u0E30\u0E32-\u0E33\u0E40-\u0E46\u0E81-\u0E82\u0E84\u0E87-\u0E88'+'\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7'+'\u0EAA-\u0EAB\u0EAD-\u0EB0\u0EB2-\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6'+'\u0EDC-\u0EDD\u0F00\u0F40-\u0F47\u0F49-\u0F6A\u0F88-\u0F8B\u1000-\u1021'+'\u1023-\u1027\u1029-\u102A\u1050-\u1055\u10A0-\u10C5\u10D0-\u10FA\u10FC'+'\u1100-\u1159\u115F-\u11A2\u11A8-\u11F9\u1200-\u1248\u124A-\u124D'+'\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0'+'\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310'+'\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C'+'\u166F-\u1676\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711'+'\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7'+'\u17DC\u1820-\u1877\u1880-\u18A8\u1900-\u191C\u1950-\u196D\u1970-\u1974'+'\u1980-\u19A9\u19C1-\u19C7\u1A00-\u1A16\u1D00-\u1DBF\u1E00-\u1E9B'+'\u1EA0-\u1EF9\u1F00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D'+'\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC'+'\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC'+'\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u2094\u2102\u2107'+'\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D'+'\u212F-\u2131\u2133-\u2139\u213C-\u213F\u2145-\u2149\u2C00-\u2C2E'+'\u2C30-\u2C5E\u2C80-\u2CE4\u2D00-\u2D25\u2D30-\u2D65\u2D6F\u2D80-\u2D96'+'\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6'+'\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3006\u3031-\u3035'+'\u303B-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF'+'\u3105-\u312C\u3131-\u318E\u31A0-\u31B7\u31F0-\u31FF\u3400-\u4DB5'+'\u4E00-\u9FBB\uA000-\uA48C\uA800-\uA801\uA803-\uA805\uA807-\uA80A'+'\uA80C-\uA822\uAC00-\uD7A3\uF900-\uFA2D\uFA30-\uFA6A\uFA70-\uFAD9'+'\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C'+'\uFB3E\uFB40-\uFB41\uFB43-\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F'+'\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A'+'\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7'+'\uFFDA-\uFFDC',ja='\u0300-\u036F\u0483-\u0486\u0591-\u05B9\u05BB-\u05BD\u05BF'+'\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u0615\u064B-\u065E\u0670'+'\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\u0711\u0730-\u074A'+'\u07A6-\u07B0\u0901-\u0903\u093C\u093E-\u094D\u0951-\u0954\u0962-\u0963'+'\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7-\u09C8\u09CB-\u09CD\u09D7'+'\u09E2-\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47-\u0A48\u0A4B-\u0A4D'+'\u0A70-\u0A71\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD'+'\u0AE2-\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B43\u0B47-\u0B48\u0B4B-\u0B4D'+'\u0B56-\u0B57\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7'+'\u0C01-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55-\u0C56'+'\u0C82-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5-\u0CD6'+'\u0D02-\u0D03\u0D3E-\u0D43\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D82-\u0D83'+'\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2-\u0DF3\u0E31\u0E34-\u0E3A'+'\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB-\u0EBC\u0EC8-\u0ECD\u0F18-\u0F19'+'\u0F35\u0F37\u0F39\u0F3E-\u0F3F\u0F71-\u0F84\u0F86-\u0F87\u0F90-\u0F97'+'\u0F99-\u0FBC\u0FC6\u102C-\u1032\u1036-\u1039\u1056-\u1059\u135F'+'\u1712-\u1714\u1732-\u1734\u1752-\u1753\u1772-\u1773\u17B6-\u17D3\u17DD'+'\u180B-\u180D\u18A9\u1920-\u192B\u1930-\u193B\u19B0-\u19C0\u19C8-\u19C9'+'\u1A17-\u1A1B\u1DC0-\u1DC3\u20D0-\u20DC\u20E1\u20E5-\u20EB\u302A-\u302F'+'\u3099-\u309A\uA802\uA806\uA80B\uA823-\uA827\uFB1E\uFE00-\uFE0F'+'\uFE20-\uFE23',ka='\u0030-\u0039\u0660-\u0669\u06F0-\u06F9\u0966-\u096F\u09E6-\u09EF'+'\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F'+'\u0CE6-\u0CEF\u0D66-\u0D6F\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29'+'\u1040-\u1049\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9'+'\uFF10-\uFF19',la=ia+ja+ha,ma=ka+'_',na=la+ma,oa='['+la+']',pa='['+na+']',qa='^|$|[^&'+na+']',ra='[#\\uFF03]',sa='('+qa+')('+ra+')('+pa+'*'+oa+pa+'*)';return new RegExp(sa,'ig');}function l(da){var ea=y(da),fa=0,ga=0;return n(da).map(function(ha){while(fa<ea.length){var ia=ea[fa],ja=ia.offset-ga;if(ja<ha.offset){ga+=ia.token.length-ia.name.length;fa++;}else break;}return {marker:ha.marker,tag:ha.hashtag,rawOffset:ha.offset+ga,offset:ha.offset};});}function m(da){return o(da,t(da));}function n(da){var ea=aa(da);return o(ea,p(da,ea));}function o(da,ea){return r(da).slice(0,i).filter(function(fa){var ga=v(fa.offset,fa.hashtag.length,ea);return !ga&&fa.hashtag.length<=h;});}function p(da,ea){return u(s(da),t(ea));}var q=k();function r(da){var ea=[];da.replace(q,function(fa,ga,ha,ia,ja){ea.push({marker:ha,hashtag:ia,offset:ja+ga.length});});return ea;}function s(da){return ba(da).map(function(ea){return [ea.offset,ea.name.length];});}function t(da){var ea=[],fa,ga=0;while((fa=g.permissiveMatch(da))){var ha=da.indexOf(fa);ea.push([ga+ha,fa.length]);da=da.substring(ha+fa.length);ga+=ha+fa.length;}return ea;}function u(da,ea){var fa=[],ga=0,ha=0,ia=0;while(ga<da.length&&ha<ea.length)if(da[ga][0]>ea[ha][0]){fa[ia++]=ea[ha++];}else fa[ia++]=da[ga++];return fa.concat(da.slice(ga),ea.slice(ha));}function v(da,ea,fa){if(!fa)return false;var ga=x(fa,da);return w(da,ea,fa,ga)||w(da,ea,fa,ga+1);}function w(da,ea,fa,ga){if(!fa[ga])return false;var ha=fa[ga][0],ia=fa[ga][1];return !((da+ea-1<ha)||(da>ha+ia-1));}function x(da,ea){var fa=0,ga=da.length-1;while(fa<=ga){var ha=Math.floor((fa+ga)/2),ia=da[ha][0];if(ia==ea){return ha;}else if(ia<ea){fa=ha+1;}else ga=ha-1;}return ga;}function y(da){var ea=[];da.replace(j,function(fa,ga,ha,ia,ja){ea.push({token:fa,id:ga,type:ha,name:ia,offset:ja});});return ea;}function z(da){return da?da.replace(/\\([^\\])/g,'$1').replace(/\\\\/g,'\\'):null;}function aa(da){return da.replace(j,function(ea,fa,ga,ha,ia){return z(ha);});}function ba(da){var ea=0,fa=0;return y(da).map(function(ga){var ha=da.indexOf(ga.token,fa);fa=ha+1;ha-=ea;var ia=z(ga.name);ea+=ga.token.length-ia.length;if(ha>=0)return {id:ga.id,name:ia,type:ga.type,offset:ha};});}var ca={};ca.parse=l;ca.parseWithoutMentions=m;e.exports=ca;});
__d("FriendBrowserCheckboxController",["AsyncRequest","CSS","DOM","Event","Form","OnVisible","$","bind","copyProperties","ge"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('DOM'),j=b('Event'),k=b('Form'),l=b('OnVisible'),m=b('$'),n=b('bind'),o=b('copyProperties'),p=b('ge');function q(){}o(q,{instances:{},getInstance:function(r){return this.instances[r];}});o(q.prototype,{init:function(r,s,t,u){q.instances[r]=this;this._id=r;this._simplified=t;this._infiniteScroll=u;this._form=s;this._contentGrid=i.find(s,'.friendBrowserCheckboxContentGrid');this._loadingIndicator=i.find(s,'.friendBrowsingCheckboxContentLoadingIndicator');this._checkboxResults=i.find(s,'.friendBrowserCheckboxResults');this._contentPager=i.find(s,'.friendBrowserCheckboxContentPager');this.numGetNewRequests=0;this.queuedRequests={};j.listen(this._form,'submit',this.onFormSubmit.bind(this));},addTypeahead:function(r,s){r.subscribe('select',this.onHubSelect.bind(this,r,s));if(this._simplified)r.subscribe('unselect',this.onHubSelect.bind(this,r,s));},onFormSubmit:function(){this.getNew(true);return false;},addSelector:function(r){r.subscribe('change',this.getNew.bind(this,false));},onHubSelect:function(r,s,event,t){if(this._simplified){this.getNew(true);return;}if(!((event=='select')&&t.selected))return;var u=this.buildNewCheckbox(s,t.selected.text,t.selected.uid),v=i.find(this._form,'.checkboxes_'+s);i.appendContent(v.firstChild,u);var w=i.scry(r.getElement(),'input[type="button"]');if(w&&w[0])w[0].click();this.getNew(true);},buildNewCheckbox:function(r,s,t){var u=r+'_ids_'+t,v=r+'_ids[]',w=i.create('input',{id:u,type:'checkbox',value:t,name:v,checked:true});j.listen(w,'click',n(this,'getNew',false));var x=i.create('td',null,w);h.addClass(x,'vTop');h.addClass(x,'hLeft');var y=i.create('label',null,s),z=i.create('td',null,y);h.addClass(z,'vMid');h.addClass(z,'hLeft');var aa=i.create('tr');aa.appendChild(x);aa.appendChild(z);return aa;},showMore:function(){var r=i.scry(this._contentPager,'.friendBrowserMorePager')[0];if(!r)return false;if(h.hasClass(r,'async_saving'))return false;var s=this.numGetNewRequests,t=k.serialize(this._form);t.show_more=true;var u=new g().setURI('/ajax/growth/friend_browser/checkbox.php').setData(t).setHandler(n(this,function(v){this.showMoreHandler(v,s);})).setStatusElement(r).send();},showMoreHandler:function(r,s){if(s==this.numGetNewRequests){var t=r.payload;i.appendContent(this._contentGrid,t.results);this.updatePagerAndExtraData(t.pager,t.extra_data);}},getNew:function(r){this.numGetNewRequests++;var s=this.numGetNewRequests;h.addClass(this._checkboxResults,'friendBrowserCheckboxContentOnload');if(p('friendBrowserCI'))h.addClass(m('friendBrowserCI'),'friendBrowserCheckboxContentOnload');h.show(this._loadingIndicator);var t=k.serialize(this._form);t.used_typeahead=r;new g().setURI('/ajax/growth/friend_browser/checkbox.php').setData(t).setHandler(n(this,function(u){this.getNewHandler(u,s);})).send();},getNewHandler:function(r,s){if(s==this.numGetNewRequests){var t=r.payload;i.setContent(this._contentGrid,t.results);h.removeClass(this._checkboxResults,'friendBrowserCheckboxContentOnload');if(p('friendBrowserCI'))h.hide(m('friendBrowserCI'));h.hide(this._loadingIndicator);this.updatePagerAndExtraData(t.pager,t.extra_data);}},updatePagerAndExtraData:function(r,s){i.setContent(this._contentPager,r);if(this._infiniteScroll)this.setupOnVisible();i.replace(this._form.elements.extra_data,s);},setupOnVisible:function(){var r=i.scry(this._contentPager,'.friendBrowserMorePager')[0];if(r&&this._id!='jewel'){this._onVisible&&this._onVisible.remove();this._onVisible=new l(r,n(this,'showMore'),false,1000);}}});e.exports=q;});
__d("legacy:friend-browser-checkbox-js",["FriendBrowserCheckboxController"],function(a,b,c,d){a.FriendBrowserCheckboxController=b('FriendBrowserCheckboxController');},3);
__d("FacebarResultStoreUtils",[],function(a,b,c,d,e,f){var g={processEntityResult:function(h,i,j,k){var l={semantic:i.toString(),structure:[{type:'ent:'+h,text:j,uid:i}],type:h,cost:k,cache_id_length:0};l.tuid=JSON.stringify({semantic:l.semantic,structure:l.structure});return l;},getRawTextFromStructured:function(h){var i='';h.forEach(function(j,k){i+=j.getText();});return i;}};e.exports=g;});
__d("HashtagSearchResultUtils",["FacebarResultStoreUtils","HashtagParser","HashtagSearchResultConfig","URI"],function(a,b,c,d,e,f){var g=b('FacebarResultStoreUtils'),h=b('HashtagParser'),i=b('HashtagSearchResultConfig'),j=b('URI'),k={getHashtagFromQuery:function(l){var m=h.parse(l);if(m&&m.length===1&&m[0].offset===0)return m[0].tag;return false;},makeTypeaheadResult:function(l){return {category:'Hashtag',path:j('/hashtag/'+l).toString(),photo:i.image_url,rankType:null,replace_results:i.boost_result?true:false,scaled_score:1,score:0,text:'#'+l,type:'hashtag_exact',uid:'hashtag:'+l};},makeFacebarEntry:function(l){return {category:'Hashtag',path:j('/hashtag/'+l).toString(),photo:i.image_url,replace_results:i.boost_result?true:false,text:'#'+l,type:'hashtag_exact',uid:'hashtag:'+l};},makeFacebarResult:function(l){var m=g.processEntityResult('hashtag_exact','hashtag:'+l,'#'+l,i.hashtag_cost);m.parse={display:[{type:'ent:hashtag_exact',uid:'hashtag:'+l}],remTokens:[],suffix:''};m.tags={hashtag:'hashtag'};return m;}};e.exports=k;});
__d("ContextualHelpSearchController",["Event","AsyncRequest","DOM","CSS","Focus","Input","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('DOM'),j=b('CSS'),k=b('Focus'),l=b('Input'),m=b('copyProperties'),n=400;function o(){this._token=null;this._timerID=0;this._lastQuery=null;this.typing_listener=null;this.clear_listener=null;this.async_request=null;}m(o.prototype,{init:function(p,q,r,s,t){this.loader=p;this.search_box=q;this.topics_area=r;this.results_area=s;this.clear_button=t;this.typing_listener=g.listen(this.search_box,'keyup',this.setTimer.bind(this));this.clear_listener=g.listen(this.clear_button,'click',this.clearResults.bind(this));k.set(this.search_box);},source:'contextual_help',clearResults:function(){this.show(this.topics_area);this._lastQuery='';l.reset(this.search_box);k.set(this.search_box);if(this.async_request!==null){this.async_request.abort();this.async_request=null;}j.addClass(this.clear_button,'hidden_elem');},update:function(){var p=l.getValue(this.search_box);if(p===this._lastQuery)return;this._lastQuery=p;if(p===''){this.clearResults();return;}this.show(this.loader);var q={query:p,width:this._width||n,source:this.source};this.async_request=new h('/help/ajax/search/').setData(q).setHandler(function(r){this._update(r);}.bind(this));this.async_request.send();},_update:function(p){this.async_request=null;var q=p.getPayload().results;i.setContent(this.results_area,q);this.show(this.results_area);if(l.getValue(this.search_box)===''){this.clearResults();}else j.removeClass(this.clear_button,'hidden_elem');},setTimer:function(){if(this._timerID!==0)clearTimeout(this._timerID);this._timerID=setTimeout(this.update.bind(this),300);if(this.async_request!=null){this.async_request.abort();this.async_request=null;}},show:function(p){var q=[this.loader,this.topics_area,this.results_area];for(var r=0;r<q.length;r++)j.addClass(q[r],'hidden_elem');j.removeClass(p,'hidden_elem');}});e.exports=o;});
__d("RequestsJewel",["Arbiter","AsyncRequest","AsyncSignal","ChannelConstants","CSS","DOM","Event","FriendBrowserCheckboxController","LinkController","Parent","ScrollableArea","Vector","copyProperties","ge","shield","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AsyncSignal'),j=b('ChannelConstants'),k=b('CSS'),l=b('DOM'),m=b('Event'),n=b('FriendBrowserCheckboxController'),o=b('LinkController'),p=b('Parent'),q=b('ScrollableArea'),r=b('Vector'),s=b('copyProperties'),t=b('ge'),u=b('shield'),v=b('tx');function w(){}s(w,{instance:null,getInstance:function(){return this.instance;}});s(w.prototype,{init:function(x,y,z){w.instance=this;this.countNew=0;this.jewel=x;this.jewelFlyoutCase=x.getRoot();this.jewelFlyout=t('fbRequestsFlyout');this.newCountSpan=t('newRequestCount');this.folder=y;this.doNewMarkRead=z;this.openTimestamp=0;this._requestList={};this._egoData={};this._requestCount=0;this.egoPredictedCount=0;this.pendingCount=0;this.shouldLogEgoClick=false;this.shouldClearPredictionAssocOnClick=false;var aa=t('requestsMarkReadButton');if(aa)m.listen(aa,'click',u(this._markRead,this));this.jewel.subscribe('marked-seen',u(this._markSeenCallback,this));this.jewel.subscribe('closed',u(this._clearNewItems,this));this.jewel.subscribe('updated',this._updateCount.bind(this));this.jewel.subscribe('opened',this._openHandler.bind(this));o.registerHandler(this._handleLink.bind(this));g.subscribe(j.getArbiterType('jewel_requests_add'),this._addRequest.bind(this));g.subscribe(j.getArbiterType('jewel_requests_remove_old'),this._removeOldRequest.bind(this));g.subscribe(j.getArbiterType('friend_requests_seen'),this._markSeenFromMessage.bind(this));g.subscribe('jewel/ego_predicted_count',function(ba,ca){this.egoPredictedCount=ca.ego_predicted_count;this.pendingCount=ca.pending_count;this.egoUnseenTimestamp=ca.unseen_timestamp;this.shouldLogEgoClick=ca.should_log_ego_click;this.actionContext=ca.action_context;}.bind(this));m.listen(this.jewelFlyout,'submit',function(ba){var ca=p.byClass(ba.getTarget(),'objectListItem');if(ca){k.removeClass(ca,'jewelItemNew');k.addClass(ca,'jewelItemResponded');this.pageInCollapsedRequests();}}.bind(this));this.setupScroll();return this;},setupScroll:function(){var x=l.scry(this.jewelFlyout,'.uiScrollableAreaWrap')[0];if(x){this._scrollableWrap=x;this._lastLinkPosition=0;this._scrollListener=m.listen(x,'scroll',this._handleScroll.bind(this),m.Priority._BUBBLE);}},fromDom:function(){l.scry(this.jewelFlyout,'.jewelItemList li.objectListItem').forEach(function(x){var y=x.getAttribute('id');if(y){var z=t(y+'_status'),aa=this._parseIDToInts(y),ba=z.getAttribute('data-ego');if(aa.requester){this._requestList[aa.requester]=y;if(ba)this._egoData[ba]=ba;}++this._requestCount;}}.bind(this));this._conditionShowEmptyMessage();},_parseID:function(x){var y=x.match(/^(\d+)_(\d+)/);return (y)?{requester:y[1],type:y[2]}:undefined;},_parseIDToInts:function(x){var y=x?this._parseID(x):undefined,z;if(y&&y.requester){z=parseInt(y.requester,10);if(isNaN(z))z=undefined;}var aa;if(y&&y.type){aa=parseInt(y.type,10);if(isNaN(aa))aa=undefined;}return {requester:z,type:aa};},_handleLink:function(x,event){var y=p.byClass(x,'jewelItemNew');if(y&&p.byClass(y,'fbRequestList')&&p.byClass(y,'beeperEnabled')){var z=this._parseID(y.id);z&&this._markSeenCallback(z.requester,z.type);g.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});k.removeClass(y,'jewelItemNew');}return true;},_handleScroll:function(){var x=l.scry(this._scrollableWrap,'.uiMorePager');if(!x||(t('fbRequestsJewelManualPager')&&x.length<2))return;var y=x.pop();if(y){var z=r.getElementPosition(y,'viewport').y;if(z>0)k.addClass(p.byClass(this._scrollableWrap,'uiScrollableArea'),'contentAfter');var aa=l.find(y,'a');if(!aa)return;var ba=r.getElementPosition(aa,'viewport').y;if(ba==this._lastLinkPosition)return;var ca=r.getElementPosition(this._scrollableWrap,'viewport').y+r.getElementDimensions(this._scrollableWrap).y;if(ba-300<ca&&ba>0){this._lastLinkPosition=ba;var da=aa.getAttribute('ajaxify');if(da){new h(da).setRelativeTo(aa).setStatusElement(p.byClass(aa,'stat_elem')).send();}else n.getInstance('jewel').showMore();}}},_addRequest:function(x,y){if(!y)return;var z=y.obj.from,aa=y.obj.suggester,ba=this._parseIDToInts(this._requestList[z]).type,ca=ba===19&&!aa;if(!ca&&(ba||this.jewel.isOpen()))return;if(t('fbRequestsJewelLoading')){new h().setURI('/ajax/requests/loader/').send();}else{var da=this._onMarkupCallback.bind(this,z,!!aa),ea={from:z};if(aa)ea.suggester=aa;new h().setURI('/ajax/friends/jewel/request_markup').setData(ea).setHandler(da).send();}},_onMarkupCallback:function(x,y,z){var aa=z.getPayload();if(!aa)return;var ba=this._requestList[x],ca=this._parseIDToInts(ba).type;if(ca===19&&!y){var da=ba&&t(ba);da&&l.replace(da,aa.markup);}else{var ea=l.scry(this.jewelFlyout,'.fbRequestList .uiList')[0];if(!ea)return;l.prependContent(ea,aa.markup);var fa={jewel:'requests',count:++this.countNew};g.inform('jewel/count-updated',fa);++this._requestCount;this._conditionShowEmptyMessage();}this._requestList[x]=aa.item_id;},_removeOldRequest:function(x,y){if(!y||this.jewel.isOpen()||t('fbRequestsJewelLoading')!==null)return;var z=this._requestList[y.obj.from],aa=z&&t(z);if(aa){k.hasClass(aa,'jewelItemNew')&&g.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});if(!k.hasClass(aa,'jewelItemResponded')){l.remove(aa);delete this._requestList[y.obj.from];--this._requestCount;this._conditionShowEmptyMessage();}}},pageInCollapsedRequests:function(){var x=t('fbRequestsJewelManualPager');if(x){var y=l.scry(x,'.uiMorePagerPrimary')[0];if(y.style&&y.style.display!='none')setTimeout(function(){y.click();},100);}},_markRead:function(){this.jewel.markSeen();this._clearNewItems();},_markSeenCallback:function(x,y){var z=l.scry(this.jewelFlyout,'li');new i('/ajax/gigaboxx/endpoint/UpdateLastSeenTime.php',{folder:this.folder,first_item:z[0].id}).send();new h().setURI('/ajax/friends/jewel/predicted_count_logging').setData({ego_predicted_count:this.egoPredictedCount,pending_count:this.pendingCount,unseen_timestamp:this.egoUnseenTimestamp,action_context:this.actionContext,should_log_ego_click:this.shouldLogEgoClick}).send();var aa=typeof x!='undefined'&&typeof y!='undefined'?{requester:x,type:y}:{};this.doNewMarkRead&&new i('/ajax/requests/mark_read/',aa).send();},_markSeenFromMessage:function(x,y){g.inform('jewel/count-updated',{jewel:'requests',count:0});},_removeRequest:function(x,y){var z=y.obj.item_id;if(z){var aa=t(z),ba=aa&&k.hasClass(aa,'jewelItemNew');aa?l.remove(aa):ba&&g.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});}},_clearNewItems:function(x,y){l.scry(this.jewel.root,'li.jewelItemNew').forEach(function(z){k.removeClass(z,'jewelItemNew');});},_updateCount:function(x,y){this.countNew=y.count;k.conditionClass(this.jewelFlyout,'beeperUnread',this.countNew>0);k.conditionClass(this.jewelFlyoutCase,'showRequests',this.countNew>0);if(this.newCountSpan){var z=this.countNew==1?v._("{num} NEW REQUEST",{num:this.countNew}):v._("{num} NEW REQUESTS",{num:this.countNew});l.setContent(this.newCountSpan,z);}},_conditionShowEmptyMessage:function(){l.scry(this.jewelFlyout,'li.empty').forEach(function(x){k.conditionShow(x,this._requestCount<=0);}.bind(this));},_openHandler:function(){var x=l.scry(this.jewelFlyout,'.uiScrollableArea')[0];if(t('fbRequestsJewelLoading')){var y=Date.now();if(this.openTimestamp+5000<y){this.openTimestamp=y;new h().setURI('/ajax/requests/loader/').setData({log_impressions:true}).send();}}else{var z=Object.keys(this._requestList);if(z.length>0){new h().setURI('/friends/requests/log_impressions').setData({ids:z.join(','),ref:'jewel'}).send();var aa=Object.keys(this._egoData);if(aa.length>0)new h().setURI('/growth/jewel/impression_logging.php').setData({egodata:aa}).send();}}x&&q.poke(x);}});e.exports=w;});
__d("legacy:RequestsJewel",["RequestsJewel"],function(a,b,c,d){a.RequestsJewel=b('RequestsJewel');},3);
__d("JewelX",["Event","Arbiter","ArbiterMixin","CSS","DOM","HTML","Keys","TabIsolation","Toggler","copyProperties","emptyFunction","reportData"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('CSS'),k=b('DOM'),l=b('HTML'),m=b('Keys'),n=b('TabIsolation'),o=b('Toggler'),p=b('copyProperties'),q=b('emptyFunction'),r=b('reportData'),s=function(t,u){t&&u&&this.init(t,u);};p(s,{_instancesByName:{},_resizeListener:null});p(s.prototype,i,{init:function(t,u){this.name=u.name;this.root=t;this.countNew=0;this.initialCount=0;this.escHandler=null;s._instancesByName[this.name]=this;var v=k.find(t,'.jewelFlyout'),w=new n(v);o.createInstance(v).setSticky(false);o.listen('show',this.root,function(x){this._logFirstClick();this.hasNew()&&this.markSeen();this.reset();this.inform('opened');h.inform('layer_shown',{type:'Jewel'});w.enable();this.setupEvents();}.bind(this));o.listen('hide',this.root,function(x,y){this.hasNew()&&this.markSeen();this.reset();this.inform('closed');h.inform('layer_hidden',{type:'Jewel'});w.disable();this.removeEvents();}.bind(this));h.subscribe('jewel/count-updated',function(x,y){y.jewel==this.name&&this.update(y);}.bind(this));h.subscribe('jewel/count-initial',function(x,y){y.jewel==this.name&&this.setInitial(y);}.bind(this));h.subscribe('jewel/reset',function(x,y){y.jewel==this.name&&this.reset();}.bind(this));s._resizeListener=s._resizeListener||(function(){var x=null;return g.listen(window,'resize',function(){clearTimeout(x);x=h.inform.bind(h,'jewel/resize').defer(100,false);});})();},getRoot:function(){return this.root;},hasNew:function(){return j.hasClass(this.root,'hasNew');},isOpen:function(){return j.hasClass(this.root,'openToggler');},reset:function(){j.removeClass(this.root,'hasNew');},setContent:function(t){var u=k.find(this.root,'ul.jewelItemList');k.setContent(u,l(t));},update:function(t){this.countNew=t.count;var u=k.find(this.root,'span.jewelCount span');k.setContent(u,this.countNew);var v=isNaN(this.countNew)||this.countNew>0;j.conditionClass(this.root,'hasNew',v);if(v){var w=(''+this.countNew).length;j.conditionClass(this.root,'hasCountSmall',w===1);j.conditionClass(this.root,'hasCountMedium',w===2);j.conditionClass(this.root,'hasCountLarge',w>2);}this.inform('updated',t);},setInitial:function(t){this.initialCount=t;},setupEvents:function(){this.escHandler=g.listen(document.documentElement,'keydown',function(t){if(t.keyCode===m.ESC&&this.isOpen())o.hide(this.root);}.bind(this));},removeEvents:function(){if(this.escHandler)this.escHandler.remove();},markSeen:function(){h.inform('jewel/count-updated',{jewel:this.name,count:0},h.BEHAVIOR_STATE);this.inform('marked-seen');},_logFirstClick:function(){this._logFirstClick=q;r('jewel_click',{gt:{count:this.countNew,initial:this.initialCount,jewel:this.name}});}});e.exports=s;});
__d("MercuryJewelCountControl",["Arbiter","DOM","MercuryThreadlistConstants","copyProperties","shield","tx","MercuryServerRequests","MercuryThreadInformer","MercuryUnseenState"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DOM'),i=b('MercuryThreadlistConstants'),j=b('copyProperties'),k=b('shield'),l=b('tx'),m=b('MercuryServerRequests').get(),n=b('MercuryThreadInformer').get(),o=b('MercuryUnseenState').get(),p,q,r,s=function(u){if(u||r.isOpen())o.markAsSeen();},t=function(u,v){p=u;q=h.find(p,'#mercurymessagesCountValue');r=v;this.render();m.subscribe('model-update-completed',function(w,x){s(false);});n.subscribe('unseen-updated',this.render.bind(this));r.subscribe('marked-seen',k(s,this,true));};j(t.prototype,{render:function(){var u='';if(o.exceedsMaxCount()){u=l._("{count}+",{count:i.MAX_UNSEEN_COUNT});}else u=o.getUnseenCount().toString();g.inform('jewel/count-updated',{jewel:'mercurymessages',count:u},g.BEHAVIOR_STATE);}});e.exports=t;});
__d("MercuryJewelThreadlistControl",["Arbiter","ArbiterMixin","AvailableListConstants","Bootloader","MercuryChatUtils","MercuryConfig","CSS","DOM","Event","JSLogger","JSXDOM","LastMobileActiveTimes","MercuryAPIArgsSource","MercuryIDs","MercuryThreadlistConstants","MessagingTag","MercuryOrderedThreadlist","Parent","MercuryPresence","MercuryJewelTemplates","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads","Tooltip","MercuryUnreadState","copyProperties","csx","curry","cx","fbt","throttle","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AvailableListConstants'),j=b('Bootloader'),k=b('MercuryChatUtils'),l=b('MercuryConfig'),m=b('CSS'),n=b('DOM'),o=b('Event'),p=b('JSLogger'),q=b('JSXDOM'),r=b('LastMobileActiveTimes'),s=b('MercuryAPIArgsSource'),t=b('MercuryIDs'),u=b('MercuryThreadlistConstants'),v=b('MessagingTag'),w=b('MercuryOrderedThreadlist').get(),x=b('Parent'),y=b('MercuryPresence'),z=b('MercuryJewelTemplates'),aa=b('MercuryThreadInformer').get(),ba=b('MercuryThreadMetadataRenderer').get(),ca=b('MercuryThreads').get(),da=b('Tooltip'),ea=b('MercuryUnreadState').get(),fa=b('copyProperties'),ga=b('csx'),ha=b('curry'),ia=b('cx'),ja=b('fbt'),ka=b('throttle'),la=b('tx'),ma=p.create('mercury_jewel');function na(wa,xa){this._contentArea=n.scry(wa,'.scrollable')[0]||wa;this._contentElement=n.find(this._contentArea,'.jewelContent');this._loadingElement=n.find(this._contentArea,'.jewelLoading');this._loadMoreButton=n.find(this._contentArea,"._8y5");this._loadMoreLink=n.find(this._contentArea,"a._8y6");this._currentFolder=v.INBOX;this._jewelFolderLinks=[];this._jewelFolderLinks[v.INBOX]=n.find(xa,"._1sde");this._jewelFolderLinks[v.OTHER]=n.find(xa,"._1sdf");this._jewelFolderCounts=[];this._jewelFolderCounts[v.INBOX]=n.find(xa,"._1sdg");this._jewelFolderCounts[v.OTHER]=n.find(xa,"._1sdh");sa.bind(this)();o.listen(this._jewelFolderLinks[v.INBOX],'click',ra.bind(this,v.INBOX));o.listen(this._jewelFolderLinks[v.OTHER],'click',ra.bind(this,v.OTHER));this._curCount=[];this._curCount[v.INBOX]=u.JEWEL_THREAD_COUNT+1;this._curCount[v.OTHER]=u.JEWEL_THREAD_COUNT+1;this._isFolderLoaded=[];this._isFolderLoaded[v.INBOX]=false;this._isFolderLoaded[v.OTHER]=false;this._folderIsLoading=[];this._folderIsLoading[v.INBOX]=false;this._folderIsLoading[v.OTHER]=false;aa.subscribe('threadlist-updated',this.render.bind(this));aa.subscribe('unread-updated',sa.bind(this));this.render();ma.bump('opened_threadlist_'+this._currentFolder);o.listen(this._contentArea,'scroll',ka(oa,50,this));o.listen(this._loadMoreLink,'click',this.renderMoreThreads.bind(this));}fa(na,{EVENT_THREADS_LOADED:'threads-loaded',EVENT_THREADS_RENDERED:'threads-rendered'});fa(na.prototype,h);fa(na.prototype,{render:function(){n.empty(this._contentElement);m.show(this._loadingElement);m.hide(this._loadMoreButton);var wa=n.create('div');n.appendContent(this._contentElement,wa);w.getThreadlist(u.RECENT_THREAD_OFFSET,this._curCount[this._currentFolder],this._currentFolder,this.renderThreads.bind(this,wa),true);},renderThreads:function(wa,xa){this.inform(na.EVENT_THREADS_LOADED);if(xa.length){xa.forEach(function(ya){var za=z[':fb:mercury:jewel:threadlist-row'].build();ca.getThreadMeta(ya,function(ab){ba.renderCoreThreadlist(ab,za,this.renderSingleThread.bind(this),{show_unread_count:true});}.bind(this));n.appendContent(wa,za.getRoot());}.bind(this));}else n.setContent(this._contentElement,this.renderEmptyThreadlist());m.hide(this._loadingElement);m.conditionShow(this._loadMoreButton,!this._isFolderLoaded[this._currentFolder]);this.inform(na.EVENT_THREADS_RENDERED);},renderSingleThread:function(wa,xa){var ya=xa.unread_count>0;if(ya)m.addClass(wa.getRoot(),'jewelItemNew');var za=q.div({className:"x_div"}),ab=q.div({className:"_5c9q"}),bb="Mark as Unread";if(ya)bb="Mark as Read";da.set(ab,bb,'above','right');o.listen(ab,'click',function(event){ca.changeThreadReadStatus(xa.thread_id,xa.unread_count>0);return false;});za.appendChild(ab);wa.getNode('link').appendChild(za);if(l.MessagesJewelPresenceOpenChat&&xa.is_subscribed){var cb=wa.getNode('chatButton'),db=xa.is_canonical&&xa.canonical_fbid?xa.canonical_fbid:xa.thread_id;va(db,cb);}else m.hide(wa.getNode('chatButton'));if(l.MessagesJewelOpenInChat&&k.canOpenChatTab(xa)){o.listen(wa.getRoot(),'click',function(event){g.inform('chat/open-tab',{thread_id:xa.thread_id});});}else ba.renderTitanLink(xa.thread_id,wa.getNode('link'),null,this._currentFolder);o.listen(wa.getRoot(),'mouseover',function(event){var eb=wa.getRoot();if(!x.byClass(eb,'notifNegativeBase'))m.addClass(eb,'selected');});o.listen(wa.getRoot(),'mouseout',function(event){m.removeClass(wa.getRoot(),'selected');});},renderMoreThreads:function(){m.addClass(this._loadMoreButton,'async_saving');this._folderIsLoading[this._currentFolder]=true;var wa=this._curCount[this._currentFolder]+u.JEWEL_MORE_COUNT;w.getThreadlist(u.RECENT_THREAD_OFFSET,wa+1,this._currentFolder,qa.bind(this,wa,this._currentFolder),true,s.JEWEL);},renderEmptyThreadlist:function(){return n.create('li',{className:'empty'},"No messages");}});function oa(){if(!this._isFolderLoaded[this._currentFolder]&&!this._folderIsLoading[this._currentFolder]&&pa.bind(this)())this.renderMoreThreads();}function pa(){return this._contentArea.scrollTop+this._contentArea.clientHeight>=this._contentArea.scrollHeight-1;}function qa(wa,xa,ya){this._curCount[xa]=wa;if(!this._isFolderLoaded[xa]&&ya.length<this._curCount[xa]+1)this._isFolderLoaded[xa]=true;this._folderIsLoading[xa]=false;m.removeClass(this._loadMoreButton,'async_saving');this.render();}function ra(wa){if(this._currentFolder!=wa){ma.bump('opened_threadlist_'+wa);m.addClass(this._jewelFolderLinks[wa],"_1sdd");m.removeClass(this._jewelFolderLinks[this._currentFolder],"_1sdd");this._currentFolder=wa;this.render();}}function sa(){ta.bind(this)(v.INBOX);ta.bind(this)(v.OTHER);}function ta(wa){var xa;if(ea.exceedsMaxCount(wa)){xa=u.MAX_UNREAD_COUNT;}else xa=ea.getUnreadCount(wa);var ya=this._jewelFolderCounts[wa];if(xa>0){if(xa==u.MAX_UNREAD_COUNT)xa+='+';n.setContent(ya,la._("({unread_count})",{unread_count:xa}));}else n.setContent(ya,'');}function ua(wa,xa,ya){var za=wa.get(ya);if(za===i.MOBILE||za===i.ACTIVE){m.show(xa);}else{da.remove(xa);m.hide(xa);return;}var ab=(q.div(null,"Click to chat")),bb=r.getShortDisplay(ya);if(bb&&za===i.MOBILE)ab=(q.div(null,"Click to chat",' (',ja._("Last active {time} ago",[ja.param("time",bb)]),')'));da.set(xa,ab,'right');}function va(wa,xa){var ya=q.span(null),za=t.isValid(wa)&&t.isMultichat(wa);if(za){m.addClass(ya,'groupThread');}else y.updateOnPresenceChanges(wa,ya);j.loadModules(['PresenceStatus','ChatOpenTab'],function(ab,bb){if(za){da.set(xa,"Click to chat with the group");}else o.listen(xa,'mouseenter',ha(ua,ab,xa,wa));o.listen(xa,'click',function(event){event.kill();bb[za?'openThread':'openUserTab'](wa,'mercury jewel presence icon');});});n.setContent(xa,ya);}e.exports=na;});
__d("MercuryJewel",["MercuryChannelHandler","MercuryJewelCountControl","DOM","MercuryJewelThreadlistControl","MercuryServerRequests","userAction"],function(a,b,c,d,e,f){b('MercuryChannelHandler');var g=b('MercuryJewelCountControl'),h=b('DOM'),i=b('MercuryJewelThreadlistControl'),j=b('MercuryServerRequests').get(),k=b('userAction'),l=false;function m(q,r,s,t){j.handleUpdate(t);var u=new g(r,s),v=h.find(q,'#MercuryJewelThreadList');if(s.getRoot()&&s.isOpen()){n.call(this,v,q);}else s.subscribe('opened',n.bind(this,v,q));}e.exports=m;function n(q,r){this._ua=k('messages').uai('click','jewel');this._listenForLoad=this._listenForRender=true;if(!l){var s=new i(q,r);s.subscribe(i.EVENT_THREADS_LOADED,o.bind(this));s.subscribe(i.EVENT_THREADS_RENDERED,p.bind(this));l=true;}}function o(){if(this._listenForLoad){this._ua.add_event('loaded');this._listenForLoad=false;}}function p(){if(this._listenForRender){this._ua.add_event('rendered');this._listenForRender=false;}}});
__d("MessagingEvents",["Arbiter","ChannelConstants","arrayContains","copyProperties","isEmpty"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('arrayContains'),j=b('copyProperties'),k=b('isEmpty'),l={},m=new g();function n(o){if(!k(l))return;for(var p in o)m.inform('count/'+p,o[p]);}m.subscribe('mark-as-read',function(o,p){(p.tids||p.chat_ids||[]).forEach(function(q){q=''+q;if(!(q in l)){l[q]=true;var r=function(){m.unsubscribe(s);clearTimeout(t);delete l[q];},s=m.subscribe('read',function(u,v){if(i((v.tids||[]),q)||i((v.chat_ids||[]),q))r();}),t=r.defer(60000);}});});g.subscribe(h.getArbiterType('messaging'),function(o,p){var q=j({},p.obj),event=q.event||'';delete q.type;delete q.event;m.inform(event,q);if('unread_counts' in q){var r=q.unread_counts;n({unread:r.inbox,other_unseen:r.other});}});g.subscribe(h.getArbiterType('inbox'),function(o,p){var q=j(p.obj);delete q.type;n(q);});a.MessagingEvents=e.exports=m;},3);
__d("TitanLeftNav",["CounterDisplay","MessagingEvents"],function(a,b,c,d,e,f){var g=b('CounterDisplay'),h=b('MessagingEvents'),i={initialize:function(){h.subscribe('count/other_unseen',function(j,k){g.setCount('other_unseen',k);});}};e.exports=i;});
__d("AccessibleMenu",["Event","CSS","DOM","Keys","TabbableElements","Toggler"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('Keys'),k=b('TabbableElements'),l=b('Toggler'),m,n,o;function p(){var x=i.scry(m,'a[rel="toggle"]')[0];x&&x.focus();l.getInstance(m).hide();}function q(x){if(!x)return false;h.removeClass(x,'selected');x.setAttribute('aria-selected','false');}function r(x){if(!x)return false;h.addClass(x,'selected');x.setAttribute('aria-selected','true');var y=k.find(x);if(y[0])y[0].focus();}function s(x){var y=i.scry(m,'.selected')[0],z=n.indexOf(y)+x,aa=n[z];if(!aa)return false;q(y);r(aa);}function t(x){if(!l.isShown()||l.getActive()!==m)return true;var y=g.getKeyCode(x);switch(y){case j.TAB:s(x.shiftKey?-1:1);g.prevent(x);break;case j.ESC:p();g.prevent(x);break;case j.UP:case j.DOWN:s(y===j.UP?-1:1);g.prevent(x);break;}}function u(x,y){m=y.getActive();n=i.scry(m,'[role="menuitem"]');if(!o)o=g.listen(document.documentElement,'keydown',t);}function v(){if(l.getActive()==m)q(i.scry(m,'.selected')[0]);}var w={init:function(x){l.listen('show',x,u);l.listen('hide',x,v);}};e.exports=w;});
__d("UserNoOp",["copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('emptyFunction');function i(){}g(i.prototype,{add_event:h.thatReturnsThis,add_data:h.thatReturnsThis,uai:h.thatReturnsThis,uai_fallback:h.thatReturnsThis});e.exports=i;});
__d("NegativeNotif",["Animation","AsyncRequest","CSS","DataStore","DOM","Event","Parent","Tooltip","NotifXList","$","clickRefAction","copyProperties","userAction"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('AsyncRequest'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('Event'),m=b('Parent'),n=b('Tooltip'),o=b('NotifXList'),p=b('$'),q=b('clickRefAction'),r=b('copyProperties'),s=b('userAction');function t(u,v){r(this,v);this.owner=u;this.xLink=k.find(this.obj,'.notif_x');this.confirmingMsg=k.find(this.obj,'.confirmingMsg');this.mainLink=k.find(this.obj,'.notifMainLink');this.userXClicked=false;this.userUnsubscribed=false;l.listen(this.xLink,'click',this.xClick.bind(this));if(i.hasClass(this.obj,'first_receipt')&&i.hasClass(p('jewelContainer'),'notifGentleAppReceipt'))this.gentleFirstReceiptHoverEventHandler=l.listen(this.obj,'mouseover',this.gentleFirstReceiptNotifHover.bind(this));}r(t.prototype,{FADE_AWAY_DURATION:2500,X_OUT_DURATION:100,X_OUT_DURATION_SHORT:2,GENTLE_FRUI_MIN_HOVER_DURATION:500,GENTLE_FRUI_FADE_DURATION_FAST:200,GENTLE_FRUI_FADE_DURATION_SLOW:2500,GENTLE_FRUI_DELAY_FADE_TIME:60000,xClick:function(event){this._activateX();var u=this.xLink.getAttribute('data-gt'),v=u?{gt:JSON.parse(u)}:{};s('xbutton',this.xLink,event).uai('click');q('click',this.xLink,event,null,v);return false;},gentleFirstReceiptNotifHover:function(event){event.stop();var u=k.find(this.obj,'.first_receipt_no_button'),v=j.get(u,'notif_fr_prompt');n.set(u,v,'above','center');n.show(u);this._gentleFirstReceiptTooltipFadeIn();if(!this.gentleFirstReceiptUnhoverEventHandler){this.hoverTime=new Date();this.gentleFirstReceiptUnhoverEventHandler=l.listen(document.documentElement,'mouseover',this.gentleFirstReceiptNotifUnhover.bind(this));}if(!this.gentleFirstReceiptNoClickEventHandler)this.gentleFirstReceiptNoClickEventHandler=l.listen(u,'click',this.gentleFirstReceiptNoClick.bind(this));},gentleFirstReceiptNotifUnhover:function(event){if(m.byClass(event.getTarget(),'uiContextualLayer')||m.byClass(event.getTarget(),'uiScrollableAreaTrack'))return false;var u=new Date();if(this.hoverTime&&u-this.hoverTime<this.GENTLE_FRUI_MIN_HOVER_DURATION){this.gentleFirstReceiptUnhoverEventHandler.remove();this.gentleFirstReceiptUnhoverEventHandler=null;this._gentleFirstReceiptTooltipAlreadyFadedIn=false;return;}this._removeGentleFirstReceiptListeners();this._gentleFirstReceiptTooltipFadeAway();this._gentleFirstReceiptXButtonFadeAway();var v=this;setTimeout(function(){v._gentleFirstReceiptUIFadeAway();},this.GENTLE_FRUI_DELAY_FADE_TIME);this._sendFirstReceiptYesToServer();},gentleFirstReceiptNoClick:function(event){this._removeGentleFirstReceiptListeners();},restore:function(){if(o.newNotifExist(this.id)){o.resumeInsert(this.id);}else o.removeNotif(this.id);this._confirmingMsgFadeAway(this.confirmingMsg);this._notifMainLinkShowUp(this.mainLink);this._buttonShowUp(this.xLink);this._adjustContainer(this.obj);},reset:function(){if(this.userXClicked&&!this.userUnsubscribed){this.userXClicked=false;this.restore();}},onTurnedOff:function(){this.userUnsubscribed=true;i.hide(this.confirmingMsg);this._notifMainLinkShowUp(k.find(this.obj,'.confirmedMsg'));this._adjustContainer(this.obj);},onUndid:function(){this.userXClicked=false;this.userUnsubscribed=false;this.restore();i.show(this.confirmingMsg);this._notifMainLinkFadeAway(k.find(this.obj,'.confirmedMsg'));k.remove(k.find(this.obj,'.confirmedMsg'));},onMarkedSpam:function(){k.remove(k.find(this.obj,'.confirmedMsg'));this._fadeAway(k.find(this.obj,'.spamMsg'));},onFirstReceiptYes:function(){this._hideFirstReceiptDiv();this._fadeAway(k.find(this.obj,'.firstConfirmedMsg'));},onFirstReceiptNo:function(){this._hideFirstReceiptDiv();i.hide(this.confirmingMsg);this._activateX();new h().setURI('/ajax/notifications/negative_req.php').setData({request_type:'turn_off',notification_id:this.id}).send();},_sendFirstReceiptYesToServer:function(){new h().setURI('/ajax/notifications/negative_req.php').setData({request_type:'first_receipt_yes',notification_id:this.id}).send();},_gentleFirstReceiptTooltipFadeIn:function(){if(this._gentleFirstReceiptTooltipAlreadyFadedIn)return;var u=k.find(document.documentElement,'.uiLayer .uiContextualLayer .uiTooltipX');new g(u).from('opacity','0').to('opacity','1').duration(this.GENTLE_FRUI_FADE_DURATION_FAST).go();this._gentleFirstReceiptTooltipAlreadyFadedIn=true;},_gentleFirstReceiptTooltipFadeAway:function(){if(!this._gentleFirstReceiptTooltipAlreadyFadedIn)return;var u=k.find(document.documentElement,'.uiLayer .uiContextualLayer .uiTooltipX'),v=m.byClass(u,'uiLayer'),w=v.cloneNode(true);k.insertAfter(v,w);new g(w).from('opacity','1').to('opacity','0').duration(this.GENTLE_FRUI_FADE_DURATION_FAST).ondone(function(){k.remove(w);}).go();this._gentleFirstReceiptTooltipAlreadyFadedIn=false;},_gentleFirstReceiptXButtonFadeAway:function(){var u=k.find(this.obj,'.first_receipt_no_button');new g(u).from('opacity','1').to('opacity','0').duration(this.GENTLE_FRUI_FADE_DURATION_FAST).hide().go();i.addClass(this.obj,'show_original_x');},_gentleFirstReceiptUIFadeAway:function(){var u=this.obj;this.new_label=k.find(this.obj,'.notif_new_label');new g(this.new_label).to('opacity','0').duration(this.GENTLE_FRUI_FADE_DURATION_SLOW).ondone(function(){i.removeClass(u,'first_receipt');}).go();if(!i.hasClass(this.obj,'jewelItemNew'))new g(this.obj).from('backgroundColor','#ECEFF5').to('backgroundColor','#FFFFFF').duration(this.GENTLE_FRUI_FADE_DURATION_SLOW).go();},_removeGentleFirstReceiptListeners:function(){if(this.gentleFirstReceiptHoverEventHandler)this.gentleFirstReceiptHoverEventHandler.remove();if(this.gentleFirstReceiptUnhoverEventHandler)this.gentleFirstReceiptUnhoverEventHandler.remove();if(this.gentleFirstReceiptNoClickEventHandler)this.gentleFirstReceiptNoClickEventHandler.remove();},_activateX:function(){i.addClass(this.obj,'forPushSafety');this.userXClicked=true;o.userXClick(this.id);this._notifMainLinkFadeAway(this.mainLink);this._buttonFadeAway(this.xLink);if(i.shown(this.confirmingMsg))this._confirmingMsgShowUp(this.confirmingMsg);this._adjustContainer(this.obj);},_hideFirstReceiptDiv:function(){i.removeClass(this.obj,'first_receipt');i.hide(k.find(this.obj,'.first_receipt_div'));},_fadeAway:function(u){new g(u).from('backgroundColor','#FFF9D7').to('backgroundColor','#FFFFFF').duration(this.FADE_AWAY_DURATION).checkpoint().to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().hide().duration(this.X_OUT_DURATION).go();},_adjustContainer:function(u){new g(u).by('height','0px').duration(this.X_OUT_DURATION).checkpoint().by('height','0px').duration(this.X_OUT_DURATION_SHORT).checkpoint().to('height','auto').duration(this.X_OUT_DURATION).go();},_notifMainLinkShowUp:function(u){new g(u).duration(this.X_OUT_DURATION).checkpoint().to('height','auto').to('paddingTop','4px').to('paddingBottom','4px').blind().show().duration(this.X_OUT_DURATION_SHORT).checkpoint().to('opacity','1').blind().duration(this.X_OUT_DURATION).go();},_confirmingMsgShowUp:function(u){new g(u).duration(this.X_OUT_DURATION).checkpoint().to('height','auto').to('paddingTop','10px').to('paddingBottom','10px').blind().show().duration(this.X_OUT_DURATION_SHORT).checkpoint().to('opacity','1').blind().duration(this.X_OUT_DURATION).go();},_notifMainLinkFadeAway:function(u){new g(u).to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().hide().duration(this.X_OUT_DURATION_SHORT).go();},_confirmingMsgFadeAway:function(u){new g(u).to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().duration(this.X_OUT_DURATION_SHORT).go();},_buttonShowUp:function(u){new g(u).duration(this.X_OUT_DURATION).checkpoint().show().duration(this.X_OUT_DURATION_SHORT).checkpoint().to('opacity','1').blind().duration(this.X_OUT_DURATION).go();},_buttonFadeAway:function(u){new g(u).to('opacity','0').blind().duration(this.X_OUT_DURATION).checkpoint().hide().duration(this.X_OUT_DURATION_SHORT).go();}});e.exports=t;});
__d("NotificationCounter",["Arbiter","DocumentTitle","JSLogger"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DocumentTitle'),i=b('JSLogger'),j={messages:0,notifications:0,requests:0},k={init:function(l){g.subscribe('update_title',this._handleUpdate.bind(this));g.subscribe('jewel/count-updated',this._handleCountUpdate.bind(this));},getCount:function(){var l=0;for(var m in j){var n=Number(j[m]);if(typeof j[m]=='string'&&isNaN(n))return j[m];if(isNaN(n)||n<0){i.create('jewels').error('bad_count',{jewel:m,count:j[m]});continue;}l+=n;}return l;},updateTitle:function(){var l=this.getCount(),m=h.get();m=l?'('+l+') '+m:m;h.set(m,true);},_handleCountUpdate:function(l,m){j[m.jewel]=m.count;this.updateTitle();},_handleUpdate:function(l,m){this.updateTitle();}};e.exports=k;});
__d("NotificationList",["Animation","ArbiterMixin","CSS","DOM","DoublyLinkedListMap","HTML","NotificationURI","Tooltip","Event","$","copyProperties","cx","csx","ge","isEmpty","tx"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('ArbiterMixin'),i=b('CSS'),j=b('DOM'),k=b('DoublyLinkedListMap'),l=b('HTML'),m=b('NotificationURI'),n=b('Tooltip'),o=b('Event'),p=b('$'),q=b('copyProperties'),r=b('cx'),s=b('csx'),t=b('ge'),u=b('isEmpty'),v=b('tx'),w="0",x="1",y="2";function z(ca){return ca==x||ca==y;}function aa(ca){return ca==x;}function ba(ca,da){this._list=new k();this._filter_func=null;this.unseenCount=0;this.contentRoot=ca;this.noItemsElement=null;this.ITEM_TAG='li';this.ITEM_CLASS='notification';this.NO_ITEMS_ID='jewelNoNotifications';this.NO_ITEMS_CLASS='empty';this.compare=da.compare||this.compare;this.shouldBlockAnimation=da.shouldBlockAnimation||null;this.unseenVsUnread=da.unseenVsUnread||false;this.markReadSignalServer=da.markReadSignalServer;this.animations={};}q(ba,{ITEM_UNREAD_CLASS:'jewelItemNew',MARK_READ_TYPE:'mark_read',UNREAD_COUNT_CHANGE_TYPE:'unread_count_change',INSERTION_TYPE:'insert',REMOVAL_TYPE:'remove',getIdFromDom:function(ca){return ca.getAttribute('id').replace('notification_','');},localizeUrls:function(ca){j.scry(ca,'a').forEach(function(da){da.href=m.localize(da.href);});}});q(ba.prototype,h,{FADE_DURATION:250,RESIZE_DURATION:200,_getField:function(ca,da){var ea=this._list.get(ca);return ea&&ea[da];},getDomObj:function(ca){return this._getField(ca,'obj');},fromDom:function(){var ca=this.ITEM_TAG+'.'+this.ITEM_CLASS,da=j.scry(this.contentRoot,ca);for(var ea=0;ea<da.length;++ea){var fa=da[ea],ga=ba.getIdFromDom(fa);this.insert(ga,fa.getAttribute('data-notiftime'),null);}},compare:function(ca,da){return ca.time<da.time||(ca.time===da.time&&ca.id<da.id);},insert:function(ca,da,ea,fa,ga,ha){var ia=x,ja=0,ka=this._list.exists(ca),la=ha&&this._list.exists(ha),ma=null,na;if(ka||la)if(!(fa&&ea)){return false;}else{if(this._filter_func){na={notif_id:ca,notif_time:da,notif_markup:ea,replace:fa,ignoreUnread:ga,notif_alt_id:ha};if(this._filter_func(na))return false;}ia=this._getField(ca,'readness');ja=this._getField(ca,'time');if(ja>da)return false;ma=ka?ca:ha;this._remove(ma);}var oa=(ea&&l(ea).getRootNode())||p('notification_'+ca),pa=Math.max(da,ja),qa=oa.getAttribute('data-readness');if(!this.unseenVsUnread&&y==qa)qa=w;na={id:ca,obj:oa,time:pa,readness:qa,app_id:oa.getAttribute('data-appid')};this._insert(na);this._setUpReadStateToggle(ca,oa);ba.localizeUrls(oa);this.noItemsElement&&i.hide(this.noItemsElement);if(aa(qa)){ga&&!z(ia)&&this.markRead([ca]);this.unseenCount=this.getUnseenIds().length;this.inform(ba.UNREAD_COUNT_CHANGE_TYPE);}var ra=!ma||ja<pa||(qa&&!ia&&!ga);this.inform(ba.INSERTION_TYPE,{id:ca,is_new:ra,obj:oa,replaced_id:ma,time:pa});return true;},_setReadStateToggleReadness:function(ca,da){var ea;if(da){ea=this.unseenVsUnread?"Mark as Read":"Unread";}else ea="Read";if(!(da&&this.unseenVsUnread)){i.removeClass(ca,"_5c9q");i.addClass(ca,"_5c9_");}n.set(ca,ea,'above','center');},_setUpReadStateToggle:function(ca,da){var ea=this.isUnreadId(ca),fa=j.scry(da,"._5c9q")[0];if(!fa)return;this._setReadStateToggleReadness(fa,ea);var ga=function(event){if(this.unseenVsUnread&&this.isUnreadId(ca))this.markReadSignalServer([ca]);o.kill(event);return false;};o.listen(fa,'click',ga.bind(this));},showNoNotifications:function(){if(null==this.noItemsElement)this.noItemsElement=t(this.NO_ITEMS_ID);if(null==this.noItemsElement){this.noItemsElement=j.create(this.ITEM_TAG,{id:this.NO_ITEMS_ID,className:this.NO_ITEMS_CLASS},"No new notifications");j.appendContent(this.contentRoot,this.noItemsElement);}i.show(this.noItemsElement);},_insert:function(ca){this._list.remove(ca.id);var da=null;this._list.find(function(fa){var ga=this.compare(fa,ca);!ga&&(da=fa.id);return ga;}.bind(this));var ea=this.getDomObj(da);if(ea){this._list.insertAfter(ca.id,ca,da);j.insertAfter(ea,ca.obj);}else{this._list.prepend(ca.id,ca);j.prependContent(this.contentRoot,ca.obj);}},_remove:function(ca){var da=this._getField(ca,'obj');if(!da)return false;this.inform(ba.REMOVAL_TYPE,{id:ca});this._list.remove(ca);j.remove(da);this.isEmpty()&&this.showNoNotifications();return true;},getUnreadIds:function(){return this._list.reduce(function(ca,da){z(ca.readness)&&da.push(ca.id);return da;},[]);},getUnseenIds:function(){return this._list.reduce(function(ca,da){aa(ca.readness)&&da.push(ca.id);return da;},[]);},getIds:function(){return this._list.reduce(function(ca,da){da.push(ca.id);return da;},[]);},isUnreadId:function(ca){var da=this.getDomObj(ca);return z(this._getField(ca,'readness'))||(da&&i.hasClass(da,ba.ITEM_UNREAD_CLASS));},isUnseenId:function(ca){return aa(this._getField(ca,'readness'));},markRead:function(ca,da){ca=ca?ca.filter(this.isUnreadId.bind(this)):this.getUnreadIds();var ea=false;for(var fa=0;fa<ca.length;fa++){var ga=this._list.get(ca[fa]);if(ga){if(this._setReadness(ca[fa],w))ea=true;if(da){this._markReadInDom(ca[fa],ga.obj);}else this.animateMarkRead(ga.obj);}}if(ea){this.unseenCount=this.getUnseenIds().length;this.inform(ba.UNREAD_COUNT_CHANGE_TYPE);}},markSeen:function(ca){if(!Array.isArray(ca))return;if(!this.unseenVsUnread){this.markRead(ca);return;}ca=ca.filter(this.isUnseenId.bind(this));var da=false;for(var ea=0;ea<ca.length;ea++)if(this._setReadness(ca[ea],y))da=true;if(da){this.unseenCount=this.getUnseenIds().length;this.inform(ba.UNREAD_COUNT_CHANGE_TYPE);}},_setReadness:function(ca,da){var ea=this._list.get(ca);if(!ea||ea.readness==da)return false;if(ea.readness==w&&da==y)return false;ea.readness=da;ea.obj.setAttribute('data-readness',da);return true;},_markReadInDom:function(ca,da){if(!this.isUnreadId(ca))return;var ea=p(da);if(ea){this.stopAnimation(ca);i.removeClass(ea,ba.ITEM_UNREAD_CLASS);var fa=j.scry(ea,'.read_toggle')[0];fa&&this._setReadStateToggleReadness(fa,false);}},animateMarkRead:function(ca){if(!i.hasClass(ca,ba.ITEM_UNREAD_CLASS))return;var da=ba.getIdFromDom(ca),ea=this._markReadInDom.bind(this,da,ca);if(i.hasClass(ca,'fbJewelBeep')){ea();return;}if(this.shouldBlockAnimation&&this.shouldBlockAnimation(ca))return;ea.defer(10000);},stopAnimation:function(ca){ca in this.animations&&this.animations[ca].stop();delete this.animations[ca];return true;},insertMany:function(ca,da){if('object'==typeof ca&&!u(ca)){for(var ea in ca){var fa=ca[ea];this.insert(ea,fa.time,fa.markup,true,da,fa.alt_id||null);}this.noItemsElement&&i.hide(this.noItemsElement);}else this.isEmpty()&&this.showNoNotifications();},isEmpty:function(){return this._list.isEmpty();},getEarliestNotifTime:function(){return this._list.isEmpty()?0:Math.min.apply(null,this.getIds().map(function(ca){return this._getField(ca,'time');}.bind(this)));},setFilterFn:function(ca){this._filter_func=ca;},toggleNotifsSimilarTo:function(ca,da,ea){var fa=this._getField(ca,'app_id');if(fa){var ga=this.getIds();for(var ha=0;ha<ga.length;++ha)if(fa==this._getField(ga[ha],'app_id')){var ia=this.getDomObj(ga[ha]);if(ca!=ga[ha])da?this._hideWithAnimation(ia):this._showWithAnimation(ia);var ja=j.scry(ia,'.first_receipt_div');if(ja.length==1)if(ea){i.hide(ja[0]);i.removeClass(ia,'first_receipt');}else{i.show(ja[0]);i.addClass(ia,'first_receipt');}}}},_hideWithAnimation:function(ca){new g(ca).to('opacity','0').blind().duration(this.FADE_DURATION).checkpoint().to('height','0px').to('paddingTop','0px').to('paddingBottom','0px').blind().hide().duration(this.RESIZE_DURATION).go();},_showWithAnimation:function(ca){new g(ca).to('height','auto').to('paddingTop','auto').to('paddingBottom','auto').blind().show().duration(this.RESIZE_DURATION).checkpoint().to('opacity','1').blind().duration(this.FADE_DURATION).go();}});e.exports=ba;});
__d("notificationInlineAccept",["AsyncRequest","CSS","DOM","Event","csx"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('DOM'),j=b('Event'),k=b('csx'),l={setup:function(m,n){var o=i.find(n,"._568t"),p=i.find(n,"._56hf"),q={notif_id:m};j.listen(o,'click',function(r){r.kill();h.addClass(n,'async_saving');q.approve=true;new g('/ajax/profile/tagging/notif_approve.php').setRelativeTo(o).setMethod('POST').setData(q).send();});j.listen(p,'click',function(r){r.kill();h.addClass(n,'async_saving');new g('/ajax/profile/tagging/notif_approve.php').setRelativeTo(p).setMethod('POST').setData(q).send();});}};e.exports=l;});
__d("Notifications",["Animation","Arbiter","AsyncRequest","AsyncSignal","Bootloader","ChannelConstants","CSS","DOM","Env","Event","JSLogger","NegativeNotif","NotificationCounter","NotificationList","NotifXList","Parent","Poller","ScrollableArea","Style","SystemEvents","Toggler","URI","UserActivity","UserNoOp","Vector","$","copyProperties","csx","emptyFunction","ge","isEmpty","notificationInlineAccept","shield","throttle","userAction"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('AsyncSignal'),k=b('Bootloader'),l=b('ChannelConstants'),m=b('CSS'),n=b('DOM'),o=b('Env'),p=b('Event'),q=b('JSLogger'),r=b('NegativeNotif'),s=b('NotificationCounter'),t=b('NotificationList'),u=b('NotifXList'),v=b('Parent'),w=b('Poller'),x=b('ScrollableArea'),y=b('Style'),z=b('SystemEvents'),aa=b('Toggler'),ba=b('URI'),ca=b('UserActivity'),da=b('UserNoOp'),ea=b('Vector'),fa=b('$'),ga=b('copyProperties'),ha=b('csx'),ia=b('emptyFunction'),ja=b('ge'),ka=b('isEmpty'),la=b('notificationInlineAccept'),ma=b('shield'),na=b('throttle'),oa=b('userAction');function pa(qa){this.updateTime=qa.updateTime||Date.now();this.update_period=qa.updatePeriod||60000;this.latest_notif_time=qa.latestNotif||0;this.latest_read_notif_time=qa.latestReadNotif||0;this.cache_version=qa.cacheVersion||0;this.notifReceivedType=qa.notifReceivedType||'notification';this.wrapperID=qa.wrapperID||'notificationsWrapper';this.contentID=qa.contentID||'jewelNotifs';this.isBusinessOnly=qa.isBusinessOnly||false;this.shouldLogImpressions=qa.shouldLogImpressions||false;this.allowDesktopNotifications=qa.allowDesktopNotifications||false;this.logAutoShutOffImpression=true;this.useInfiniteScroll=qa.useInfiniteScroll||false;this.unseenVsUnread=qa.unseenVsUnread||false;this.scrollableAreaNode=null;this.firstReceiptMap={};this.user=o.user;this.queuedNotifications=[];this.timeElement='small.time';this.ua=new da();this._notifsWithInlineAction=[];this._init();}ga(pa.prototype,{TIME_TRAVEL:'time_travel',ONLINE:'online',SCROLL_OFF_TINY:'scroll_off_tiny',INACTIVE_REFRESH:'inactive_refresh',_init:function(){this.cookieName='notifications_'+this.user;this.updateCheckCount=0;this.fetchListeners=[];this.currentFetchRequest=null;this.wrapper=ja(this.wrapperID);this.content=ja(this.contentID);this.jewelFlyout=ja('fbNotificationsFlyout');this.footer=n.find(this.jewelFlyout,'.jewelFooter');this.loadingIndicator=ja(this.contentID+'_loading_indicator');this.NOTIF_JEWEL_REF='notif_jewel';this.notifLogger=q.create('notifications');s.init();this.alertList=new t(this.content,this._getListParams());this._updateCount();a.MinNotifications&&a.MinNotifications.fetchSent()&&(this.fetch=ia);h.subscribe(l.getArbiterType(this.notifReceivedType),this._handleNotificationMsg.bind(this));h.subscribe(l.getArbiterType('notifications_read'),this._handleNotificationsReadMsg.bind(this));h.subscribe(l.getArbiterType('notifications_seen'),this._handleNotificationsSeenMsg.bind(this));h.subscribe('jewel/resize',ma(this._hideOverflow,this));this.alertList.subscribe(t.UNREAD_COUNT_CHANGE_TYPE,this._updateCount.bind(this));this._poller=new w({interval:this.update_period,setupRequest:this._update.bind(this),clearOnQuicklingEvents:false,dontStart:true});this._poller.start.bind(this._poller).defer(this.update_period,false);if(this.wrapper)this.countSpan=n.find(this.wrapper,'span.jewelCount span');this.initializeEvents();this.fromDom();if(this.useInfiniteScroll){this._autoLoadNotifIndex=1;this._truncate=false;this.alertList.subscribe(t.INSERTION_TYPE,this._handleInsert.bind(this));}},_getListParams:function(){return {shouldBlockAnimation:function(qa){return this.isNotifJewelOpen();}.bind(this),unseenVsUnread:this.unseenVsUnread,markReadSignalServer:this.markRead.bind(this).curry(true)};},fromDom:function(){this.alertList.fromDom();a.MinNotifications&&a.MinNotifications.fetched()&&this.alertList.isEmpty()&&this.alertList.showNoNotifications();},initializeEvents:function(){var qa=this.alertList.ITEM_TAG,ra=null;p.listen(this.content,{mouseover:function(event){var ua=event.getTarget();ra=v.byTag(ua,qa);if(ra&&ua!=ra)if(v.byClass(ra,'notifNegativeBase')){m.addClass(ra,'notifHover');}else m.addClass(ra,'selected');},mouseout:function(event){ra&&m.removeClass(ra,'selected');ra&&m.removeClass(ra,'notifHover');ra=null;},mousedown:this.onContentMouseDown.bind(this)});p.listen(this.wrapper,'mouseover',this.onMouseOver.bind(this));aa.listen('show',this.wrapper,this.onClick.bind(this));aa.listen('hide',this.wrapper,this.onHide.bind(this));this.shouldLogImpressions&&aa.listen('show',this.wrapper,this._logImpression.bind(this));var sa=function(ua){this._poller.request();this.notifLogger.bump(ua);}.bind(this);z.subscribe(z.TIME_TRAVEL,sa.curry(this.TIME_TRAVEL));z.subscribe(z.ONLINE,function(ua,va){va&&sa(this.ONLINE);});var ta=1000*60*60;ca.subscribe(function(ua,va){(va.idleness>ta)&&sa(this.INACTIVE_REFRESH);}.bind(this));this.negativeNotifs={};this._initNotifNegativeFeedback();if(this.useInfiniteScroll){this._setupScroll();this._initializeScrollEvents();this._updateScrollDataStructures.bind(this).defer();this._hideOverflow();}},_setupScroll:function(){this._scrollArea=n.scry(this.jewelFlyout,'div.uiScrollableAreaWrap')[0];this._morePagerLink=n.find(this.jewelFlyout,'.notifMorePager a');this._morePager=v.byClass(this._morePagerLink,'notifMorePager')||this._morePagerLink;this._infiniteScrollNotif=null;this.afterFirstFetch=false;this.animate=false;if(a.MinNotifications&&a.MinNotifications.fetched()){this.afterFirstFetch=true;m.show(this._morePager);}},_initializeScrollEvents:function(){p.listen(this._scrollArea,'scroll',na(this._handleScroll.bind(this)));p.listen(this._morePagerLink,'success',function(qa){this.fetchHandler(qa.getData().response);}.bind(this));},_updateScrollDataStructures:function(){var qa=this.alertList.getIds(),ra=Math.max(0,qa.length-this._autoLoadNotifIndex);this._infiniteScrollNotif=this.alertList.getDomObj(qa[ra]);this._annotateMorePagerURI();},_annotateMorePagerURI:function(){this._morePagerLink.setAttribute('ajaxify',new ba(this._morePagerLink.getAttribute('ajaxify')).addQueryData({earliest_time:this.alertList.getEarliestNotifTime()}));},onContentMouseDown:function(event){var qa=v.byTag(event.getTarget(),this.alertList.ITEM_TAG),ra=qa&&t.getIdFromDom(qa);if(ra&&this.alertList.isUnreadId(ra))this.markRead(true,[ra]);},onMouseOver:function(event){if(m.hasClass(event.getTarget(),"jewelButton"))this.ua=oa('notifs',event.target,event,{mode:'DEDUP'}).uai('mouseover','jewel').add_event('hover');this.fetch();},onClick:function(){this.ua.add_event('show');this.fetch();this.markRead(true);this._hideOverflow();if(this.scrollableAreaNode){var qa=x.getInstance(this.scrollableAreaNode);qa&&qa.poke();}},onHide:function(){this.animate=false;this.animation&&this.animation.stop();this.ua.add_event('hide');this.markRead(true);this._dequeueNotifications();},_dequeueNotifications:function(){this.queuedNotifications.forEach(function(qa){this._displayNotification(qa.type,qa.data);},this);this.queuedNotifications.length=0;},_handleScroll:function(){if(this._checkInfiniteScroll()){this._autoLoadNotifIndex=5;this._sendFetchRequest(this._morePager);}},_handleInsert:function(qa,ra){if(ra.is_new)this._newDataFromInsert=true;if(n.scry(ra.obj,"._568v").length&&this._notifsWithInlineAction.indexOf(ra.id)===-1){this._notifsWithInlineAction.push(ra.id);la.setup(ra.id,this.alertList.getDomObj(ra.id));}this._updateScrollDataStructures();},_checkInfiniteScroll:function(){if(this._infiniteScrollNotif&&this._scrollArea){var qa=ea.getElementPosition(this._infiniteScrollNotif).y,ra=ea.getElementPosition(this._scrollArea).y+ea.getElementDimensions(this._scrollArea).y;return qa<ra;}return false;},_initNotifNegativeFeedback:function(){u.init(this);this.alertList.setFilterFn(u.filterStoreClicked);aa.listen('hide',fa(this.wrapperID),function(){for(var qa in this.negativeNotifs)if(qa)this.negativeNotifs[qa] instanceof r&&this.negativeNotifs[qa].reset();}.bind(this));h.subscribe('notif/negativeCancel',function(qa,ra){this.negativeNotifs[ra.id]&&this.negativeNotifs[ra.id].restore();}.bind(this));h.subscribe('notif/negativeConfirmed',function(qa,ra){this.negativeNotifs[ra.id]&&this.negativeNotifs[ra.id].onTurnedOff();this.alertList.toggleNotifsSimilarTo(ra.id,true,true);this._hideOverflow();this._handleScroll();}.bind(this));h.subscribe('notif/negativeUndid',function(qa,ra){this.negativeNotifs[ra.id]&&this.negativeNotifs[ra.id].onUndid();this.alertList.toggleNotifsSimilarTo(ra.id,false,true);this._hideOverflow();}.bind(this));h.subscribe('notif/negativeMarkedSpam',function(qa,ra){this.negativeNotifs[ra.id]&&this.negativeNotifs[ra.id].onMarkedSpam();}.bind(this));h.subscribe('notif/negativeFirstReceiptYes',function(qa,ra){this.negativeNotifs[ra.id]&&this.negativeNotifs[ra.id].onFirstReceiptYes();this.alertList.toggleNotifsSimilarTo(ra.id,false,true);}.bind(this));h.subscribe('notif/negativeFirstReceiptNo',function(qa,ra){this.negativeNotifs[ra.id]&&this.negativeNotifs[ra.id].onFirstReceiptNo();this.alertList.toggleNotifsSimilarTo(ra.id,false,true);}.bind(this));this.alertList.subscribe(t.INSERTION_TYPE,function(qa,ra){this._updateFirstReceipt(ra);var sa=n.scry(ra.obj,'.notif_x');if(sa.length==1)this.negativeNotifs[ra.id]=new r(this,ra);}.bind(this));},_sendIDs:function(qa,ra,sa){var ta=sa||{};for(var ua=0;ua<qa.length;++ua)ta['alert_ids['+ua+']']=qa[ua];new j(ba(ra).getQualifiedURI().toString(),ta).send();},_waitForFetch:function(qa){return this.currentFetchRequest&&this.fetchListeners.push(qa.bind(this));},_logImpression:function(){var qa=this.alertList.getIds();if(qa.length===0&&this._waitForFetch(this._logImpression))return;this.logImpressionIds(qa,this.NOTIF_JEWEL_REF);},logImpressionIds:function(qa,ra){this.shouldLogImpressions&&this._sendIDs(qa,'/ajax/notifications/impression.php',{ref:ra});},markRead:function(qa,ra){var sa=!Array.isArray(ra);ra=sa?this.alertList.getUnseenIds():ra.filter(this.alertList.isUnreadId.bind(this.alertList));if(ra.length){qa&&this._sendIDs(ra,'/ajax/notifications/mark_read.php',{seen:sa?1:0});if(ja('jewelNoticeMessage')&&this.logAutoShutOffImpression){new j('/ajax/notifications/auto_shutoff_seen.php').send();this.logAutoShutOffImpression=false;}var ta=qa;sa?this.alertList.markSeen(ra):this.alertList.markRead(ra,ta);}sa&&this._waitForFetch(this.markRead.bind(this,qa));},markAllRead:function(){var qa=this.alertList.getUnreadIds();this.markRead(true,qa);},_updateErrorHandler:function(qa){},_updateURI:'/ajax/presence/update.php',_update:function(qa){qa.setHandler(this._handleUpdate.bind(this)).setOption('suppressErrorAlerts',true).setErrorHandler(this._updateErrorHandler.bind(this)).setData({notif_latest:this.latest_notif_time,notif_latest_read:this.latest_read_notif_time,isBusinessOnly:this.isBusinessOnly}).setURI(this._updateURI).setAllowCrossPageTransition(true);},_handleUpdate:function(qa){var ra=qa.payload.notifications;if(!ra.no_change){this.updateTime=qa.payload.time;this.latest_notif_time=ra.latest_notif;this.latest_read_notif_time=ra.latest_read_notif;this._updateDisplay();this.alertList.insertMany(ra.notifications);}},_updateDisplay:function(){if(!this.content)return;this._updateCount();},_updateCount:function(){h.inform('jewel/count-updated',{jewel:'notifications',count:this.alertList.unseenCount},h.BEHAVIOR_STATE);this._hideOverflow();},fetch:function(qa){this._sendFetchRequest(qa);},_getFetchQueryData:function(){var qa={time:this.latest_notif_time,user:this.user,isBusinessOnly:this.isBusinessOnly,version:this.cache_version,locale:o.locale};if(this.useInfiniteScroll)qa.earliest_time=this.alertList.getEarliestNotifTime();return qa;},_sendFetchRequest:function(qa){if(this.useInfiniteScroll){this._infiniteScrollNotif=null;this._newDataFromInsert=false;this._truncate=true;}var ra=ba('/ajax/notifications/get.php'),sa=qa||this.loadingIndicator;if(this.currentFetchRequest)return true;this.ua.add_event('fetch');ra.setQueryData(this._getFetchQueryData());this.currentFetchRequest=new i().setURI(ra).setStatusElement(sa).setMethod('GET').setReadOnly(true).setTimeoutHandler(30000,this.fetchErrorHandler.bind(this)).setHandler(this.fetchHandler.bind(this)).setErrorHandler(this.fetchErrorHandler.bind(this)).setAllowCrossPageTransition(true);!this.currentFetchRequest.send()&&this.fetchErrorHandler();return true;},fetchErrorHandler:function(qa){this.currentFetchRequest=null;this.ua.add_event('fetch_error');this.loadingIndicator&&m.hide(this.loadingIndicator);this.useInfiniteScroll&&this._updateScrollDataStructures();},fetchHandler:function(qa){this.ua.add_event('fetch_success');var ra=qa.getPayload();this.alertList.insertMany(ra.notifications,true);this.loadingIndicator&&m.hide(this.loadingIndicator);this.loadingIndicator=null;this.currentFetchRequest=null;this.fetch=ia;if(this.fetchListeners){for(var sa=0;sa<this.fetchListeners.length;sa++)this.fetchListeners[sa]();this.fetchListeners=[];}var ta=ra.generated,ua=Math.round(Date.now()/1000);if(ua-ta>15)ta=ua;k.loadModules(['LiveTimer'],function(va){va.restart(ta);va.startLoop(0);});if(this.useInfiniteScroll){if(ka(ra.notifications)||!this._newDataFromInsert){this._noMoreNotifications();}else m.show(this._morePager);this._updateScrollDataStructures();if(this.isNotifJewelOpen()&&this.afterFirstFetch)this.animate=true;this.afterFirstFetch=true;}this._hideOverflow();},_noMoreNotifications:function(){m.hide(this._morePager);this.useInfiniteScroll=false;},_mergeNotification:function(qa,ra,sa,ta){var ua=!this.alertList.isUnreadId(qa);this.alertList.insert(qa,ra,sa,true,null,ta||null);this.latest_notif_time=0;if(ua)this._updateCount();var va=this.alertList.getDomObj(qa);if(va)k.loadModules(['LiveTimer'],function(wa){wa.addTimeStamps(va);});},_handleNotificationMsg:function(qa,ra){if(this.isNotifJewelOpen()){var sa={type:qa,data:ra};this.queuedNotifications.push(sa);}else this._displayNotification(qa,ra);},_displayNotification:function(qa,ra){var sa=ra.obj;if(typeof this.useDesktopNotifications=='undefined')this.useDesktopNotifications=this.allowDesktopNotifications&&window.webkitNotifications&&window.webkitNotifications.checkPermission()===0;if(this.useDesktopNotifications)k.loadModules(['DesktopNotifications'],function(ta){ta.addNotification(sa.alert_id);});if(sa.markup){this._mergeNotification(sa.alert_id,sa.time,sa.markup,sa.alt_id||null);}else this._poller.request();},_handleNotificationsReadMsg:function(qa,ra){var sa=ra.obj;this.markRead(false,sa.alert_ids);},_handleNotificationsSeenMsg:function(qa,ra){if(!this.unseenVsUnread){this._handleNotificationsReadMsg(qa,ra);return;}var sa=ra.obj;this.alertList.markSeen(sa.alert_ids);},_hideOverflow:function(){if(!this.isNotifJewelOpen())return;var qa=n.scry(fa('fbNotificationsList'),'.notification');this.scrollableAreaNode=this.scrollableAreaNode||n.scry(this.jewelFlyout,'.uiScrollableArea')[0];var ra=20,sa=m.hasClass(document.documentElement,'tinyViewport')&&!m.hasClass(document.body,'fixedBody');if(!qa.length||sa){y.set(this.scrollableAreaNode,'height','100%');this.notifLogger.rate(this.SCROLL_OFF_TINY,sa);return;}var ta=this.scrollableAreaNode||qa[0],ua=ea.getViewportDimensions().y-ea.getElementPosition(ta,'viewport').y-ea.getElementDimensions(this.footer).y-5,va=ua,wa=0;for(;wa<qa.length&&va>0;++wa)if(m.shown(qa[wa]))va-=ea.getElementDimensions(qa[wa]).y;var xa=530,ya=Math.min(xa,ua-Math.max(va,0));if(va>=0&&ya<xa){if(!this.useInfiniteScroll){ya='100%';}else{if(this._truncate&&qa.length>=5)ya-=ra;ya+='px';}}else ya+='px';if(this.useInfiniteScroll&&this.animate&&ya!='100%'){this.animation&&this.animation.stop();this.animation=new g(this.scrollableAreaNode).to('height',ya).duration(200).go();}else{var za=x.getInstance(this.scrollableAreaNode);za&&za.showScrollbar.bind(za).defer();y.set(this.scrollableAreaNode,'height',ya);}},_updateFirstReceipt:function(qa){var ra=qa.obj.getAttribute('data-appid'),sa=n.scry(qa.obj,'.first_receipt_div');if(ra&&sa.length==1){if(this.firstReceiptMap[ra]){if(qa.id!=this.firstReceiptMap[ra].id&&this.firstReceiptMap[ra].time>qa.time)return;m.removeClass(this.firstReceiptMap[ra].obj,'first_receipt');}this.firstReceiptMap[ra]=qa;m.addClass(qa.obj,'first_receipt');}},isNotifJewelOpen:function(){var qa=aa.getInstance(this.wrapper).getActive();return (qa===this.wrapper&&m.hasClass(qa,'openToggler'));}});e.exports=pa;});
__d("legacy:original-notifications-jewel",["Notifications"],function(a,b,c,d){a.Notifications=b('Notifications');},3);
__d("legacy:onvisible",["OnVisible"],function(a,b,c,d){a.OnVisible=b('OnVisible');},3);
__d("PagesVoiceBar",["$","Arbiter","AsyncRequest","CSS","ChannelConstants","DOM","PageTransitions"],function(a,b,c,d,e,f){var g=b('$'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('CSS'),k=b('ChannelConstants'),l=b('DOM'),m=b('PageTransitions'),n='PagesVoiceBar/toggle',o='PagesVoiceBar/initialized',p='PagesVoiceBar/switchVoice',q='page_transition',r='pages_voice_bar_sync',s=null,t=null,u=false,v=false;function w(){v=!v;j.conditionClass(document.body,'hasVoiceBar',v);}function x(da,ea){new i('/ajax/pages/switch_voice.php').setData(ea).setHandler(function(fa){ba();}).send();}function y(){s=null;}function z(da,ea){if(ea.obj.profile_id&&ea.obj.profile_id==s)ba();}function aa(da){h.subscribe(o,da);}function ba(){m.getNextURI().go();}var ca={initVoiceBar:function(){if(u)return;t=g('pagesVoiceBarContent');v=j.hasClass(document.body,'hasVoiceBar');h.subscribe(n,w);h.subscribe(p,x);h.subscribe(q,y);h.subscribe(k.getArbiterType(r),z);u=true;h.inform(o,null,h.BEHAVIOR_STATE);},update:function(da,ea){aa(function(){s=ea;l.setContent(t,da);});}};e.exports=ca;});
__d("PrivacyLiteFlyout",["Event","function-extensions","$","Animation","Arbiter","ArbiterMixin","AsyncRequest","CSS","DOM","Ease","Parent","SelectorDeprecated","Style","Toggler","copyProperties","cx","csx","ge"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('$'),i=b('Animation'),j=b('Arbiter'),k=b('ArbiterMixin'),l=b('AsyncRequest'),m=b('CSS'),n=b('DOM'),o=b('Ease'),p=b('Parent'),q=b('SelectorDeprecated'),r=b('Style'),s=b('Toggler'),t=b('copyProperties'),u=b('cx'),v=b('csx'),w=b('ge'),x='PrivacyLiteFlyout/expandingSection',y={},z={};function aa(){switch(window.location.pathname){case '/':case '/home.php':case '/index.php':return true;default:return false;}}function ba(ka){var la="._59fb";return !p.byClass(ka,'hasSmurfbar')&&n.scry(h('blueBar'),la).length;}function ca(ka,la,ma){var na=la?0:ka.offsetHeight;r.set(ka,'height',na+'px');r.set(ka,'overflow','hidden');m.show(ka);var oa=la?ka.scrollHeight:0,pa=n.getID(ka);y[pa]&&y[pa].stop();y[pa]=new i(ka).to('height',oa).ondone(function(){y[pa]=null;r.set(ka,'height','');r.set(ka,'overflow','');oa||m.hide(ka);ma();}).duration(Math.abs(oa-na)*1.5).ease(o.sineOut).go();}function da(ka){return new l().setURI(ka).send();}function ea(){return da('/ajax/privacy/privacy_lite/increment_masher_tip_count');}function fa(){return da('/ajax/privacy/privacy_lite/dismiss_masher_tip');}var ga=null,ha=false,ia=false,ja=t({loadBody:function(ka){if(!ha&&w('fbPrivacyLiteFlyoutLoading')){ha=true;if(!ka)ka=false;new l('/ajax/privacy/privacy_lite/loader').setData({from_megaphone:ka}).send();}},renderBody:function(ka){var la=w('fbPrivacyLiteFlyoutLoading');if(la){n.replace(la,ka);ja.inform('load',null,j.BEHAVIOR_STATE);}},hideCleanup:function(ka){j.inform(x);var la=n.scry(ka,"._2va0").forEach(function(ma){m.removeClass(ma,"_2va0");});},registerFlyoutToggler:function(ka,la){ga=la;var ma=s.createInstance(ka);ma.setSticky(false);s.listen(['show','hide'],la,function(na){ja.inform(na);ia=na==='show';if(!ia){ja.hideCleanup(ka);ma.hide();j.inform('layer_hidden',{type:'PrivacyShortcutsFlyout'});}else j.inform('layer_shown',{type:'PrivacyShortcutsFlyout'});});},registerFinalReminderFlyout:function(ka){if(ia||!aa())return;var la=n.find(ka.getRoot(),"._57bk"),ma=ka.getContext();if(ba(ma))ka.setOffsetY(-5);ja.subscribe('show',function(){ka.hide();});var na=g.listen(la,'click',function(){ka.hide();da('/ajax/privacy/privacy_lite/dismiss_rollout_reminder');na.remove();});da('/ajax/privacy/privacy_lite/increment_rollout_reminder');ka.show();},isFlyoutVisible:function(){return ga&&s.getActive()===ga;},exists:function(){return !!n.scry(document.body,"._59fc")[0];},setFlyoutVisible:function(ka){ka?s.show(ga):s.hide(ga);},showSection:function(ka){var la=z[ka],ma=la.chevron,na=la.sublist_container;j.inform(x,ma);if(ja.inform('expand',ka)!==false){m.removeClass(ma,"_9or");m.addClass(ma,"_9os");ca(na,true,function(){ja.inform('expanded',ka);});}},hideSection:function(ka,la,ma){var na=z[ka],oa=na.chevron,pa=na.sublist_container;if(ma===oa)return;if(ja.inform('collapse',ka)!==false){m.addClass(oa,"_9or");m.removeClass(oa,"_9os");ca(pa,false,function(){ja.inform('collapsed',ka);});}},toggleSection:function(ka){var la=z[ka].chevron;s.getInstance(la).hide();if(m.hasClass(la,"_9or")){ja.showSection(ka);new l('/ajax/privacy/privacy_lite/log_section_expand').setData({section:ka}).send();}else ja.hideSection(ka);},registerSection:function(ka,la){z[ka]=la;j.subscribe(x,ja.hideSection.curry(ka));g.listen(la.section_block,'click',ja.toggleSection.curry(ka));},registerInlineHelpOnAudienceChange:function(ka,la,ma){q.subscribe('select',function(na,oa){if(oa.selector!=ka)return;m.addClass(la,"_2va0");if(ma)new l('/ajax/privacy/privacy_lite/kill_intro').send();});},registerInlineHelpXOutOnClick:function(ka,la){g.listen(ka,'click',m.addClass.curry(la,"_9p0"));},registerBlockUnhideOnFocus:function(ka,la){g.listen(ka,'focus',m.show.curry(la));},registerMessageFilterSettingOnClick:function(ka,la){var ma=n.find(ka,"._fv0");g.listen(ka,'click',function(){if(ma.checked)new l('/ajax/mercury/change_filtering_type.php').setData({filtering_type:la,source:'privacy_lite'}).send();});},registerGraphSearchPrivacyReminder:function(ka,la){g.listen(la,'click',function(){n.remove(ka);da('/ajax/privacy/privacy_lite/dismiss_gs_privacy_reminder');});},registerMasher:function(ka,la){var ma=false;j.subscribe(x,function(na,oa){var pa=true;if(oa)pa=!!n.scry(p.byTag(oa,'li'),"._571t").length;if(ma||!pa)return;ma=!!(ea());});g.listen(la,'click',function(){n.remove(ka);fa();});}},k);e.exports=ja;});
__d("PrivacyLiteFlyoutHelp",["Event","Arbiter","AsyncRequest","ContextualHelpSearchController","CSS","DOM","Parent","copyProperties","csx","cx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('ContextualHelpSearchController'),k=b('CSS'),l=b('DOM'),m=b('Parent'),n=b('copyProperties'),o=b('csx'),p=b('cx'),q,r;function s(t,u,v,w,x){this._width=315;r=l.find(u,'input');var y=l.create('div');this.init(t,r,y,v,w);q=m.byClass(u,"_8-a");g.listen(x,'click',this._hideSearch.bind(this));h.subscribe('PrivacyLiteFlyout/expandingSection',this._hideSearch.bind(this));var z=l.scry(q,"._d1r")[0];z&&g.listen(z,'click',function(){k.addClass(q,"_aw6");r.focus();if(!this.suggestedResults)new i('/ajax/privacy/privacy_lite/help_suggestions').setHandler(function(aa){var ba=aa.getPayload().searchSuggestions,ca=l.find(q,"._4_8m");l.setContent(ca,ba);k.addClass(q,"_4_8l");}.bind(this)).send();}.bind(this));}n(s.prototype,new j(),{source:'privacy_shortcuts',_hideSearch:function(){this.clearResults();k.removeClass(q,"_aw6");},show:function(t){if(t===this.topics_area){k.removeClass(q,"_aw7");return;}else if(t===this.loader){k.addClass(q,"_aw7");k.hide(this.results_area);}else k.hide(this.loader);k.show(t);}});e.exports=s;});
__d("ViewasChromeBar",["Event","Arbiter","AsyncRequest","CSS","DOM","Focus","ModalMask","PageTransitions","Parent","cx","csx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('CSS'),k=b('DOM'),l=b('Focus'),m=b('ModalMask'),n=b('PageTransitions'),o=b('Parent'),p=b('cx'),q=b('csx'),r='ViewasChromeBar/initialized',s=null,t=false;function u(x){h.subscribe(r,x);}function v(x){j.addClass(x,"_7g7");var y=k.find(x,"._7g0");l.set(k.find(y,'.textInput'));}var w={initChromeBar:function(x){if(t)return;s=x;t=true;h.inform(r,null,h.BEHAVIOR_STATE);},update:function(x,y){u(function(){k.setContent(s,x);if(y)new i('/ajax/privacy/glasgow/viewas_bar_flyout_open').send();});},registerSpecificModeOnClick:function(x){g.listen(x,'click',v.curry(o.byClass(x,"_7f-")));},registerFlyoutModalMask:function(){m.show();n.registerHandler(m.hide,10);}};e.exports=w;});
__d("BingScalingCommon",[],function(a,b,c,d,e,f){var g={integrateWebsuggestions:function(h,i,j,k,l){var m=[],n=i?m:[],o=[],p=0,q=0,r=j;k=Math.floor(j*k);for(var s=0;s<h.length;s++){var t=h[s];if(t.type==='websuggestion'&&!t.isSeeMore){if((r>0&&p<k)||(p>0&&p<l)){n.push(t);p++;r--;}else if(r>0)o.push(t);}else{if(r<=0&&!i)continue;m.push(t);q++;r--;}}if(r>0&&o.length>0)n=n.concat(o.slice(0,r));if(!i)return m.concat(n);return n;}};e.exports=g;});
__d("SearchDataSource",["Event","Arbiter","AsyncResponse","DataSource","HashtagSearchResultUtils","copyProperties","createArrayFrom","BingScalingCommon"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncResponse'),j=b('DataSource'),k=b('HashtagSearchResultUtils'),l=b('copyProperties'),m=b('createArrayFrom'),n=b('BingScalingCommon');for(var o in j)if(j.hasOwnProperty(o))q[o]=j[o];var p=j===null?null:j.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=j;function q(r){this._token=r.token||'';this._lazyonload=r.lazyonload===false?false:true;this._extraTypes=r.extraTypes;this._buckets=r.buckets;this._noMultiFetch=r.noMultiFetch||false;this._maxWebSuggToCountFetchMore=r.maxWebSuggToCountFetchMore||0;var s=r.maxResults||8;j.call(this,r);this._numResults={min:3,max:s};this.recordingRoute=r.recordingRoute||'non_banzai';this._enabledHashtag=r.enabledHashtag||false;this.logBackendQueriesWindow=r.logBackendQueriesWindow||25;this._minWebSugg=r.minWebSugg||2;this._queryToWebSuggState={};this._genTime=r.genTime;}q.prototype.init=function(){p.init.call(this);this._leanPayload=null;this._bootstrapRequestsPending=0;this._criticalOnly=true;this._updateMaxResults();g.listen(window,'resize',this._updateMaxResults.bind(this));this.complexChars=new RegExp('[\uFF66-\uFFDD\u4E00-\u9FCC\u3400-\u4DBF]');};q.prototype.dirty=function(){p.dirty.call(this);this._fetchOnUseRequests=[];};q.prototype.asyncErrorHandler=function(r){if(window.Dialog&&window.Dialog.getCurrent()==null&&r.getError()==1400003)i.verboseErrorHandler(r);};q.prototype.fetch=function(r,s,t){t=t||{};t.fetch_start=Date.now();p.fetch.call(this,r,s,t);};q.prototype.fetchHandler=function(r,s){var t=r.getPayload(),u=l({fetch_end:Date.now()},s),v=u.value?h.BEHAVIOR_EVENT:h.BEHAVIOR_PERSISTENT;this.inform('beginFetchHandler',{response:r});if(s.type=='lean'){this._leanPayload=t;this._processLean();}else{if(t.coeff2_ts)u.coeff2_ts=t.coeff2_ts;var w={limit:typeof t.webSuggLimit!=='undefined'?t.webSuggLimit:6,showOnTop:typeof t.webSuggOnTop!=='undefined'?t.webSuggOnTop:false};this._queryToWebSuggState[s.value]=w;p.fetchHandler.call(this,r,s);if(s.bootstrap&&!r.getRequest().getData().no_cache)u.browserCacheHit=(t.timestamp<this._genTime);if(s.bootstrap&&!t.no_data&&this._bootstrapRequestsPending>0){s.bootstrap=false;--this._bootstrapRequestsPending;!this._bootstrapRequestsPending&&this._bootstrapPostProcess();}if(t.no_data||t.stale||t.token!==this._token){var x=l({},r.getRequest().getData());if(x.lazy){delete x.lazy;x.token=this._token;this._fetchOnUse(x,s);}}}this.inform('endpointStats',u,v);};q.prototype.respond=function(r,s,t){this.inform('respondValidUids',s);this.inform('reorderResults',s);var u=this.buildData(s,r);u.forEach(function(v,w){v.origIndex=w;});this.inform('respond',{value:r,results:u,isAsync:!!t});return u;};q.prototype.buildData=function(r,s){if(!r||r.length===0)return [];var t=this.getWebSuggState(s),u=t.showOnTop,v=n.integrateWebsuggestions(r.map(this.getEntry.bind(this)),Boolean(u),this._maxResults,t.limit);v.length=Math.min(v.length,this._maxResults);return v;};q.prototype.getWebSuggState=function(r){while(r){var s=this._queryToWebSuggState[r];if(typeof s!=='undefined')return s;r=r.slice(0,r.length-1);}return {limit:0,showOnTop:false};};q.prototype._isQueryTooShort=function(r){return r.length<this._minQueryLength&&!(this.complexChars&&this.complexChars.test(r));};q.prototype.shouldFetchMoreResults=function(r){var s=0,t=0;r.forEach(function(u){if(u.type!=='websuggestion'||t++<this._maxWebSuggToCountFetchMore)s++;}.bind(this));return s<this._maxResults;};q.prototype._bootstrapPostProcess=function(){var r={time:Date.now()};this.inform('bootstrapped',r,h.BEHAVIOR_PERSISTENT);this._processLean();};q.prototype._processLean=function(){if(this._leanPayload){var r,s=this._leanPayload.entries;for(var t in s){r=this.getEntry(t);r&&(r.index=s[t]);}this.setExclusions(this._leanPayload.blocked);this._leanPayload=null;}};q.prototype._updateMaxResults=function(){var r=window.innerHeight||document.documentElement.clientHeight;this.setMaxResults(Math.max(this._numResults.min,Math.min(this._numResults.max,Math.ceil(2+((r-370)/56)))));};q.prototype._bootstrapFetch=function(r,s){var t=l(s,this.bootstrapData);if(this._criticalOnly&&this._lazyonload)t.lazy=1;this.fetch(this.bootstrapEndpoint,t,{bootstrap:true,type:r});++this._bootstrapRequestsPending;};q.prototype._fetchOnUse=function(r,s){for(var t in this.bootstrapData)!r.hasOwnProperty(t)&&(r[t]=this.bootstrapData[t]);if(this._criticalOnly){this._fetchOnUseRequests.push({args:r,ctx:s});}else this.fetch(this.bootstrapEndpoint,r,s);};q.prototype._fetchLean=function(){var r={no_cache:1};r.options=m(r.options);r.options.push('lean');this._fetchOnUse(r,{type:'lean'});};q.prototype.bootstrap=function(r){if(!r){this._criticalOnly=false;this._flushFetchOnUseRequests();}if(this._bootstrapped)return;var s={filter:['event'],no_cache:1};this._fetchOnUse(s,{type:'event'});var t=['app','page','group','friendlist'];t=t.concat(this._extraTypes||[]);if(this._noMultiFetch){t.push('user');this._bootstrapFetch('user',{filter:t});}else{this._bootstrapFetch('other',{filter:t});if(this._buckets){for(var u=0;u<this._buckets.length;++u){var v={filter:['user'],buckets:this._buckets[u]};this._bootstrapFetch('user',v);}}else this._bootstrapFetch('user',{filter:['user']});}this._fetchLean();this._bootstrapped=true;};q.prototype._flushFetchOnUseRequests=function(){var r=this._fetchOnUseRequests.length;for(var s=0;s<r;++s){var t=this._fetchOnUseRequests[s];this.fetch(this.bootstrapEndpoint,t.args,t.ctx);}if(r>0)this.inform('extra_bootstrap',{time:Date.now()},h.BEHAVIOR_PERSISTENT);this._fetchOnUseRequests=[];};q.prototype.onLoad=function(r,s){this.inform('onload',{time:Date.now()},h.BEHAVIOR_PERSISTENT);if(r)this.bootstrap.bind(this,s).defer();};q.prototype.mergeUids=function(r,s,t,u){var v=this.getDynamicHashtagResult(u);if(u&&v&&s.indexOf(v)<=0)s.unshift(v);var w=t[0]?this.getEntry(t[0]):null,x=s[0]?this.getEntry(s[0]):null,y=(w&&w.replace_results)?w:null;y=(!y&&x&&x.replace_results)?x:y;var z=p.mergeUids.call(this,r,s,t,u);if(y){this.inform('backend_topreplace',{});return this.deduplicateByKey([y.uid].concat(z));}return z;};q.prototype.getTextToIndexFromFields=function(r,s){var t=[],u=r.tokenVersion==="v2";for(var v=0;v<s.length;++v){if(u&&(s[v]==="text"||s[v]==="alias"))continue;var w=r[s[v]];if(w)t.push(w.join?w.join(' '):w);}return t.join(' ');};q.prototype.getDynamicHashtagResult=function(r){if(!r||!this._enabledHashtag)return;var s=k.getHashtagFromQuery(r);if(!s)return;var t='hashtag:'+s,u=this.getEntry(t);if(!u)this.processEntries([k.makeTypeaheadResult(s)],r);return t;};e.exports=q;});
__d("SearchTypeaheadRecorder",["Event","AsyncRequest","Banzai","Keys","TokenizeUtil","Vector","ge","clickRefAction","copyProperties","userAction"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('Banzai'),j=b('Keys'),k=b('TokenizeUtil'),l=b('Vector'),m=b('ge'),n=b('clickRefAction'),o=b('copyProperties'),p=b('userAction');function q(s){this.init(s);this.initEvents();}q.prototype.init=function(s){this.core=s.getCore();this.data=s.getData();this.view=s.getView();this.element=this.core.getElement();this.initTime=Date.now();this._onloadTime=0;this._extraRecorder=[];var t=m('search_first_focus');this.initStartTime=t&&t.value;this.bootstrapStats={bootstrapped:0};this._reset();};q.prototype._reset=function(){this.stats={};this.avgStats={};this.appendStats={};this._backspacing=false;this.backendQueries=[];this._topreplace=false;this._inflightRequests={};var s=Math.random().toString();this.data.setQueryData({sid:s});this.view.setSid(s);this.recordStat('sid',s);this.recordStat('keypressed',0);};q.prototype.initEvents=function(){this.core.subscribe('focus',function(event){if(!this.stats.session_start_time)this.recordStat('session_start_time',Date.now());}.bind(this));this.core.subscribe('blur',function(event){var s=Date.now();for(var t in this._inflightRequests){var u=this._inflightRequests[t],v=s-u;this.recordAvgStat('search_endpoint_ms_from_js',v);}this.recordStat('session_end_time',s);this.submit();}.bind(this));this.view.subscribe('select',function(s,t){this.recordSelectInfo(t);}.bind(this));this.view.subscribe('render',function(s,t){this.recordRender(t);}.bind(this));this.data.subscribe('activity',function(s,t){this.recordStat('pending_request',t.activity);}.bind(this));this.data.subscribe('respondValidUids',function(s,t){this.validUids=t.slice(0);}.bind(this));this.data.subscribe('beforeQuery',function(s,t){if(!t.value){this.query='';this.results=[];return;}if(!this.stats.first_query_time)this.recordStat('first_query_time',Date.now());this.query=t.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('queryEndpoint',function(s,t){this.recordCountStat('num_search_ajax_requests');this.recordAvgStat('endpoint_query_length',t.value.length);this._inflightRequests[t.value]=Date.now();}.bind(this));this.data.subscribe('onload',function(s,t){this._onloadTime=t.time;}.bind(this));this.data.subscribe('bootstrapped',function(s,t){this.bootstrapStats.endTime=t.time;this.bootstrapStats.bootstrapped=1;}.bind(this));this.core.subscribe('recordFunction',function(s,t){this._extraRecorder.push(t);}.bind(this));this.data.subscribe('endpointStats',function(s,t){var u=t.fetch_end-t.fetch_start;if(t.value){this.recordAvgStat('search_endpoint_ms_from_js',u);}else this.bootstrapStats[t.type]=u;if(t.coeff2_ts)this.bootstrapStats.coeff2_ts=t.coeff2_ts;if(typeof t.browserCacheHit!='undefined')this.recordCountStat(t.browserCacheHit?'bootstrap_cachehits':'bootstrap_cachemisses');if(this._inflightRequests[t.value])delete this._inflightRequests[t.value];}.bind(this));this.data.subscribe('query',function(s,t){this.recordAvgStat('num_results_from_cache',t.results.length);}.bind(this));this.data.subscribe('backend_topreplace',function(s,t){if(false===this._topreplace){this.recordStat("backend_topreplace",1);this._topreplace=true;}}.bind(this));g.listen(this.element,'keydown',function(event){this.recordStat('keypressed',1);if(g.getKeyCode(event)==j.BACKSPACE){if(!this._backspacing&&this.query){this._backspacing=true;this.recordAppendStat('before_backspace_queries',this.query);}}else this._backspacing=false;}.bind(this));this.data.subscribe('beforeFetch',function(s,t){var u=t.request.data.value;if(!u)return;this.backendQueries.push(u);}.bind(this));};q.prototype.recordStat=function(s,t){this.stats[s]=t;};q.prototype.recordCountStat=function(s){var t=this.stats[s];this.stats[s]=t?t+1:1;};q.prototype.recordAvgStat=function(s,t){if(this.avgStats[s]){this.avgStats[s][0]+=t;++this.avgStats[s][1];}else this.avgStats[s]=[t,1];};q.prototype.recordAppendStat=function(s,t){if(!this.appendStats.hasOwnProperty(s))this.appendStats[s]=[];this.appendStats[s].push(t);};q.prototype.recordRender=function(s){this.results=s.filter(function(u){return (u.uid!='search'&&u.type!='disabled_result'&&u.type!='header');}).map(function(u){return o(null,u);});var t=l.getViewportDimensions();this.recordStat('window_size_width',t.x);this.recordStat('window_size_height',t.y);if(this.results.length>0&&!this.stats.first_result_time)this.recordStat('first_result_time',Date.now());};q.prototype.recordSelectInfo=function(s){var t=s.selected,u=s.index;if(t.groupIndex!==undefined)u=s.index-t.groupIndex-1;var v={href:t.path},w=t.dataGT?{gt:JSON.parse(t.dataGT)}:{};n('click',v,null,null,w);p('search').uai('click');if(t.uid=='search'){this.recordStat('selected_search',1);}else if(t.uid=='invite'){this.recordStat('selected_invite',1);}else{var x=t.rankType||t.render_type||t.type,y=(x=='friend'?'user':x);this.recordStat('selected_'+y,1);this.recordStat('selected_position',u);this.recordStat('selected_type',x);this.recordStat('selected_name_length',t.text.length);this.recordStat('selected_id',t.uid);this.recordStat('selected_degree',t.bootstrapped?1:2);var z=k.parse(this.data.getTextToIndex(t)).tokens,aa=r(z,this.query);if(aa)this.recordStat('matched_terms',aa);}var ba={};this._extraRecorder.forEach(function(ca){ca(s,this.results,ba);}.bind(this));this.recordStat('extra_select_info',JSON.stringify(ba));if(t.type==='websuggestion'){this.recordStat('selected_memcached_websuggestion',t.fromMemcache);this.recordStat('selected_websuggestion_source',t.websuggestion_source);}this.recordStat('selected_with_mouse',s.clicked?1:0);};q.prototype._dataToSubmit=function(){this.recordStat('candidate_results',this.buildResults());this.recordStat('query',this.query);this.recordStat('init_time',this.initTime);if(this.initStartTime){this.recordStat('init_start_time',this.initStartTime);this.recordStat('onload_time',this._onloadTime);this.initStartTime=0;}this.recordStat('bootstrapped',this.bootstrapStats.bootstrapped);if(this.bootstrapStats.endTime){this.recordStat('bootstrapped_time',this.bootstrapStats.endTime);this.recordStat('user_bootstrap_ms',this.bootstrapStats.user);this.recordStat('other_bootstrap_ms',this.bootstrapStats.other);this.bootstrapStats.endTime=0;}this.recordStat('coeff2_ts',this.bootstrapStats.coeff2_ts);this.recordStat('max_results',this.data._maxResults);if(this.backendQueries.length>0){if(this.backendQueries.length>this.data.logBackendQueriesWindow)this.backendQueries=this.backendQueries.slice(this.backendQueries.length-this.data.logBackendQueriesWindow);this.recordStat('backend_queries',this.backendQueries);}var s=this.stats;for(var t in this.avgStats){var u=this.avgStats[t];s[t]=u[0]/u[1];}for(var v in this.appendStats)s[v]=JSON.stringify(this.appendStats[v]);return s;};q.prototype.buildResults=function(){var s=(this.results||[]).map(function(t,u){var v=k.parse(this.data.getTextToIndex(t)).tokens,w=t.rankType||t.render_type||t.type,x=t.bootstrapped?1:0,y=t.s_token||'',z=r(v,this.query)||this.query,aa=t.index_rank,ba=t.match_type,ca=t.l_type,da=t.vertical_type,ea=t.prefix_match,fa=t.prefix_length;if(typeof t.groupIndex=='number')return [t.groupIndex,t.indexInGroup,t.uid,w,x,y,z,aa,ba,ea,fa,t.origIndex,ca,da];return [0,u,t.uid,w,x,y,z,aa,ba,ea,fa,t.origIndex,ca,da];}.bind(this));return JSON.stringify(s);};q.prototype.submit=function(){var s=this._dataToSubmit();switch(this.data.recordingRoute){case 'double_recording':if(Math.random()>.5){s.recorded_first='legacy';setTimeout(this.submitThroughAsyncRequest.bind(this,s),0);i.post(this._banzaiRoute,s,{delay:0,retry:true});}else{s.recorded_first='banzai';i.post(this._banzaiRoute,s,{delay:0,retry:true});setTimeout(this.submitThroughAsyncRequest.bind(this,s),0);}break;case 'random_recording':if(Math.random()>.5){this.submitThroughAsyncRequest(s);}else i.post(this._banzaiRoute,s,{delay:0,retry:true});break;case 'banzai_basic':i.post(this._banzaiRoute,s);break;case 'banzai_vital':i.post(this._banzaiRoute,s,{delay:0,retry:true});break;default:this.submitThroughAsyncRequest(s);}this._reset();};q.prototype.submitThroughAsyncRequest=function(s){if(Object.keys(s).length>0)new h().setURI(this._endPoint).setMethod('POST').setData({stats:s}).setOption('handleErrorAfterUnload',true).setErrorHandler(function(t){s.retry=true;new h().setURI(this._endPoint).setMethod('POST').setData({stats:s}).setOption('asynchronous',false).send();}.bind(this)).send();};var r=function(s,t){var u=k.parse(t);if(u.flatValue[u.flatValue.length-1]===' ')return u.flatValue;var v=u.tokens[u.tokens.length-1],w={};s.forEach(function(ba){w[ba]=(w[ba]||0)+1;});var x={},y=u.tokens.slice(0,u.tokens.length-1);y.forEach(function(ba){x[ba]=(x[ba]||0)+1;});for(var z=0;z<s.length;++z){var aa=s[z];if(aa.indexOf(v)===0&&(w[aa]-(x[aa]||0)>0)){y.push(aa);return y.join(' ');}}return undefined;};o(q.prototype,{_endPoint:'/ajax/typeahead/record_metrics.php',_banzaiRoute:'search'});e.exports=q;});
__d("LayerSlowlyFadeOnShow",["LayerFadeOnShow","emptyFunction"],function(a,b,c,d,e,f){var g=b('LayerFadeOnShow'),h=b('emptyFunction');for(var i in g)if(g.hasOwnProperty(i))k[i]=g[i];var j=g===null?null:g.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=g;function k(){if(g!==null)g.apply(this,arguments);}k.prototype._getDuration=h.thatReturns(500);e.exports=k;});