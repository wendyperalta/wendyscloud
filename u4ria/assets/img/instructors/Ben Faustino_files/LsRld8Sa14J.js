/*!CK:1206490945!*//*1379685169,180620121*/

if (self.CavalryLogger) { CavalryLogger.start_js(["n\/Wu1"]); }

__d("Grid.react",["ReactPropTypes","React","cx","flattenChildren","getObjectValues","joinClasses"],function(a,b,c,d,e,f){var g=b('ReactPropTypes'),h=b('React'),i=b('cx'),j=b('flattenChildren'),k=b('getObjectValues'),l=b('joinClasses'),m=h.createClass({displayName:'Grid',propTypes:{cols:g.number.isRequired,fixed:g.bool,alignv:g.oneOf(['top','middle','bottom']),alignh:g.oneOf(['left','center','right']),spacing:g.string},render:function(){var p=k(j(this.props.children)),q=p.length,r=[],s=[],t=0;p.forEach(function(u,v){if(!(u instanceof n.componentConstructor))u=n(null,u);u.props.alignv=u.props.alignv||this.props.alignv;u.props.alignh=u.props.alignh||this.props.alignh;o(u,((this.props.fixed?"_5f0n":'')));if(this.props.spacing)o(u,this.props.spacing);s.push(u);t+=Math.max(u.props.colSpan||0,1);if(t%this.props.cols===0||v+1===q){if(this.props.fixed&&t<this.props.cols){for(var w=t;w<this.props.cols;w++)s.push(n(null));t=this.props.cols;}if(t===this.props.cols)o(s[s.length-1],"_51mw");r.push(h.DOM.tr({className:"_51mx",key:v},s));s=[];t=0;}}.bind(this));return this.transferPropsTo(h.DOM.table({className:"uiGrid _51mz",cellSpacing:"0",cellPadding:"0"},h.DOM.tbody(null,r)));}}),n=h.createClass({displayName:'GridItem',propTypes:{alignv:g.oneOf(['top','middle','bottom']),alignh:g.oneOf(['left','center','right'])},render:function(){var p=(("_51m-")+(this.props.alignv==='top'?' '+"vTop":'')+(this.props.alignv==='middle'?' '+"vMid":'')+(this.props.alignv==='bottom'?' '+"vBot":'')+(this.props.alignh==='left'?' '+"hLeft":'')+(this.props.alignh==='center'?' '+"hCent":'')+(this.props.alignh==='right'?' '+"hRght":''));return this.transferPropsTo(h.DOM.td({className:p},this.props.children));}}),o=function(p,q){p.props.className=l(p.props.className,q);};m.GridItem=n;e.exports=m;});
__d("MercuryAudioPlayer",["Event","Arbiter","DOM","Flash","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('DOM'),j=b('Flash'),k=b('copyProperties'),l=200;function m(){var v=i.create('audio'),w=false;try{if(!!v.canPlayType)if(v.canPlayType('video/mp4;').replace(/^no$/,''))w=true;}finally{return w;}}function n(){return j.isAvailable();}var o=function(){this.interval=null;this.arbiterInstance=null;this.audio=i.create('audio');g.listen(this.audio,'playing',function(){this.informAttachment('playing',this.audio.currentTime);this.interval=setInterval(function(){this.informAttachment('playing',this.audio.currentTime);}.bind(this),l);}.bind(this));g.listen(this.audio,'ended',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};k(o.prototype,{setAudio:function(v,w){this.audio.setAttribute('src',v);this.arbiterInstance=w;},informAttachment:function(v,w){if(this.arbiterInstance)this.arbiterInstance.inform(v,w);},play:function(){this.audio.play();this.informAttachment('played');},resume:function(){this.audio.play();this.informAttachment('played');},pause:function(){this.audio.pause();clearInterval(this.interval);this.informAttachment('paused');},getType:function(){return 'html5';}});var p=function(){this.src=null;this.arbiterInstance=null;var v=i.create('div');document.body.appendChild(v);this.swf=j.embed('/swf/SoundStreamPlayer.swf',v,null,{});this.interval=null;h.subscribe('soundstream/finished',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};k(p.prototype,{setAudio:function(v,w){this.src=v;this.arbiterInstance=w;},informAttachment:function(v,w){if(this.arbiterInstance)this.arbiterInstance.inform(v,w);},play:function(){this.swf.playSound(this.src);this.interval=setInterval(function(){var v=this.swf.getCurrentTime();this.informAttachment('playing',v);}.bind(this),l);this.informAttachment('played');},resume:function(){this.swf.resume();this.informAttachment('played');},pause:function(){clearInterval(this.interval);this.swf.pause();this.informAttachment('paused');},getType:function(){return 'flash';}});function q(){if(m()){return new o();}else if(n())return new p();return false;}var r=null,s=null,t=0;function u(v,w){this.src=v;this.arbiterInstance=w;this.audio_id=++t;r!==null||(r=q());if(!r)return false;}k(u.prototype,{getType:function(){if(!r){return false;}else return r.getType();},play:function(v){if(v&&s==this.audio_id){r.resume();}else{this.pause();s=this.audio_id;r.setAudio(this.src,this.arbiterInstance);r.play();}},pause:function(){r.pause();}});e.exports=u;});
__d("MercuryAttachmentAudioClip.react",["Arbiter","ArbiterMixin","MercuryAudioPlayer","Env","JSLogger","LeftRight.react","React","cx","shield","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('MercuryAudioPlayer'),j=b('Env'),k=b('JSLogger'),l=b('LeftRight.react'),m=b('React'),n=b('cx'),o=b('shield'),p=b('tx'),q='MercuryAttachmentAudioClip/play',r=k.create('mercury_audio_clip'),s=m.createClass({displayName:'AudioClip',mixins:[h],getInitialState:function(){this.subscribe('playing',this.updateTime);this.subscribe('played',o(this.setState,this,{playing:true,started:true}));this.subscribe('paused',o(this.setState,this,{playing:false}));this.subscribe('finished',o(this.setState,this,{playing:false,started:false,time:this.props.duration}));this.logged=false;var t=this.props.downloadOnly?false:new i(this.props.src,this);g.subscribe(q,function(u,v){if(this.props.src!=v)this.setState({time:0});}.bind(this));return {time:0,playing:false,started:false,duration:this.props.duration,audioPlayer:t};},updateTime:function(t,u){this.setState({time:u});},play:function(){if(this.state.playing){this.state.audioPlayer.pause();}else{this.state.audioPlayer.play(this.state.started);g.inform(q,this.props.src);if(!this.logged){this.logged=true;r.log('play',{uid:j.user,duration:this.props.duration});}}},_formatSeconds:function(t){if(t){t=Math.ceil(t);var u=t%60;if(u<10)u='0'+u;var v=Math.floor(t/60);return v+':'+u;}else return null;},_renderPlayer:function(t,u){return (m.DOM.a({className:"_1miz",style:{width:t},onClick:this.play},m.DOM.span({className:"_1mi-"},m.DOM.i({className:"_1mi_"})),m.DOM.span({className:"_1mj0"},u),m.DOM.div({className:"_1mj1"})));},render:function(){var t=this.state.time,u=this.state.playing,v=this._formatSeconds(this.state.duration),w=this.props.width||170,x=null,y=Math.ceil((t*(w+2))/this.state.duration);if(this.state.audioPlayer&&this.state.audioPlayer.getType()){var z=this._renderPlayer(w,v),aa=this._renderPlayer(w,v),ba=(("_1mj2")+(u&&(t!==0)?' '+"_1mj3":'')+(u&&(t===0)?' '+"_4g4x":''));x=(m.DOM.div({className:ba},z,m.DOM.div({className:"_1mj4",style:{width:y}},aa)));}else x=(m.DOM.div({className:"_1mj2"},m.DOM.div({className:"_1miz"},l(null,m.DOM.a({className:"_1mj5",href:this.props.src},m.DOM.span({className:"_3qi6"},m.DOM.i({className:"_1mj6"})),m.DOM.span({className:"_1mj7"},"Voice Message"),m.DOM.span({className:"_1mj8"},v)),m.DOM.a({href:this.props.src,className:"_1mj9"},m.DOM.i({className:"_1mja"}))))));return (m.DOM.div({className:"_1mjb"},x));}});e.exports=s;});
__d("MercuryStickerPackFlyout.react",["AsyncRequest","Grid.react","LegacyScrollableArea.react","ReactPropTypes","React","Sticker.react","XUISpinner.react","cx"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Grid.react'),i=b('LegacyScrollableArea.react'),j=b('ReactPropTypes'),k=b('React'),l=b('Sticker.react'),m=b('XUISpinner.react'),n=b('cx'),o=h.GridItem,p=148,q=256,r=52,s=k.createClass({displayName:'MercuryStickerPackFlyout',propTypes:{packID:j.number.isRequired},getInitialState:function(){return {stickers:[]};},componentDidMount:function(){this.requestStickers();},componentDidUpdate:function(t){if(t.packID!==this.props.packID)this.requestStickers();},getScaledDimensions:function(t,u){var v,w,x;if(u>t){x=r/u;v=t*x;w=u*x;}else{x=r/t;v=t*x;w=u*x;}return {height:Math.round(v),width:Math.round(w)};},requestStickers:function(){new g().setURI('/ajax/messaging/stickers/flyout').setMethod("POST").setData({packID:this.props.packID}).setHandler(function(t){this.setState({stickers:t.payload.stickerData});}.bind(this)).send();},renderStickers:function(){var t=this.state.stickers.map(function(u){var v=this.getScaledDimensions(u.height,u.width);return (o(null,k.DOM.div({className:"_55bp",'data-id':u.id},l({animationTrigger:"hover",className:"_55bx",frameCount:u.frameCount,frameRate:u.frameRate||83,framesPerCol:u.framesPerCol,framesPerRow:u.framesPerRow,sourceHeight:v.height,sourceURI:u.sourceURI,sourceWidth:v.width,spriteURI:u.spriteURI,style:{cursor:'pointer'}}))));}.bind(this));return t;},render:function(){if(this.state.stickers.length===0)return (m({className:"_5905"}));return (i({height:p,width:q,fade:true},k.DOM.div({className:"_5bo4"},h({cols:4,fixed:true},this.renderStickers()))));}});e.exports=s;});
__d("MercuryStickersFlyoutList.react",["Animation","React","Image.react","cx","fbt","ix"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('React'),i=b('Image.react'),j=b('cx'),k=b('fbt'),l=b('ix'),m=5,n="Sticker Store",o=h.createClass({displayName:'MercuryStickersFlyoutList',_calculateNumPages:function(q){return Math.max(1,Math.ceil((q.length-1)/m));},getInitialState:function(){return {animating:false,selectedId:this.props.packs[0].id,page:0,numPages:this._calculateNumPages(this.props.packs)};},componentWillReceiveProps:function(q){this.setState({numPages:this._calculateNumPages(q.packs)});},shouldComponentUpdate:function(q,r){return !r.animating;},_canGoPrev:function(){return this.state.page>0;},_canGoNext:function(){return this.state.page+1<this.state.numPages;},_setPage:function(q){if(this.state.animating)return;this.setState({animating:true,page:q});var r=this.refs.positioner.getDOMNode();new g(r).to('marginLeft',-r.childNodes[q].offsetLeft+'px').ondone(function(){this.setState({animating:false});}.bind(this)).duration(200).go();},_back:function(){this._canGoPrev()&&this._setPage(this.state.page-1);},_next:function(){this._canGoNext()&&this._setPage(this.state.page+1);},render:function(){var q=this.props.packs,r=this.props.onPackClick,s=[];q.forEach(function(y,z){s.push(p({key:y.id,onClick:function(){r&&r(y.id);this.setState({selectedId:y.id});}.bind(this),pack:y,selected:this.state.selectedId===y.id}));}.bind(this));var t=[],u=[];s.forEach(function(y,z){u.push(y);if(z>0&&(z%m===0||z===s.length-1)){t.push(h.DOM.div({className:"_58_z"},u));u=[];}});var v=(("_58_w")+(' '+"lfloat")+(!this._canGoPrev()?' '+"hidden_elem":'')),w=(("_58_x")+(' '+"rfloat")+(!this._canGoNext()?' '+"hidden_elem":'')),x;if(t.length>1)x=h.DOM.a({className:w,onClick:this._next},i({className:"_590q",src:l('/images/messaging/stickers/selector/rightarrow.png')}));return (h.DOM.div({className:"_5908"},h.DOM.a({ajaxify:"/ajax/messaging/stickers/store",'aria-label':n,className:"_59wb rfloat",'data-hover':"tooltip",ref:"store",rel:"dialog"},i({className:"_5bo3",src:l('/images/messaging/stickers/selector/store.png')})),h.DOM.a({className:v,onClick:this._back},i({className:"_590q",src:l('/images/messaging/stickers/selector/leftarrow.png')})),x,h.DOM.div({className:"_590r"},h.DOM.div({className:"_58_y",ref:"positioner"},t))));}}),p=h.createClass({displayName:'PackIcon',render:function(){var q=this.props.pack,r=(("_55bn")+(this.props.selected?' '+"_55bo":''));return (h.DOM.a({'aria-label':q.name,className:r,'data-id':q.id,'data-hover':"tooltip",onClick:function(){this.props.onClick&&this.props.onClick(q.id);}.bind(this),tabIndex:"0"},h.DOM.img({className:"_55bw",src:q.icon}),h.DOM.img({className:"_590u",src:q.selectedIcon})));}});e.exports=o;});
__d("ReactLayer",["React","ReactComponent","ReactEventEmitter","ReactMount","emptyFunction","getObjectValues","invariant","merge","mixInto"],function(a,b,c,d,e,f){var g=b('React'),h=b('ReactComponent'),i=b('ReactEventEmitter'),j=b('ReactMount'),k=b('emptyFunction'),l=b('getObjectValues'),m=b('invariant'),n=b('merge'),o=b('mixInto'),p={immutableProps:{},getDefaultEnabledBehaviors:function(){return {};},createLayer:null,receiveProps:null,mountComponent:function(t,u){h.Mixin.mountComponent.call(this,t,u);this.reactContent=this.wrapReactContent(this.props.children);return this.reactContent.mountComponent(t,u);},unmountComponent:function(){h.Mixin.unmountComponent.call(this);this.reactContent.unmountComponent();this.reactContent=null;},mountLayer:function(){if(this.constructor.propTypes)this._assertValidProps(this.props);this.container=document.createElement('div');j.renderComponent(this,this.container);this.layer=this.createLayer(this.container);m(this.layer);this.layerSubscriptions=[];this.layerSubscribe(['show','hide'],function(t){this.props.onToggle&&this.props.onToggle(t==='show');}.bind(this));},setProps:function(t){this.replaceProps(n(this.props,t));},replaceProps:function(t){if(this.constructor.propTypes)this._assertValidProps(t);var u;for(u in this.immutableProps)m(this.props[u]===t[u]);var v=this.reactContent,w=this.wrapReactContent(t.children);v.replaceProps(w.props);this.receiveProps(t);this.props=t;},enumerateBehaviors:function(t){t=this.getEffectiveBehaviors(t);return l(t).filter(k.thatReturnsArgument);},updateBehaviors:function(t){var u=this.getEffectiveBehaviors(this.props.behaviors),v=this.getEffectiveBehaviors(t),w;for(w in u)if(!v[w])this.layer.disableBehavior(u[w]);for(w in v){var x=u[w],y=v[w];if(x&&y){m(x===y);continue;}x&&this.layer.disableBehavior(x);y&&this.layer.enableBehavior(y);}},getEffectiveBehaviors:function(t){return n(this.getDefaultEnabledBehaviors(),t);},unmountLayer:function(){this.unmountComponent();this.layer.destroy();this.layer=null;this.container.innerHTML='';while(this.layerSubscriptions.length)this.layerSubscriptions.pop().unsubscribe();},layerSubscribe:function(t,u){this.layerSubscriptions.push(this.layer.subscribe(t,function(v,w){i.isEnabled()&&u(v,w);}));},getNodeForOwnerRef:function(t){var u=this.getSiblingByRef(t);return u&&u.getDOMNode();},wrapReactContent:function(t){return g.DOM.div(null,t);},_assertValidProps:function(t){var u=this.constructor.displayName,v=this.constructor.propTypes;for(var w in v){var x=v[w];if(x)x(t,w,u);}}},q={displayName:function(t,u){t.displayName=u;},mixins:function(t,u){if(u)for(var v=0;v<u.length;v++)r(t,u[v]);},propTypes:function(t,u){t.propTypes=u;}};function r(t,u){var v=t.prototype;for(var w in u)if(u.hasOwnProperty(w)){var x=u[w];if(q.hasOwnProperty(w)){q[w](t,x);}else v[w]=x;}}var s={createClass:function(t){var u=function(){};o(u,h.Mixin);o(u,p);r(u,t);var v=function(w,x){var y=new u();y.construct.apply(y,arguments);return y;};v.componentConstructor=u;v.originalSpec=t;return v;}};e.exports=s;});
__d("Spotlight.react",["LayerHideOnBlur","LayerHideOnEscape","ReactLayer","Spotlight"],function(a,b,c,d,e,f){var g=b('LayerHideOnBlur'),h=b('LayerHideOnEscape'),i=b('ReactLayer'),j=b('Spotlight'),k=i.createClass({getDefaultEnabledBehaviors:function(){return {hideOnBlur:g,hideOnEscape:h};},createLayer:function(l){var m=this.enumerateBehaviors(this.props.behaviors),n={addedBehaviors:m},o=new j(n,l);o.conditionShow(this.props.shown);if(this.props.onHide)o.subscribe('hide',this.props.onHide);return o;},receiveProps:function(l){this.layer.conditionShow(l.shown);}});e.exports=k;});
__d("GraphQLQuery",["createObjectFrom"],function(a,b,c,d,e,f){var g=b("createObjectFrom");function h(){}h.prototype.addField=function(l){if(this.fieldSet){this.fieldSet.fields.push(l);}else this.fieldSet=new k.FieldSet([l]);};h.prototype.addFields=function(l){l.forEach(this.addField,this);};for(var i in h)if(h.hasOwnProperty(i))k[i]=h[i];var j=h===null?null:h.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=h;function k(l,m){this.rootCall=l;this.fieldSet=m;}k.prototype.toString=function(){return (this.rootCall||'')+(this.fieldSet||'');};k.Call=(function(){function l(m,n){this.name=m;this.args=n||[];}l.prototype.toString=function(){return this.name+'('+this.args.join(',')+')';};return l;})();k.CallValue=(function(){function l(m){this.callValue=m;}l.prototype.toString=function(){return this.callValue.replace(/[)(}{><,.\\]/g,'\\$&');};return l;})();k.CallVariable=(function(){function l(m){this.callVariableName=m;}l.prototype.toString=function(){return '<'+this.callVariableName+'>';};return l;})();k.Field=(function(){for(i in h)if(h.hasOwnProperty(i))l[i]=h[i];l.prototype=Object.create(j);l.prototype.constructor=l;l.__superConstructor__=h;function l(m,n,o,p,q){this.name=p||m;this.fieldName=m;this.calls=n||[];this.fieldSet=o;this.alias=p;this.condition=q;}l.prototype.toString=function(){var m='';if(this.condition)m+=this.condition+'?';m+=this.fieldName;if(this.calls.length!==0)m+='.'+this.calls.join('.');if(this.alias)m+=' as '+this.alias;if(this.fieldSet)m+=this.fieldSet;return m;};l.prototype.addCall=function(m){this.calls.push(m);};l.prototype.removeCalls=function(m){var n=g(m),o=[];for(var p=0;p<this.calls.length;p++)if(!n[this.calls[p].name])o.push(this.calls[p]);this.calls=o;};return l;})();k.FieldSet=(function(){function l(m){this.fields=m||[];}l.prototype.toString=function(){return '{'+this.fields.join(',')+'}';};return l;})();e.exports=k;});
__d("GraphQLParser",["GraphQLQuery"],function(a,b,c,d,e,f){var g=b("GraphQLQuery");function h(k){this.queryString=k;this.queryLength=k.length;this.index=-1;this.character=null;this.next();}h.prototype.error=function(k){throw new h.SyntaxError(this.queryString,this.index,k);};h.prototype.next=function(k){if(k&&k!==this.character)this.error('Expected "'+k+'" instead of "'+this.character+'".');this.index++;if(this.index>this.queryLength){this.error('Expected another character, but at end of string.');}else this.character=this.index===this.queryLength?null:this.queryString[this.index];};h.prototype.end=function(){if(this.character)this.error('Expected end of string instead of '+this.character+'.');};h.prototype.whitespace=function(){while(this.character===' '||this.character==='\t'||this.character==='\r'||this.character==='\n')this.next();};h.prototype.query=function(k){var l=null;if(k){l=new g.Call(this.name(),this.callArguments());this.whitespace();}var m=null;if(this.character==='{')m=this.fieldSet();return new g(l,m);};h.prototype.name=function(){var k=this.index;if(this.character===':')this.error('Name cannot begin with :');while(i(this.character))this.next();if(this.index===k)this.error('Expected name.');return this.queryString.substr(k,this.index-k);};h.prototype.fieldSet=function(){var k=[];this.next('{');this.whitespace();k.push(this.field());this.whitespace();while(this.character===','){this.next(',');this.whitespace();k.push(this.field());this.whitespace();}this.next('}');return new g.FieldSet(k);};h.prototype.field=function(){var k,l,m=this.name();this.whitespace();if(this.character==='?'){this.next('?');this.whitespace();k=this.name();l=m;}else k=m;this.whitespace();var n=this.calls(),o;if(this.character==='a'){this.next('a');this.next('s');this.whitespace();o=this.name();}this.whitespace();var p;if(this.character==='{')p=this.fieldSet();return new g.Field(k,n,p,o,l);};h.prototype.calls=function(){var k=[];while(this.character==='.'){this.next('.');this.whitespace();k.push(new g.Call(this.name(),this.callArguments()));this.whitespace();}return k;};h.prototype.callArguments=function(){this.next('(');this.whitespace();var k=[];if(this.character!==')'){k.push(this.callArgument());while(this.character===','){this.next(',');this.whitespace();k.push(this.callArgument());}}this.next(')');return k;};h.prototype.callArgument=function(){return this.character==='<'?this.callVariable():this.callValue();};h.prototype.callVariable=function(){this.next('<');var k=this.name();this.next('>');return new g.CallVariable(k);};h.prototype.callValue=function(){var k=this.index,l=false;while(j(this.character)){if(this.character==='\\'){this.next();l=true;}this.next();}if(this.index===k)this.error('Expected call value.');var m=this.index-k,n=this.queryString.substr(k,m);n=n.replace(/\s+$/,'');if(l)for(var o=0;o<m;++o)if(n[o]==='\\'){n=n.substr(0,o)+n.substr(o+1);--m;}return new g.CallValue(n);};h.SyntaxError=(function(){for(var k in Error)if(Error.hasOwnProperty(k))m[k]=Error[k];var l=Error===null?null:Error.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=Error;function m(n,o,p){this.queryString=n;this.character=o;this.parserError=p;this.message='Syntax error "'+p+'" at character '+o+' in query: '+n;}return m;})();function i(k){if(k===null)return false;return k==='_'||k===':'||k==='-'||(k>='0'&&k<='9')||(k>='A'&&k<='Z')||(k>='a'&&k<='z');}function j(k){if(k===null)return false;return k!='('&&k!=')'&&k!='{'&&k!='}'&&k!='<'&&k!='>'&&k!='.'&&k!=',';}h.parseQuery=function(k){var l=new h(k);l.whitespace();var m=l.query(true);l.whitespace();l.end();return m;};h.parseRootlessQuery=function(k){var l=new h(k);l.whitespace();var m=l.query(false);l.whitespace();l.end();return m;};e.exports=h;});
__d("PagedQuery",["GraphQLParser","GraphQLQuery","keyOf"],function(a,b,c,d,e,f){var g=b("GraphQLParser"),h=b("GraphQLQuery"),i=b("keyOf");function j(k,l){this.$PagedQuery0=k;this.$PagedQuery1=l;}j.prototype.$PagedQuery2=function(){var k=this.findFieldByPath(this.$PagedQuery0);k.removeCalls(['find','after','before','first','last']);return k;};j.prototype.$PagedQuery3=function(k,l,m){var n=this.$PagedQuery2(),o=m?'after':'before';n.addCall(new h.Call(o,[k]));var p=m?'first':'last';n.addCall(new h.Call(p,[l]));return this.$PagedQuery0.toString();};j.prototype.$PagedQuery4=function(k){if(i(this.$PagedQuery1[k])==='node')return 'node';return this.$PagedQuery1[k];};j.prototype.$PagedQuery5=function(k){var l=i(this.$PagedQuery1[k]);if(l==='node')return this.$PagedQuery1[k].node;return this.$PagedQuery1[k];};j.prototype.pageAfterQueryString=function(k,l){return this.$PagedQuery3(k,l,true);};j.prototype.pageBeforeQueryString=function(k,l){return this.$PagedQuery3(k,l,false);};j.prototype.pageFirstQueryString=function(k){var l=this.$PagedQuery2();l.addCall(new h.Call('first',[k]));return this.$PagedQuery0.toString();};j.prototype.pageLastQueryString=function(k){var l=this.$PagedQuery2();l.addCall(new h.Call('last',[k]));return this.$PagedQuery0.toString();};j.prototype.findFieldByPath=function(k){var l=k,m=this.$PagedQuery4(0);if(k.rootCall.name!=m)throw new Error("Query path does not match root query at top node, "+"expected "+m+", "+"found "+k.name+" instead.");for(var n=1;n<this.$PagedQuery1.length;n++){var o=l.fieldSet.fields,p=false,q=this.$PagedQuery4(n);for(var r=0;r<o.length;r++)if(o[r].fieldName==q){l=o[r];p=true;break;}if(!p)throw new Error("Query path does not match query structure at location "+n+", "+"expected "+q+", "+"not located in "+o);}return l;};j.prototype.findDataByPath=function(k){var l=k;for(var m=0;m<this.$PagedQuery1.length;m++){var n=this.$PagedQuery5(m);if(!l||!l[n])throw new Error("Query path does not match payload at location "+m+", "+"expected "+n);l=l[n];}return l;};j.constructFromPath=function(k,l){return new j(g.parseQuery(k),l);};e.exports=j;});
__d("PagedQueryCacheCore",["KeyedCallbackManager","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b("KeyedCallbackManager"),h=b("copyProperties"),i=b("emptyFunction");function j(k,l,m,n){this.$PagedQueryCacheCore0=k;this.$PagedQueryCacheCore1=l;this.$PagedQueryCacheCore2=h({enableLooping:false},n);var o=this.$PagedQueryCacheCore1.findDataByPath(m),p=o.edges;this.$PagedQueryCacheCore3=o.page_info;this.$PagedQueryCacheCore4=new g();this.$PagedQueryCacheCore5={};this.$PagedQueryCacheCore6={};this.$PagedQueryCacheCore7={};this.$PagedQueryCacheCore8=0;this.$PagedQueryCacheCore9=0;this.$PagedQueryCacheCorea={};this.$PagedQueryCacheCoreb(p,0);if(this.$PagedQueryCacheCore2.allDataLoaded)this.$PagedQueryCacheCorec();}j.prototype.$PagedQueryCacheCoreb=function(k,l){var m={},n=false;for(var o=0;o<k.length;o++){if(this.hasLooped())break;var p=l+o,q=k[o].cursor,r=k[o].node,s=this.$PagedQueryCacheCore5[q];if(this.$PagedQueryCacheCore2.enableLooping&&s!==undefined){n=true;continue;}var t=this.$PagedQueryCacheCore4.getResource(p);if(t!==undefined&&t!=q)throw new Error('Attempting to add cursor '+q+' at location '+p+' which already contains cursor '+t);this.$PagedQueryCacheCore7[r.id]=q;this.$PagedQueryCacheCore6[q]=r;m[p]=q;this.$PagedQueryCacheCore5[q]=p;this.$PagedQueryCacheCore8=Math.min(p,this.$PagedQueryCacheCore8);this.$PagedQueryCacheCore9=Math.max(p,this.$PagedQueryCacheCore9);}if(n)this.$PagedQueryCacheCorec();this.$PagedQueryCacheCore4.addResourcesAndExecute(m);};j.prototype.getItemsAfterCursor=function(k,l,m){return this.$PagedQueryCacheCored(k,l,true,m);};j.prototype.getItemsBeforeCursor=function(k,l,m){return this.$PagedQueryCacheCored(k,l,false,m);};j.prototype.$PagedQueryCacheCoree=function(k){if(!this.hasLooped())return k;var l=this.$PagedQueryCacheCoref.end-this.$PagedQueryCacheCoref.start+1;while(k<this.$PagedQueryCacheCoref.start||k>this.$PagedQueryCacheCoref.end)if(k<this.$PagedQueryCacheCoref.start){k+=l;}else k-=l;return k;};j.prototype.$PagedQueryCacheCored=function(k,l,m,n){var o=this.$PagedQueryCacheCoreg(k);if(!m)o=o-l-1;var p=[];for(var q=1;q<=l;q++)p.push(this.$PagedQueryCacheCoree(o+q));var r=this.$PagedQueryCacheCore4.getUnavailableResourcesFromRequest(p);if(r.length){r=this.$PagedQueryCacheCoreh(r);if(!r.length)return;var s;if(m){if(this.$PagedQueryCacheCore2.enableLooping&&!this.hasNextPage(k)){s=this.$PagedQueryCacheCore1.pageFirstQueryString(l);}else s=this.$PagedQueryCacheCore1.pageAfterQueryString(k,l);}else if(this.$PagedQueryCacheCore2.enableLooping&&!this.hasPreviousPage(k)){s=this.$PagedQueryCacheCore1.pageLastQueryString(l);}else s=this.$PagedQueryCacheCore1.pageBeforeQueryString(k,l);for(var t=0;t<r.length;++t)this.$PagedQueryCacheCorea[r[t]]=true;this.$PagedQueryCacheCorei&&this.$PagedQueryCacheCorei();this.$PagedQueryCacheCore0(s,this.$PagedQueryCacheCore1,r,m?this.$PagedQueryCacheCore2.first_query:this.$PagedQueryCacheCore2.last_query,this.$PagedQueryCacheCore2.persistent_params,this.$PagedQueryCacheCorej.bind(this));}var u=function(v){var w=[];for(var x=0;x<l;x++)w.push(this.$PagedQueryCacheCore6[v[p[x]]]);return w;}.bind(this);return this.$PagedQueryCacheCore4.deferredExecuteOrEnqueue(p).then(u).addCallback(n,this);};j.prototype.$PagedQueryCacheCorej=function(){this.$PagedQueryCacheCorek.apply(this,arguments);};j.prototype.$PagedQueryCacheCoreg=function(k){var l=this.$PagedQueryCacheCore5[k];if(l===undefined)throw new Error("Cursor not found: the request can still be made but the result "+"would not link to the existing data");return l;};j.prototype.setPayloadCallback=function(k){this.$PagedQueryCacheCorek=k;};j.prototype.updateData=function(k){var l=this.$PagedQueryCacheCore1.findDataByPath(k.query_results),m=l&&l.edges;if(!m)return;for(var n=0;n<m.length;++n)this.$PagedQueryCacheCore6[m[n].cursor]=m[n].node;};j.prototype.addData=function(k){var l=false,m=null,n=0;for(var o in k.query_params){if(o=='after'||o=='before')m=k.query_params[o];if(o=='first'||o=='last'){l=(o=='first');n=k.query_params[o];}}if(this.$PagedQueryCacheCore2.enableLooping&&!m)m=l?this.$PagedQueryCacheCore3.end_cursor:this.$PagedQueryCacheCore3.start_cursor;if(!m||this.$PagedQueryCacheCore5[m]===undefined)return;var p=this.$PagedQueryCacheCore5[m],q=this.$PagedQueryCacheCore1.findDataByPath(k.query_results);if(!q.edges.length){this.$PagedQueryCacheCorel(k.requested_indices);if(l){this.$PagedQueryCacheCore3.has_next_page=false;this.$PagedQueryCacheCore2.enableLooping&&this.getItemsAfterCursor(m,n,i);}else{this.$PagedQueryCacheCore3.has_previous_page=false;this.$PagedQueryCacheCore2.enableLooping&&this.getItemsBeforeCursor(m,n,i);}return;}var r;if(l){r=p+1;this.$PagedQueryCacheCore3.end_cursor=q.page_info.end_cursor;this.$PagedQueryCacheCore3.has_next_page=q.page_info.has_next_page;}else{r=p-q.edges.length;this.$PagedQueryCacheCore3.start_cursor=q.page_info.start_cursor;this.$PagedQueryCacheCore3.has_previous_page=q.page_info.has_previous_page;}this.$PagedQueryCacheCoreb(q.edges,r);this.$PagedQueryCacheCorel(k.requested_indices);};j.prototype.hasNextPage=function(k){var l=this.$PagedQueryCacheCoreg(k);if(this.$PagedQueryCacheCore4.getResource(l+1)){return true;}else if(k==this.$PagedQueryCacheCore3.end_cursor){return this.$PagedQueryCacheCore3.has_next_page;}else throw new Error('hasNextPage called on unknown cursor');};j.prototype.hasPreviousPage=function(k){var l=this.$PagedQueryCacheCoreg(k);if(this.$PagedQueryCacheCore4.getResource(l-1)){return true;}else if(k==this.$PagedQueryCacheCore3.start_cursor){return this.$PagedQueryCacheCore3.has_previous_page;}else throw new Error('hasPreviousPage called on unknown cursor');};j.prototype.hasLooped=function(){return this.$PagedQueryCacheCore2.enableLooping&&this.$PagedQueryCacheCoref;};j.prototype.getItemAtIndex=function(k,l){k=this.$PagedQueryCacheCoree(k);var m=function(n){l(this.$PagedQueryCacheCore6[n[k]]);}.bind(this);this.$PagedQueryCacheCore4.deferredExecuteOrEnqueue([k]).addCallback(m,this);};j.prototype.getItemAtIndexImmediate=function(k){k=this.$PagedQueryCacheCoree(k);var l=this.$PagedQueryCacheCore4.getResource(k),m;if(l)m=this.$PagedQueryCacheCore6[l];return m;};j.prototype.getAvailableRange=function(){var k=this.$PagedQueryCacheCoreg(this.$PagedQueryCacheCore3.start_cursor),l=this.$PagedQueryCacheCoreg(this.$PagedQueryCacheCore3.end_cursor);return {offset:k,length:l-k+1};};j.prototype.getCursorForID=function(k){return this.$PagedQueryCacheCore7[k];};j.prototype.getIndexForID=function(k){var l=this.getCursorForID(k);return (l!==undefined)?this.$PagedQueryCacheCore5[l]:undefined;};j.prototype.$PagedQueryCacheCorel=function(k){if(k)for(var l=0;l<k.length;++l)delete(this.$PagedQueryCacheCorea[k[l]]);};j.prototype.$PagedQueryCacheCoreh=function(k){if(!this.$PagedQueryCacheCorea)return k;var l=[];for(var m=0;m<k.length;++m)if(!this.$PagedQueryCacheCorea[k[m]])l.push(k[m]);return l;};j.prototype.$PagedQueryCacheCorec=function(){this.$PagedQueryCacheCoref={start:this.$PagedQueryCacheCore8,end:this.$PagedQueryCacheCore9};};j.prototype.setPreFetchCallback=function(k){this.$PagedQueryCacheCorei=k;};e.exports=j;});
__d("ReactLayeredComponentMixin",["ReactCurrentOwner"],function(a,b,c,d,e,f){var g=b('ReactCurrentOwner'),h={componentWillMount:function(){this._renderedLayers={};},componentDidMount:function(){this._updateLayers();},componentDidUpdate:function(){this._updateLayers();},componentWillUnmount:function(){var i=this._renderedLayers;for(var j in i)if(i.hasOwnProperty(j)){i[j]&&i[j].unmountLayer();delete this._renderedLayers[j];}delete this._renderedLayers;},_updateLayers:function(){var i=this._renderedLayers;g.current=this;var j=this.renderLayers()||{};g.current=null;var k;for(k in j){var l=j[k];if(l&&j.hasOwnProperty(k)){var m=i.hasOwnProperty(k)?i[k]:null;if(m&&m.constructor===l.constructor){m.replaceProps(l.props);}else{if(m)m.unmountLayer();l.mountLayer();this._renderedLayers[k]=l;}}}for(k in i)if(i.hasOwnProperty(k)&&(!j.hasOwnProperty(k)||!j[k])){i[k]&&i[k].unmountLayer();delete this._renderedLayers[k];}}};e.exports=h;});
__d("StanfordCrypto",[],function(global,require,requireDynamic,requireLazy,module,exports) {/**
 * @generated SignedSource<<72537bc063e40aff1d3c305140ab943e>>
 * 
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 * !! This file is a check-in of a static_upstream project!      !!
 * !!                                                            !!
 * !! You should not modify this file directly. Instead:         !!
 * !! 1) Use `fjs use-upstream` to temporarily replace this with !!
 * !!    the latest version from upstream.                       !!
 * !! 2) Make your changes, test them, etc.                      !!
 * !! 3) Use `fjs push-upstream` to copy your changes back to    !!
 * !!    static_upstream.                                        !!
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 * 
 * @providesModule StanfordCrypto
 *
 * @preserve-whitespace
 */

"use strict";var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};
if(typeof module!="undefined"&&module.exports)module.exports=sjcl;
sjcl.cipher.aes=function(a){this.i[0][0][0]||this.B();var b,c,d,e,f=this.i[0][4],g=this.i[1];b=a.length;var h=1;if(b!==4&&b!==6&&b!==8)throw new sjcl.exception.invalid("invalid aes key size");this.a=[d=a.slice(0),e=[]];for(a=b;a<4*b+28;a++){c=d[a-1];if(a%b===0||b===8&&a%b===4){c=f[c>>>24]<<24^f[c>>16&255]<<16^f[c>>8&255]<<8^f[c&255];if(a%b===0){c=c<<8^c>>>24^h<<24;h=h<<1^(h>>7)*283}}d[a]=d[a-b]^c}for(b=0;a;b++,a--){c=d[b&3?a:a-4];e[b]=a<=4||b<4?c:g[0][f[c>>>24]]^g[1][f[c>>16&255]]^g[2][f[c>>8&255]]^
g[3][f[c&255]]}};
sjcl.cipher.aes.prototype={encrypt:function(a){return this.K(a,0)},decrypt:function(a){return this.K(a,1)},i:[[[],[],[],[],[]],[[],[],[],[],[]]],B:function(){var a=this.i[0],b=this.i[1],c=a[4],d=b[4],e,f,g,h=[],i=[],j,k,l,m;for(e=0;e<0x100;e++)i[(h[e]=e<<1^(e>>7)*283)^e]=e;for(f=g=0;!c[f];f^=j||1,g=i[g]||1){l=g^g<<1^g<<2^g<<3^g<<4;l=l>>8^l&255^99;c[f]=l;d[l]=f;k=h[e=h[j=h[f]]];m=k*0x1010101^e*0x10001^j*0x101^f*0x1010100;k=h[l]*0x101^l*0x1010100;for(e=0;e<4;e++){a[e][f]=k=k<<24^k>>>8;b[e][l]=m=m<<24^m>>>8}}for(e=
0;e<5;e++){a[e]=a[e].slice(0);b[e]=b[e].slice(0)}},K:function(a,b){if(a.length!==4)throw new sjcl.exception.invalid("invalid aes block size");var c=this.a[b],d=a[0]^c[0],e=a[b?3:1]^c[1],f=a[2]^c[2];a=a[b?1:3]^c[3];var g,h,i,j=c.length/4-2,k,l=4,m=[0,0,0,0];g=this.i[b];var n=g[0],o=g[1],p=g[2],q=g[3],r=g[4];for(k=0;k<j;k++){g=n[d>>>24]^o[e>>16&255]^p[f>>8&255]^q[a&255]^c[l];h=n[e>>>24]^o[f>>16&255]^p[a>>8&255]^q[d&255]^c[l+1];i=n[f>>>24]^o[a>>16&255]^p[d>>8&255]^q[e&255]^c[l+2];a=n[a>>>24]^o[d>>16&
255]^p[e>>8&255]^q[f&255]^c[l+3];l+=4;d=g;e=h;f=i}for(k=0;k<4;k++){m[b?3&-k:k]=r[d>>>24]<<24^r[e>>16&255]<<16^r[f>>8&255]<<8^r[a&255]^c[l++];g=d;d=e;e=f;f=a;a=g}return m}};
sjcl.bitArray={bitSlice:function(a,b,c){a=sjcl.bitArray.Q(a.slice(b/32),32-(b&31)).slice(1);return c===undefined?a:sjcl.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d=Math.floor(-b-c&31);return((b+c-1^b)&-32?a[b/32|0]<<32-d^a[b/32+1|0]>>>d:a[b/32|0]>>>d)&(1<<c)-1},concat:function(a,b){if(a.length===0||b.length===0)return a.concat(b);var c=a[a.length-1],d=sjcl.bitArray.getPartial(c);return d===32?a.concat(b):sjcl.bitArray.Q(b,d,c|0,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;
if(b===0)return 0;return(b-1)*32+sjcl.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(a.length*32<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;b&=31;if(c>0&&b)a[c-1]=sjcl.bitArray.partial(b,a[c-1]&2147483648>>b-1,1);return a},partial:function(a,b,c){if(a===32)return b;return(c?b|0:b<<32-a)+a*0x10000000000},getPartial:function(a){return Math.round(a/0x10000000000)||32},equal:function(a,b){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(b))return false;var c=0,d;for(d=0;d<a.length;d++)c|=
a[d]^b[d];return c===0},Q:function(a,b,c,d){var e;e=0;if(d===undefined)d=[];for(;b>=32;b-=32){d.push(c);c=0}if(b===0)return d.concat(a);for(e=0;e<a.length;e++){d.push(c|a[e]>>>b);c=a[e]<<32-b}e=a.length?a[a.length-1]:0;a=sjcl.bitArray.getPartial(e);d.push(sjcl.bitArray.partial(b+a&31,b+a>32?c:d.pop(),1));return d},j:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]}};
sjcl.codec.utf8String={fromBits:function(a){var b="",c=sjcl.bitArray.bitLength(a),d,e;for(d=0;d<c/8;d++){if((d&3)===0)e=a[d/4];b+=String.fromCharCode(e>>>24);e<<=8}return decodeURIComponent(escape(b))},toBits:function(a){a=unescape(encodeURIComponent(a));var b=[],c,d=0;for(c=0;c<a.length;c++){d=d<<8|a.charCodeAt(c);if((c&3)===3){b.push(d);d=0}}c&3&&b.push(sjcl.bitArray.partial(8*(c&3),d));return b}};
sjcl.codec.hex={fromBits:function(a){var b="",c;for(c=0;c<a.length;c++)b+=((a[c]|0)+0xf00000000000).toString(16).substr(4);return b.substr(0,sjcl.bitArray.bitLength(a)/4)},toBits:function(a){var b,c=[],d;a=a.replace(/\s|0x/g,"");d=a.length;a+="00000000";for(b=0;b<a.length;b+=8)c.push(parseInt(a.substr(b,8),16)^0);return sjcl.bitArray.clamp(c,d*4)}};
sjcl.codec.base64={H:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d="",e=0,f=sjcl.codec.base64.H,g=0,h=sjcl.bitArray.bitLength(a);if(c)f=f.substr(0,62)+"-_";for(c=0;d.length*6<h;){d+=f.charAt((g^a[c]>>>e)>>>26);if(e<6){g=a[c]<<6-e;e+=26;c++}else{g<<=6;e-=6}}for(;d.length&3&&!b;)d+="=";return d},toBits:function(a,b){a=a.replace(/\s|=/g,"");var c=[],d=0,e=sjcl.codec.base64.H,f=0,g;if(b)e=e.substr(0,62)+"-_";for(b=0;b<a.length;b++){g=e.indexOf(a.charAt(b));
if(g<0)throw new sjcl.exception.invalid("this isn't base64!");if(d>26){d-=26;c.push(f^g>>>d);f=g<<32-d}else{d+=6;f^=g<<32-d}}d&56&&c.push(sjcl.bitArray.partial(d&56,f,1));return c}};sjcl.codec.base64url={fromBits:function(a){return sjcl.codec.base64.fromBits(a,1,1)},toBits:function(a){return sjcl.codec.base64.toBits(a,1)}};sjcl.hash.sha256=function(a){this.a[0]||this.B();if(a){this.p=a.p.slice(0);this.k=a.k.slice(0);this.f=a.f}else this.reset()};sjcl.hash.sha256.hash=function(a){return(new sjcl.hash.sha256).update(a).finalize()};
sjcl.hash.sha256.prototype={blockSize:512,reset:function(){this.p=this.O.slice(0);this.k=[];this.f=0;return this},update:function(a){if(typeof a==="string")a=sjcl.codec.utf8String.toBits(a);var b,c=this.k=sjcl.bitArray.concat(this.k,a);b=this.f;a=this.f=b+sjcl.bitArray.bitLength(a);for(b=512+b&-512;b<=a;b+=512)this.G(c.splice(0,16));return this},finalize:function(){var a,b=this.k,c=this.p;b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)]);for(a=b.length+2;a&15;a++)b.push(0);b.push(Math.floor(this.f/
4294967296));for(b.push(this.f|0);b.length;)this.G(b.splice(0,16));this.reset();return c},O:[],a:[],B:function(){function a(e){return(e-Math.floor(e))*0x100000000|0}var b=0,c=2,d;a:for(;b<64;c++){for(d=2;d*d<=c;d++)if(c%d===0)continue a;if(b<8)this.O[b]=a(Math.pow(c,0.5));this.a[b]=a(Math.pow(c,1/3));b++}},G:function(a){var b,c,d=a.slice(0),e=this.p,f=this.a,g=e[0],h=e[1],i=e[2],j=e[3],k=e[4],l=e[5],m=e[6],n=e[7];for(a=0;a<64;a++){if(a<16)b=d[a];else{b=d[a+1&15];c=d[a+14&15];b=d[a&15]=(b>>>7^b>>>18^
b>>>3^b<<25^b<<14)+(c>>>17^c>>>19^c>>>10^c<<15^c<<13)+d[a&15]+d[a+9&15]|0}b=b+n+(k>>>6^k>>>11^k>>>25^k<<26^k<<21^k<<7)+(m^k&(l^m))+f[a];n=m;m=l;l=k;k=j+b|0;j=i;i=h;h=g;g=b+(h&i^j&(h^i))+(h>>>2^h>>>13^h>>>22^h<<30^h<<19^h<<10)|0}e[0]=e[0]+g|0;e[1]=e[1]+h|0;e[2]=e[2]+i|0;e[3]=e[3]+j|0;e[4]=e[4]+k|0;e[5]=e[5]+l|0;e[6]=e[6]+m|0;e[7]=e[7]+n|0}};
sjcl.mode.ccm={name:"ccm",encrypt:function(a,b,c,d,e){var f,g=b.slice(0),h=sjcl.bitArray,i=h.bitLength(c)/8,j=h.bitLength(g)/8;e=e||64;d=d||[];if(i<7)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(f=2;f<4&&j>>>8*f;f++);if(f<15-i)f=15-i;c=h.clamp(c,8*(15-f));b=sjcl.mode.ccm.J(a,b,c,d,e,f);g=sjcl.mode.ccm.l(a,g,c,b,e,f);return h.concat(g.data,g.tag)},decrypt:function(a,b,c,d,e){e=e||64;d=d||[];var f=sjcl.bitArray,g=f.bitLength(c)/8,h=f.bitLength(b),i=f.clamp(b,h-e),j=f.bitSlice(b,
h-e);h=(h-e)/8;if(g<7)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(b=2;b<4&&h>>>8*b;b++);if(b<15-g)b=15-g;c=f.clamp(c,8*(15-b));i=sjcl.mode.ccm.l(a,i,c,j,e,b);a=sjcl.mode.ccm.J(a,i.data,c,d,e,b);if(!f.equal(i.tag,a))throw new sjcl.exception.corrupt("ccm: tag doesn't match");return i.data},J:function(a,b,c,d,e,f){var g=[],h=sjcl.bitArray,i=h.j;e/=8;if(e%2||e<4||e>16)throw new sjcl.exception.invalid("ccm: invalid tag length");if(d.length>0xffffffff||b.length>0xffffffff)throw new sjcl.exception.bug("ccm: can't deal with 4GiB or more data");
f=[h.partial(8,(d.length?64:0)|e-2<<2|f-1)];f=h.concat(f,c);f[3]|=h.bitLength(b)/8;f=a.encrypt(f);if(d.length){c=h.bitLength(d)/8;if(c<=65279)g=[h.partial(16,c)];else if(c<=0xffffffff)g=h.concat([h.partial(16,65534)],[c]);g=h.concat(g,d);for(d=0;d<g.length;d+=4)f=a.encrypt(i(f,g.slice(d,d+4).concat([0,0,0])))}for(d=0;d<b.length;d+=4)f=a.encrypt(i(f,b.slice(d,d+4).concat([0,0,0])));return h.clamp(f,e*8)},l:function(a,b,c,d,e,f){var g,h=sjcl.bitArray;g=h.j;var i=b.length,j=h.bitLength(b);c=h.concat([h.partial(8,
f-1)],c).concat([0,0,0]).slice(0,4);d=h.bitSlice(g(d,a.encrypt(c)),0,e);if(!i)return{tag:d,data:[]};for(g=0;g<i;g+=4){c[3]++;e=a.encrypt(c);b[g]^=e[0];b[g+1]^=e[1];b[g+2]^=e[2];b[g+3]^=e[3]}return{tag:d,data:h.clamp(b,j)}}};
sjcl.mode.ocb2={name:"ocb2",encrypt:function(a,b,c,d,e,f){if(sjcl.bitArray.bitLength(c)!==128)throw new sjcl.exception.invalid("ocb iv must be 128 bits");var g,h=sjcl.mode.ocb2.D,i=sjcl.bitArray,j=i.j,k=[0,0,0,0];c=h(a.encrypt(c));var l,m=[];d=d||[];e=e||64;for(g=0;g+4<b.length;g+=4){l=b.slice(g,g+4);k=j(k,l);m=m.concat(j(c,a.encrypt(j(c,l))));c=h(c)}l=b.slice(g);b=i.bitLength(l);g=a.encrypt(j(c,[0,0,0,b]));l=i.clamp(j(l.concat([0,0,0]),g),b);k=j(k,j(l.concat([0,0,0]),g));k=a.encrypt(j(k,j(c,h(c))));
if(d.length)k=j(k,f?d:sjcl.mode.ocb2.pmac(a,d));return m.concat(i.concat(l,i.clamp(k,e)))},decrypt:function(a,b,c,d,e,f){if(sjcl.bitArray.bitLength(c)!==128)throw new sjcl.exception.invalid("ocb iv must be 128 bits");e=e||64;var g=sjcl.mode.ocb2.D,h=sjcl.bitArray,i=h.j,j=[0,0,0,0],k=g(a.encrypt(c)),l,m,n=sjcl.bitArray.bitLength(b)-e,o=[];d=d||[];for(c=0;c+4<n/32;c+=4){l=i(k,a.decrypt(i(k,b.slice(c,c+4))));j=i(j,l);o=o.concat(l);k=g(k)}m=n-c*32;l=a.encrypt(i(k,[0,0,0,m]));l=i(l,h.clamp(b.slice(c),
m).concat([0,0,0]));j=i(j,l);j=a.encrypt(i(j,i(k,g(k))));if(d.length)j=i(j,f?d:sjcl.mode.ocb2.pmac(a,d));if(!h.equal(h.clamp(j,e),h.bitSlice(b,n)))throw new sjcl.exception.corrupt("ocb: tag doesn't match");return o.concat(h.clamp(l,m))},pmac:function(a,b){var c,d=sjcl.mode.ocb2.D,e=sjcl.bitArray,f=e.j,g=[0,0,0,0],h=a.encrypt([0,0,0,0]);h=f(h,d(d(h)));for(c=0;c+4<b.length;c+=4){h=d(h);g=f(g,a.encrypt(f(h,b.slice(c,c+4))))}b=b.slice(c);if(e.bitLength(b)<128){h=f(h,d(h));b=e.concat(b,[2147483648|0,0,
0,0])}g=f(g,b);return a.encrypt(f(d(f(h,d(h))),g))},D:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^(a[0]>>>31)*135]}};
sjcl.mode.gcm={name:"gcm",encrypt:function(a,b,c,d,e){var f=b.slice(0);b=sjcl.bitArray;e=e||128;d=d||[];a=sjcl.mode.gcm.l(true,a,f,d,c,e);return b.concat(a.data,a.tag)},decrypt:function(a,b,c,d,e){var f=b.slice(0),g=sjcl.bitArray,h=g.bitLength(f);e=e||128;d=d||[];if(e<=h){b=g.bitSlice(f,h-e);f=g.bitSlice(f,0,h-e)}else{b=f;f=[]}a=sjcl.mode.gcm.l(false,a,f,d,c,e);if(!g.equal(a.tag,b))throw new sjcl.exception.corrupt("gcm: tag doesn't match");return a.data},T:function(a,b){var c,d,e,f,g=sjcl.bitArray.j;
d=[0,0,0,0];e=b.slice(0);for(b=0;b<128;b++){if(c=(a[Math.floor(b/32)]&1<<31-b%32)!==0)d=g(d,e);f=(e[3]&1)!==0;for(c=3;c>0;c--)e[c]=e[c]>>>1|(e[c-1]&1)<<31;e[0]>>>=1;if(f)e[0]^=-0x1f000000}return d},e:function(a,b,c){var d,e=c.length;b=b.slice(0);for(d=0;d<e;d+=4){b[0]^=0xffffffff&c[d];b[1]^=0xffffffff&c[d+1];b[2]^=0xffffffff&c[d+2];b[3]^=0xffffffff&c[d+3];b=sjcl.mode.gcm.T(b,a)}return b},l:function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o=sjcl.bitArray;l=c.length;m=o.bitLength(c);n=o.bitLength(d);h=o.bitLength(e);
g=b.encrypt([0,0,0,0]);if(h===96){e=e.slice(0);e=o.concat(e,[1])}else{e=sjcl.mode.gcm.e(g,[0,0,0,0],e);e=sjcl.mode.gcm.e(g,e,[0,0,Math.floor(h/0x100000000),h&0xffffffff])}h=sjcl.mode.gcm.e(g,[0,0,0,0],d);k=e.slice(0);d=h.slice(0);a||(d=sjcl.mode.gcm.e(g,h,c));for(j=0;j<l;j+=4){k[3]++;i=b.encrypt(k);c[j]^=i[0];c[j+1]^=i[1];c[j+2]^=i[2];c[j+3]^=i[3]}c=o.clamp(c,m);if(a)d=sjcl.mode.gcm.e(g,h,c);a=[Math.floor(n/0x100000000),n&0xffffffff,Math.floor(m/0x100000000),m&0xffffffff];d=sjcl.mode.gcm.e(g,d,a);i=
b.encrypt(e);d[0]^=i[0];d[1]^=i[1];d[2]^=i[2];d[3]^=i[3];return{tag:o.bitSlice(d,0,f),data:c}}};sjcl.misc.hmac=function(a,b){this.N=b=b||sjcl.hash.sha256;var c=[[],[]],d=b.prototype.blockSize/32;this.n=[new b,new b];if(a.length>d)a=b.hash(a);for(b=0;b<d;b++){c[0][b]=a[b]^909522486;c[1][b]=a[b]^1549556828}this.n[0].update(c[0]);this.n[1].update(c[1])};sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(a){a=(new this.N(this.n[0])).update(a).finalize();return(new this.N(this.n[1])).update(a).finalize()};
sjcl.misc.pbkdf2=function(a,b,c,d,e){c=c||1E3;if(d<0||c<0)throw sjcl.exception.invalid("invalid params to pbkdf2");if(typeof a==="string")a=sjcl.codec.utf8String.toBits(a);e=e||sjcl.misc.hmac;a=new e(a);var f,g,h,i,j=[],k=sjcl.bitArray;for(i=1;32*j.length<(d||1);i++){e=f=a.encrypt(k.concat(b,[i]));for(g=1;g<c;g++){f=a.encrypt(f);for(h=0;h<f.length;h++)e[h]^=f[h]}j=j.concat(e)}if(d)j=k.clamp(j,d);return j};
sjcl.random={randomWords:function(a,b){var c=[];b=this.isReady(b);var d;if(b===0)throw new sjcl.exception.notReady("generator isn't seeded");else b&2&&this.W(!(b&1));for(b=0;b<a;b+=4){(b+1)%0x10000===0&&this.M();d=this.A();c.push(d[0],d[1],d[2],d[3])}this.M();return c.slice(0,a)},setDefaultParanoia:function(a){this.w=a},addEntropy:function(a,b,c){c=c||"user";var d,e,f=(new Date).valueOf(),g=this.s[c],h=this.isReady(),i=0;d=this.I[c];if(d===undefined)d=this.I[c]=this.S++;if(g===undefined)g=this.s[c]=
0;this.s[c]=(this.s[c]+1)%this.b.length;switch(typeof a){case "number":if(b===undefined)b=1;this.b[g].update([d,this.z++,1,b,f,1,a|0]);break;case "object":c=Object.prototype.toString.call(a);if(c==="[object Uint32Array]"){e=[];for(c=0;c<a.length;c++)e.push(a[c]);a=e}else{if(c!=="[object Array]")i=1;for(c=0;c<a.length&&!i;c++)if(typeof a[c]!="number")i=1}if(!i){if(b===undefined)for(c=b=0;c<a.length;c++)for(e=a[c];e>0;){b++;e>>>=1}this.b[g].update([d,this.z++,2,b,f,a.length].concat(a))}break;case "string":if(b===
undefined)b=a.length;this.b[g].update([d,this.z++,3,b,f,a.length]);this.b[g].update(a);break;default:i=1}if(i)throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[g]+=b;this.g+=b;if(h===0){this.isReady()!==0&&this.L("seeded",Math.max(this.h,this.g));this.L("progress",this.getProgress())}},isReady:function(a){a=this.F[a!==undefined?a:this.w];return this.h&&this.h>=a?this.m[0]>80&&(new Date).valueOf()>this.P?3:1:this.g>=a?2:0},getProgress:function(a){a=
this.F[a?a:this.w];return this.h>=a?1:this.g>a?1:this.g/a},startCollectors:function(){if(!this.o){if(window.addEventListener){window.addEventListener("load",this.q,false);window.addEventListener("mousemove",this.r,false)}else if(document.attachEvent){document.attachEvent("onload",this.q);document.attachEvent("onmousemove",this.r)}else throw new sjcl.exception.bug("can't attach event");this.o=true}},stopCollectors:function(){if(this.o){if(window.removeEventListener){window.removeEventListener("load",
this.q,false);window.removeEventListener("mousemove",this.r,false)}else if(window.detachEvent){window.detachEvent("onload",this.q);window.detachEvent("onmousemove",this.r)}this.o=false}},addEventListener:function(a,b){this.t[a][this.R++]=b},removeEventListener:function(a,b){var c;a=this.t[a];var d=[];for(c in a)a.hasOwnProperty(c)&&a[c]===b&&d.push(c);for(b=0;b<d.length;b++){c=d[b];delete a[c]}},b:[new sjcl.hash.sha256],m:[0],C:0,s:{},z:0,I:{},S:0,h:0,g:0,P:0,a:[0,0,0,0,0,0,0,0],d:[0,0,0,0],u:undefined,
w:6,o:false,t:{progress:{},seeded:{}},R:0,F:[0,48,64,96,128,192,0x100,384,512,768,1024],A:function(){for(var a=0;a<4;a++){this.d[a]=this.d[a]+1|0;if(this.d[a])break}return this.u.encrypt(this.d)},M:function(){this.a=this.A().concat(this.A());this.u=new sjcl.cipher.aes(this.a)},V:function(a){this.a=sjcl.hash.sha256.hash(this.a.concat(a));this.u=new sjcl.cipher.aes(this.a);for(a=0;a<4;a++){this.d[a]=this.d[a]+1|0;if(this.d[a])break}},W:function(a){var b=[],c=0,d;this.P=b[0]=(new Date).valueOf()+3E4;for(d=
0;d<16;d++)b.push(Math.random()*0x100000000|0);for(d=0;d<this.b.length;d++){b=b.concat(this.b[d].finalize());c+=this.m[d];this.m[d]=0;if(!a&&this.C&1<<d)break}if(this.C>=1<<this.b.length){this.b.push(new sjcl.hash.sha256);this.m.push(0)}this.g-=c;if(c>this.h)this.h=c;this.C++;this.V(b)},r:function(a){sjcl.random.addEntropy([a.x||a.clientX||a.offsetX||0,a.y||a.clientY||a.offsetY||0],2,"mouse")},q:function(){sjcl.random.addEntropy((new Date).valueOf(),2,"loadtime")},L:function(a,b){var c;a=sjcl.random.t[a];
var d=[];for(c in a)a.hasOwnProperty(c)&&d.push(a[c]);for(c=0;c<d.length;c++)d[c](b)}};try{var s=new Uint32Array(32);crypto.getRandomValues(s);sjcl.random.addEntropy(s,1024,"crypto['getRandomValues']")}catch(t){}
sjcl.json={defaults:{v:1,iter:1E3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},encrypt:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json,f=e.c({iv:sjcl.random.randomWords(4,0)},e.defaults),g;e.c(f,c);c=f.adata;if(typeof f.salt==="string")f.salt=sjcl.codec.base64.toBits(f.salt);if(typeof f.iv==="string")f.iv=sjcl.codec.base64.toBits(f.iv);if(!sjcl.mode[f.mode]||!sjcl.cipher[f.cipher]||typeof a==="string"&&f.iter<=100||f.ts!==64&&f.ts!==96&&f.ts!==128||f.ks!==128&&f.ks!==192&&f.ks!==0x100||f.iv.length<
2||f.iv.length>4)throw new sjcl.exception.invalid("json encrypt: invalid parameters");if(typeof a==="string"){g=sjcl.misc.cachedPbkdf2(a,f);a=g.key.slice(0,f.ks/32);f.salt=g.salt}if(typeof b==="string")b=sjcl.codec.utf8String.toBits(b);if(typeof c==="string")c=sjcl.codec.utf8String.toBits(c);g=new sjcl.cipher[f.cipher](a);e.c(d,f);d.key=a;f.ct=sjcl.mode[f.mode].encrypt(g,b,f.iv,c,f.ts);return e.encode(f)},decrypt:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json;b=e.c(e.c(e.c({},e.defaults),e.decode(b)),
c,true);var f;c=b.adata;if(typeof b.salt==="string")b.salt=sjcl.codec.base64.toBits(b.salt);if(typeof b.iv==="string")b.iv=sjcl.codec.base64.toBits(b.iv);if(!sjcl.mode[b.mode]||!sjcl.cipher[b.cipher]||typeof a==="string"&&b.iter<=100||b.ts!==64&&b.ts!==96&&b.ts!==128||b.ks!==128&&b.ks!==192&&b.ks!==0x100||!b.iv||b.iv.length<2||b.iv.length>4)throw new sjcl.exception.invalid("json decrypt: invalid parameters");if(typeof a==="string"){f=sjcl.misc.cachedPbkdf2(a,b);a=f.key.slice(0,b.ks/32);b.salt=f.salt}if(typeof c===
"string")c=sjcl.codec.utf8String.toBits(c);f=new sjcl.cipher[b.cipher](a);c=sjcl.mode[b.mode].decrypt(f,b.ct,b.iv,c,b.ts);e.c(d,b);d.key=a;return sjcl.codec.utf8String.fromBits(c)},encode:function(a){var b,c="{",d="";for(b in a)if(a.hasOwnProperty(b)){if(!b.match(/^[a-z0-9]+$/i))throw new sjcl.exception.invalid("json encode: invalid property name");c+=d+'"'+b+'":';d=",";switch(typeof a[b]){case "number":case "boolean":c+=a[b];break;case "string":c+='"'+escape(a[b])+'"';break;case "object":c+='"'+
sjcl.codec.base64.fromBits(a[b],0)+'"';break;default:throw new sjcl.exception.bug("json encode: unsupported type");}}return c+"}"},decode:function(a){a=a.replace(/\s/g,"");if(!a.match(/^\{.*\}$/))throw new sjcl.exception.invalid("json decode: this isn't json!");a=a.replace(/^\{|\}$/g,"").split(/,/);var b={},c,d;for(c=0;c<a.length;c++){if(!(d=a[c].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i)))throw new sjcl.exception.invalid("json decode: this isn't json!");b[d[2]]=
d[3]?parseInt(d[3],10):d[2].match(/^(ct|salt|iv)$/)?sjcl.codec.base64.toBits(d[4]):unescape(d[4])}return b},c:function(a,b,c){if(a===undefined)a={};if(b===undefined)return a;var d;for(d in b)if(b.hasOwnProperty(d)){if(c&&a[d]!==undefined&&a[d]!==b[d])throw new sjcl.exception.invalid("required parameter overridden");a[d]=b[d]}return a},Y:function(a,b){var c={},d;for(d in a)if(a.hasOwnProperty(d)&&a[d]!==b[d])c[d]=a[d];return c},X:function(a,b){var c={},d;for(d=0;d<b.length;d++)if(a[b[d]]!==undefined)c[b[d]]=
a[b[d]];return c}};sjcl.encrypt=sjcl.json.encrypt;sjcl.decrypt=sjcl.json.decrypt;sjcl.misc.U={};sjcl.misc.cachedPbkdf2=function(a,b){var c=sjcl.misc.U,d;b=b||{};d=b.iter||1E3;c=c[a]=c[a]||{};d=c[d]=c[d]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):sjcl.random.randomWords(2,0)};c=b.salt===undefined?d.firstSalt:b.salt;d[c]=d[c]||sjcl.misc.pbkdf2(a,c,b.iter);return{key:d[c].slice(0),salt:c.slice(0)}};

/* 5otbdfpC3nd */});
__d("EncryptedLocalStorage",["StanfordCrypto","WebStorage","LogHistory"],function(a,b,c,d,e,f){var g=b('StanfordCrypto'),h=b('WebStorage'),i=b('LogHistory'),j=i.getInstance('encrypted_local_storage');function k(l){this._store=h.getLocalStorage();this._password=l;}k.prototype.getStore=function(){return this._store;};k.prototype.available=function(){return !!this._store;};k.prototype.keys=function(){var l=[];for(var m=0;m<this._store.length;m++)l.push(this._store.key(m));return l;};k.prototype.get=function(l){var m=this._store.getItem(l);if(m==null)return null;try{return g.decrypt(this._password,m);}catch(n){j.error('decryption_fail',{key:l});return null;}};k.prototype.set=function(l,m){var n=g.encrypt(this._password,m);this._store.setItem(l,n);};k.prototype.remove=function(l){this._store.removeItem(l);};k.prototype.clear=function(){this._store.clear();};e.exports=k;});
__d("MercuryShareLinkUploader",["ArbiterMixin","AsyncRequest","CSS","DOM","Form","URLScraper","WebMessengerEvents","mixin","Event"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('CSS'),j=b('DOM'),k=b('Form'),l=b('URLScraper'),m=b('WebMessengerEvents'),n=b('mixin'),o=b('Event'),p=n(g);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t,u,v,w,x){this.$MercuryShareLinkUploader0=t;this.$MercuryShareLinkUploader1=u;this.$MercuryShareLinkUploader2=v;this.$MercuryShareLinkUploader3=x;this.$MercuryShareLinkUploader4=false;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6=null;o.listen(w,'click',this.close.bind(this));o.listen(x,'keyup',function(){!x.value.length&&this.$MercuryShareLinkUploader7.enable();}.bind(this));this.$MercuryShareLinkUploader7=new l(x);this.$MercuryShareLinkUploader7.subscribe('match',function(y,z){this.loadShare(z&&z.url);}.bind(this));}s.prototype.getAttachData=function(){return this.loadAttachData(this.$MercuryShareLinkUploader4,this.$MercuryShareLinkUploader0,this.$MercuryShareLinkUploader3);};s.prototype.loadAttachData=function(t,u,v){if(t){var w=k.serialize(u),x=w.attachment&&w.attachment.params,y=w.link_metrics?w.link_metrics.no_image:true;if(!x||!x.url)return null;if(v.value.indexOf(x.url)===-1)return w;if(!x.summary&&!x.favicon&&y){var z=x.url.substr(0,x.title.length);if(!x.title||x.title===z)return null;}return w;}return null;};s.prototype.check=function(){this.$MercuryShareLinkUploader7.check();};s.prototype.close=function(){this.$MercuryShareLinkUploader8();this.$MercuryShareLinkUploader7.disable();this.inform('closed');};s.prototype.clear=function(){this.$MercuryShareLinkUploader8();this.$MercuryShareLinkUploader7.enable();};s.prototype.enable=function(){this.$MercuryShareLinkUploader7.enable();};s.prototype.disable=function(){this.$MercuryShareLinkUploader7.disable();};s.prototype.loadShare=function(t){this.$MercuryShareLinkUploader5=t;this.$MercuryShareLinkUploader6&&this.$MercuryShareLinkUploader6.abort();this.$MercuryShareLinkUploader6=new h().setMethod('POST').setURI('/ajax/share_scrape.php').setData({u:t}).setHandler(this.$MercuryShareLinkUploader9.bind(this).curry(t)).setStatusElement(this.$MercuryShareLinkUploader2);this.$MercuryShareLinkUploader6.send();this.inform('link-detected');};s.prototype.$MercuryShareLinkUploader9=function(t,u){if(this.$MercuryShareLinkUploader5!==t)return;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6=null;i.show(this.$MercuryShareLinkUploader0);j.empty(this.$MercuryShareLinkUploader1);j.setContent(this.$MercuryShareLinkUploader1,u.payload);this.$MercuryShareLinkUploader4=true;if(!this.getAttachData()){this.close();return;}m.detailDOMChanged();};s.prototype.$MercuryShareLinkUploader8=function(){i.hide(this.$MercuryShareLinkUploader0);this.$MercuryShareLinkUploader4=false;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6&&this.$MercuryShareLinkUploader6.abort();this.$MercuryShareLinkUploader6=null;this.$MercuryShareLinkUploader7.reset();m.detailDOMChanged();};e.exports=s;});
__d("JoinableConversationMessageFilter",["MercuryLogMessageType","MercuryThreads","MercuryParticipants"],function(a,b,c,d,e,f){var g=b('MercuryLogMessageType'),h=b('MercuryThreads').get(),i=b('MercuryParticipants'),j={_isFilterable:function(k){var l=k.log_message_type;if(!l)return false;if(l==g.JOINABLE_JOINED)return k.log_message_data.joined_participant!==i.user;if(l==g.UNSUBSCRIBE||l==g.SUBSCRIBE){var m=h.getThreadMetaNow(k.thread_id);if(m&&m.is_joinable)return k.author!==i.user;return false;}return false;},filterMessages:function(k,l,m){var n=[];for(var o=0;o<l.length;o++){var p=l[o];if(j._isFilterable(p)){if(m)k(p);}else n.push(p);}return n;}};e.exports=j;});
__d("MercuryThreadMuter",["AsyncDialog","AsyncRequest","DOM","Env","MercuryThreads"],function(a,b,c,d,e,f){var g=b('AsyncDialog'),h=b('AsyncRequest'),i=b('DOM'),j=b('Env'),k=b('MercuryThreads').get(),l={getUserIDEmail:function(){return j.user+'@facebook.com';},getThreadMuteSettingForUser:function(m){return m.mute_settings&&m.mute_settings[l.getUserIDEmail()];},isThreadMuted:function(m){return l.getThreadMuteSettingForUser(m)!==undefined;},showMuteChangeDialog:function(m){g.send(new h('/ajax/mercury/mute_thread_dialog.php'),function(n){n.subscribe('confirm',function(){this.hide();var o;i.scry(this.getRoot(),'input[type="radio"]').forEach(function(r){if(r.checked)o=r.value;});switch(o){case 'always':o=-1;break;case '1hour':o=3600;break;case '8am':var p=new Date(),q=new Date();q.setHours(8);q.setMinutes(0);q.setSeconds(0);if(q>p){o=q-p;}else o=q-p+(24*3600);o/=1000;break;default:o=0;}k.updateThreadMuteSetting(m,o);}.bind(n));});}};e.exports=l;});
__d("JoinStatusTabSheet",["copyProperties","DOM","MercuryLogMessageType","MercuryParticipants"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('DOM'),i=b('MercuryLogMessageType'),j=b('MercuryParticipants');function k(l,m){this._rootElement=l;this._messageQueue=[];this._sheetView=m;}g(k.prototype,{_setMessage:function(l,m){var n=l.author,o=l.log_message_type;if(o==i.JOINABLE_JOINED){var p=l.log_message_data.joined_participant;if(p!==j.user)j.get(p,function(s){h.setContent(m,h.tx._("{actor} joined the chat.",{actor:s.name}));});}else if(o==i.UNSUBSCRIBE){if(n!==j.user)j.get(n,function(s){h.setContent(m,h.tx._("{actor} left the conversation.",{actor:s.name}));});}else if(o==i.SUBSCRIBE)if(n!==j.user){var q=l.log_message_data.added_participants;if(q&&q.length>0){var r=[n,q[0]];j.getMulti(r,function(s){h.setContent(m,h.tx._("{actor} added {subscriber1}.",{actor:s[n].name,subscriber1:s[q[0]].name}));});}}},isPermanent:function(){return false;},getCloseTimeout:function(){return 3000;},getType:function(){return 'join_status_type';},addToQueue:function(l){this._messageQueue.push(l);if(this._messageQueue.length===1)this._open();},render:function(){var l=this._messageQueue[0],m=this._getTemplate().build();this._setMessage(l,m.getNode('text'));h.setContent(this._rootElement,m.getRoot());},_open:function(){this._sheetView.open(this);},autoCloseCallback:function(){this._messageQueue.shift();if(this._messageQueue.length>0)this._open();},couldNotReplace:function(){this._open.bind(this).defer(this.getCloseTimeout(),false);}});e.exports=k;});
__d("MercuryDrafts",["CacheStorage","EncryptedLocalStorage","MercuryConfig","MercurySingletonMixin","copyProperties","isEmpty"],function(a,b,c,d,e,f){var g=b('CacheStorage'),h=b('EncryptedLocalStorage'),i=b('MercuryConfig'),j=b('MercurySingletonMixin'),k=b('copyProperties'),l=b('isEmpty');function m(n){this.$MercuryDrafts0=n;var o=new h(i.local_storage_crypto);this.$MercuryDrafts1=new g(o,'mercury-drafts:'+this.$MercuryDrafts0);}m.prototype.saveDraft=function(n,o){if(this.isMessageEmpty(o)){this.removeDraft(n);}else this.$MercuryDrafts1.set(n,this.$MercuryDrafts2(n,o));};m.prototype.removeDraft=function(n){this.$MercuryDrafts1.remove(n);};m.prototype.getDraft=function(n){var o=this.$MercuryDrafts1.get(n,{});return o.message;};m.prototype.isMessageEmpty=function(n){return l(n)||(l(n.body)&&l(n.content_attachment)&&l(n.raw_attachments)&&l(n.photo_fbids)&&l(n.image_ids));};m.prototype.$MercuryDrafts2=function(n,o){return {thread_id:n,message:o};};k(m,j);e.exports=m;});
__d("MercuryDraftsController",["MercuryDrafts","Input","MercuryConfig","MercurySingletonMixin","copyProperties","isEmpty"],function(a,b,c,d,e,f){var g=b('MercuryDrafts').get(),h=b('Input'),i=b('MercuryConfig'),j=b('MercurySingletonMixin'),k=b('copyProperties'),l=b('isEmpty');function m(n){this.$MercuryDraftsController0;}m.prototype.clearDraft=function(n){if(this.canSaveDrafts(n))g.removeDraft(n);};m.prototype.saveDraft=function(n,o,p,q,r){if(!this.canSaveDrafts(n))return;var s={body:h.getValue(o)};if(!l(p.getAttachments())){s.has_attachment=true;s.raw_attachments=p.getAttachments();}if(!l(p.getImageFiles())){s.has_attachment=true;s.image_ids=p.getImageFiles();}if(r&&!l(r.getSelectedFBIDs())){s.has_attachment=true;s.photo_fbids=r.getSelectedFBIDs();}if(q.getAttachData()){s.has_attachment=true;s.content_attachment=q.getAttachData();}g.saveDraft(n,s);};m.prototype.loadDraft=function(n,o,p,q,r){if(!this.canSaveDrafts(n)||this.$MercuryDraftsController1(o,p,q,r))return;var s=g.getDraft(n);if(!l(s)){if(s.body){o.focus();h.setValue(o,s.body);}if(!l(s.raw_attachments))p.addCachedAttachments(s.raw_attachments);if(!l(s.image_ids))p.addCachedImageFiles(s.image_ids);if(!l(s.content_attachment))q.loadShare(s.content_attachment.attachment.params.url);if(r&&!l(s.photo_fbids))r.addCachedPhotos(s.photo_fbids);}};m.prototype.canSaveDrafts=function(n){return !!(i.ChatSaveDraftsGK&&n);};m.prototype.$MercuryDraftsController1=function(n,o,p,q){return !h.isEmpty(n)||!l(o.getAttachments())||!l(o.getImageFiles())||(q&&!l(q.getSelectedFBIDs()))||p.getAttachData();};m.prototype.toString=function(){return '[object MercuryDraftsController:'+this.$MercuryDraftsController0+']';};k(m,j);e.exports=m;});
__d("MessagesEmoticonView",["DOM","EmoticonsList","Event","Focus","InputSelection","Keys","Parent","SubscriptionsHandler","TextAreaControl","Toggler","copyProperties","endsWith","startsWith"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('EmoticonsList'),i=b('Event'),j=b('Focus'),k=b('InputSelection'),l=b('Keys'),m=b('Parent'),n=b('SubscriptionsHandler'),o=b('TextAreaControl'),p=b('Toggler'),q=b('copyProperties'),r=b('endsWith'),s=b('startsWith'),t=h.symbols;function u(w,x,y){var z=m.byClass(w,'emoticon');if(!z)return;var aa='emoticon_',ba=null;z.className.split(' ').forEach(function(ia){if(s(ia,aa))ba=ia.substring(aa.length);});if(!t[ba])return;var ca=o.getInstance(x),da=ca.getValue(),ea=t[ba],fa=da.substring(0,y.start),ga=da.substring(y.end);if(y.start>0&&!r(fa,' '))ea=' '+ea;if(!s(ga,' '))ea+=' ';var ha=fa+ea+ga;y.start+=ea.length;y.end=y.start;ca.setValue(ha);k.set(x,y.start,y.end);return true;}function v(w,x){var y={start:0,end:0};function z(){y=k.get(x);}var aa=g.find(w,'.uiToggleFlyout');this._subscriptions=new n();this._subscriptions.addSubscriptions(p.subscribe('show',function(ba,ca){if(ca.active&&g.contains(w,ca.active)){k.set(x,y.start,y.end);var da=g.scry(aa,'a.emoticon')[0];da&&j.setWithoutOutline(da);}}),i.listen(aa,'click',function(event){var ba=u(event.getTarget(),x,y);ba&&p.hide(w);}),i.listen(aa,'keyup',function(event){if(event.keyCode===l.ESC){p.hide(w);k.set(x,y.start,y.end);}}),i.listen(x,'keyup',z),i.listen(x,'click',z));}q(v.prototype,{destroy:function(){this._subscriptions.release();this._subscriptions=null;}});q(v,{create:function(w,x){return new v(w,x);}});e.exports=v;});
__d("MessagesEmoticons.react",["Grid.react","React","cx","fbt"],function(a,b,c,d,e,f){var g=b('Grid.react'),h=b('React'),i=b('cx'),j=b('fbt'),k=g.GridItem,l={smile:"smile",frown:"frown",tongue:"tongue",grin:"grin",gasp:"gasp",wink:"wink",pacman:"pacman",grumpy:"grumpy",unsure:"unsure",cry:"cry",kiki:"kiki",glasses:"glasses",sunglasses:"sunglasses",heart:"heart",devil:"devil",angel:"angel",squint:"squint",confused:"confused",upset:"upset",colonthree:"colonthree",like:"like"},m=h.createClass({displayName:'MessagesEmoticons',getEmoticons:function(){var n=Object.keys(l).map(function(o){return (k(null,h.DOM.div({className:"panelCell"},h.DOM.a({'aria-label':l.emoticon,className:'emoticon emoticon_'+o}))));});return n;},render:function(){return (h.DOM.div({className:"emoticonsTable"},g({cols:7,alignv:"middle",alignh:"center",spacing:"pam"},this.getEmoticons())));}});e.exports=m;});
__d("MercuryTypingReceiver",["Arbiter","ChannelConstants","MercuryActionTypeConstants","MercuryParticipants","MercuryPayloadSource","MercuryServerRequests","MercuryThreads","TypingDetector","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('MercuryActionTypeConstants'),j=b('MercuryParticipants'),k=b('MercuryPayloadSource'),l=b('MercuryServerRequests').get(),m=b('MercuryThreads').get(),n=b('TypingDetector'),o=b('setTimeoutAcrossTransitions'),p,q={},r=30000,s=new g();function t(y){var z=q[y]||{},aa=Object.keys(z);aa.sort(function(ba,ca){return z[ba]-z[ca];});return aa;}function u(){p=null;var y=Date.now(),z={},aa=false;for(var ba in q){var ca=false;for(var da in q[ba]||{})if(q[ba][da]<y-r){delete q[ba][da];ca=true;}else aa=true;if(ca)z[ba]=t(ba);}for(var ea in z){s.inform('state-changed',z);break;}if(aa)p=o(u,3000);}function v(y,z){if(y in q)if(z in q[y]){delete q[y][z];w(y);}}function w(y){var z={};z[y]=t(y);s.inform('state-changed',z);}function x(y){if(y.thread)return l.getClientThreadIDNow(y.thread);if(y.type==='typ')return m.getThreadIdForUser(y.from);return null;}g.subscribe([h.getArbiterType('typ'),h.getArbiterType('ttyp')],function(y,z){var aa=z.obj,ba=x(aa);if(ba){var ca=j.getIDForUser(aa.from);if(aa.st==n.TYPING){q[ba]=q[ba]||{};var da=q[ba][ca];q[ba][ca]=Date.now();if(!p)p=o(u,3000);!da&&w(ba);}else if(aa.st==n.INACTIVE)v(ba,ca);}});l.subscribe('update-typing-state',function(y,z){var aa=z.payload_source;if(aa!=k.CLIENT_CHANNEL_MESSAGE)return;var ba=z.actions;if(!ba||!ba.length)return;var ca=i.USER_GENERATED_MESSAGE;ba.forEach(function(da){if(da.action_type==ca&&da.author!=j.user)v(da.thread_id,da.author);});});e.exports=s;});
__d("MercuryIndicatorController",["ArbiterMixin","DOM","MercuryActionTypeConstants","MercuryConfig","MercuryDelayedRoger","MercuryMessageSourceTags","MercuryParticipants","MercuryRoger","MercuryThreads","MercuryTypingReceiver","arrayContains","copyProperties","formatDate","removeFromArray","tx"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('DOM'),i=b('MercuryActionTypeConstants'),j=b('MercuryConfig'),k=b('MercuryDelayedRoger'),l=b('MercuryMessageSourceTags'),m=b('MercuryParticipants'),n=b('MercuryRoger'),o=b('MercuryThreads').get(),p=b('MercuryTypingReceiver'),q=b('arrayContains'),r=b('copyProperties'),s=b('formatDate'),t=b('removeFromArray'),u=b('tx'),v=[];function w(x){this._threadID=x;this._canonicalUser=o.getCanonicalUserInThread(x);v.push(this);}r(w.prototype,g,{destroy:function(){t(v,this);},setLastMessage:function(x){this._lastMsg=x;this._handleStateChange();},_informStateChanged:function(x){if(x.activity=='none'&&this._currentActivity=='none')return;if(this._lastMsg&&m.isAuthor(this._lastMsg.author))x.self_authored=true;this._currentActivity=x.activity;this.inform('state-changed',x);},_notifySentFrom:function(){var x,y,z=this._lastMsg.location_text,aa=this._lastMsg.source_tags||[];if(z){x=u._("Sent from {location}",{location:z});y='sentFromMobile';}else if(q(aa,l.MESSENGER)){x=h.create('a',{href:'/mobile/messenger','class':'fcg',target:'_blank'},"Sent from Messenger");y='sentFromMobile';}else if(q(aa,l.MOBILE)){x=h.create('a',{href:'/mobile','class':'fcg',target:'_blank'},"Sent from Mobile");y='sentFromMobile';}else if(q(aa,l.EMAIL)){x="Sent from email";y='sentFromEmail';}else{this._informStateChanged({activity:'none'});return;}this._informStateChanged({activity:y,text:x});},_notifySeenTimestamp:function(x){var y=n.getSeenTimestamp(this._threadID,x[0])*.001,z=Date.now()*.001,aa;if(y<z-518400){aa='M j';}else if(y<z-86400){aa='D g:ia';}else aa='g:ia';this._informStateChanged({activity:'seen-timestamp',text:u._("Seen {timestamp}",{timestamp:s(y,aa)})});},_checkNamesForCollision:function(x,y){var z=false;m.getMulti(x,function(aa){function ba(ea){if(typeof aa[ea]!=="undefined"){return aa[ea].short_name.toLowerCase();}else return ea;}var ca=y.map(ba),da=x.map(ba);z=ca.some(function(ea){return da.indexOf(ea)!==da.lastIndexOf(ea);});});return z;},_notifySeenBy:function(x){var y=this._lastMsg,z=true;m.getMulti(x,function(aa){z=false;if(this._lastMsg!=y)return;var ba=o.getThreadMetaNow(this._threadID),ca=ba?ba.participants.length:0,da=x.length+(y.author!=m.user),ea,fa=false,ga=false,ha=ca>2&&da>=ca-1;if(!(ha)&&ca>0)ga=this._checkNamesForCollision(ba.participants,x);if(ha){ea="Seen by everyone";}else if(x.length==1){ea=u._("Seen by {user}",{user:aa[x[0]].short_name});}else if(x.length==2){ea=u._("Seen by {user1}, {user2}",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name});}else if(x.length==3){ea=u._("Seen by {user1}, {user2}, {user3}",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name,user3:aa[x[2]].short_name});}else if(x.length>3){var ia=Object.keys(aa).length-2,ja=u._("{num} more",{num:ia}),ka=h.create('span',{className:'more'},ja);ea=h.tx._("Seen by {user1}, {user2}, {=num more link}",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name,'=num more link':ka});fa=true;}fa=fa||ga;this._informStateChanged({activity:'seen-by',text:ea,seenBy:x,hasNameCollision:ga,tooltip:fa});}.bind(this));z&&this._informStateChanged({activity:'none'});},_notifyTyping:function(x){var y=this._lastMsg,z=true;m.getMulti(x,function(aa){z=false;if(this._lastMsg!=y)return;if(this._canonicalUser||j.ChatMultiTypGK){var ba=o.getThreadMetaNow(this._threadID),ca=ba?ba.participants.length:0,da,ea=false;if(ca>2&&x.length>=ca-1){da="Everyone is typing...";}else if(x.length==1){da=u._("{name} is typing...",{name:aa[x[0]].short_name});}else if(x.length==2){da=u._("{user1} and {user2} are typing...",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name});}else if(x.length==3){da=u._("{user1}, {user2}, and {user3} are typing...",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name,user3:aa[x[2]].short_name});}else if(x.length>3){var fa=Object.keys(aa).length-2,ga=u._("{num} more",{num:fa}),ha=h.create('a',{href:'#'},ga);da=h.tx._("{user1}, {user2}, and {=num more link} are typing...",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name,'=num more link':ha});ea=true;}this._informStateChanged({activity:'typing',text:da,typing:x,tooltip:ea});}}.bind(this));z&&this._informStateChanged({activity:'none'});},_handleStateChange:function(){var x=i.LOG_MESSAGE;if(!this._lastMsg||this._lastMsg.action_type==x){this._informStateChanged({activity:'none'});return;}if(this._typing&&this._typing.length){this._notifyTyping(this._typing);return;}if(this._canonicalUser&&this._lastMsg.author!=m.user){this._notifySentFrom();return;}var y=k.getSeenBy(this._threadID,true);if(y.length)if(this._canonicalUser){this._notifySeenTimestamp(y);return;}else{this._notifySeenBy(y);return;}this._informStateChanged({activity:'none'});}});p.subscribe('state-changed',function(x,y){v.forEach(function(z){var aa=y[z._threadID];if(aa!==undefined){z._typing=aa;z._handleStateChange();}});});k.subscribe('state-changed',function(x,y){v.forEach(function(z){y[z._threadID]&&z._handleStateChange();});});e.exports=w;});
__d("MercuryLastMessageIndicator",["CSS","MercuryIndicatorController","DOM","MercuryParticipants","Tooltip","copyProperties","csx","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('MercuryIndicatorController'),i=b('DOM'),j=b('MercuryParticipants'),k=b('Tooltip'),l=b('copyProperties'),m=b('csx'),n=b('cx');function o(p,q,r,s){this._lastMessageIndicator=q;this._hideTyping=r||false;this._messagesView=s;this._controller=new h(p);this._subscription=this._controller.subscribe('state-changed',this._handleStateChanged.bind(this));}l(o.prototype,{destroy:function(){this._setClass(null);this._subscription.unsubscribe();this._controller.destroy();},setLastMessage:function(p){this._controller.setLastMessage(p);},_handleStateChanged:function(p,q){var r=this._messagesView.isScrolledToBottom();this._rerender(q);r&&this._messagesView.scrollToBottom();},_rerender:function(p){if(p.activity=='none'){this._setClass(null);return;}if(this._hideTyping&&p.activity=='typing'){this._setClass(null);return;}g.conditionClass(this._lastMessageIndicator,"_510e",p.self_authored);var q=i.find(this._lastMessageIndicator,"._510f");if(p.text){i.setContent(q,p.text);}else i.empty(q);if(p.activity.substring(0,4)=='seen'){this._setClass('seen');if(p.activity=='seen-by'&&p.tooltip){j.getMulti(p.seenBy,function(r){var s=i.create('div');for(var t in r){var u=i.create('div');i.setContent(u,r[t].name);i.appendContent(s,u);}var v=p.hasNameCollision,w;if(v){w=this._lastMessageIndicator;}else w=i.find(this._lastMessageIndicator,'span.more');k.set(w,s,'above','center');}.bind(this));}else k.remove(this._lastMessageIndicator);}else this._setClass(p.activity);},_setClass:function(p){if(this._lastClass===p)return;this._lastClass&&g.removeClass(this._lastMessageIndicator,this._lastClass);p&&g.addClass(this._lastMessageIndicator,p);this._lastClass=p;}});e.exports=o;});
__d("PhotoUtils",["Event","URI"],function(a,b,c,d,e,f){var g=b('Event'),h=b('URI'),i={getImagesFromData:function(j){var k=[];for(var l in j)if(l.indexOf('image')===0)k.push(j[l]);return k;},getFBIDFromData:function(j){return j&&j.id;},getDownloadURLFromData:function(j){if(!j.download_image||!j.download_image.uri)return null;var k=new h(j.download_image.uri);k.addQueryData({dl:1});return k;},getPermalinkFromData:function(j){return j.permalink;},canViewerMakeCoverPhoto:function(j){return !!j.can_viewer_make_cover_photo;},getCoverPhotoURLFromData:function(j){return new h('/profile.php').addQueryData({preview_cover:i.getFBIDFromData(j)});},preload:function(j,k,l){var m=j.getDimensions();for(var n=0;n<k.length;++n){var o=m.getBestFitImageFromPhoto(k[n],m.getMaxStageDimensions()),p=new Image();l&&g.listen(p,'load',l.curry(k[n]));j.getLogger().log(o.uri);p.src=o.uri;}}};e.exports=i;});
__d("PhotoViewerDimensions",["Event","PhotoUtils","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('PhotoUtils'),i=b('Vector'),j=b('copyProperties');function k(l){var m=['verticalPadding','horizontalPadding','normalResDim'];for(var n in l)if(m.indexOf(n)<0)throw new Error("Unsupported extraData value '"+n+"' should not be used");if(l){this._verticalPadding=l.verticalPadding;this._horizontalPadding=l.horizontalPadding;this._normalResDim=l.normalResDim;}this._listener=g.listen(window,'resize',this._resetMaxStageDimensions.bind(this));}k.prototype.destroy=function(){this._listener.remove();};k.prototype.shouldUseHiRes=function(l){if(!l.hasHiResDimensions())return false;var m=this.getStageDimensions(l.getHiResDimensions()),n=this.getImageDimensionsForStage(l.getHiResDimensions(),m);return (n.x>this._normalResDim.x||n.y>this._normalResDim.y);};k.prototype.getStageDimensions=function(l){var m=this.getMaxStageDimensions(),n=new i(Math.min(l.x,m.x),Math.min(l.y,m.y)),o=n.x/n.y,p=l.x/l.y;if(o<p){n.y=Math.round(n.x/p);}else n.x=Math.round(n.y*p);return n;};k.prototype.getImageDimensionsForStage=function(l,m){var n=l.x,o=l.y,p=m.x,q=m.y;if(n>=p||o>=q){var r=n/o,s=p/q;if(s<r){n=p;o=Math.round(p/r);}else if(s>r){n=Math.round(q*r);o=q;}else{n=p;o=q;}}return new i(n,o);};k.prototype.getMaxStageDimensions=function(){if(!this._maxStageDimensions)this._maxStageDimensions=new i(i.getViewportDimensions().x-this._horizontalPadding,i.getViewportDimensions().y-this._verticalPadding);return this._maxStageDimensions;};k.prototype._resetMaxStageDimensions=function(){this._maxStageDimensions=null;};k.prototype.getDimensionsFromImage=function(l){return this.shouldUseHiRes(l)?l.getHiResDimensions():l.getNormalDimensions();};k.prototype.getSrcFromImage=function(l){return this.shouldUseHiRes(l)?l.getHiResSrc():l.getNormalSrc();};k.prototype.getBestFitImageFromPhoto=function(l,m){var n=null,o=h.getImagesFromData(l);o=o.sort(function(q,r){return r.width-q.width;});for(var p=0;p<o.length;p++)if(!n||o[p].width>=m.x||o[p].height>=m.y)n=o[p];return n;};k.prototype.getBestFitDimensionsFromPhoto=function(l,m){var n=this.getBestFitImageFromPhoto(l,m);return new i(n.width,n.height);};j(k.prototype,{_verticalPadding:40,_horizontalPadding:60,_normalResDim:{x:960,y:960}});e.exports=k;});
__d("SpotlightViewer",["React","ReactLayeredComponentMixin","Spotlight.react","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('ReactLayeredComponentMixin'),i=b('Spotlight.react'),j=b('cx'),k=g.createClass({displayName:'SpotlightViewer',mixins:[h],renderLayers:function(){return {photoLayer:i({shown:this.props.open,onHide:this.props.onHide},g.DOM.div({className:"_n3"},this.props.children))};},render:function(){return (g.DOM.div(null));}});e.exports=k;});
__d("PagedQueryCache",["AsyncRequest","GraphQLParser","PagedQueryCacheCore","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('GraphQLParser'),i=b('PagedQueryCacheCore'),j=b('copyProperties');function k(o,p,q,r,s,t){var u=h.parseQuery(o),v=p.findFieldByPath(u),w={};for(var x=0;x<v.calls.length;x++){var y=v.calls[x];w[y.name]=y.args[0].callValue;}j(w,s);new g('/ajax/graphql/query/').setData({queryName:r,params:w}).setHandler(function(z){var aa=z.getPayload();t({requested_indices:q,query_results:JSON.parse(aa.output),query_metadata:{query_string:aa.query},query_params:w});}).setAllowCrossPageTransition(true).send();}for(var l in i)if(i.hasOwnProperty(l))n[l]=i[l];var m=i===null?null:i.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=i;function n(o,p,q){i.call(this,k,o,p,q);}e.exports=n;});
__d("PhotoCentralUpdates",["Arbiter","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i={handleUpdate:function(j,k){var l=h({payloadsource:j},k);g.inform('update-photos',l);}};e.exports=i;});
__d("PhotoStore",["Arbiter","PagedQuery","PagedQueryCache","PhotoCentralUpdates","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('PagedQuery'),i=b('PagedQueryCache'),j=b('PhotoCentralUpdates'),k=b('copyProperties'),l={actions:{UPDATE:'update'},_photoCache:{},_postCreateCallbacks:{},getPhotoCache:function(m){if(!this._photoCache[m])throw new Error('Photo cache requested for unknown set ID');return this._photoCache[m];},hasBeenCreated:function(m){return !!this._photoCache[m];},clearSetCache:function(m){delete this._photoCache[m];delete this._postCreateCallbacks[m];},getByIndex:function(m,n,o){return this.getPhotoCache(m).getItemAtIndex(n,o);},getByIndexImmediate:function(m,n){if(this._photoCache[m])return this._photoCache[m].getItemAtIndexImmediate(n);return undefined;},getIndexForID:function(m,n){if(this._photoCache[m])return this._photoCache[m].getIndexForID(n);return undefined;},getCursorByIndexImmediate:function(m,n){var o=this.getByIndexImmediate(m,n);if(o)return this._photoCache[m].getCursorForID(o.id);return undefined;},getAvailableRange:function(m,n){return this.getPhotoCache(m).getAvailableRange();},hasLooped:function(m){return this.getPhotoCache(m).hasLooped();},fetchForward:function(m,n,o,p){return this.getPhotoCache(m).getItemsAfterCursor(n,o,p);},fetchBackward:function(m,n,o,p){return this.getPhotoCache(m).getItemsBeforeCursor(n,o,p);},executePostCreate:function(m,n){if(this._photoCache[m]){n&&n();}else this._postCreateCallbacks[m]=n;},runPostCreateCallback:function(m){var n=this._postCreateCallbacks[m];if(n){n();delete this._postCreateCallbacks[m];}},setPreFetchCallback:function(m,n){this.getPhotoCache(m).setPreFetchCallback(n);},_updateData:function(m){var n=m.query_results,o=m.query_metadata,p=o.set_id;if(!this._photoCache[p]){var q=h.constructFromPath(o.query_string,o.query_path);this._photoCache[p]=new i(q,n,k({enableLooping:true},o.config));this._photoCache[p].setPayloadCallback(function(r){r.query_metadata.set_id=p;j.handleUpdate(0,r);});this.runPostCreateCallback(p);}else if(m.query_metadata.action==l.actions.UPDATE){this._photoCache[p].updateData(m);}else this._photoCache[p].addData(m);}};g.subscribe('update-photos',function(event,m){l._updateData(m);});e.exports=l;});
__d("PhotoViewState",["ArbiterMixin","PhotoStore","PhotoUtils","SpotlightViewerLoggingEvents","copyProperties","mixin"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('PhotoStore'),i=b('PhotoUtils'),j=b('SpotlightViewerLoggingEvents'),k=b('copyProperties'),l=b('mixin'),m=l(g);for(var n in m)if(m.hasOwnProperty(n))p[n]=m[n];var o=m===null?null:m.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=m;function p(q,r,s,t,u){this._viewer=q;this._setID=r;this._updateCallback=t;this._position=s||0;this._preloaded={};this._reverse=u;}p.prototype.destroy=function(){};p.prototype._fetchCallback=function(q){this._preload(q);this._log(j.DATA_FETCH_COMPLETE);};p.prototype._preload=function(q){i.preload(this._viewer,q,function(r){this._preloaded[i.getFBIDFromData(r)]=true;}.bind(this));};p.prototype._preloadPhotosInRange=function(q,r){var s=[];for(var t=q;t<=r;++t){var u=h.getByIndexImmediate(this._setID,t);if(u&&!this._isPreloaded(u))s.push(u);}this._preload(s);};p.prototype._isPreloaded=function(q){return this._preloaded[i.getFBIDFromData(q)];};p.prototype.getPosition=function(){return this._position;};p.prototype.isValidMovement=function(q){if(!h.hasBeenCreated(this._setID))return false;if(h.hasLooped(this._setID))return true;var r=this._position+q,s=h.getAvailableRange(this._setID),t=s.offset+s.length-1;return r>=s.offset-1&&r<=t+1;};p.prototype.getRelativeMovement=function(q){return h.getIndexForID(this._setID,q)-this._position;};p.prototype.moveCursor=function(q){if(!this.isValidMovement(q))return false;this._position+=q;return true;};p.prototype._page=function(q){if(!this.moveCursor(q))return;this._log(j.PAGE_BEGIN);var r=h.getByIndexImmediate(this._setID,this._position);if(!r){this.inform('photo_fetch');this._log(j.PHOTO_FETCH);}else if(!this._isPreloaded(r))this._preload([r]);h.getByIndex(this._setID,this._position,this._updateCallback);this._loadMoreIfNecessary(q>0,p.BUFFER_SIZE);this._log(j.PAGE_COMPLETE);};p.prototype.loadMoreForwardIfNecessary=function(q){var r=h.getAvailableRange(this._setID),s=r.offset+r.length-1,t=this._position+q;if(t>s&&!h.hasLooped(this._setID)){var u=h.getCursorByIndexImmediate(this._setID,s);h.fetchForward(this._setID,u,q,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(this._position+1,t);};p.prototype.loadMoreBackwardIfNecessary=function(q){var r=h.getAvailableRange(this._setID),s=this._position-q;if(s<r.offset&&!h.hasLooped(this._setID)){var t=h.getCursorByIndexImmediate(this._setID,r.offset);h.fetchBackward(this._setID,t,q,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(s,this._position-1);};p.prototype._loadMoreIfNecessary=function(q,r){if(q){this.loadMoreForwardIfNecessary(r);}else this.loadMoreBackwardIfNecessary(r);};p.prototype.displayFirst=function(){h.setPreFetchCallback(this._setID,function(){this._log(j.DATA_FETCH_BEGIN);}.bind(this));var q=function(r){if(!this._isPreloaded(r))this._preload([r]);this._updateCallback(r);}.bind(this);h.getByIndex(this._setID,this._position,q);if(this._reverse){this.loadMoreBackwardIfNecessary(p.BUFFER_SIZE);}else this.loadMoreForwardIfNecessary(p.BUFFER_SIZE);};p.prototype.backward=function(){this._page(this._reverse?1:-1);};p.prototype.forward=function(){this._page(this._reverse?-1:1);};p.prototype._log=function(q){this._viewer.log(q);};k(p,{BUFFER_SIZE:4});e.exports=p;});
__d("SpotlightViewerImage",["React","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('cx'),i=g.createClass({displayName:'SpotlightViewerImage',render:function(){return (g.DOM.img({className:"_4-od",src:this.props.src,style:{width:this.props.dimensions.x,height:this.props.dimensions.y}}));}});e.exports=i;});
__d("SpotlightViewerCoreMixin",["PhotoLogger","PhotoStore","PhotoUtils","PhotoViewState","SpotlightViewerImage","SpotlightViewerLoggingEvents"],function(a,b,c,d,e,f){var g=b('PhotoLogger'),h=b('PhotoStore'),i=b('PhotoUtils'),j=b('PhotoViewState'),k=b('SpotlightViewerImage'),l=b('SpotlightViewerLoggingEvents'),m={_displayFirstPhoto:function(){h.executePostCreate(this.props.setid,this.viewState.displayFirst.bind(this.viewState));},_getInitialPosition:function(){var n;if(!this.props.clearcache)n=h.getIndexForID(this.props.setid,this.props.photoid);if(n===undefined){h.clearSetCache(this.props.setid);n=0;}return n;},componentWillMount:function(){this._logger=new g(this.getViewerID());this.log(l.OPEN_BEGIN);var n=this._getInitialPosition();this.viewState=new j(this,this.props.setid,n,this._updatePhoto,this.props.reverse);this.behaviors&&this.enableBehaviors(this.behaviors);this.inform('open');this._displayFirstPhoto();},componentDidMount:function(){this._enableSubscriptions&&this._enableSubscriptions();this.log(l.OPEN_COMPLETE);},isOpen:function(){return this.state.open;},close:function(){if(!this.isOpen())return;this.log(l.CLOSE_BEGIN);this.setState({open:false},function(){this.inform('close');this.log(l.CLOSE_COMPLETE);}.bind(this));},componentWillUnmount:function(){this.viewState.destroy();delete this.viewState;this._resizer.destroy();delete this._resizer;this._dimensions.destroy();delete this._dimensions;this._subscriptions.release();this.destroyBehaviors();},getDimensions:function(){return this._dimensions;},_onClickViewport:function(n){n?this.viewState.forward():this.viewState.backward();},_getMedia:function(n,o){return (k({ref:"image",src:n.uri,dimensions:o.imageDimensions}));},_getCurrentFBID:function(){return i.getFBIDFromData(this.state.photoData);},_updatePhoto:function(n){this.log(l.PHOTO_CHANGE_BEGIN);var o=function(){this.inform('photo_change',n);this.log(l.PHOTO_CHANGE_COMPLETE);}.bind(this);if(i.getFBIDFromData(n)==this._getCurrentFBID()){this.setState({photoData:n},o);}else this.setState({updatingPhoto:true,photoData:n},this.setState.bind(this,{updatingPhoto:false},o));},getLogger:function(){return this._logger;},log:function(n){this._logger&&this._logger.logEvent(n);}};e.exports=m;});
__d("SpotlightViewerPagers",["LeftRight.react","Link.react","React","cx"],function(a,b,c,d,e,f){var g=b('LeftRight.react'),h=b('Link.react'),i=b('React'),j=b('cx'),k=i.createClass({displayName:'SpotlightViewerPagers',render:function(){return (g(null,h({className:"_4-oa _4-ob _50-m"}),h({className:"_4-oa _4-oc _50-m"})));}});e.exports=k;});
__d("SpotlightViewerPageWithKeys",["KeyEventController","SubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('KeyEventController'),h=b('SubscriptionsHandler');function i(j){this.$SpotlightViewerPageWithKeys0=j;}i.prototype.enable=function(){this.$SpotlightViewerPageWithKeys1=new h();this.$SpotlightViewerPageWithKeys1.addSubscriptions(g.registerKey('LEFT',function(){this.$SpotlightViewerPageWithKeys0.viewState.backward();return false;}.bind(this)),g.registerKey('RIGHT',function(){this.$SpotlightViewerPageWithKeys0.viewState.forward();return false;}.bind(this)));};i.prototype.disable=function(){this.$SpotlightViewerPageWithKeys1.release();delete this.$SpotlightViewerPageWithKeys1;};e.exports=i;});
__d("SpotlightViewerStageResizer",["Event","SubscriptionsHandler","UserAgent","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('SubscriptionsHandler'),i=b('UserAgent'),j=b('Vector'),k=b('copyProperties');function l(){this._init();}l.prototype._init=function(){this._subscriptionsHandler=new h();this._subscriptionsHandler.addSubscriptions(g.listen(window,'resize',this._resetStageDimensions.bind(this)));this._resetStageDimensions();};l.prototype.destroy=function(){this._subscriptionsHandler.release();};l.prototype._resetStageDimensions=function(){this._currentStageDimensions=new j(this._minWidth,this._minHeight);};l.prototype.getImageAndStageDimensions=function(m,n){var o=m.getBestFitDimensionsFromPhoto(n,m.getMaxStageDimensions()),p=m.getStageDimensions(o);if(!this._currentStageDimensions)this._resetStageDimensions();this._currentStageDimensions=new j(Math.max(p.x,this._minWidth,this._currentStageDimensions.x),Math.max(p.y,this._minHeight,this._currentStageDimensions.y));var q=m.getImageDimensionsForStage(o,this._currentStageDimensions),r=this._currentStageDimensions.y-q.y;if(r>0&&r<this._padding)this._currentStageDimensions.y=q.y;var s=this._currentStageDimensions.x-q.x;if(s>0&&s<this._padding)this._currentStageDimensions.x-=s;if(i.ie()<8)q.x-=1;return {stageDimensions:this._currentStageDimensions,imageDimensions:q};};l.prototype.getCurrentStageDimensions=function(){return this._currentStageDimensions;};k(l.prototype,{_padding:40,_minHeight:520,_minWidth:520,_subscriptions:null,_currentStageDimensions:null});e.exports=l;});
__d("SpotlightViewerThumbnailMixin",["PhotoStore","Vector"],function(a,b,c,d,e,f){var g=b('PhotoStore'),h=b('Vector'),i={_getInitialPhotoData:function(){var j=g.getIndexForID(this.props.setid,this.props.photoid),k=g.getByIndexImmediate(this.props.setid,j);return k?k:this._getThumbnailPhotoData();},_getThumbnailPhotoData:function(){if(!this.props.dimensions||!this.props.thumbsrc)return null;var j={id:this.props.photoid};for(var k=0;k<this.props.dimensions.length;++k){var l=h.deserialize(this.props.dimensions[k]);j['image'+k]={width:l.x,height:l.y,uri:this.props.thumbsrc};}return j;}};e.exports=i;});
__d("SpotlightViewerUnmountOnClose",[],function(a,b,c,d,e,f){function g(h){this.$SpotlightViewerUnmountOnClose0=h;}g.prototype.enable=function(){this.$SpotlightViewerUnmountOnClose1=this.$SpotlightViewerUnmountOnClose0.subscribeOnce('close',this.$SpotlightViewerUnmountOnClose0.unmountComponent.bind(this.$SpotlightViewerUnmountOnClose0));};g.prototype.disable=function(){this.$SpotlightViewerUnmountOnClose1&&this.$SpotlightViewerUnmountOnClose1.unsubscribe();delete this.$SpotlightViewerUnmountOnClose1;};e.exports=g;});
__d("SpotlightViewport",["Locale","Parent","React","Vector","cx","joinClasses"],function(a,b,c,d,e,f){var g=b('Locale'),h=b('Parent'),i=b('React'),j=b('Vector'),k=b('cx'),l=b('joinClasses'),m=i.createClass({displayName:'SpotlightViewport',PAGE_TO_PREV_PERCENTAGE:.2,sections:{NONE:null,FORWARD:1,BACKWARD:2},getInitialState:function(){return {currentActiveSection:this.sections.NONE,active:true};},_onMouseMove:function(event){var n=j.getEventPosition(event.nativeEvent),o=j.getElementPosition(this.getDOMNode()),p,q=n.x-o.x,r=q/this.props.stageDimensions.x;if(g.isRTL()){p=r>(1-this.PAGE_TO_PREV_PERCENTAGE);}else p=r<this.PAGE_TO_PREV_PERCENTAGE;if(p){this.setState({currentActiveSection:this.sections.BACKWARD});}else this.setState({currentActiveSection:this.sections.FORWARD});},_onClick:function(event){var n=this.state.currentActiveSection==this.sections.FORWARD,o=event.nativeEvent.target;if(!h.byClass(o,"_51an"))this.props.onClick&&this.props.onClick(n);},_onMouseEnter:function(){this.setState({active:true});},_onMouseLeave:function(){this.setState({active:false});},render:function(){var n=(("_4-of")+(!this.state.active&&!this.props.active?' '+"_50-l":'')+(this.state.currentActiveSection===this.sections.BACKWARD?' '+"_516a":'')+(this.state.currentActiveSection===this.sections.FORWARD?' '+"_516b":'')+(this.props.showLoadingIndicator?' '+"_51jp":''));if(this.props.className)n=l(n,this.props.className);return (i.DOM.div({className:n,style:{width:this.props.stageDimensions&&this.props.stageDimensions.x,height:this.props.stageDimensions&&this.props.stageDimensions.y},onClick:this._onClick,onMouseMove:this._onMouseMove,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave},this.props.children,i.DOM.div({className:"_4-og"},i.DOM.span({className:"_4-oh"}),this.props.media,i.DOM.div({className:"_4-oi"}))));}});e.exports=m;});
__d("SpotlightMessagesViewer",["ArbiterMixin","BehaviorsMixin","Event","PhotoViewerDimensions","React","SpotlightViewer","SpotlightViewerCoreMixin","SpotlightViewerPagers","SpotlightViewerPageWithKeys","SpotlightViewerStageResizer","SpotlightViewerThumbnailMixin","SpotlightViewerUnmountOnClose","SpotlightViewport","SubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('BehaviorsMixin'),i=b('Event'),j=b('PhotoViewerDimensions'),k=b('React'),l=b('SpotlightViewer'),m=b('SpotlightViewerCoreMixin'),n=b('SpotlightViewerPagers'),o=b('SpotlightViewerPageWithKeys'),p=b('SpotlightViewerStageResizer'),q=b('SpotlightViewerThumbnailMixin'),r=b('SpotlightViewerUnmountOnClose'),s=b('SpotlightViewport'),t=b('SubscriptionsHandler'),u=k.createClass({displayName:'SpotlightMessagesViewer',mixins:[g,h,m,q],behaviors:[o,r],getViewerID:function(){return this.props.setid;},getInitialState:function(){this._dimensions=new j();this._subscriptions=new t();this._resizer=new p(this._dimensions);return {photoData:this._getInitialPhotoData(),open:true,maxStageDimensions:this._dimensions.getMaxStageDimensions(),updatingPhoto:false};},_enableSubscriptions:function(){this._subscriptions.addSubscriptions(i.listen(window,'resize',this._onResize));this.props.useloadingindicator&&this._subscriptions.addSubscriptions(this.viewState.subscribe('photo_fetch',this.setState.bind(this,{photoData:null},null)));},_onResize:function(){this.setState({maxStageDimensions:this._dimensions.getMaxStageDimensions()});},render:function(){var v,w,x,y=null;if(this.state.photoData){v=this._resizer.getImageAndStageDimensions(this._dimensions,this.state.photoData);w=this._dimensions.getBestFitImageFromPhoto(this.state.photoData,this.state.maxStageDimensions);x=v.stageDimensions;y=!this.state.updatingPhoto?this._getMedia(w,v):null;}else x=this._resizer.getCurrentStageDimensions();var z=this.props.useloadingindicator&&!this.state.photoData;return (l({open:this.state.open,onHide:this.close},s({onClick:this._onClickViewport,stageDimensions:x,media:y,showLoadingIndicator:z},this.props.disablepaging?null:n(null))));}});e.exports=u;});
__d("MessagesViewer",["DOM","React","SpotlightMessagesViewer","ge"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('React'),i=b('SpotlightMessagesViewer'),j=b('ge'),k={setID:'messages',bootstrap:function(l,m,n,o,p){var q=i({open:true,setid:k.setID,photoid:l,thumbsrc:n,dimensions:[m],disablepaging:o,reverse:p});k.render(q);},render:function(l){var m=j('messages_viewer');if(!m){m=g.create('div',{id:'messages_viewer'});document.body.appendChild(m);}h.renderComponent(l,m);l.subscribeOnce('close',function(){g.empty(m);});}};e.exports=k;});
__d("MercuryAttachmentRenderer",["MercuryAttachmentTemplates","MercuryAttachmentAudioClip.react","CSS","MercuryConstants","DOM","Event","JSXDOM","MercuryAttachment","MercuryAttachmentType","MercuryConfig","MercuryMessages","MercuryParticipants","MessagesViewer","React","Sticker.react","Style","URI","UserAgent","cx","tx"],function(a,b,c,d,e,f){var g=b('MercuryAttachmentTemplates'),h=b('MercuryAttachmentAudioClip.react'),i=b('CSS'),j=b('MercuryConstants'),k=b('DOM'),l=b('Event'),m=b('JSXDOM'),n=b('MercuryAttachment'),o=b('MercuryAttachmentType'),p=b('MercuryConfig'),q=b('MercuryMessages').get(),r=b('MercuryParticipants'),s=b('MessagesViewer'),t=b('React'),u=b('Sticker.react'),v=b('Style'),w=b('URI'),x=b('UserAgent'),y=b('cx'),z=b('tx'),aa=x.ie()<=8;function ba(ea,fa){var ga=g[fa].build().setNodeContent('filename',ea.name),ha=ga.getNode('link');ha.setAttribute('href',ea.url);ea.rel&&ha.setAttribute('rel',ea.rel);i.addClass(ga.getRoot(),n.getAttachIconClass(ea.icon_type));return ga;}function ca(ea,fa){var ga=g[fa].build().setNodeContent('filename',ea.name);i.addClass(ga.getRoot(),n.getAttachIconClass(ea.icon_type));return ga;}var da={renderAttachment:function(ea,fa,ga,ha,ia){var ja=100,ka=ea?160:400,la=null,ma=null,na=j.MercurySupportedShareType;if(this.isErrorAttachment(fa))la=da.renderError(fa);if(!ea&&this.isShareAttachment(fa)&&fa.share_xhp)ma=da.renderShareXHP(fa,ga.id);if(this.isStickerAttachment(fa))ma=da.renderSticker(fa,ga,ea);if(!ma&&this.isShareAttachment(fa)){var oa=fa.share_data_type;switch(oa){case na.FB_PHOTO:ma=da.renderPreview(fa,ga,ha,ia);break;case na.FB_VIDEO:ma=da.renderVideoThumb(fa);break;case na.FB_MUSIC_ALBUM:case na.FB_SONG:case na.FB_PLAYLIST:case na.FB_MUSICIAN:case na.FB_RADIO_STATION:ma=da.renderMusic(fa);break;case na.EXTERNAL:case na.FB_TEMPLATE:case na.FB_COUPON:case na.FB_SOCIAL_REPORT_PHOTO:ma=da.renderExternalLink(fa);break;default:if(fa.name)ma=da.renderShareLink(fa,ga&&ga.id,ea);break;}}if(!ma&&fa.preview_loading)ma=da.renderPreview(null);if(!ma&&fa.preview_url)ma=da.renderPreview(fa,ga,ha,ia);if(!ma&&this.isFileAttachment(fa))if(fa.metadata&&fa.metadata.type==j.MercuryAttachmentAudioClip){ma=k.create('div');var pa=da.renderAudioClip(fa,ga.message_id,ja,ka);t.renderComponent(pa,ma);}else ma=ea?da.renderFileLink(fa):da.renderExtendedFileLink(fa);return {error:la,content:ma,bubblePreferred:this.isBubblePreferred(fa)};},isBubblePreferred:function(ea){return !this.isStickerAttachment(ea);},renderError:function(ea){var fa=g[':fb:mercury:attachment:error'].build();k.appendContent(fa.getNode('error'),ea.error_msg);return fa.getRoot();},renderExternalLink:function(ea){var fa=g[':fb:mercury:attachment:external-link'].build().setNodeContent('name',ea.name);ea.base_url&&fa.setNodeContent('shortLink',ea.base_url);var ga=fa.getNode('preview'),ha=fa.getNode('image-link');ha.setAttribute('href',ea.url);ea.rel&&ha.setAttribute('rel',ea.rel);if(ea.preview_url){var ia=fa.getNode('preview-image');ia.setAttribute('src',ea.preview_url);i.addClass(ga,ea.preview_class);i.show(ia);}else{i.addClass(fa.getRoot(),'noMedia');i.hide(ga);}fa.getNode('name').setAttribute('href',ea.url);d(['LinkshimHandler'],function(ja){ja.setUpLinkshimHandling(fa.getNode('name'));ja.setUpLinkshimHandling(fa.getNode('image-link'));});if(ea.rel)fa.getNode('name').setAttribute('rel',ea.rel);return fa.getRoot();},renderFileLink:function(ea){var fa=null;if(ea.url===''){fa=':fb:mercury:attachment:file-name';return ca(ea,fa).getRoot();}else{fa=':fb:mercury:attachment:file-link';return ba(ea,fa).getRoot();}},renderAudioClip:function(ea,fa,ga,ha){var ia=ea.metadata.duration/1000,ja=200;if(ga&&ha)if(ia<5){ja=ga;}else ja=(1-Math.pow(10,(ia-5)/-30))*(ha-ga)+ga;return h({src:ea.url,duration:ea.metadata.duration/1000,showHelp:false,width:ja});},renderExtendedFileLink:function(ea){var fa=null;if(ea.url===''){fa=':fb:mercury:attachment:file-name';return ca(ea,fa).getRoot();}var fa=':fb:mercury:attachment:extended-file-link',ga=ba(ea,fa);if(ea.open_url){var ha=ga.getNode('openLinkContainer');i.show(ha);var ia=ga.getNode('openFile');ia.setAttribute('href',ea.open_url);}var ja=ga.getNode('downloadFile');ja.setAttribute('href',ea.url);ea.rel&&ja.setAttribute('rel',ea.rel);return ga.getRoot();},renderMusic:function(ea){var fa=g[':fb:mercury:attachment:music'].build().setNodeContent('filename',ea.name),ga=fa.getNode('link');ga.setAttribute('href',ea.url);ga.setAttribute('target','_blank');ea.rel&&ga.setAttribute('rel',ea.rel);var ha=fa.getNode('image-link');ha.setAttribute('href',ea.url);ea.rel&&ha.setAttribute('rel',ea.rel);var ia=fa.getNode('preview-image');ia.setAttribute('src',ea.preview_url);i.show(ia);i.addClass(fa.getNode('icon_link'),'MercuryMusicIcon');return fa.getRoot();},resizeContain:function(ea,fa){var ga=ea.width/ea.height,ha=fa.width/fa.height;if(ha<ga){return {width:Math.min(ea.height*ha,fa.width),height:Math.min(ea.height,fa.height)};}else return {width:Math.min(ea.width,fa.width),height:Math.min(ea.width/ha,fa.height)};},renderPreview:function(ea,fa,ga,ha){var ia=g[':fb:mercury:attachment:preview'].build(),ja=ia.getNode('image-link');if(ea){if(ea.url){var ka=new w(ea.url).getQueryData().uri;if(ka&&ea.rel==='async'){ja.setAttribute('href',ka);ja.setAttribute('ajaxify',ea.url);}else ja.setAttribute('href',ea.url);}ea.rel&&ja.setAttribute('rel',ea.rel);var la;if(ea.preview_uploading){i.addClass(ja,"_57jm");if(ga>=176){la='/images/photos/dots_large.png';}else if(ga>=86){la='/images/photos/dots_medium.png';}else la='/images/photos/dots_small.png';v.set(ja,'width',ga+'px');v.set(ja,'max-width',ga+'px');if(ea.preview_width&&ea.preview_height)v.set(ja,'padding-bottom',((ea.preview_height/ea.preview_width)*100)+'%');}else if(ea.metadata&&ea.metadata.fbid){la=w('/ajax/mercury/attachments/photo.php').addQueryData({fbid:ea.metadata.fbid,mode:ha,width:ga,height:ga}).toString();if(p.MessagesViewerReactGK)l.listen(ja,'click',s.bootstrap.curry(ea.metadata.fbid,ea.metadata.dimensions,la,fa.attachments.length==1,p.MessagesViewerViewAllInThreadGK));}else la=w(ea.preview_url).addQueryData({mode:ha,width:ga,height:ga}).toString();var ma=ia.getNode('preview-image');if(la){if(ha==='contain'&&ea.preview_width&&ea.preview_height){var na=da.resizeContain({width:ga,height:ga},{width:ea.preview_width,height:ea.preview_height});ma.setAttribute('width',na.width);ma.setAttribute('height',na.height);}if(ea.preview_uploading||(ha==='cover'&&!aa)){i.addClass(ja,"_55pj");v.set(ja,'backgroundImage','url('+la+')');}else{ma.onload=function(){ma.removeAttribute('width');ma.removeAttribute('height');};ma.setAttribute('src',la);}}if(fa)this.renderReportRespondLink(ia.getRoot(),ea,fa.message_id);}else i.addClass(ja,"_ksa");return ia.getRoot();},renderShareLink:function(ea,fa,ga){var ha=g[':fb:mercury:attachment:share-link'].build().setNodeContent('name',ea.name),ia=ha.getNode('link');ia.setAttribute('href',ea.url);ea.rel&&ia.setAttribute('rel',ea.rel);return ha.getRoot();},renderVideoThumb:function(ea){var fa=g[':fb:mercury:attachment:video-thumb'].build(),ga=fa.getNode('thumb');ga.setAttribute('href',ea.url);ga.setAttribute('rel',ea.rel);var ha=k.find(fa.getRoot(),'img');ha.src=ea.preview_url;return fa.getRoot();},renderShareXHP:function(ea,fa){var ga=k.create('div');if(ea){k.appendContent(ga,ea.share_xhp);this.renderReportRespondLink(ga,ea,fa);}return ga;},renderSticker:function(ea,fa,ga){var ha=ga?'chatScrolled/':'messengerScrolled/';ha+=fa.thread_id;var ia=k.create('div'),ja=u({animationTrigger:'click',className:'mvs',frameCount:ea.metadata.frameCount||1,frameRate:ea.metadata.frameRate||83,framesPerCol:ea.metadata.framesPerCol||1,framesPerRow:ea.metadata.framesPerRow||1,sourceHeight:ea.metadata.height,sourceURI:ea.url,sourceWidth:ea.metadata.width,spriteURI:ea.metadata.spriteURI,subscribedThreadID:ha});t.renderComponent(ja,ia);return ia;},renderReportRespondLink:function(ea,fa,ga){if(!fa.is_social_report_attachment)return null;switch(fa.share_data_type){case j.MercurySupportedShareType.FB_PHOTO:break;case j.MercurySupportedShareType.FB_SOCIAL_REPORT_PHOTO:return null;default:return null;}var ha=null;if(ga)ha=q.getMessagesFromIDs([ga])[0];if(!ha)return null;if(ha.author===r.user)return null;var ia=null;r.get(ha.author,function(ja){ia=k.create('a',{rel:'dialog-post',className:"_z6l",id:'respond-link',ajaxify:w('/ajax/report/social_resolution/post/').setQueryData({attachment_fbid:fa.attach_id,post_fbid:fa.shared_object_id,sender_id:r.getUserID(ja.id)}).toString()});k.setContent(ia,z._("Respond to {name}'s request",{name:ja.name}));k.appendContent(ea,ia);});},renderPhotoAttachments:function(ea,fa,ga,ha){var ia=ea.length;if(!ia)return null;var ja=m.div({className:"_55pk"}),ka=(m.div({className:"_55pl"},ja));if(ia===1){var la=da.renderPreview(ea[0],fa,ga,'contain');k.appendContent(ja,la);return ka;}var ma=(ia==2||ia==4)?2:3,na=(ga-(ma-1)*ha)/ma,oa=Math.ceil(ia/ma),pa=oa*na+(oa-1)*ha,qa=(m.div({className:"_55pm",style:'padding-bottom: '+(pa/ga*100)+'%;'}));k.appendContent(ja,qa);for(var ra=0;ra<ia;++ra){var sa=da.renderPreview(ea[ra],fa,na,'cover'),ta=ra%ma,ua=Math.floor(ra/ma);i.addClass(sa,"_55pn");v.apply(sa,{width:(na/ga*100)+'%',left:((ta*(na+ha))/ga*100)+'%',top:((ua*(na+ha))/pa*100)+'%'});k.appendContent(qa,sa);}return ka;},isPhotoAttachment:function(ea){return ea.attach_type==o.PHOTO||(ea.attach_type==o.FILE&&ea.preview_url);},isShareAttachment:function(ea){return ea.attach_type==o.SHARE;},isFileAttachment:function(ea){return ea.attach_type==o.FILE;},isErrorAttachment:function(ea){return ea.attach_type==o.ERROR;},isStickerAttachment:function(ea){return ea.attach_type==o.STICKER;},booleanLexicographicComparator:function(ea){return function(fa,ga){for(var ha=0;ha<ea.length;++ha){var ia=ea[ha](fa),ja=ea[ha](ga);if(ia&&!ja){return -1;}else if(!ia&&ja)return 1;}return 0;};}};e.exports=da;});
__d("MercuryMessageRenderer",["MercuryAttachmentRenderer","CSS","DOM","DOMEmoji","DOMEmote","DOMHyperlink","DOMQuery","FBIDEmote","JSXDOM","MercuryLogMessageType","MercuryParticipants","Tooltip","cx","transformTextToDOM","tx"],function(a,b,c,d,e,f){var g=b('MercuryAttachmentRenderer'),h=b('CSS'),i=b('DOM'),j=b('DOMEmoji'),k=b('DOMEmote'),l=b('DOMHyperlink'),m=b('DOMQuery'),n=b('FBIDEmote'),o=b('JSXDOM'),p=b('MercuryLogMessageType'),q=b('MercuryParticipants'),r=b('Tooltip'),s=b('cx'),t=b('transformTextToDOM'),u=b('tx'),v=["January","February","March","April","May","June","July","August","September","October","November","December"],w={renderDate:function(pa){var qa=new Date();qa.setHours(0);qa.setMinutes(0);qa.setSeconds(0);qa.setMilliseconds(0);var ra=24*60*60*1000,sa=qa.getTime()-pa.getTime();if(sa<=0){return "Today";}else if(sa<ra)return "Yesterday";var ta=v[pa.getMonth()],ua=pa.getDate(),va=pa.getFullYear();if(va!=qa.getFullYear()){return u._("{month} {date}, {year}",{month:ta,date:ua,year:va});}else return u._("{month} {date}",{month:ta,date:ua});},renderTooltipFlyout:function(pa,qa){qa.forEach(function(ra){var sa=i.create('div');i.setContent(sa,ra.name);i.appendContent(pa,sa);});},renderLogMessage:function(pa,qa,ra,sa){z(pa,sa);aa(qa,sa);ba(ra,sa);},formatMessageBody:function(pa,qa,ra){var sa=(pa||'').replace(/\s+$/,'');if(!qa)return y(sa,false,ra);var ta=Object.keys(qa).map(function(wa){return window.parseInt(wa);}).sort(function(wa,xa){return wa-xa;}),ua=[],va=0;ta.forEach(function(wa){var xa=sa.slice(va,wa);if(xa)ua.push(y(xa,false,ra));va=wa+qa[wa].length;var ya=sa.slice(wa,va);if(ya)ua.push(y(ya,true,ra));});if(va<sa.length)ua.push(y(sa.slice(va),false,ra));return ua.length===0?null:ua.length===1?ua[0]:i.create('span',{},ua);}};function x(pa,qa){var ra=pa.replace(/\r\n?/g,'\n').split(/\n{2,}/);return ra.filter(function(sa){return sa.length;}).map(function(sa){return o.p(null,qa(sa));});}function y(pa,qa,ra){if(pa.length===0&&!qa)return null;var sa=function(ta){return t(ta,[l.params(true),j,n,k]);};return (o.span({className:qa?'highlight':null},ra?x(pa,sa):sa(pa)));}function z(pa,qa){var ra='',sa;switch(qa.log_message_type){case p.JOINABLE_CREATED:case p.JOINABLE_JOINED:case p.SUBSCRIBE:ra='mercurySubscribeIcon';break;case p.UNSUBSCRIBE:ra='mercuryUnsubscribeIcon';break;case p.THREAD_NAME:ra='mercuryThreadNameIcon';break;case p.THREAD_IMAGE:ra='mercuryThreadImageIcon';break;case p.VIDEO_CALL:sa=qa.log_message_data.answered;if(sa||oa(qa)){ra='mercuryVideoCallIcon';}else ra='mercuryMissedVideoCallIcon';break;case p.PHONE_CALL:sa=qa.log_message_data.answered;if(sa){ra='mercuryPhoneCallIcon';}else ra='mercuryMissedPhoneCallIcon';break;case p.SERVER_ERROR:ra='mercuryErrorIcon';break;}h.addClass(pa,ra);}function aa(pa,qa){switch(qa.log_message_type){case p.JOINABLE_CREATED:ga(pa,qa);break;case p.JOINABLE_JOINED:ha(pa,qa);break;case p.SUBSCRIBE:la(pa,qa);break;case p.UNSUBSCRIBE:ma(pa,qa);break;case p.VIDEO_CALL:if(oa(qa)){ca(pa,qa);}else ea(pa,qa);break;case p.PHONE_CALL:da(pa,qa);break;case p.THREAD_NAME:fa(pa,qa);break;case p.THREAD_IMAGE:ia(pa,qa);break;case p.SERVER_ERROR:na(pa,qa);break;}}function ba(pa,qa){var ra=qa.log_message_type;if(ra==p.THREAD_IMAGE){var sa=qa.log_message_data.image;if(sa){var ta=g.renderPreview(sa.preview_url?sa:null);i.setContent(pa,ta);h.addClass(ta,"_z6a");h.show(pa);}}}var ca=function(pa,qa){q.get(qa.author,function(ra){var sa=i.create('span',{className:"_511e"},ra.short_name),ta;switch(qa.log_message_data.event_name){case 'installing':ta=i.tx._("{firstname} is setting up video calling...",{firstname:sa});break;case 'installed':ta=i.tx._("{firstname} finished setting up video calling.",{firstname:sa});break;case 'install_canceled':ta=i.tx._("You canceled the video calling installation. ",{firstname:sa});break;}if(ta)i.setContent(pa,ta);});},da=function(pa,qa){var ra=qa.log_message_data.caller,sa=qa.log_message_data.callee,ta=[ra,sa];q.getMulti(ta,function(ua){if(ra==q.user){var va=i.create('span',{className:"_511e"},ua[sa].short_name),wa;if(qa.log_message_data.answered){wa=i.tx._("You called {firstname}.",{firstname:va});}else wa=i.tx._("{firstname} missed a call from you. ",{firstname:va});}else{var xa=i.create('span',{className:"_511e"},ua[ra].short_name);if(qa.log_message_data.answered){wa=i.tx._("{firstname} called you.",{firstname:xa});}else wa=i.tx._("You missed a call from {firstname}. ",{firstname:xa});}i.setContent(pa,wa);});},ea=function(pa,qa){var ra=qa.log_message_data.caller,sa=qa.log_message_data.callee,ta=[ra,sa];q.getMulti(ta,function(ua){if(ra==q.user){var va=i.create('span',{className:"_511e"},ua[sa].short_name),wa;if(qa.log_message_data.answered){wa=i.tx._("You called {firstname}.",{firstname:va});}else wa=i.tx._("{firstname} missed a call from you. ",{firstname:va});}else{var xa=i.create('span',{className:"_511e"},ua[ra].short_name);if(qa.log_message_data.answered){wa=i.tx._("{firstname} called you.",{firstname:xa});}else wa=i.tx._("You missed a call from {firstname}. ",{firstname:xa});}i.setContent(pa,wa);});},fa=function(pa,qa){var ra=qa.log_message_data.name,sa=i.create('b',{},ra);if(qa.author==q.user){if(ra){i.setContent(pa,i.tx._("You named the conversation: {name}.",{name:sa}));}else i.setContent(pa,i.tx._("You removed the conversation name."));}else q.get(qa.author,function(ta){var ua,va=ja(ta);if(ra){ua=i.tx._("{actor} named the conversation: {name}.",{actor:va,name:sa});}else ua=i.tx._("{actor} removed the conversation name.",{actor:va});i.setContent(pa,ua);});},ga=function(pa,qa){if(qa.author==q.user){i.setContent(pa,i.tx._("Other people can join this chat from News Feed and add their friends."));}else q.get(qa.author,function(ra){var sa=ja(ra);i.setContent(pa,i.tx._("{actor} shared this chat to News Feed. Other people can join and add their friends.",{actor:sa}));});},ha=function(pa,qa){var ra=qa.log_message_data.joined_participant;if(ra==q.user){i.setContent(pa,i.tx._("You joined the chat. Other people can join from News Feed and add their friends."));}else q.get(ra,function(sa){var ta=ja(sa);i.setContent(pa,i.tx._("{actor} joined the chat.",{actor:ta}));});},ia=function(pa,qa){if(qa.author==q.user){if(qa.log_message_data.image){i.setContent(pa,i.tx._("You changed the conversation picture."));}else i.setContent(pa,i.tx._("You removed the conversation picture."));}else q.get(qa.author,function(ra){var sa=ja(ra),ta;if(qa.log_message_data.image){ta=i.tx._("{actor} changed the conversation picture.",{actor:sa});}else ta=i.tx._("{actor} removed the conversation picture.",{actor:sa});i.setContent(pa,ta);});},ja=function(pa){if(pa.href)return i.create('a',{href:pa.href,className:"_511e"},pa.name);return pa.name;},ka=function(pa){var qa=pa.indexOf(q.user);if(qa>0)return pa.splice(qa,1).concat(pa);return pa;},la=function(pa,qa){var ra=ka(qa.log_message_data.added_participants),sa=null,ta;if(ra.length==1){sa=[qa.author,ra[0]];q.getMulti(sa,function(ua){if(qa.author==q.user){ta=i.tx._("You added {subscriber1}.",{subscriber1:ja(ua[ra[0]])});}else if(ra[0]==q.user){ta=i.tx._("{actor} added you.",{actor:ja(ua[qa.author])});}else ta=i.tx._("{actor} added {subscriber1}.",{actor:ja(ua[qa.author]),subscriber1:ja(ua[ra[0]])});i.setContent(pa,ta);});}else if(ra.length==2){sa=[qa.author].concat(ra);q.getMulti(sa,function(ua){if(qa.author==q.user){ta=i.tx._("You added {subscriber1} and {subscriber2}.",{subscriber1:ja(ua[ra[0]]),subscriber2:ja(ua[ra[1]])});}else if(ra[0]==q.user){ta=i.tx._("{actor} added you and {subscriber2}.",{actor:ja(ua[qa.author]),subscriber2:ja(ua[ra[1]])});}else ta=i.tx._("{actor} added {subscriber1} and {subscriber2}.",{actor:ja(ua[qa.author]),subscriber1:ja(ua[ra[0]]),subscriber2:ja(ua[ra[1]])});i.setContent(pa,ta);});}else if(ra.length==3){sa=[qa.author].concat(ra);q.getMulti(sa,function(ua){if(qa.author==q.user){ta=i.tx._("You added {subscriber1}, {subscriber2} and {subscriber3}.",{subscriber1:ja(ua[ra[0]]),subscriber2:ja(ua[ra[1]]),subscriber3:ja(ua[ra[2]])});}else if(ra[0]==q.user){ta=i.tx._("{actor} added you, {subscriber2} and {subscriber3}.",{actor:ja(ua[qa.author]),subscriber2:ja(ua[ra[1]]),subscriber3:ja(ua[ra[2]])});}else ta=i.tx._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",{actor:ja(ua[qa.author]),subscriber1:ja(ua[ra[0]]),subscriber2:ja(ua[ra[1]]),subscriber3:ja(ua[ra[2]])});i.setContent(pa,ta);});}else{sa=[qa.author].concat(ra);q.getMulti(sa,function(ua){var va=i.tx._("{num} more",{num:ra.length-2}),wa=i.create('span',{className:'more'},va),xa=i.create('div');w.renderTooltipFlyout(xa,ra.slice(2).map(function(za){return ua[za];}));if(qa.author==q.user){ta=i.tx._("You added {subscriber1}, {subscriber2} and {more_people}.",{subscriber1:ja(ua[ra[0]]),subscriber2:ja(ua[ra[1]]),more_people:wa});}else if(ra[0]==q.user){ta=i.tx._("{actor} added you, {subscriber2} and {more_people}.",{actor:ja(ua[qa.author]),subscriber2:ja(ua[ra[1]]),more_people:wa});}else ta=i.tx._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",{actor:ja(ua[qa.author]),subscriber1:ja(ua[ra[0]]),subscriber2:ja(ua[ra[1]]),more_people:wa});i.setContent(pa,ta);var ya=m.find(pa,'span.more');r.set(ya,xa,'above','center');});}},ma=function(pa,qa){q.get(qa.author,function(ra){var sa;if(qa.author==q.user){sa=i.tx._("You left the conversation.");}else sa=i.tx._("{actor} left the conversation.",{actor:ja(ra)});i.setContent(pa,sa);});},na=function(pa,qa){var ra="We were unable to fetch previous messages in this conversation.";i.setContent(pa,ra);},oa=function(pa){return pa.log_message_data.event_name==='installing'||pa.log_message_data.event_name==='install_canceled';};e.exports=w;});
__d("MercurySheetPolicy",[],function(a,b,c,d,e,f){var g={canReplaceOpenSheet:function(h,i){if(h.getType()==i.getType())return false;if(h.isPermanent()&&!i.isPermanent())return false;return true;}};e.exports=g;});
__d("MercurySheetView",["Animation","ArbiterMixin","MercurySheetPolicy","CSS","DOM","Style","MercurySheetTemplates","Vector","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('ArbiterMixin'),i=b('MercurySheetPolicy'),j=b('CSS'),k=b('DOM'),l=b('Style'),m=b('MercurySheetTemplates'),n=b('Vector'),o=b('copyProperties'),p=b('cx'),q=5000,r=function(s,t,u){this._threadID=s;this._rootElement=t;this._tabMainElement=u;this._openSheet=null;};o(r.prototype,h,{destroy:function(){k.empty(this._rootElement);},_openCommon:function(s,t){if(this._openSheet&&!i.canReplaceOpenSheet(this._openSheet,s)){if(s.couldNotReplace)s.couldNotReplace();return;}this.clear(function(){this._openSheet=s;var u=m[':fb:mercury:tab-sheet:loading'].build().getRoot();k.setContent(this._rootElement,u);j.show(u);j.show(this._rootElement);s.render();if(t){j.addClass(this._tabMainElement,'sheetSlide');j.addClass(this._tabMainElement,"_1sk4");var v=n.getElementDimensions(this._rootElement).y;l.set(this._rootElement,'bottom',v+'px');this.resize();this._animation=new g(this._rootElement).to('bottom',0).duration(150).ease(g.ease.both).ondone(function(){j.removeClass(this._tabMainElement,'sheetSlide');j.removeClass(this._tabMainElement,"_1sk4");this.resize();}.bind(this)).go();}else this.resize();if(!s.isPermanent()){var w=q;if(s.getCloseTimeout)w=s.getCloseTimeout();var x=this.getAutoCloseCallback(s);this._sheetCloseHandler=this.close.bind(this,s,x).defer(w,false);if(s.timeoutCanBeReset)s.setResetTimeoutCallback(this.resetTimeout.bind(this));}}.bind(this));},getAutoCloseCallback:function(s){if(!s.autoCloseCallback)return null;return s.autoCloseCallback.bind(s);},resetTimeout:function(s,t){clearTimeout(this._sheetCloseHandler);var u=this.getAutoCloseCallback(s);this._sheetCloseHandler=this.close.bind(this,s,u).defer(t,false);},set:function(s){return this._openCommon(s,false);},open:function(s){return this._openCommon(s,true);},close:function(s,t){if(this._openSheet!=s)return;if(!this._openSheet){t&&t();return;}if(this._animation)this._animation.stop();if(this._sheetCloseHandler){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=null;}j.addClass(this._tabMainElement,'sheetSlide');j.addClass(this._tabMainElement,"_1sk4");var u=n.getElementDimensions(this._rootElement).y;this.resize();this._animation=new g(this._rootElement).to('bottom',u+'px').duration(100).ease(g.ease.begin).ondone(function(){k.empty(this._rootElement);j.hide(this._rootElement);j.removeClass(this._tabMainElement,'sheetSlide');j.removeClass(this._tabMainElement,"_1sk4");this._openSheet=null;this.resize();t&&t();}.bind(this)).go();},clear:function(s){this.close(this._openSheet,s);},resize:function(){this.inform('resize');}});e.exports=r;});
__d("MercuryStickersData",["Arbiter","MercuryStickersInitialData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('MercuryStickersInitialData'),i=h.packs,j={getPacks:function(){return i;},updatePackData:function(k){i=k.packs;g.inform('MercuryStickers/updatedPacks');}};e.exports=j;});
__d("MercuryStickers.react",["Arbiter","BanzaiLogger","MercuryStickerPackFlyout.react","MercuryStickersData","MercuryStickersFlyoutList.react","MessagesEmoticons.react","Parent","React","ReactPropTypes","SubscriptionsHandler","Toggler","cx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('BanzaiLogger'),i=b('MercuryStickerPackFlyout.react'),j=b('MercuryStickersData'),k=b('MercuryStickersFlyoutList.react'),l=b('MessagesEmoticons.react'),m=b('Parent'),n=b('React'),o=b('ReactPropTypes'),p=b('SubscriptionsHandler'),q=b('Toggler'),r=b('cx'),s=n.createClass({displayName:'MercuryStickers',propTypes:{onStickerSelect:o.func.isRequired},getInitialState:function(){return {currentPackID:j.getPacks()[0].id,showFlyout:false};},componentDidMount:function(){var t=m.byClass(this.getDOMNode(),'uiToggle');if(t){q.listen('show',t,function(){h.log('MercuryStickersLoggerConfig',{event:'open_tray'});this.setState({showFlyout:true});}.bind(this));}else this.setState({showFlyout:true});this.subscriptions=new p();this.subscriptions.addSubscriptions(g.subscribe('MercuryStickers/updatedPacks',this.forceUpdate.bind(this,null)));},componentWillUnmount:function(){this.subscriptions.release();},selectPack:function(t){this.setState({currentPackID:t});},loadPack:function(){if(this.state.currentPackID==='emoticons')return (n.DOM.div({className:"_55bq",'data-id':this.state.currentPackID},l(null)));h.log('MercuryStickersLoggerConfig',{event:'select_pack',packid:this.state.currentPackID});return (n.DOM.div({className:"_55bq",'data-id':this.state.currentPackID},i({packID:this.state.currentPackID})));},selectedSticker:function(event){var t=m.byClass(event.target,"_55bp");if(t){this.props.onStickerSelect(t.getAttribute('data-id'));var u=m.byClass(this.getDOMNode(),'uiToggle');u&&q.hide(u);}},render:function(){if(!this.state.showFlyout)return n.DOM.div(null);return (n.DOM.div(null,n.DOM.div({className:"_5906"},k({onPackClick:this.selectPack,packs:j.getPacks()})),n.DOM.div({className:"_5907",onClick:this.selectedSticker},this.loadPack())));}});e.exports=s;});
__d("MercuryTypeahead",["Event","ArbiterMixin","DOM","DOMDimensions","Input","Keys","MercuryTypeaheadTemplates","Tokenizer","Typeahead","TypeaheadCore","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('DOM'),j=b('DOMDimensions'),k=b('Input'),l=b('Keys'),m=b('MercuryTypeaheadTemplates'),n=b('Tokenizer'),o=b('Typeahead'),p=b('TypeaheadCore'),q=b('copyProperties'),r=b('cx'),s=function(t,u){this._domElement=null;this._typeahead=null;this._tokenizer=null;this._placeholder='';this._exclusions=[];this._viewNodeOrID=null;this._viewOptions={renderer:'compact',autoSelect:true};this._tokenizerBehaviors=[];this._heightPrev=null;this._dataSource=t;this._view=u;};q(s.prototype,h);q(s.prototype,{setPlaceholder:function(t){this._placeholder=t;return this;},setExcludedParticipants:function(t){this._exclusions=[];t.forEach(function(u){var v=u.indexOf(':');if(u.substr(0,v)=='fbid')this._exclusions.push(u.substr(v+1));}.bind(this));return this;},setViewNodeID:function(t){this._viewNodeOrID=t;},setViewNode:function(t){this._viewNodeOrID=t;},setFullWidthView:function(t){var u=i.create('div',{className:"_4ck uiTypeaheadView"});i.setContent(t,u);this.setViewNode(u);},setViewOption:function(t,u){this._viewOptions[t]=u;},addTokenizerBehavior:function(t){this._tokenizerBehaviors.push(t);},build:function(t){if(this._domElement)return;var u=m[':fb:mercury:tokenizer'].build(),v=m[':fb:mercury:typeahead'].build();this._domElement=u.getRoot();i.appendContent(this._domElement,v.getRoot());var w=v.getNode('textfield');k.setPlaceholder(w,this._placeholder);w.setAttribute('data-placeholder',this._placeholder);this._input=w;var x={node_id:this._viewNodeOrID,ctor:this._view,options:this._viewOptions},y={ctor:p,options:{setValueOnSelect:true}};this._typeahead=new o(this._dataSource,x,y,v.getRoot());this._typeahead.init();var z={inline:true,behaviors:this._tokenizerBehaviors};this._tokenizer=new n(this._domElement,this._typeahead);this._tokenizer.init(u.getNode('tokenarea'),'participants',[],z);this._tokenizer.subscribe(['addToken','removeToken','removeAllTokens'],this._tokensChanged.bind(this));this._tokenizer.subscribe('resize',function(){this.inform('resize');}.bind(this));g.listen(w,'focus',function(){this._resetDataSource();this._typeahead.init();}.bind(this));g.listen(this._domElement,'click',this.focus.bind(this));g.listen(w,'keydown',this.keydown.bind(this));this._heightPrev=j.getElementDimensions(this._domElement).height;},getElement:function(){return this._domElement;},getSelectedParticipantIDs:function(){var t=[];if(this._tokenizer)(this._tokenizer.getTokenValues()||[]).forEach(function(u){t.push('fbid:'+u);});return t;},getTokens:function(){var t=[];if(this._tokenizer)t=this._tokenizer.getTokens();return t;},getTokenizer:function(){return this._tokenizer;},keydown:function(event){if(this._tokenizer.inline&&event.keyCode==l.ESC){if(k.isEmpty(this._input)){var t=this._tokenizer.getLastToken();if(t&&t.isRemovable())this._tokenizer.removeToken(t);}else this._typeahead.getCore().reset();return false;}if(k.isEmpty(this._input)&&this._tokenizer.inline&&event.keyCode===l.RETURN)return this.inform('tokens-return');},reset:function(){this._tokenizer&&this._tokenizer.removeAllTokens();this._typeahead&&this._typeahead.getCore().reset();},focus:function(){this._tokenizer&&this._tokenizer.focusInput();},getTypeahead:function(){return this._typeahead;},_resetDataSource:function(){this._dataSource.setExclusions(this._exclusions);},_tokensChanged:function(){this.inform('tokens-changed');}});e.exports=s;});
__d("FileFormResetOnSubmit",["DOMQuery"],function(a,b,c,d,e,f){var g=b('DOMQuery');function h(i){this._form=i;}h.prototype.enable=function(){this._subscription=this._form.subscribe('submit',Function.prototype.defer.bind(this._reset.bind(this)));};h.prototype.disable=function(){this._subscription.unsubscribe();this._subscription=null;};h.prototype._reset=function(){var i=g.scry(this._form.getRoot(),'input[type="file"]');i.forEach(function(j){j.value='';});};e.exports=h;});
__d("PhotosUploadID",[],function(a,b,c,d,e,f){var g=1024,h={getNewID:function(){return g++;}};e.exports=h;});
__d("legacy:CompactTypeaheadRenderer",["CompactTypeaheadRenderer"],function(a,b,c,d){if(!a.TypeaheadRenderers)a.TypeaheadRenderers={};a.TypeaheadRenderers.compact=b('CompactTypeaheadRenderer');},3);